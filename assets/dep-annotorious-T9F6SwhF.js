function m1(r,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const n in i)if(n!=="default"&&!(n in r)){const s=Object.getOwnPropertyDescriptor(i,n);s&&Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:()=>i[n]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var _D=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wp(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function xD(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var n=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return r[i]}})}),t}var kd={exports:{}},Da={},Ud={exports:{}},$e={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nv;function g1(){if(nv)return $e;nv=1;var r=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;function m(N){return N===null||typeof N!="object"?null:(N=p&&N[p]||N["@@iterator"],typeof N=="function"?N:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,_={};function T(N,W,re){this.props=N,this.context=W,this.refs=_,this.updater=re||y}T.prototype.isReactComponent={},T.prototype.setState=function(N,W){if(typeof N!="object"&&typeof N!="function"&&N!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,N,W,"setState")},T.prototype.forceUpdate=function(N){this.updater.enqueueForceUpdate(this,N,"forceUpdate")};function E(){}E.prototype=T.prototype;function S(N,W,re){this.props=N,this.context=W,this.refs=_,this.updater=re||y}var A=S.prototype=new E;A.constructor=S,v(A,T.prototype),A.isPureReactComponent=!0;var P=Array.isArray,D=Object.prototype.hasOwnProperty,k={current:null},U={key:!0,ref:!0,__self:!0,__source:!0};function j(N,W,re){var _e,me={},Pe=null,Ue=null;if(W!=null)for(_e in W.ref!==void 0&&(Ue=W.ref),W.key!==void 0&&(Pe=""+W.key),W)D.call(W,_e)&&!U.hasOwnProperty(_e)&&(me[_e]=W[_e]);var Te=arguments.length-2;if(Te===1)me.children=re;else if(1<Te){for(var ge=Array(Te),Ke=0;Ke<Te;Ke++)ge[Ke]=arguments[Ke+2];me.children=ge}if(N&&N.defaultProps)for(_e in Te=N.defaultProps,Te)me[_e]===void 0&&(me[_e]=Te[_e]);return{$$typeof:r,type:N,key:Pe,ref:Ue,props:me,_owner:k.current}}function q(N,W){return{$$typeof:r,type:N.type,key:W,ref:N.ref,props:N.props,_owner:N._owner}}function ee(N){return typeof N=="object"&&N!==null&&N.$$typeof===r}function pe(N){var W={"=":"=0",":":"=2"};return"$"+N.replace(/[=:]/g,function(re){return W[re]})}var H=/\/+/g;function F(N,W){return typeof N=="object"&&N!==null&&N.key!=null?pe(""+N.key):W.toString(36)}function G(N,W,re,_e,me){var Pe=typeof N;(Pe==="undefined"||Pe==="boolean")&&(N=null);var Ue=!1;if(N===null)Ue=!0;else switch(Pe){case"string":case"number":Ue=!0;break;case"object":switch(N.$$typeof){case r:case e:Ue=!0}}if(Ue)return Ue=N,me=me(Ue),N=_e===""?"."+F(Ue,0):_e,P(me)?(re="",N!=null&&(re=N.replace(H,"$&/")+"/"),G(me,W,re,"",function(Ke){return Ke})):me!=null&&(ee(me)&&(me=q(me,re+(!me.key||Ue&&Ue.key===me.key?"":(""+me.key).replace(H,"$&/")+"/")+N)),W.push(me)),1;if(Ue=0,_e=_e===""?".":_e+":",P(N))for(var Te=0;Te<N.length;Te++){Pe=N[Te];var ge=_e+F(Pe,Te);Ue+=G(Pe,W,re,ge,me)}else if(ge=m(N),typeof ge=="function")for(N=ge.call(N),Te=0;!(Pe=N.next()).done;)Pe=Pe.value,ge=_e+F(Pe,Te++),Ue+=G(Pe,W,re,ge,me);else if(Pe==="object")throw W=String(N),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(N).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.");return Ue}function $(N,W,re){if(N==null)return N;var _e=[],me=0;return G(N,_e,"","",function(Pe){return W.call(re,Pe,me++)}),_e}function le(N){if(N._status===-1){var W=N._result;W=W(),W.then(function(re){(N._status===0||N._status===-1)&&(N._status=1,N._result=re)},function(re){(N._status===0||N._status===-1)&&(N._status=2,N._result=re)}),N._status===-1&&(N._status=0,N._result=W)}if(N._status===1)return N._result.default;throw N._result}var ie={current:null},Y={transition:null},de={ReactCurrentDispatcher:ie,ReactCurrentBatchConfig:Y,ReactCurrentOwner:k};function z(){throw Error("act(...) is not supported in production builds of React.")}return $e.Children={map:$,forEach:function(N,W,re){$(N,function(){W.apply(this,arguments)},re)},count:function(N){var W=0;return $(N,function(){W++}),W},toArray:function(N){return $(N,function(W){return W})||[]},only:function(N){if(!ee(N))throw Error("React.Children.only expected to receive a single React element child.");return N}},$e.Component=T,$e.Fragment=t,$e.Profiler=n,$e.PureComponent=S,$e.StrictMode=i,$e.Suspense=u,$e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=de,$e.act=z,$e.cloneElement=function(N,W,re){if(N==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+N+".");var _e=v({},N.props),me=N.key,Pe=N.ref,Ue=N._owner;if(W!=null){if(W.ref!==void 0&&(Pe=W.ref,Ue=k.current),W.key!==void 0&&(me=""+W.key),N.type&&N.type.defaultProps)var Te=N.type.defaultProps;for(ge in W)D.call(W,ge)&&!U.hasOwnProperty(ge)&&(_e[ge]=W[ge]===void 0&&Te!==void 0?Te[ge]:W[ge])}var ge=arguments.length-2;if(ge===1)_e.children=re;else if(1<ge){Te=Array(ge);for(var Ke=0;Ke<ge;Ke++)Te[Ke]=arguments[Ke+2];_e.children=Te}return{$$typeof:r,type:N.type,key:me,ref:Pe,props:_e,_owner:Ue}},$e.createContext=function(N){return N={$$typeof:o,_currentValue:N,_currentValue2:N,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},N.Provider={$$typeof:s,_context:N},N.Consumer=N},$e.createElement=j,$e.createFactory=function(N){var W=j.bind(null,N);return W.type=N,W},$e.createRef=function(){return{current:null}},$e.forwardRef=function(N){return{$$typeof:l,render:N}},$e.isValidElement=ee,$e.lazy=function(N){return{$$typeof:d,_payload:{_status:-1,_result:N},_init:le}},$e.memo=function(N,W){return{$$typeof:c,type:N,compare:W===void 0?null:W}},$e.startTransition=function(N){var W=Y.transition;Y.transition={};try{N()}finally{Y.transition=W}},$e.unstable_act=z,$e.useCallback=function(N,W){return ie.current.useCallback(N,W)},$e.useContext=function(N){return ie.current.useContext(N)},$e.useDebugValue=function(){},$e.useDeferredValue=function(N){return ie.current.useDeferredValue(N)},$e.useEffect=function(N,W){return ie.current.useEffect(N,W)},$e.useId=function(){return ie.current.useId()},$e.useImperativeHandle=function(N,W,re){return ie.current.useImperativeHandle(N,W,re)},$e.useInsertionEffect=function(N,W){return ie.current.useInsertionEffect(N,W)},$e.useLayoutEffect=function(N,W){return ie.current.useLayoutEffect(N,W)},$e.useMemo=function(N,W){return ie.current.useMemo(N,W)},$e.useReducer=function(N,W,re){return ie.current.useReducer(N,W,re)},$e.useRef=function(N){return ie.current.useRef(N)},$e.useState=function(N){return ie.current.useState(N)},$e.useSyncExternalStore=function(N,W,re){return ie.current.useSyncExternalStore(N,W,re)},$e.useTransition=function(){return ie.current.useTransition()},$e.version="18.3.1",$e}var sv;function Yp(){return sv||(sv=1,Ud.exports=g1()),Ud.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ov;function y1(){if(ov)return Da;ov=1;var r=Yp(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,n=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(l,u,c){var d,p={},m=null,y=null;c!==void 0&&(m=""+c),u.key!==void 0&&(m=""+u.key),u.ref!==void 0&&(y=u.ref);for(d in u)i.call(u,d)&&!s.hasOwnProperty(d)&&(p[d]=u[d]);if(l&&l.defaultProps)for(d in u=l.defaultProps,u)p[d]===void 0&&(p[d]=u[d]);return{$$typeof:e,type:l,key:m,ref:y,props:p,_owner:n.current}}return Da.Fragment=t,Da.jsx=o,Da.jsxs=o,Da}var av;function v1(){return av||(av=1,kd.exports=y1()),kd.exports}var qp=v1(),Hd={exports:{}},Fi={},zd={exports:{}},Gd={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lv;function _1(){return lv||(lv=1,function(r){function e(Y,de){var z=Y.length;Y.push(de);e:for(;0<z;){var N=z-1>>>1,W=Y[N];if(0<n(W,de))Y[N]=de,Y[z]=W,z=N;else break e}}function t(Y){return Y.length===0?null:Y[0]}function i(Y){if(Y.length===0)return null;var de=Y[0],z=Y.pop();if(z!==de){Y[0]=z;e:for(var N=0,W=Y.length,re=W>>>1;N<re;){var _e=2*(N+1)-1,me=Y[_e],Pe=_e+1,Ue=Y[Pe];if(0>n(me,z))Pe<W&&0>n(Ue,me)?(Y[N]=Ue,Y[Pe]=z,N=Pe):(Y[N]=me,Y[_e]=z,N=_e);else if(Pe<W&&0>n(Ue,z))Y[N]=Ue,Y[Pe]=z,N=Pe;else break e}}return de}function n(Y,de){var z=Y.sortIndex-de.sortIndex;return z!==0?z:Y.id-de.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();r.unstable_now=function(){return o.now()-l}}var u=[],c=[],d=1,p=null,m=3,y=!1,v=!1,_=!1,T=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function A(Y){for(var de=t(c);de!==null;){if(de.callback===null)i(c);else if(de.startTime<=Y)i(c),de.sortIndex=de.expirationTime,e(u,de);else break;de=t(c)}}function P(Y){if(_=!1,A(Y),!v)if(t(u)!==null)v=!0,le(D);else{var de=t(c);de!==null&&ie(P,de.startTime-Y)}}function D(Y,de){v=!1,_&&(_=!1,E(j),j=-1),y=!0;var z=m;try{for(A(de),p=t(u);p!==null&&(!(p.expirationTime>de)||Y&&!pe());){var N=p.callback;if(typeof N=="function"){p.callback=null,m=p.priorityLevel;var W=N(p.expirationTime<=de);de=r.unstable_now(),typeof W=="function"?p.callback=W:p===t(u)&&i(u),A(de)}else i(u);p=t(u)}if(p!==null)var re=!0;else{var _e=t(c);_e!==null&&ie(P,_e.startTime-de),re=!1}return re}finally{p=null,m=z,y=!1}}var k=!1,U=null,j=-1,q=5,ee=-1;function pe(){return!(r.unstable_now()-ee<q)}function H(){if(U!==null){var Y=r.unstable_now();ee=Y;var de=!0;try{de=U(!0,Y)}finally{de?F():(k=!1,U=null)}}else k=!1}var F;if(typeof S=="function")F=function(){S(H)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,$=G.port2;G.port1.onmessage=H,F=function(){$.postMessage(null)}}else F=function(){T(H,0)};function le(Y){U=Y,k||(k=!0,F())}function ie(Y,de){j=T(function(){Y(r.unstable_now())},de)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Y){Y.callback=null},r.unstable_continueExecution=function(){v||y||(v=!0,le(D))},r.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<Y?Math.floor(1e3/Y):5},r.unstable_getCurrentPriorityLevel=function(){return m},r.unstable_getFirstCallbackNode=function(){return t(u)},r.unstable_next=function(Y){switch(m){case 1:case 2:case 3:var de=3;break;default:de=m}var z=m;m=de;try{return Y()}finally{m=z}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Y,de){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var z=m;m=Y;try{return de()}finally{m=z}},r.unstable_scheduleCallback=function(Y,de,z){var N=r.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?N+z:N):z=N,Y){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=z+W,Y={id:d++,callback:de,priorityLevel:Y,startTime:z,expirationTime:W,sortIndex:-1},z>N?(Y.sortIndex=z,e(c,Y),t(u)===null&&Y===t(c)&&(_?(E(j),j=-1):_=!0,ie(P,z-N))):(Y.sortIndex=W,e(u,Y),v||y||(v=!0,le(D))),Y},r.unstable_shouldYield=pe,r.unstable_wrapCallback=function(Y){var de=m;return function(){var z=m;m=de;try{return Y.apply(this,arguments)}finally{m=z}}}}(Gd)),Gd}var uv;function x1(){return uv||(uv=1,zd.exports=_1()),zd.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hv;function T1(){if(hv)return Fi;hv=1;var r=Yp(),e=x1();function t(a){for(var h="https://reactjs.org/docs/error-decoder.html?invariant="+a,f=1;f<arguments.length;f++)h+="&args[]="+encodeURIComponent(arguments[f]);return"Minified React error #"+a+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,n={};function s(a,h){o(a,h),o(a+"Capture",h)}function o(a,h){for(n[a]=h,a=0;a<h.length;a++)i.add(h[a])}var l=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},p={};function m(a){return u.call(p,a)?!0:u.call(d,a)?!1:c.test(a)?p[a]=!0:(d[a]=!0,!1)}function y(a,h,f,g){if(f!==null&&f.type===0)return!1;switch(typeof h){case"function":case"symbol":return!0;case"boolean":return g?!1:f!==null?!f.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function v(a,h,f,g){if(h===null||typeof h>"u"||y(a,h,f,g))return!0;if(g)return!1;if(f!==null)switch(f.type){case 3:return!h;case 4:return h===!1;case 5:return isNaN(h);case 6:return isNaN(h)||1>h}return!1}function _(a,h,f,g,x,w,O){this.acceptsBooleans=h===2||h===3||h===4,this.attributeName=g,this.attributeNamespace=x,this.mustUseProperty=f,this.propertyName=a,this.type=h,this.sanitizeURL=w,this.removeEmptyString=O}var T={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){T[a]=new _(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var h=a[0];T[h]=new _(h,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){T[a]=new _(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){T[a]=new _(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){T[a]=new _(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){T[a]=new _(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){T[a]=new _(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){T[a]=new _(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){T[a]=new _(a,5,!1,a.toLowerCase(),null,!1,!1)});var E=/[\-:]([a-z])/g;function S(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var h=a.replace(E,S);T[h]=new _(h,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var h=a.replace(E,S);T[h]=new _(h,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var h=a.replace(E,S);T[h]=new _(h,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){T[a]=new _(a,1,!1,a.toLowerCase(),null,!1,!1)}),T.xlinkHref=new _("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){T[a]=new _(a,1,!1,a.toLowerCase(),null,!0,!0)});function A(a,h,f,g){var x=T.hasOwnProperty(h)?T[h]:null;(x!==null?x.type!==0:g||!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(v(h,f,x,g)&&(f=null),g||x===null?m(h)&&(f===null?a.removeAttribute(h):a.setAttribute(h,""+f)):x.mustUseProperty?a[x.propertyName]=f===null?x.type===3?!1:"":f:(h=x.attributeName,g=x.attributeNamespace,f===null?a.removeAttribute(h):(x=x.type,f=x===3||x===4&&f===!0?"":""+f,g?a.setAttributeNS(g,h,f):a.setAttribute(h,f))))}var P=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,D=Symbol.for("react.element"),k=Symbol.for("react.portal"),U=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),q=Symbol.for("react.profiler"),ee=Symbol.for("react.provider"),pe=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),$=Symbol.for("react.memo"),le=Symbol.for("react.lazy"),ie=Symbol.for("react.offscreen"),Y=Symbol.iterator;function de(a){return a===null||typeof a!="object"?null:(a=Y&&a[Y]||a["@@iterator"],typeof a=="function"?a:null)}var z=Object.assign,N;function W(a){if(N===void 0)try{throw Error()}catch(f){var h=f.stack.trim().match(/\n( *(at )?)/);N=h&&h[1]||""}return`
`+N+a}var re=!1;function _e(a,h){if(!a||re)return"";re=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(h)if(h=function(){throw Error()},Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(J){var g=J}Reflect.construct(a,[],h)}else{try{h.call()}catch(J){g=J}a.call(h.prototype)}else{try{throw Error()}catch(J){g=J}a()}}catch(J){if(J&&g&&typeof J.stack=="string"){for(var x=J.stack.split(`
`),w=g.stack.split(`
`),O=x.length-1,B=w.length-1;1<=O&&0<=B&&x[O]!==w[B];)B--;for(;1<=O&&0<=B;O--,B--)if(x[O]!==w[B]){if(O!==1||B!==1)do if(O--,B--,0>B||x[O]!==w[B]){var V=`
`+x[O].replace(" at new "," at ");return a.displayName&&V.includes("<anonymous>")&&(V=V.replace("<anonymous>",a.displayName)),V}while(1<=O&&0<=B);break}}}finally{re=!1,Error.prepareStackTrace=f}return(a=a?a.displayName||a.name:"")?W(a):""}function me(a){switch(a.tag){case 5:return W(a.type);case 16:return W("Lazy");case 13:return W("Suspense");case 19:return W("SuspenseList");case 0:case 2:case 15:return a=_e(a.type,!1),a;case 11:return a=_e(a.type.render,!1),a;case 1:return a=_e(a.type,!0),a;default:return""}}function Pe(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case U:return"Fragment";case k:return"Portal";case q:return"Profiler";case j:return"StrictMode";case F:return"Suspense";case G:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case pe:return(a.displayName||"Context")+".Consumer";case ee:return(a._context.displayName||"Context")+".Provider";case H:var h=a.render;return a=a.displayName,a||(a=h.displayName||h.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case $:return h=a.displayName||null,h!==null?h:Pe(a.type)||"Memo";case le:h=a._payload,a=a._init;try{return Pe(a(h))}catch{}}return null}function Ue(a){var h=a.type;switch(a.tag){case 24:return"Cache";case 9:return(h.displayName||"Context")+".Consumer";case 10:return(h._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=h.render,a=a.displayName||a.name||"",h.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return h;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Pe(h);case 8:return h===j?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h}return null}function Te(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function ge(a){var h=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function Ke(a){var h=ge(a)?"checked":"value",f=Object.getOwnPropertyDescriptor(a.constructor.prototype,h),g=""+a[h];if(!a.hasOwnProperty(h)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var x=f.get,w=f.set;return Object.defineProperty(a,h,{configurable:!0,get:function(){return x.call(this)},set:function(O){g=""+O,w.call(this,O)}}),Object.defineProperty(a,h,{enumerable:f.enumerable}),{getValue:function(){return g},setValue:function(O){g=""+O},stopTracking:function(){a._valueTracker=null,delete a[h]}}}}function Je(a){a._valueTracker||(a._valueTracker=Ke(a))}function ht(a){if(!a)return!1;var h=a._valueTracker;if(!h)return!0;var f=h.getValue(),g="";return a&&(g=ge(a)?a.checked?"true":"false":a.value),a=g,a!==f?(h.setValue(a),!0):!1}function st(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function ti(a,h){var f=h.checked;return z({},h,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:f??a._wrapperState.initialChecked})}function Zt(a,h){var f=h.defaultValue==null?"":h.defaultValue,g=h.checked!=null?h.checked:h.defaultChecked;f=Te(h.value!=null?h.value:f),a._wrapperState={initialChecked:g,initialValue:f,controlled:h.type==="checkbox"||h.type==="radio"?h.checked!=null:h.value!=null}}function bi(a,h){h=h.checked,h!=null&&A(a,"checked",h,!1)}function b(a,h){bi(a,h);var f=Te(h.value),g=h.type;if(f!=null)g==="number"?(f===0&&a.value===""||a.value!=f)&&(a.value=""+f):a.value!==""+f&&(a.value=""+f);else if(g==="submit"||g==="reset"){a.removeAttribute("value");return}h.hasOwnProperty("value")?Q(a,h.type,f):h.hasOwnProperty("defaultValue")&&Q(a,h.type,Te(h.defaultValue)),h.checked==null&&h.defaultChecked!=null&&(a.defaultChecked=!!h.defaultChecked)}function M(a,h,f){if(h.hasOwnProperty("value")||h.hasOwnProperty("defaultValue")){var g=h.type;if(!(g!=="submit"&&g!=="reset"||h.value!==void 0&&h.value!==null))return;h=""+a._wrapperState.initialValue,f||h===a.value||(a.value=h),a.defaultValue=h}f=a.name,f!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,f!==""&&(a.name=f)}function Q(a,h,f){(h!=="number"||st(a.ownerDocument)!==a)&&(f==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+f&&(a.defaultValue=""+f))}var he=Array.isArray;function Ee(a,h,f,g){if(a=a.options,h){h={};for(var x=0;x<f.length;x++)h["$"+f[x]]=!0;for(f=0;f<a.length;f++)x=h.hasOwnProperty("$"+a[f].value),a[f].selected!==x&&(a[f].selected=x),x&&g&&(a[f].defaultSelected=!0)}else{for(f=""+Te(f),h=null,x=0;x<a.length;x++){if(a[x].value===f){a[x].selected=!0,g&&(a[x].defaultSelected=!0);return}h!==null||a[x].disabled||(h=a[x])}h!==null&&(h.selected=!0)}}function Ne(a,h){if(h.dangerouslySetInnerHTML!=null)throw Error(t(91));return z({},h,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function ue(a,h){var f=h.value;if(f==null){if(f=h.children,h=h.defaultValue,f!=null){if(h!=null)throw Error(t(92));if(he(f)){if(1<f.length)throw Error(t(93));f=f[0]}h=f}h==null&&(h=""),f=h}a._wrapperState={initialValue:Te(f)}}function We(a,h){var f=Te(h.value),g=Te(h.defaultValue);f!=null&&(f=""+f,f!==a.value&&(a.value=f),h.defaultValue==null&&a.defaultValue!==f&&(a.defaultValue=f)),g!=null&&(a.defaultValue=""+g)}function at(a){var h=a.textContent;h===a._wrapperState.initialValue&&h!==""&&h!==null&&(a.value=h)}function mt(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Xe(a,h){return a==null||a==="http://www.w3.org/1999/xhtml"?mt(h):a==="http://www.w3.org/2000/svg"&&h==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var gt,R=function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(h,f,g,x){MSApp.execUnsafeLocalFunction(function(){return a(h,f,g,x)})}:a}(function(a,h){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=h;else{for(gt=gt||document.createElement("div"),gt.innerHTML="<svg>"+h.valueOf().toString()+"</svg>",h=gt.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;h.firstChild;)a.appendChild(h.firstChild)}});function C(a,h){if(h){var f=a.firstChild;if(f&&f===a.lastChild&&f.nodeType===3){f.nodeValue=h;return}}a.textContent=h}var I={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},L=["Webkit","ms","Moz","O"];Object.keys(I).forEach(function(a){L.forEach(function(h){h=h+a.charAt(0).toUpperCase()+a.substring(1),I[h]=I[a]})});function ne(a,h,f){return h==null||typeof h=="boolean"||h===""?"":f||typeof h!="number"||h===0||I.hasOwnProperty(a)&&I[a]?(""+h).trim():h+"px"}function ve(a,h){a=a.style;for(var f in h)if(h.hasOwnProperty(f)){var g=f.indexOf("--")===0,x=ne(f,h[f],g);f==="float"&&(f="cssFloat"),g?a.setProperty(f,x):a[f]=x}}var He=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function lt(a,h){if(h){if(He[a]&&(h.children!=null||h.dangerouslySetInnerHTML!=null))throw Error(t(137,a));if(h.dangerouslySetInnerHTML!=null){if(h.children!=null)throw Error(t(60));if(typeof h.dangerouslySetInnerHTML!="object"||!("__html"in h.dangerouslySetInnerHTML))throw Error(t(61))}if(h.style!=null&&typeof h.style!="object")throw Error(t(62))}}function ze(a,h){if(a.indexOf("-")===-1)return typeof h.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fi=null;function Dt(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Ir=null,$r=null,en=null;function Ko(a){if(a=_a(a)){if(typeof Ir!="function")throw Error(t(280));var h=a.stateNode;h&&(h=Hl(h),Ir(a.stateNode,a.type,h))}}function wm(a){$r?en?en.push(a):en=[a]:$r=a}function Em(){if($r){var a=$r,h=en;if(en=$r=null,Ko(a),h)for(a=0;a<h.length;a++)Ko(h[a])}}function Sm(a,h){return a(h)}function Am(){}var tc=!1;function bm(a,h,f){if(tc)return a(h,f);tc=!0;try{return Sm(a,h,f)}finally{tc=!1,($r!==null||en!==null)&&(Am(),Em())}}function Jo(a,h){var f=a.stateNode;if(f===null)return null;var g=Hl(f);if(g===null)return null;f=g[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(a=a.type,g=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!g;break e;default:a=!1}if(a)return null;if(f&&typeof f!="function")throw Error(t(231,h,typeof f));return f}var ic=!1;if(l)try{var $o={};Object.defineProperty($o,"passive",{get:function(){ic=!0}}),window.addEventListener("test",$o,$o),window.removeEventListener("test",$o,$o)}catch{ic=!1}function Tw(a,h,f,g,x,w,O,B,V){var J=Array.prototype.slice.call(arguments,3);try{h.apply(f,J)}catch(fe){this.onError(fe)}}var ea=!1,vl=null,_l=!1,rc=null,ww={onError:function(a){ea=!0,vl=a}};function Ew(a,h,f,g,x,w,O,B,V){ea=!1,vl=null,Tw.apply(ww,arguments)}function Sw(a,h,f,g,x,w,O,B,V){if(Ew.apply(this,arguments),ea){if(ea){var J=vl;ea=!1,vl=null}else throw Error(t(198));_l||(_l=!0,rc=J)}}function as(a){var h=a,f=a;if(a.alternate)for(;h.return;)h=h.return;else{a=h;do h=a,(h.flags&4098)!==0&&(f=h.return),a=h.return;while(a)}return h.tag===3?f:null}function Cm(a){if(a.tag===13){var h=a.memoizedState;if(h===null&&(a=a.alternate,a!==null&&(h=a.memoizedState)),h!==null)return h.dehydrated}return null}function Rm(a){if(as(a)!==a)throw Error(t(188))}function Aw(a){var h=a.alternate;if(!h){if(h=as(a),h===null)throw Error(t(188));return h!==a?null:a}for(var f=a,g=h;;){var x=f.return;if(x===null)break;var w=x.alternate;if(w===null){if(g=x.return,g!==null){f=g;continue}break}if(x.child===w.child){for(w=x.child;w;){if(w===f)return Rm(x),a;if(w===g)return Rm(x),h;w=w.sibling}throw Error(t(188))}if(f.return!==g.return)f=x,g=w;else{for(var O=!1,B=x.child;B;){if(B===f){O=!0,f=x,g=w;break}if(B===g){O=!0,g=x,f=w;break}B=B.sibling}if(!O){for(B=w.child;B;){if(B===f){O=!0,f=w,g=x;break}if(B===g){O=!0,g=w,f=x;break}B=B.sibling}if(!O)throw Error(t(189))}}if(f.alternate!==g)throw Error(t(190))}if(f.tag!==3)throw Error(t(188));return f.stateNode.current===f?a:h}function Pm(a){return a=Aw(a),a!==null?Om(a):null}function Om(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var h=Om(a);if(h!==null)return h;a=a.sibling}return null}var Im=e.unstable_scheduleCallback,Mm=e.unstable_cancelCallback,bw=e.unstable_shouldYield,Cw=e.unstable_requestPaint,Ft=e.unstable_now,Rw=e.unstable_getCurrentPriorityLevel,nc=e.unstable_ImmediatePriority,Nm=e.unstable_UserBlockingPriority,xl=e.unstable_NormalPriority,Pw=e.unstable_LowPriority,Dm=e.unstable_IdlePriority,Tl=null,Mr=null;function Ow(a){if(Mr&&typeof Mr.onCommitFiberRoot=="function")try{Mr.onCommitFiberRoot(Tl,a,void 0,(a.current.flags&128)===128)}catch{}}var lr=Math.clz32?Math.clz32:Nw,Iw=Math.log,Mw=Math.LN2;function Nw(a){return a>>>=0,a===0?32:31-(Iw(a)/Mw|0)|0}var wl=64,El=4194304;function ta(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function Sl(a,h){var f=a.pendingLanes;if(f===0)return 0;var g=0,x=a.suspendedLanes,w=a.pingedLanes,O=f&268435455;if(O!==0){var B=O&~x;B!==0?g=ta(B):(w&=O,w!==0&&(g=ta(w)))}else O=f&~x,O!==0?g=ta(O):w!==0&&(g=ta(w));if(g===0)return 0;if(h!==0&&h!==g&&(h&x)===0&&(x=g&-g,w=h&-h,x>=w||x===16&&(w&4194240)!==0))return h;if((g&4)!==0&&(g|=f&16),h=a.entangledLanes,h!==0)for(a=a.entanglements,h&=g;0<h;)f=31-lr(h),x=1<<f,g|=a[f],h&=~x;return g}function Dw(a,h){switch(a){case 1:case 2:case 4:return h+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Lw(a,h){for(var f=a.suspendedLanes,g=a.pingedLanes,x=a.expirationTimes,w=a.pendingLanes;0<w;){var O=31-lr(w),B=1<<O,V=x[O];V===-1?((B&f)===0||(B&g)!==0)&&(x[O]=Dw(B,h)):V<=h&&(a.expiredLanes|=B),w&=~B}}function sc(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function Lm(){var a=wl;return wl<<=1,(wl&4194240)===0&&(wl=64),a}function oc(a){for(var h=[],f=0;31>f;f++)h.push(a);return h}function ia(a,h,f){a.pendingLanes|=h,h!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,h=31-lr(h),a[h]=f}function Fw(a,h){var f=a.pendingLanes&~h;a.pendingLanes=h,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=h,a.mutableReadLanes&=h,a.entangledLanes&=h,h=a.entanglements;var g=a.eventTimes;for(a=a.expirationTimes;0<f;){var x=31-lr(f),w=1<<x;h[x]=0,g[x]=-1,a[x]=-1,f&=~w}}function ac(a,h){var f=a.entangledLanes|=h;for(a=a.entanglements;f;){var g=31-lr(f),x=1<<g;x&h|a[g]&h&&(a[g]|=h),f&=~x}}var ft=0;function Fm(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var Bm,lc,km,Um,Hm,uc=!1,Al=[],Tn=null,wn=null,En=null,ra=new Map,na=new Map,Sn=[],Bw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zm(a,h){switch(a){case"focusin":case"focusout":Tn=null;break;case"dragenter":case"dragleave":wn=null;break;case"mouseover":case"mouseout":En=null;break;case"pointerover":case"pointerout":ra.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":na.delete(h.pointerId)}}function sa(a,h,f,g,x,w){return a===null||a.nativeEvent!==w?(a={blockedOn:h,domEventName:f,eventSystemFlags:g,nativeEvent:w,targetContainers:[x]},h!==null&&(h=_a(h),h!==null&&lc(h)),a):(a.eventSystemFlags|=g,h=a.targetContainers,x!==null&&h.indexOf(x)===-1&&h.push(x),a)}function kw(a,h,f,g,x){switch(h){case"focusin":return Tn=sa(Tn,a,h,f,g,x),!0;case"dragenter":return wn=sa(wn,a,h,f,g,x),!0;case"mouseover":return En=sa(En,a,h,f,g,x),!0;case"pointerover":var w=x.pointerId;return ra.set(w,sa(ra.get(w)||null,a,h,f,g,x)),!0;case"gotpointercapture":return w=x.pointerId,na.set(w,sa(na.get(w)||null,a,h,f,g,x)),!0}return!1}function Gm(a){var h=ls(a.target);if(h!==null){var f=as(h);if(f!==null){if(h=f.tag,h===13){if(h=Cm(f),h!==null){a.blockedOn=h,Hm(a.priority,function(){km(f)});return}}else if(h===3&&f.stateNode.current.memoizedState.isDehydrated){a.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}a.blockedOn=null}function bl(a){if(a.blockedOn!==null)return!1;for(var h=a.targetContainers;0<h.length;){var f=cc(a.domEventName,a.eventSystemFlags,h[0],a.nativeEvent);if(f===null){f=a.nativeEvent;var g=new f.constructor(f.type,f);fi=g,f.target.dispatchEvent(g),fi=null}else return h=_a(f),h!==null&&lc(h),a.blockedOn=f,!1;h.shift()}return!0}function Vm(a,h,f){bl(a)&&f.delete(h)}function Uw(){uc=!1,Tn!==null&&bl(Tn)&&(Tn=null),wn!==null&&bl(wn)&&(wn=null),En!==null&&bl(En)&&(En=null),ra.forEach(Vm),na.forEach(Vm)}function oa(a,h){a.blockedOn===h&&(a.blockedOn=null,uc||(uc=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Uw)))}function aa(a){function h(x){return oa(x,a)}if(0<Al.length){oa(Al[0],a);for(var f=1;f<Al.length;f++){var g=Al[f];g.blockedOn===a&&(g.blockedOn=null)}}for(Tn!==null&&oa(Tn,a),wn!==null&&oa(wn,a),En!==null&&oa(En,a),ra.forEach(h),na.forEach(h),f=0;f<Sn.length;f++)g=Sn[f],g.blockedOn===a&&(g.blockedOn=null);for(;0<Sn.length&&(f=Sn[0],f.blockedOn===null);)Gm(f),f.blockedOn===null&&Sn.shift()}var Ys=P.ReactCurrentBatchConfig,Cl=!0;function Hw(a,h,f,g){var x=ft,w=Ys.transition;Ys.transition=null;try{ft=1,hc(a,h,f,g)}finally{ft=x,Ys.transition=w}}function zw(a,h,f,g){var x=ft,w=Ys.transition;Ys.transition=null;try{ft=4,hc(a,h,f,g)}finally{ft=x,Ys.transition=w}}function hc(a,h,f,g){if(Cl){var x=cc(a,h,f,g);if(x===null)Rc(a,h,g,Rl,f),zm(a,g);else if(kw(x,a,h,f,g))g.stopPropagation();else if(zm(a,g),h&4&&-1<Bw.indexOf(a)){for(;x!==null;){var w=_a(x);if(w!==null&&Bm(w),w=cc(a,h,f,g),w===null&&Rc(a,h,g,Rl,f),w===x)break;x=w}x!==null&&g.stopPropagation()}else Rc(a,h,g,null,f)}}var Rl=null;function cc(a,h,f,g){if(Rl=null,a=Dt(g),a=ls(a),a!==null)if(h=as(a),h===null)a=null;else if(f=h.tag,f===13){if(a=Cm(h),a!==null)return a;a=null}else if(f===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;a=null}else h!==a&&(a=null);return Rl=a,null}function jm(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Rw()){case nc:return 1;case Nm:return 4;case xl:case Pw:return 16;case Dm:return 536870912;default:return 16}default:return 16}}var An=null,dc=null,Pl=null;function Xm(){if(Pl)return Pl;var a,h=dc,f=h.length,g,x="value"in An?An.value:An.textContent,w=x.length;for(a=0;a<f&&h[a]===x[a];a++);var O=f-a;for(g=1;g<=O&&h[f-g]===x[w-g];g++);return Pl=x.slice(a,1<g?1-g:void 0)}function Ol(a){var h=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&h===13&&(a=13)):a=h,a===10&&(a=13),32<=a||a===13?a:0}function Il(){return!0}function Wm(){return!1}function Ui(a){function h(f,g,x,w,O){this._reactName=f,this._targetInst=x,this.type=g,this.nativeEvent=w,this.target=O,this.currentTarget=null;for(var B in a)a.hasOwnProperty(B)&&(f=a[B],this[B]=f?f(w):w[B]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Il:Wm,this.isPropagationStopped=Wm,this}return z(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=Il)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=Il)},persist:function(){},isPersistent:Il}),h}var qs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fc=Ui(qs),la=z({},qs,{view:0,detail:0}),Gw=Ui(la),pc,mc,ua,Ml=z({},la,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yc,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==ua&&(ua&&a.type==="mousemove"?(pc=a.screenX-ua.screenX,mc=a.screenY-ua.screenY):mc=pc=0,ua=a),pc)},movementY:function(a){return"movementY"in a?a.movementY:mc}}),Ym=Ui(Ml),Vw=z({},Ml,{dataTransfer:0}),jw=Ui(Vw),Xw=z({},la,{relatedTarget:0}),gc=Ui(Xw),Ww=z({},qs,{animationName:0,elapsedTime:0,pseudoElement:0}),Yw=Ui(Ww),qw=z({},qs,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Zw=Ui(qw),Qw=z({},qs,{data:0}),qm=Ui(Qw),Kw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$w={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function eE(a){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(a):(a=$w[a])?!!h[a]:!1}function yc(){return eE}var tE=z({},la,{key:function(a){if(a.key){var h=Kw[a.key]||a.key;if(h!=="Unidentified")return h}return a.type==="keypress"?(a=Ol(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Jw[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yc,charCode:function(a){return a.type==="keypress"?Ol(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Ol(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),iE=Ui(tE),rE=z({},Ml,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Zm=Ui(rE),nE=z({},la,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yc}),sE=Ui(nE),oE=z({},qs,{propertyName:0,elapsedTime:0,pseudoElement:0}),aE=Ui(oE),lE=z({},Ml,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),uE=Ui(lE),hE=[9,13,27,32],vc=l&&"CompositionEvent"in window,ha=null;l&&"documentMode"in document&&(ha=document.documentMode);var cE=l&&"TextEvent"in window&&!ha,Qm=l&&(!vc||ha&&8<ha&&11>=ha),Km=" ",Jm=!1;function $m(a,h){switch(a){case"keyup":return hE.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function eg(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Zs=!1;function dE(a,h){switch(a){case"compositionend":return eg(h);case"keypress":return h.which!==32?null:(Jm=!0,Km);case"textInput":return a=h.data,a===Km&&Jm?null:a;default:return null}}function fE(a,h){if(Zs)return a==="compositionend"||!vc&&$m(a,h)?(a=Xm(),Pl=dc=An=null,Zs=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return Qm&&h.locale!=="ko"?null:h.data;default:return null}}var pE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tg(a){var h=a&&a.nodeName&&a.nodeName.toLowerCase();return h==="input"?!!pE[a.type]:h==="textarea"}function ig(a,h,f,g){wm(g),h=Bl(h,"onChange"),0<h.length&&(f=new fc("onChange","change",null,f,g),a.push({event:f,listeners:h}))}var ca=null,da=null;function mE(a){xg(a,0)}function Nl(a){var h=eo(a);if(ht(h))return a}function gE(a,h){if(a==="change")return h}var rg=!1;if(l){var _c;if(l){var xc="oninput"in document;if(!xc){var ng=document.createElement("div");ng.setAttribute("oninput","return;"),xc=typeof ng.oninput=="function"}_c=xc}else _c=!1;rg=_c&&(!document.documentMode||9<document.documentMode)}function sg(){ca&&(ca.detachEvent("onpropertychange",og),da=ca=null)}function og(a){if(a.propertyName==="value"&&Nl(da)){var h=[];ig(h,da,a,Dt(a)),bm(mE,h)}}function yE(a,h,f){a==="focusin"?(sg(),ca=h,da=f,ca.attachEvent("onpropertychange",og)):a==="focusout"&&sg()}function vE(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Nl(da)}function _E(a,h){if(a==="click")return Nl(h)}function xE(a,h){if(a==="input"||a==="change")return Nl(h)}function TE(a,h){return a===h&&(a!==0||1/a===1/h)||a!==a&&h!==h}var ur=typeof Object.is=="function"?Object.is:TE;function fa(a,h){if(ur(a,h))return!0;if(typeof a!="object"||a===null||typeof h!="object"||h===null)return!1;var f=Object.keys(a),g=Object.keys(h);if(f.length!==g.length)return!1;for(g=0;g<f.length;g++){var x=f[g];if(!u.call(h,x)||!ur(a[x],h[x]))return!1}return!0}function ag(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function lg(a,h){var f=ag(a);a=0;for(var g;f;){if(f.nodeType===3){if(g=a+f.textContent.length,a<=h&&g>=h)return{node:f,offset:h-a};a=g}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=ag(f)}}function ug(a,h){return a&&h?a===h?!0:a&&a.nodeType===3?!1:h&&h.nodeType===3?ug(a,h.parentNode):"contains"in a?a.contains(h):a.compareDocumentPosition?!!(a.compareDocumentPosition(h)&16):!1:!1}function hg(){for(var a=window,h=st();h instanceof a.HTMLIFrameElement;){try{var f=typeof h.contentWindow.location.href=="string"}catch{f=!1}if(f)a=h.contentWindow;else break;h=st(a.document)}return h}function Tc(a){var h=a&&a.nodeName&&a.nodeName.toLowerCase();return h&&(h==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||h==="textarea"||a.contentEditable==="true")}function wE(a){var h=hg(),f=a.focusedElem,g=a.selectionRange;if(h!==f&&f&&f.ownerDocument&&ug(f.ownerDocument.documentElement,f)){if(g!==null&&Tc(f)){if(h=g.start,a=g.end,a===void 0&&(a=h),"selectionStart"in f)f.selectionStart=h,f.selectionEnd=Math.min(a,f.value.length);else if(a=(h=f.ownerDocument||document)&&h.defaultView||window,a.getSelection){a=a.getSelection();var x=f.textContent.length,w=Math.min(g.start,x);g=g.end===void 0?w:Math.min(g.end,x),!a.extend&&w>g&&(x=g,g=w,w=x),x=lg(f,w);var O=lg(f,g);x&&O&&(a.rangeCount!==1||a.anchorNode!==x.node||a.anchorOffset!==x.offset||a.focusNode!==O.node||a.focusOffset!==O.offset)&&(h=h.createRange(),h.setStart(x.node,x.offset),a.removeAllRanges(),w>g?(a.addRange(h),a.extend(O.node,O.offset)):(h.setEnd(O.node,O.offset),a.addRange(h)))}}for(h=[],a=f;a=a.parentNode;)a.nodeType===1&&h.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<h.length;f++)a=h[f],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var EE=l&&"documentMode"in document&&11>=document.documentMode,Qs=null,wc=null,pa=null,Ec=!1;function cg(a,h,f){var g=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;Ec||Qs==null||Qs!==st(g)||(g=Qs,"selectionStart"in g&&Tc(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),pa&&fa(pa,g)||(pa=g,g=Bl(wc,"onSelect"),0<g.length&&(h=new fc("onSelect","select",null,h,f),a.push({event:h,listeners:g}),h.target=Qs)))}function Dl(a,h){var f={};return f[a.toLowerCase()]=h.toLowerCase(),f["Webkit"+a]="webkit"+h,f["Moz"+a]="moz"+h,f}var Ks={animationend:Dl("Animation","AnimationEnd"),animationiteration:Dl("Animation","AnimationIteration"),animationstart:Dl("Animation","AnimationStart"),transitionend:Dl("Transition","TransitionEnd")},Sc={},dg={};l&&(dg=document.createElement("div").style,"AnimationEvent"in window||(delete Ks.animationend.animation,delete Ks.animationiteration.animation,delete Ks.animationstart.animation),"TransitionEvent"in window||delete Ks.transitionend.transition);function Ll(a){if(Sc[a])return Sc[a];if(!Ks[a])return a;var h=Ks[a],f;for(f in h)if(h.hasOwnProperty(f)&&f in dg)return Sc[a]=h[f];return a}var fg=Ll("animationend"),pg=Ll("animationiteration"),mg=Ll("animationstart"),gg=Ll("transitionend"),yg=new Map,vg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function bn(a,h){yg.set(a,h),s(h,[a])}for(var Ac=0;Ac<vg.length;Ac++){var bc=vg[Ac],SE=bc.toLowerCase(),AE=bc[0].toUpperCase()+bc.slice(1);bn(SE,"on"+AE)}bn(fg,"onAnimationEnd"),bn(pg,"onAnimationIteration"),bn(mg,"onAnimationStart"),bn("dblclick","onDoubleClick"),bn("focusin","onFocus"),bn("focusout","onBlur"),bn(gg,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ma="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bE=new Set("cancel close invalid load scroll toggle".split(" ").concat(ma));function _g(a,h,f){var g=a.type||"unknown-event";a.currentTarget=f,Sw(g,h,void 0,a),a.currentTarget=null}function xg(a,h){h=(h&4)!==0;for(var f=0;f<a.length;f++){var g=a[f],x=g.event;g=g.listeners;e:{var w=void 0;if(h)for(var O=g.length-1;0<=O;O--){var B=g[O],V=B.instance,J=B.currentTarget;if(B=B.listener,V!==w&&x.isPropagationStopped())break e;_g(x,B,J),w=V}else for(O=0;O<g.length;O++){if(B=g[O],V=B.instance,J=B.currentTarget,B=B.listener,V!==w&&x.isPropagationStopped())break e;_g(x,B,J),w=V}}}if(_l)throw a=rc,_l=!1,rc=null,a}function vt(a,h){var f=h[Dc];f===void 0&&(f=h[Dc]=new Set);var g=a+"__bubble";f.has(g)||(Tg(h,a,2,!1),f.add(g))}function Cc(a,h,f){var g=0;h&&(g|=4),Tg(f,a,g,h)}var Fl="_reactListening"+Math.random().toString(36).slice(2);function ga(a){if(!a[Fl]){a[Fl]=!0,i.forEach(function(f){f!=="selectionchange"&&(bE.has(f)||Cc(f,!1,a),Cc(f,!0,a))});var h=a.nodeType===9?a:a.ownerDocument;h===null||h[Fl]||(h[Fl]=!0,Cc("selectionchange",!1,h))}}function Tg(a,h,f,g){switch(jm(h)){case 1:var x=Hw;break;case 4:x=zw;break;default:x=hc}f=x.bind(null,h,f,a),x=void 0,!ic||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(x=!0),g?x!==void 0?a.addEventListener(h,f,{capture:!0,passive:x}):a.addEventListener(h,f,!0):x!==void 0?a.addEventListener(h,f,{passive:x}):a.addEventListener(h,f,!1)}function Rc(a,h,f,g,x){var w=g;if((h&1)===0&&(h&2)===0&&g!==null)e:for(;;){if(g===null)return;var O=g.tag;if(O===3||O===4){var B=g.stateNode.containerInfo;if(B===x||B.nodeType===8&&B.parentNode===x)break;if(O===4)for(O=g.return;O!==null;){var V=O.tag;if((V===3||V===4)&&(V=O.stateNode.containerInfo,V===x||V.nodeType===8&&V.parentNode===x))return;O=O.return}for(;B!==null;){if(O=ls(B),O===null)return;if(V=O.tag,V===5||V===6){g=w=O;continue e}B=B.parentNode}}g=g.return}bm(function(){var J=w,fe=Dt(f),ye=[];e:{var ce=yg.get(a);if(ce!==void 0){var be=fc,Ie=a;switch(a){case"keypress":if(Ol(f)===0)break e;case"keydown":case"keyup":be=iE;break;case"focusin":Ie="focus",be=gc;break;case"focusout":Ie="blur",be=gc;break;case"beforeblur":case"afterblur":be=gc;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":be=Ym;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":be=jw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":be=sE;break;case fg:case pg:case mg:be=Yw;break;case gg:be=aE;break;case"scroll":be=Gw;break;case"wheel":be=uE;break;case"copy":case"cut":case"paste":be=Zw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":be=Zm}var Me=(h&4)!==0,Bt=!Me&&a==="scroll",Z=Me?ce!==null?ce+"Capture":null:ce;Me=[];for(var X=J,K;X!==null;){K=X;var we=K.stateNode;if(K.tag===5&&we!==null&&(K=we,Z!==null&&(we=Jo(X,Z),we!=null&&Me.push(ya(X,we,K)))),Bt)break;X=X.return}0<Me.length&&(ce=new be(ce,Ie,null,f,fe),ye.push({event:ce,listeners:Me}))}}if((h&7)===0){e:{if(ce=a==="mouseover"||a==="pointerover",be=a==="mouseout"||a==="pointerout",ce&&f!==fi&&(Ie=f.relatedTarget||f.fromElement)&&(ls(Ie)||Ie[tn]))break e;if((be||ce)&&(ce=fe.window===fe?fe:(ce=fe.ownerDocument)?ce.defaultView||ce.parentWindow:window,be?(Ie=f.relatedTarget||f.toElement,be=J,Ie=Ie?ls(Ie):null,Ie!==null&&(Bt=as(Ie),Ie!==Bt||Ie.tag!==5&&Ie.tag!==6)&&(Ie=null)):(be=null,Ie=J),be!==Ie)){if(Me=Ym,we="onMouseLeave",Z="onMouseEnter",X="mouse",(a==="pointerout"||a==="pointerover")&&(Me=Zm,we="onPointerLeave",Z="onPointerEnter",X="pointer"),Bt=be==null?ce:eo(be),K=Ie==null?ce:eo(Ie),ce=new Me(we,X+"leave",be,f,fe),ce.target=Bt,ce.relatedTarget=K,we=null,ls(fe)===J&&(Me=new Me(Z,X+"enter",Ie,f,fe),Me.target=K,Me.relatedTarget=Bt,we=Me),Bt=we,be&&Ie)t:{for(Me=be,Z=Ie,X=0,K=Me;K;K=Js(K))X++;for(K=0,we=Z;we;we=Js(we))K++;for(;0<X-K;)Me=Js(Me),X--;for(;0<K-X;)Z=Js(Z),K--;for(;X--;){if(Me===Z||Z!==null&&Me===Z.alternate)break t;Me=Js(Me),Z=Js(Z)}Me=null}else Me=null;be!==null&&wg(ye,ce,be,Me,!1),Ie!==null&&Bt!==null&&wg(ye,Bt,Ie,Me,!0)}}e:{if(ce=J?eo(J):window,be=ce.nodeName&&ce.nodeName.toLowerCase(),be==="select"||be==="input"&&ce.type==="file")var Fe=gE;else if(tg(ce))if(rg)Fe=xE;else{Fe=vE;var Ge=yE}else(be=ce.nodeName)&&be.toLowerCase()==="input"&&(ce.type==="checkbox"||ce.type==="radio")&&(Fe=_E);if(Fe&&(Fe=Fe(a,J))){ig(ye,Fe,f,fe);break e}Ge&&Ge(a,ce,J),a==="focusout"&&(Ge=ce._wrapperState)&&Ge.controlled&&ce.type==="number"&&Q(ce,"number",ce.value)}switch(Ge=J?eo(J):window,a){case"focusin":(tg(Ge)||Ge.contentEditable==="true")&&(Qs=Ge,wc=J,pa=null);break;case"focusout":pa=wc=Qs=null;break;case"mousedown":Ec=!0;break;case"contextmenu":case"mouseup":case"dragend":Ec=!1,cg(ye,f,fe);break;case"selectionchange":if(EE)break;case"keydown":case"keyup":cg(ye,f,fe)}var Ve;if(vc)e:{switch(a){case"compositionstart":var Ye="onCompositionStart";break e;case"compositionend":Ye="onCompositionEnd";break e;case"compositionupdate":Ye="onCompositionUpdate";break e}Ye=void 0}else Zs?$m(a,f)&&(Ye="onCompositionEnd"):a==="keydown"&&f.keyCode===229&&(Ye="onCompositionStart");Ye&&(Qm&&f.locale!=="ko"&&(Zs||Ye!=="onCompositionStart"?Ye==="onCompositionEnd"&&Zs&&(Ve=Xm()):(An=fe,dc="value"in An?An.value:An.textContent,Zs=!0)),Ge=Bl(J,Ye),0<Ge.length&&(Ye=new qm(Ye,a,null,f,fe),ye.push({event:Ye,listeners:Ge}),Ve?Ye.data=Ve:(Ve=eg(f),Ve!==null&&(Ye.data=Ve)))),(Ve=cE?dE(a,f):fE(a,f))&&(J=Bl(J,"onBeforeInput"),0<J.length&&(fe=new qm("onBeforeInput","beforeinput",null,f,fe),ye.push({event:fe,listeners:J}),fe.data=Ve))}xg(ye,h)})}function ya(a,h,f){return{instance:a,listener:h,currentTarget:f}}function Bl(a,h){for(var f=h+"Capture",g=[];a!==null;){var x=a,w=x.stateNode;x.tag===5&&w!==null&&(x=w,w=Jo(a,f),w!=null&&g.unshift(ya(a,w,x)),w=Jo(a,h),w!=null&&g.push(ya(a,w,x))),a=a.return}return g}function Js(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function wg(a,h,f,g,x){for(var w=h._reactName,O=[];f!==null&&f!==g;){var B=f,V=B.alternate,J=B.stateNode;if(V!==null&&V===g)break;B.tag===5&&J!==null&&(B=J,x?(V=Jo(f,w),V!=null&&O.unshift(ya(f,V,B))):x||(V=Jo(f,w),V!=null&&O.push(ya(f,V,B)))),f=f.return}O.length!==0&&a.push({event:h,listeners:O})}var CE=/\r\n?/g,RE=/\u0000|\uFFFD/g;function Eg(a){return(typeof a=="string"?a:""+a).replace(CE,`
`).replace(RE,"")}function kl(a,h,f){if(h=Eg(h),Eg(a)!==h&&f)throw Error(t(425))}function Ul(){}var Pc=null,Oc=null;function Ic(a,h){return a==="textarea"||a==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var Mc=typeof setTimeout=="function"?setTimeout:void 0,PE=typeof clearTimeout=="function"?clearTimeout:void 0,Sg=typeof Promise=="function"?Promise:void 0,OE=typeof queueMicrotask=="function"?queueMicrotask:typeof Sg<"u"?function(a){return Sg.resolve(null).then(a).catch(IE)}:Mc;function IE(a){setTimeout(function(){throw a})}function Nc(a,h){var f=h,g=0;do{var x=f.nextSibling;if(a.removeChild(f),x&&x.nodeType===8)if(f=x.data,f==="/$"){if(g===0){a.removeChild(x),aa(h);return}g--}else f!=="$"&&f!=="$?"&&f!=="$!"||g++;f=x}while(f);aa(h)}function Cn(a){for(;a!=null;a=a.nextSibling){var h=a.nodeType;if(h===1||h===3)break;if(h===8){if(h=a.data,h==="$"||h==="$!"||h==="$?")break;if(h==="/$")return null}}return a}function Ag(a){a=a.previousSibling;for(var h=0;a;){if(a.nodeType===8){var f=a.data;if(f==="$"||f==="$!"||f==="$?"){if(h===0)return a;h--}else f==="/$"&&h++}a=a.previousSibling}return null}var $s=Math.random().toString(36).slice(2),Nr="__reactFiber$"+$s,va="__reactProps$"+$s,tn="__reactContainer$"+$s,Dc="__reactEvents$"+$s,ME="__reactListeners$"+$s,NE="__reactHandles$"+$s;function ls(a){var h=a[Nr];if(h)return h;for(var f=a.parentNode;f;){if(h=f[tn]||f[Nr]){if(f=h.alternate,h.child!==null||f!==null&&f.child!==null)for(a=Ag(a);a!==null;){if(f=a[Nr])return f;a=Ag(a)}return h}a=f,f=a.parentNode}return null}function _a(a){return a=a[Nr]||a[tn],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function eo(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(t(33))}function Hl(a){return a[va]||null}var Lc=[],to=-1;function Rn(a){return{current:a}}function _t(a){0>to||(a.current=Lc[to],Lc[to]=null,to--)}function yt(a,h){to++,Lc[to]=a.current,a.current=h}var Pn={},wi=Rn(Pn),Ii=Rn(!1),us=Pn;function io(a,h){var f=a.type.contextTypes;if(!f)return Pn;var g=a.stateNode;if(g&&g.__reactInternalMemoizedUnmaskedChildContext===h)return g.__reactInternalMemoizedMaskedChildContext;var x={},w;for(w in f)x[w]=h[w];return g&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=h,a.__reactInternalMemoizedMaskedChildContext=x),x}function Mi(a){return a=a.childContextTypes,a!=null}function zl(){_t(Ii),_t(wi)}function bg(a,h,f){if(wi.current!==Pn)throw Error(t(168));yt(wi,h),yt(Ii,f)}function Cg(a,h,f){var g=a.stateNode;if(h=h.childContextTypes,typeof g.getChildContext!="function")return f;g=g.getChildContext();for(var x in g)if(!(x in h))throw Error(t(108,Ue(a)||"Unknown",x));return z({},f,g)}function Gl(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Pn,us=wi.current,yt(wi,a),yt(Ii,Ii.current),!0}function Rg(a,h,f){var g=a.stateNode;if(!g)throw Error(t(169));f?(a=Cg(a,h,us),g.__reactInternalMemoizedMergedChildContext=a,_t(Ii),_t(wi),yt(wi,a)):_t(Ii),yt(Ii,f)}var rn=null,Vl=!1,Fc=!1;function Pg(a){rn===null?rn=[a]:rn.push(a)}function DE(a){Vl=!0,Pg(a)}function On(){if(!Fc&&rn!==null){Fc=!0;var a=0,h=ft;try{var f=rn;for(ft=1;a<f.length;a++){var g=f[a];do g=g(!0);while(g!==null)}rn=null,Vl=!1}catch(x){throw rn!==null&&(rn=rn.slice(a+1)),Im(nc,On),x}finally{ft=h,Fc=!1}}return null}var ro=[],no=0,jl=null,Xl=0,Zi=[],Qi=0,hs=null,nn=1,sn="";function cs(a,h){ro[no++]=Xl,ro[no++]=jl,jl=a,Xl=h}function Og(a,h,f){Zi[Qi++]=nn,Zi[Qi++]=sn,Zi[Qi++]=hs,hs=a;var g=nn;a=sn;var x=32-lr(g)-1;g&=~(1<<x),f+=1;var w=32-lr(h)+x;if(30<w){var O=x-x%5;w=(g&(1<<O)-1).toString(32),g>>=O,x-=O,nn=1<<32-lr(h)+x|f<<x|g,sn=w+a}else nn=1<<w|f<<x|g,sn=a}function Bc(a){a.return!==null&&(cs(a,1),Og(a,1,0))}function kc(a){for(;a===jl;)jl=ro[--no],ro[no]=null,Xl=ro[--no],ro[no]=null;for(;a===hs;)hs=Zi[--Qi],Zi[Qi]=null,sn=Zi[--Qi],Zi[Qi]=null,nn=Zi[--Qi],Zi[Qi]=null}var Hi=null,zi=null,Tt=!1,hr=null;function Ig(a,h){var f=er(5,null,null,0);f.elementType="DELETED",f.stateNode=h,f.return=a,h=a.deletions,h===null?(a.deletions=[f],a.flags|=16):h.push(f)}function Mg(a,h){switch(a.tag){case 5:var f=a.type;return h=h.nodeType!==1||f.toLowerCase()!==h.nodeName.toLowerCase()?null:h,h!==null?(a.stateNode=h,Hi=a,zi=Cn(h.firstChild),!0):!1;case 6:return h=a.pendingProps===""||h.nodeType!==3?null:h,h!==null?(a.stateNode=h,Hi=a,zi=null,!0):!1;case 13:return h=h.nodeType!==8?null:h,h!==null?(f=hs!==null?{id:nn,overflow:sn}:null,a.memoizedState={dehydrated:h,treeContext:f,retryLane:1073741824},f=er(18,null,null,0),f.stateNode=h,f.return=a,a.child=f,Hi=a,zi=null,!0):!1;default:return!1}}function Uc(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Hc(a){if(Tt){var h=zi;if(h){var f=h;if(!Mg(a,h)){if(Uc(a))throw Error(t(418));h=Cn(f.nextSibling);var g=Hi;h&&Mg(a,h)?Ig(g,f):(a.flags=a.flags&-4097|2,Tt=!1,Hi=a)}}else{if(Uc(a))throw Error(t(418));a.flags=a.flags&-4097|2,Tt=!1,Hi=a}}}function Ng(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;Hi=a}function Wl(a){if(a!==Hi)return!1;if(!Tt)return Ng(a),Tt=!0,!1;var h;if((h=a.tag!==3)&&!(h=a.tag!==5)&&(h=a.type,h=h!=="head"&&h!=="body"&&!Ic(a.type,a.memoizedProps)),h&&(h=zi)){if(Uc(a))throw Dg(),Error(t(418));for(;h;)Ig(a,h),h=Cn(h.nextSibling)}if(Ng(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(t(317));e:{for(a=a.nextSibling,h=0;a;){if(a.nodeType===8){var f=a.data;if(f==="/$"){if(h===0){zi=Cn(a.nextSibling);break e}h--}else f!=="$"&&f!=="$!"&&f!=="$?"||h++}a=a.nextSibling}zi=null}}else zi=Hi?Cn(a.stateNode.nextSibling):null;return!0}function Dg(){for(var a=zi;a;)a=Cn(a.nextSibling)}function so(){zi=Hi=null,Tt=!1}function zc(a){hr===null?hr=[a]:hr.push(a)}var LE=P.ReactCurrentBatchConfig;function xa(a,h,f){if(a=f.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(f._owner){if(f=f._owner,f){if(f.tag!==1)throw Error(t(309));var g=f.stateNode}if(!g)throw Error(t(147,a));var x=g,w=""+a;return h!==null&&h.ref!==null&&typeof h.ref=="function"&&h.ref._stringRef===w?h.ref:(h=function(O){var B=x.refs;O===null?delete B[w]:B[w]=O},h._stringRef=w,h)}if(typeof a!="string")throw Error(t(284));if(!f._owner)throw Error(t(290,a))}return a}function Yl(a,h){throw a=Object.prototype.toString.call(h),Error(t(31,a==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":a))}function Lg(a){var h=a._init;return h(a._payload)}function Fg(a){function h(Z,X){if(a){var K=Z.deletions;K===null?(Z.deletions=[X],Z.flags|=16):K.push(X)}}function f(Z,X){if(!a)return null;for(;X!==null;)h(Z,X),X=X.sibling;return null}function g(Z,X){for(Z=new Map;X!==null;)X.key!==null?Z.set(X.key,X):Z.set(X.index,X),X=X.sibling;return Z}function x(Z,X){return Z=kn(Z,X),Z.index=0,Z.sibling=null,Z}function w(Z,X,K){return Z.index=K,a?(K=Z.alternate,K!==null?(K=K.index,K<X?(Z.flags|=2,X):K):(Z.flags|=2,X)):(Z.flags|=1048576,X)}function O(Z){return a&&Z.alternate===null&&(Z.flags|=2),Z}function B(Z,X,K,we){return X===null||X.tag!==6?(X=Md(K,Z.mode,we),X.return=Z,X):(X=x(X,K),X.return=Z,X)}function V(Z,X,K,we){var Fe=K.type;return Fe===U?fe(Z,X,K.props.children,we,K.key):X!==null&&(X.elementType===Fe||typeof Fe=="object"&&Fe!==null&&Fe.$$typeof===le&&Lg(Fe)===X.type)?(we=x(X,K.props),we.ref=xa(Z,X,K),we.return=Z,we):(we=yu(K.type,K.key,K.props,null,Z.mode,we),we.ref=xa(Z,X,K),we.return=Z,we)}function J(Z,X,K,we){return X===null||X.tag!==4||X.stateNode.containerInfo!==K.containerInfo||X.stateNode.implementation!==K.implementation?(X=Nd(K,Z.mode,we),X.return=Z,X):(X=x(X,K.children||[]),X.return=Z,X)}function fe(Z,X,K,we,Fe){return X===null||X.tag!==7?(X=_s(K,Z.mode,we,Fe),X.return=Z,X):(X=x(X,K),X.return=Z,X)}function ye(Z,X,K){if(typeof X=="string"&&X!==""||typeof X=="number")return X=Md(""+X,Z.mode,K),X.return=Z,X;if(typeof X=="object"&&X!==null){switch(X.$$typeof){case D:return K=yu(X.type,X.key,X.props,null,Z.mode,K),K.ref=xa(Z,null,X),K.return=Z,K;case k:return X=Nd(X,Z.mode,K),X.return=Z,X;case le:var we=X._init;return ye(Z,we(X._payload),K)}if(he(X)||de(X))return X=_s(X,Z.mode,K,null),X.return=Z,X;Yl(Z,X)}return null}function ce(Z,X,K,we){var Fe=X!==null?X.key:null;if(typeof K=="string"&&K!==""||typeof K=="number")return Fe!==null?null:B(Z,X,""+K,we);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case D:return K.key===Fe?V(Z,X,K,we):null;case k:return K.key===Fe?J(Z,X,K,we):null;case le:return Fe=K._init,ce(Z,X,Fe(K._payload),we)}if(he(K)||de(K))return Fe!==null?null:fe(Z,X,K,we,null);Yl(Z,K)}return null}function be(Z,X,K,we,Fe){if(typeof we=="string"&&we!==""||typeof we=="number")return Z=Z.get(K)||null,B(X,Z,""+we,Fe);if(typeof we=="object"&&we!==null){switch(we.$$typeof){case D:return Z=Z.get(we.key===null?K:we.key)||null,V(X,Z,we,Fe);case k:return Z=Z.get(we.key===null?K:we.key)||null,J(X,Z,we,Fe);case le:var Ge=we._init;return be(Z,X,K,Ge(we._payload),Fe)}if(he(we)||de(we))return Z=Z.get(K)||null,fe(X,Z,we,Fe,null);Yl(X,we)}return null}function Ie(Z,X,K,we){for(var Fe=null,Ge=null,Ve=X,Ye=X=0,ni=null;Ve!==null&&Ye<K.length;Ye++){Ve.index>Ye?(ni=Ve,Ve=null):ni=Ve.sibling;var ct=ce(Z,Ve,K[Ye],we);if(ct===null){Ve===null&&(Ve=ni);break}a&&Ve&&ct.alternate===null&&h(Z,Ve),X=w(ct,X,Ye),Ge===null?Fe=ct:Ge.sibling=ct,Ge=ct,Ve=ni}if(Ye===K.length)return f(Z,Ve),Tt&&cs(Z,Ye),Fe;if(Ve===null){for(;Ye<K.length;Ye++)Ve=ye(Z,K[Ye],we),Ve!==null&&(X=w(Ve,X,Ye),Ge===null?Fe=Ve:Ge.sibling=Ve,Ge=Ve);return Tt&&cs(Z,Ye),Fe}for(Ve=g(Z,Ve);Ye<K.length;Ye++)ni=be(Ve,Z,Ye,K[Ye],we),ni!==null&&(a&&ni.alternate!==null&&Ve.delete(ni.key===null?Ye:ni.key),X=w(ni,X,Ye),Ge===null?Fe=ni:Ge.sibling=ni,Ge=ni);return a&&Ve.forEach(function(Un){return h(Z,Un)}),Tt&&cs(Z,Ye),Fe}function Me(Z,X,K,we){var Fe=de(K);if(typeof Fe!="function")throw Error(t(150));if(K=Fe.call(K),K==null)throw Error(t(151));for(var Ge=Fe=null,Ve=X,Ye=X=0,ni=null,ct=K.next();Ve!==null&&!ct.done;Ye++,ct=K.next()){Ve.index>Ye?(ni=Ve,Ve=null):ni=Ve.sibling;var Un=ce(Z,Ve,ct.value,we);if(Un===null){Ve===null&&(Ve=ni);break}a&&Ve&&Un.alternate===null&&h(Z,Ve),X=w(Un,X,Ye),Ge===null?Fe=Un:Ge.sibling=Un,Ge=Un,Ve=ni}if(ct.done)return f(Z,Ve),Tt&&cs(Z,Ye),Fe;if(Ve===null){for(;!ct.done;Ye++,ct=K.next())ct=ye(Z,ct.value,we),ct!==null&&(X=w(ct,X,Ye),Ge===null?Fe=ct:Ge.sibling=ct,Ge=ct);return Tt&&cs(Z,Ye),Fe}for(Ve=g(Z,Ve);!ct.done;Ye++,ct=K.next())ct=be(Ve,Z,Ye,ct.value,we),ct!==null&&(a&&ct.alternate!==null&&Ve.delete(ct.key===null?Ye:ct.key),X=w(ct,X,Ye),Ge===null?Fe=ct:Ge.sibling=ct,Ge=ct);return a&&Ve.forEach(function(p1){return h(Z,p1)}),Tt&&cs(Z,Ye),Fe}function Bt(Z,X,K,we){if(typeof K=="object"&&K!==null&&K.type===U&&K.key===null&&(K=K.props.children),typeof K=="object"&&K!==null){switch(K.$$typeof){case D:e:{for(var Fe=K.key,Ge=X;Ge!==null;){if(Ge.key===Fe){if(Fe=K.type,Fe===U){if(Ge.tag===7){f(Z,Ge.sibling),X=x(Ge,K.props.children),X.return=Z,Z=X;break e}}else if(Ge.elementType===Fe||typeof Fe=="object"&&Fe!==null&&Fe.$$typeof===le&&Lg(Fe)===Ge.type){f(Z,Ge.sibling),X=x(Ge,K.props),X.ref=xa(Z,Ge,K),X.return=Z,Z=X;break e}f(Z,Ge);break}else h(Z,Ge);Ge=Ge.sibling}K.type===U?(X=_s(K.props.children,Z.mode,we,K.key),X.return=Z,Z=X):(we=yu(K.type,K.key,K.props,null,Z.mode,we),we.ref=xa(Z,X,K),we.return=Z,Z=we)}return O(Z);case k:e:{for(Ge=K.key;X!==null;){if(X.key===Ge)if(X.tag===4&&X.stateNode.containerInfo===K.containerInfo&&X.stateNode.implementation===K.implementation){f(Z,X.sibling),X=x(X,K.children||[]),X.return=Z,Z=X;break e}else{f(Z,X);break}else h(Z,X);X=X.sibling}X=Nd(K,Z.mode,we),X.return=Z,Z=X}return O(Z);case le:return Ge=K._init,Bt(Z,X,Ge(K._payload),we)}if(he(K))return Ie(Z,X,K,we);if(de(K))return Me(Z,X,K,we);Yl(Z,K)}return typeof K=="string"&&K!==""||typeof K=="number"?(K=""+K,X!==null&&X.tag===6?(f(Z,X.sibling),X=x(X,K),X.return=Z,Z=X):(f(Z,X),X=Md(K,Z.mode,we),X.return=Z,Z=X),O(Z)):f(Z,X)}return Bt}var oo=Fg(!0),Bg=Fg(!1),ql=Rn(null),Zl=null,ao=null,Gc=null;function Vc(){Gc=ao=Zl=null}function jc(a){var h=ql.current;_t(ql),a._currentValue=h}function Xc(a,h,f){for(;a!==null;){var g=a.alternate;if((a.childLanes&h)!==h?(a.childLanes|=h,g!==null&&(g.childLanes|=h)):g!==null&&(g.childLanes&h)!==h&&(g.childLanes|=h),a===f)break;a=a.return}}function lo(a,h){Zl=a,Gc=ao=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&h)!==0&&(Ni=!0),a.firstContext=null)}function Ki(a){var h=a._currentValue;if(Gc!==a)if(a={context:a,memoizedValue:h,next:null},ao===null){if(Zl===null)throw Error(t(308));ao=a,Zl.dependencies={lanes:0,firstContext:a}}else ao=ao.next=a;return h}var ds=null;function Wc(a){ds===null?ds=[a]:ds.push(a)}function kg(a,h,f,g){var x=h.interleaved;return x===null?(f.next=f,Wc(h)):(f.next=x.next,x.next=f),h.interleaved=f,on(a,g)}function on(a,h){a.lanes|=h;var f=a.alternate;for(f!==null&&(f.lanes|=h),f=a,a=a.return;a!==null;)a.childLanes|=h,f=a.alternate,f!==null&&(f.childLanes|=h),f=a,a=a.return;return f.tag===3?f.stateNode:null}var In=!1;function Yc(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ug(a,h){a=a.updateQueue,h.updateQueue===a&&(h.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function an(a,h){return{eventTime:a,lane:h,tag:0,payload:null,callback:null,next:null}}function Mn(a,h,f){var g=a.updateQueue;if(g===null)return null;if(g=g.shared,(ut&2)!==0){var x=g.pending;return x===null?h.next=h:(h.next=x.next,x.next=h),g.pending=h,on(a,f)}return x=g.interleaved,x===null?(h.next=h,Wc(g)):(h.next=x.next,x.next=h),g.interleaved=h,on(a,f)}function Ql(a,h,f){if(h=h.updateQueue,h!==null&&(h=h.shared,(f&4194240)!==0)){var g=h.lanes;g&=a.pendingLanes,f|=g,h.lanes=f,ac(a,f)}}function Hg(a,h){var f=a.updateQueue,g=a.alternate;if(g!==null&&(g=g.updateQueue,f===g)){var x=null,w=null;if(f=f.firstBaseUpdate,f!==null){do{var O={eventTime:f.eventTime,lane:f.lane,tag:f.tag,payload:f.payload,callback:f.callback,next:null};w===null?x=w=O:w=w.next=O,f=f.next}while(f!==null);w===null?x=w=h:w=w.next=h}else x=w=h;f={baseState:g.baseState,firstBaseUpdate:x,lastBaseUpdate:w,shared:g.shared,effects:g.effects},a.updateQueue=f;return}a=f.lastBaseUpdate,a===null?f.firstBaseUpdate=h:a.next=h,f.lastBaseUpdate=h}function Kl(a,h,f,g){var x=a.updateQueue;In=!1;var w=x.firstBaseUpdate,O=x.lastBaseUpdate,B=x.shared.pending;if(B!==null){x.shared.pending=null;var V=B,J=V.next;V.next=null,O===null?w=J:O.next=J,O=V;var fe=a.alternate;fe!==null&&(fe=fe.updateQueue,B=fe.lastBaseUpdate,B!==O&&(B===null?fe.firstBaseUpdate=J:B.next=J,fe.lastBaseUpdate=V))}if(w!==null){var ye=x.baseState;O=0,fe=J=V=null,B=w;do{var ce=B.lane,be=B.eventTime;if((g&ce)===ce){fe!==null&&(fe=fe.next={eventTime:be,lane:0,tag:B.tag,payload:B.payload,callback:B.callback,next:null});e:{var Ie=a,Me=B;switch(ce=h,be=f,Me.tag){case 1:if(Ie=Me.payload,typeof Ie=="function"){ye=Ie.call(be,ye,ce);break e}ye=Ie;break e;case 3:Ie.flags=Ie.flags&-65537|128;case 0:if(Ie=Me.payload,ce=typeof Ie=="function"?Ie.call(be,ye,ce):Ie,ce==null)break e;ye=z({},ye,ce);break e;case 2:In=!0}}B.callback!==null&&B.lane!==0&&(a.flags|=64,ce=x.effects,ce===null?x.effects=[B]:ce.push(B))}else be={eventTime:be,lane:ce,tag:B.tag,payload:B.payload,callback:B.callback,next:null},fe===null?(J=fe=be,V=ye):fe=fe.next=be,O|=ce;if(B=B.next,B===null){if(B=x.shared.pending,B===null)break;ce=B,B=ce.next,ce.next=null,x.lastBaseUpdate=ce,x.shared.pending=null}}while(!0);if(fe===null&&(V=ye),x.baseState=V,x.firstBaseUpdate=J,x.lastBaseUpdate=fe,h=x.shared.interleaved,h!==null){x=h;do O|=x.lane,x=x.next;while(x!==h)}else w===null&&(x.shared.lanes=0);ms|=O,a.lanes=O,a.memoizedState=ye}}function zg(a,h,f){if(a=h.effects,h.effects=null,a!==null)for(h=0;h<a.length;h++){var g=a[h],x=g.callback;if(x!==null){if(g.callback=null,g=f,typeof x!="function")throw Error(t(191,x));x.call(g)}}}var Ta={},Dr=Rn(Ta),wa=Rn(Ta),Ea=Rn(Ta);function fs(a){if(a===Ta)throw Error(t(174));return a}function qc(a,h){switch(yt(Ea,h),yt(wa,a),yt(Dr,Ta),a=h.nodeType,a){case 9:case 11:h=(h=h.documentElement)?h.namespaceURI:Xe(null,"");break;default:a=a===8?h.parentNode:h,h=a.namespaceURI||null,a=a.tagName,h=Xe(h,a)}_t(Dr),yt(Dr,h)}function uo(){_t(Dr),_t(wa),_t(Ea)}function Gg(a){fs(Ea.current);var h=fs(Dr.current),f=Xe(h,a.type);h!==f&&(yt(wa,a),yt(Dr,f))}function Zc(a){wa.current===a&&(_t(Dr),_t(wa))}var At=Rn(0);function Jl(a){for(var h=a;h!==null;){if(h.tag===13){var f=h.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||f.data==="$!"))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break;for(;h.sibling===null;){if(h.return===null||h.return===a)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var Qc=[];function Kc(){for(var a=0;a<Qc.length;a++)Qc[a]._workInProgressVersionPrimary=null;Qc.length=0}var $l=P.ReactCurrentDispatcher,Jc=P.ReactCurrentBatchConfig,ps=0,bt=null,Qt=null,ii=null,eu=!1,Sa=!1,Aa=0,FE=0;function Ei(){throw Error(t(321))}function $c(a,h){if(h===null)return!1;for(var f=0;f<h.length&&f<a.length;f++)if(!ur(a[f],h[f]))return!1;return!0}function ed(a,h,f,g,x,w){if(ps=w,bt=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,$l.current=a===null||a.memoizedState===null?HE:zE,a=f(g,x),Sa){w=0;do{if(Sa=!1,Aa=0,25<=w)throw Error(t(301));w+=1,ii=Qt=null,h.updateQueue=null,$l.current=GE,a=f(g,x)}while(Sa)}if($l.current=ru,h=Qt!==null&&Qt.next!==null,ps=0,ii=Qt=bt=null,eu=!1,h)throw Error(t(300));return a}function td(){var a=Aa!==0;return Aa=0,a}function Lr(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ii===null?bt.memoizedState=ii=a:ii=ii.next=a,ii}function Ji(){if(Qt===null){var a=bt.alternate;a=a!==null?a.memoizedState:null}else a=Qt.next;var h=ii===null?bt.memoizedState:ii.next;if(h!==null)ii=h,Qt=a;else{if(a===null)throw Error(t(310));Qt=a,a={memoizedState:Qt.memoizedState,baseState:Qt.baseState,baseQueue:Qt.baseQueue,queue:Qt.queue,next:null},ii===null?bt.memoizedState=ii=a:ii=ii.next=a}return ii}function ba(a,h){return typeof h=="function"?h(a):h}function id(a){var h=Ji(),f=h.queue;if(f===null)throw Error(t(311));f.lastRenderedReducer=a;var g=Qt,x=g.baseQueue,w=f.pending;if(w!==null){if(x!==null){var O=x.next;x.next=w.next,w.next=O}g.baseQueue=x=w,f.pending=null}if(x!==null){w=x.next,g=g.baseState;var B=O=null,V=null,J=w;do{var fe=J.lane;if((ps&fe)===fe)V!==null&&(V=V.next={lane:0,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null}),g=J.hasEagerState?J.eagerState:a(g,J.action);else{var ye={lane:fe,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null};V===null?(B=V=ye,O=g):V=V.next=ye,bt.lanes|=fe,ms|=fe}J=J.next}while(J!==null&&J!==w);V===null?O=g:V.next=B,ur(g,h.memoizedState)||(Ni=!0),h.memoizedState=g,h.baseState=O,h.baseQueue=V,f.lastRenderedState=g}if(a=f.interleaved,a!==null){x=a;do w=x.lane,bt.lanes|=w,ms|=w,x=x.next;while(x!==a)}else x===null&&(f.lanes=0);return[h.memoizedState,f.dispatch]}function rd(a){var h=Ji(),f=h.queue;if(f===null)throw Error(t(311));f.lastRenderedReducer=a;var g=f.dispatch,x=f.pending,w=h.memoizedState;if(x!==null){f.pending=null;var O=x=x.next;do w=a(w,O.action),O=O.next;while(O!==x);ur(w,h.memoizedState)||(Ni=!0),h.memoizedState=w,h.baseQueue===null&&(h.baseState=w),f.lastRenderedState=w}return[w,g]}function Vg(){}function jg(a,h){var f=bt,g=Ji(),x=h(),w=!ur(g.memoizedState,x);if(w&&(g.memoizedState=x,Ni=!0),g=g.queue,nd(Yg.bind(null,f,g,a),[a]),g.getSnapshot!==h||w||ii!==null&&ii.memoizedState.tag&1){if(f.flags|=2048,Ca(9,Wg.bind(null,f,g,x,h),void 0,null),ri===null)throw Error(t(349));(ps&30)!==0||Xg(f,h,x)}return x}function Xg(a,h,f){a.flags|=16384,a={getSnapshot:h,value:f},h=bt.updateQueue,h===null?(h={lastEffect:null,stores:null},bt.updateQueue=h,h.stores=[a]):(f=h.stores,f===null?h.stores=[a]:f.push(a))}function Wg(a,h,f,g){h.value=f,h.getSnapshot=g,qg(h)&&Zg(a)}function Yg(a,h,f){return f(function(){qg(h)&&Zg(a)})}function qg(a){var h=a.getSnapshot;a=a.value;try{var f=h();return!ur(a,f)}catch{return!0}}function Zg(a){var h=on(a,1);h!==null&&pr(h,a,1,-1)}function Qg(a){var h=Lr();return typeof a=="function"&&(a=a()),h.memoizedState=h.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ba,lastRenderedState:a},h.queue=a,a=a.dispatch=UE.bind(null,bt,a),[h.memoizedState,a]}function Ca(a,h,f,g){return a={tag:a,create:h,destroy:f,deps:g,next:null},h=bt.updateQueue,h===null?(h={lastEffect:null,stores:null},bt.updateQueue=h,h.lastEffect=a.next=a):(f=h.lastEffect,f===null?h.lastEffect=a.next=a:(g=f.next,f.next=a,a.next=g,h.lastEffect=a)),a}function Kg(){return Ji().memoizedState}function tu(a,h,f,g){var x=Lr();bt.flags|=a,x.memoizedState=Ca(1|h,f,void 0,g===void 0?null:g)}function iu(a,h,f,g){var x=Ji();g=g===void 0?null:g;var w=void 0;if(Qt!==null){var O=Qt.memoizedState;if(w=O.destroy,g!==null&&$c(g,O.deps)){x.memoizedState=Ca(h,f,w,g);return}}bt.flags|=a,x.memoizedState=Ca(1|h,f,w,g)}function Jg(a,h){return tu(8390656,8,a,h)}function nd(a,h){return iu(2048,8,a,h)}function $g(a,h){return iu(4,2,a,h)}function ey(a,h){return iu(4,4,a,h)}function ty(a,h){if(typeof h=="function")return a=a(),h(a),function(){h(null)};if(h!=null)return a=a(),h.current=a,function(){h.current=null}}function iy(a,h,f){return f=f!=null?f.concat([a]):null,iu(4,4,ty.bind(null,h,a),f)}function sd(){}function ry(a,h){var f=Ji();h=h===void 0?null:h;var g=f.memoizedState;return g!==null&&h!==null&&$c(h,g[1])?g[0]:(f.memoizedState=[a,h],a)}function ny(a,h){var f=Ji();h=h===void 0?null:h;var g=f.memoizedState;return g!==null&&h!==null&&$c(h,g[1])?g[0]:(a=a(),f.memoizedState=[a,h],a)}function sy(a,h,f){return(ps&21)===0?(a.baseState&&(a.baseState=!1,Ni=!0),a.memoizedState=f):(ur(f,h)||(f=Lm(),bt.lanes|=f,ms|=f,a.baseState=!0),h)}function BE(a,h){var f=ft;ft=f!==0&&4>f?f:4,a(!0);var g=Jc.transition;Jc.transition={};try{a(!1),h()}finally{ft=f,Jc.transition=g}}function oy(){return Ji().memoizedState}function kE(a,h,f){var g=Fn(a);if(f={lane:g,action:f,hasEagerState:!1,eagerState:null,next:null},ay(a))ly(h,f);else if(f=kg(a,h,f,g),f!==null){var x=Ri();pr(f,a,g,x),uy(f,h,g)}}function UE(a,h,f){var g=Fn(a),x={lane:g,action:f,hasEagerState:!1,eagerState:null,next:null};if(ay(a))ly(h,x);else{var w=a.alternate;if(a.lanes===0&&(w===null||w.lanes===0)&&(w=h.lastRenderedReducer,w!==null))try{var O=h.lastRenderedState,B=w(O,f);if(x.hasEagerState=!0,x.eagerState=B,ur(B,O)){var V=h.interleaved;V===null?(x.next=x,Wc(h)):(x.next=V.next,V.next=x),h.interleaved=x;return}}catch{}finally{}f=kg(a,h,x,g),f!==null&&(x=Ri(),pr(f,a,g,x),uy(f,h,g))}}function ay(a){var h=a.alternate;return a===bt||h!==null&&h===bt}function ly(a,h){Sa=eu=!0;var f=a.pending;f===null?h.next=h:(h.next=f.next,f.next=h),a.pending=h}function uy(a,h,f){if((f&4194240)!==0){var g=h.lanes;g&=a.pendingLanes,f|=g,h.lanes=f,ac(a,f)}}var ru={readContext:Ki,useCallback:Ei,useContext:Ei,useEffect:Ei,useImperativeHandle:Ei,useInsertionEffect:Ei,useLayoutEffect:Ei,useMemo:Ei,useReducer:Ei,useRef:Ei,useState:Ei,useDebugValue:Ei,useDeferredValue:Ei,useTransition:Ei,useMutableSource:Ei,useSyncExternalStore:Ei,useId:Ei,unstable_isNewReconciler:!1},HE={readContext:Ki,useCallback:function(a,h){return Lr().memoizedState=[a,h===void 0?null:h],a},useContext:Ki,useEffect:Jg,useImperativeHandle:function(a,h,f){return f=f!=null?f.concat([a]):null,tu(4194308,4,ty.bind(null,h,a),f)},useLayoutEffect:function(a,h){return tu(4194308,4,a,h)},useInsertionEffect:function(a,h){return tu(4,2,a,h)},useMemo:function(a,h){var f=Lr();return h=h===void 0?null:h,a=a(),f.memoizedState=[a,h],a},useReducer:function(a,h,f){var g=Lr();return h=f!==void 0?f(h):h,g.memoizedState=g.baseState=h,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:h},g.queue=a,a=a.dispatch=kE.bind(null,bt,a),[g.memoizedState,a]},useRef:function(a){var h=Lr();return a={current:a},h.memoizedState=a},useState:Qg,useDebugValue:sd,useDeferredValue:function(a){return Lr().memoizedState=a},useTransition:function(){var a=Qg(!1),h=a[0];return a=BE.bind(null,a[1]),Lr().memoizedState=a,[h,a]},useMutableSource:function(){},useSyncExternalStore:function(a,h,f){var g=bt,x=Lr();if(Tt){if(f===void 0)throw Error(t(407));f=f()}else{if(f=h(),ri===null)throw Error(t(349));(ps&30)!==0||Xg(g,h,f)}x.memoizedState=f;var w={value:f,getSnapshot:h};return x.queue=w,Jg(Yg.bind(null,g,w,a),[a]),g.flags|=2048,Ca(9,Wg.bind(null,g,w,f,h),void 0,null),f},useId:function(){var a=Lr(),h=ri.identifierPrefix;if(Tt){var f=sn,g=nn;f=(g&~(1<<32-lr(g)-1)).toString(32)+f,h=":"+h+"R"+f,f=Aa++,0<f&&(h+="H"+f.toString(32)),h+=":"}else f=FE++,h=":"+h+"r"+f.toString(32)+":";return a.memoizedState=h},unstable_isNewReconciler:!1},zE={readContext:Ki,useCallback:ry,useContext:Ki,useEffect:nd,useImperativeHandle:iy,useInsertionEffect:$g,useLayoutEffect:ey,useMemo:ny,useReducer:id,useRef:Kg,useState:function(){return id(ba)},useDebugValue:sd,useDeferredValue:function(a){var h=Ji();return sy(h,Qt.memoizedState,a)},useTransition:function(){var a=id(ba)[0],h=Ji().memoizedState;return[a,h]},useMutableSource:Vg,useSyncExternalStore:jg,useId:oy,unstable_isNewReconciler:!1},GE={readContext:Ki,useCallback:ry,useContext:Ki,useEffect:nd,useImperativeHandle:iy,useInsertionEffect:$g,useLayoutEffect:ey,useMemo:ny,useReducer:rd,useRef:Kg,useState:function(){return rd(ba)},useDebugValue:sd,useDeferredValue:function(a){var h=Ji();return Qt===null?h.memoizedState=a:sy(h,Qt.memoizedState,a)},useTransition:function(){var a=rd(ba)[0],h=Ji().memoizedState;return[a,h]},useMutableSource:Vg,useSyncExternalStore:jg,useId:oy,unstable_isNewReconciler:!1};function cr(a,h){if(a&&a.defaultProps){h=z({},h),a=a.defaultProps;for(var f in a)h[f]===void 0&&(h[f]=a[f]);return h}return h}function od(a,h,f,g){h=a.memoizedState,f=f(g,h),f=f==null?h:z({},h,f),a.memoizedState=f,a.lanes===0&&(a.updateQueue.baseState=f)}var nu={isMounted:function(a){return(a=a._reactInternals)?as(a)===a:!1},enqueueSetState:function(a,h,f){a=a._reactInternals;var g=Ri(),x=Fn(a),w=an(g,x);w.payload=h,f!=null&&(w.callback=f),h=Mn(a,w,x),h!==null&&(pr(h,a,x,g),Ql(h,a,x))},enqueueReplaceState:function(a,h,f){a=a._reactInternals;var g=Ri(),x=Fn(a),w=an(g,x);w.tag=1,w.payload=h,f!=null&&(w.callback=f),h=Mn(a,w,x),h!==null&&(pr(h,a,x,g),Ql(h,a,x))},enqueueForceUpdate:function(a,h){a=a._reactInternals;var f=Ri(),g=Fn(a),x=an(f,g);x.tag=2,h!=null&&(x.callback=h),h=Mn(a,x,g),h!==null&&(pr(h,a,g,f),Ql(h,a,g))}};function hy(a,h,f,g,x,w,O){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(g,w,O):h.prototype&&h.prototype.isPureReactComponent?!fa(f,g)||!fa(x,w):!0}function cy(a,h,f){var g=!1,x=Pn,w=h.contextType;return typeof w=="object"&&w!==null?w=Ki(w):(x=Mi(h)?us:wi.current,g=h.contextTypes,w=(g=g!=null)?io(a,x):Pn),h=new h(f,w),a.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=nu,a.stateNode=h,h._reactInternals=a,g&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=x,a.__reactInternalMemoizedMaskedChildContext=w),h}function dy(a,h,f,g){a=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(f,g),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(f,g),h.state!==a&&nu.enqueueReplaceState(h,h.state,null)}function ad(a,h,f,g){var x=a.stateNode;x.props=f,x.state=a.memoizedState,x.refs={},Yc(a);var w=h.contextType;typeof w=="object"&&w!==null?x.context=Ki(w):(w=Mi(h)?us:wi.current,x.context=io(a,w)),x.state=a.memoizedState,w=h.getDerivedStateFromProps,typeof w=="function"&&(od(a,h,w,f),x.state=a.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(h=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),h!==x.state&&nu.enqueueReplaceState(x,x.state,null),Kl(a,f,x,g),x.state=a.memoizedState),typeof x.componentDidMount=="function"&&(a.flags|=4194308)}function ho(a,h){try{var f="",g=h;do f+=me(g),g=g.return;while(g);var x=f}catch(w){x=`
Error generating stack: `+w.message+`
`+w.stack}return{value:a,source:h,stack:x,digest:null}}function ld(a,h,f){return{value:a,source:null,stack:f??null,digest:h??null}}function ud(a,h){try{console.error(h.value)}catch(f){setTimeout(function(){throw f})}}var VE=typeof WeakMap=="function"?WeakMap:Map;function fy(a,h,f){f=an(-1,f),f.tag=3,f.payload={element:null};var g=h.value;return f.callback=function(){cu||(cu=!0,Sd=g),ud(a,h)},f}function py(a,h,f){f=an(-1,f),f.tag=3;var g=a.type.getDerivedStateFromError;if(typeof g=="function"){var x=h.value;f.payload=function(){return g(x)},f.callback=function(){ud(a,h)}}var w=a.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(f.callback=function(){ud(a,h),typeof g!="function"&&(Dn===null?Dn=new Set([this]):Dn.add(this));var O=h.stack;this.componentDidCatch(h.value,{componentStack:O!==null?O:""})}),f}function my(a,h,f){var g=a.pingCache;if(g===null){g=a.pingCache=new VE;var x=new Set;g.set(h,x)}else x=g.get(h),x===void 0&&(x=new Set,g.set(h,x));x.has(f)||(x.add(f),a=r1.bind(null,a,h,f),h.then(a,a))}function gy(a){do{var h;if((h=a.tag===13)&&(h=a.memoizedState,h=h!==null?h.dehydrated!==null:!0),h)return a;a=a.return}while(a!==null);return null}function yy(a,h,f,g,x){return(a.mode&1)===0?(a===h?a.flags|=65536:(a.flags|=128,f.flags|=131072,f.flags&=-52805,f.tag===1&&(f.alternate===null?f.tag=17:(h=an(-1,1),h.tag=2,Mn(f,h,1))),f.lanes|=1),a):(a.flags|=65536,a.lanes=x,a)}var jE=P.ReactCurrentOwner,Ni=!1;function Ci(a,h,f,g){h.child=a===null?Bg(h,null,f,g):oo(h,a.child,f,g)}function vy(a,h,f,g,x){f=f.render;var w=h.ref;return lo(h,x),g=ed(a,h,f,g,w,x),f=td(),a!==null&&!Ni?(h.updateQueue=a.updateQueue,h.flags&=-2053,a.lanes&=~x,ln(a,h,x)):(Tt&&f&&Bc(h),h.flags|=1,Ci(a,h,g,x),h.child)}function _y(a,h,f,g,x){if(a===null){var w=f.type;return typeof w=="function"&&!Id(w)&&w.defaultProps===void 0&&f.compare===null&&f.defaultProps===void 0?(h.tag=15,h.type=w,xy(a,h,w,g,x)):(a=yu(f.type,null,g,h,h.mode,x),a.ref=h.ref,a.return=h,h.child=a)}if(w=a.child,(a.lanes&x)===0){var O=w.memoizedProps;if(f=f.compare,f=f!==null?f:fa,f(O,g)&&a.ref===h.ref)return ln(a,h,x)}return h.flags|=1,a=kn(w,g),a.ref=h.ref,a.return=h,h.child=a}function xy(a,h,f,g,x){if(a!==null){var w=a.memoizedProps;if(fa(w,g)&&a.ref===h.ref)if(Ni=!1,h.pendingProps=g=w,(a.lanes&x)!==0)(a.flags&131072)!==0&&(Ni=!0);else return h.lanes=a.lanes,ln(a,h,x)}return hd(a,h,f,g,x)}function Ty(a,h,f){var g=h.pendingProps,x=g.children,w=a!==null?a.memoizedState:null;if(g.mode==="hidden")if((h.mode&1)===0)h.memoizedState={baseLanes:0,cachePool:null,transitions:null},yt(fo,Gi),Gi|=f;else{if((f&1073741824)===0)return a=w!==null?w.baseLanes|f:f,h.lanes=h.childLanes=1073741824,h.memoizedState={baseLanes:a,cachePool:null,transitions:null},h.updateQueue=null,yt(fo,Gi),Gi|=a,null;h.memoizedState={baseLanes:0,cachePool:null,transitions:null},g=w!==null?w.baseLanes:f,yt(fo,Gi),Gi|=g}else w!==null?(g=w.baseLanes|f,h.memoizedState=null):g=f,yt(fo,Gi),Gi|=g;return Ci(a,h,x,f),h.child}function wy(a,h){var f=h.ref;(a===null&&f!==null||a!==null&&a.ref!==f)&&(h.flags|=512,h.flags|=2097152)}function hd(a,h,f,g,x){var w=Mi(f)?us:wi.current;return w=io(h,w),lo(h,x),f=ed(a,h,f,g,w,x),g=td(),a!==null&&!Ni?(h.updateQueue=a.updateQueue,h.flags&=-2053,a.lanes&=~x,ln(a,h,x)):(Tt&&g&&Bc(h),h.flags|=1,Ci(a,h,f,x),h.child)}function Ey(a,h,f,g,x){if(Mi(f)){var w=!0;Gl(h)}else w=!1;if(lo(h,x),h.stateNode===null)ou(a,h),cy(h,f,g),ad(h,f,g,x),g=!0;else if(a===null){var O=h.stateNode,B=h.memoizedProps;O.props=B;var V=O.context,J=f.contextType;typeof J=="object"&&J!==null?J=Ki(J):(J=Mi(f)?us:wi.current,J=io(h,J));var fe=f.getDerivedStateFromProps,ye=typeof fe=="function"||typeof O.getSnapshotBeforeUpdate=="function";ye||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(B!==g||V!==J)&&dy(h,O,g,J),In=!1;var ce=h.memoizedState;O.state=ce,Kl(h,g,O,x),V=h.memoizedState,B!==g||ce!==V||Ii.current||In?(typeof fe=="function"&&(od(h,f,fe,g),V=h.memoizedState),(B=In||hy(h,f,B,g,ce,V,J))?(ye||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount()),typeof O.componentDidMount=="function"&&(h.flags|=4194308)):(typeof O.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=g,h.memoizedState=V),O.props=g,O.state=V,O.context=J,g=B):(typeof O.componentDidMount=="function"&&(h.flags|=4194308),g=!1)}else{O=h.stateNode,Ug(a,h),B=h.memoizedProps,J=h.type===h.elementType?B:cr(h.type,B),O.props=J,ye=h.pendingProps,ce=O.context,V=f.contextType,typeof V=="object"&&V!==null?V=Ki(V):(V=Mi(f)?us:wi.current,V=io(h,V));var be=f.getDerivedStateFromProps;(fe=typeof be=="function"||typeof O.getSnapshotBeforeUpdate=="function")||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(B!==ye||ce!==V)&&dy(h,O,g,V),In=!1,ce=h.memoizedState,O.state=ce,Kl(h,g,O,x);var Ie=h.memoizedState;B!==ye||ce!==Ie||Ii.current||In?(typeof be=="function"&&(od(h,f,be,g),Ie=h.memoizedState),(J=In||hy(h,f,J,g,ce,Ie,V)||!1)?(fe||typeof O.UNSAFE_componentWillUpdate!="function"&&typeof O.componentWillUpdate!="function"||(typeof O.componentWillUpdate=="function"&&O.componentWillUpdate(g,Ie,V),typeof O.UNSAFE_componentWillUpdate=="function"&&O.UNSAFE_componentWillUpdate(g,Ie,V)),typeof O.componentDidUpdate=="function"&&(h.flags|=4),typeof O.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof O.componentDidUpdate!="function"||B===a.memoizedProps&&ce===a.memoizedState||(h.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||B===a.memoizedProps&&ce===a.memoizedState||(h.flags|=1024),h.memoizedProps=g,h.memoizedState=Ie),O.props=g,O.state=Ie,O.context=V,g=J):(typeof O.componentDidUpdate!="function"||B===a.memoizedProps&&ce===a.memoizedState||(h.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||B===a.memoizedProps&&ce===a.memoizedState||(h.flags|=1024),g=!1)}return cd(a,h,f,g,w,x)}function cd(a,h,f,g,x,w){wy(a,h);var O=(h.flags&128)!==0;if(!g&&!O)return x&&Rg(h,f,!1),ln(a,h,w);g=h.stateNode,jE.current=h;var B=O&&typeof f.getDerivedStateFromError!="function"?null:g.render();return h.flags|=1,a!==null&&O?(h.child=oo(h,a.child,null,w),h.child=oo(h,null,B,w)):Ci(a,h,B,w),h.memoizedState=g.state,x&&Rg(h,f,!0),h.child}function Sy(a){var h=a.stateNode;h.pendingContext?bg(a,h.pendingContext,h.pendingContext!==h.context):h.context&&bg(a,h.context,!1),qc(a,h.containerInfo)}function Ay(a,h,f,g,x){return so(),zc(x),h.flags|=256,Ci(a,h,f,g),h.child}var dd={dehydrated:null,treeContext:null,retryLane:0};function fd(a){return{baseLanes:a,cachePool:null,transitions:null}}function by(a,h,f){var g=h.pendingProps,x=At.current,w=!1,O=(h.flags&128)!==0,B;if((B=O)||(B=a!==null&&a.memoizedState===null?!1:(x&2)!==0),B?(w=!0,h.flags&=-129):(a===null||a.memoizedState!==null)&&(x|=1),yt(At,x&1),a===null)return Hc(h),a=h.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((h.mode&1)===0?h.lanes=1:a.data==="$!"?h.lanes=8:h.lanes=1073741824,null):(O=g.children,a=g.fallback,w?(g=h.mode,w=h.child,O={mode:"hidden",children:O},(g&1)===0&&w!==null?(w.childLanes=0,w.pendingProps=O):w=vu(O,g,0,null),a=_s(a,g,f,null),w.return=h,a.return=h,w.sibling=a,h.child=w,h.child.memoizedState=fd(f),h.memoizedState=dd,a):pd(h,O));if(x=a.memoizedState,x!==null&&(B=x.dehydrated,B!==null))return XE(a,h,O,g,B,x,f);if(w){w=g.fallback,O=h.mode,x=a.child,B=x.sibling;var V={mode:"hidden",children:g.children};return(O&1)===0&&h.child!==x?(g=h.child,g.childLanes=0,g.pendingProps=V,h.deletions=null):(g=kn(x,V),g.subtreeFlags=x.subtreeFlags&14680064),B!==null?w=kn(B,w):(w=_s(w,O,f,null),w.flags|=2),w.return=h,g.return=h,g.sibling=w,h.child=g,g=w,w=h.child,O=a.child.memoizedState,O=O===null?fd(f):{baseLanes:O.baseLanes|f,cachePool:null,transitions:O.transitions},w.memoizedState=O,w.childLanes=a.childLanes&~f,h.memoizedState=dd,g}return w=a.child,a=w.sibling,g=kn(w,{mode:"visible",children:g.children}),(h.mode&1)===0&&(g.lanes=f),g.return=h,g.sibling=null,a!==null&&(f=h.deletions,f===null?(h.deletions=[a],h.flags|=16):f.push(a)),h.child=g,h.memoizedState=null,g}function pd(a,h){return h=vu({mode:"visible",children:h},a.mode,0,null),h.return=a,a.child=h}function su(a,h,f,g){return g!==null&&zc(g),oo(h,a.child,null,f),a=pd(h,h.pendingProps.children),a.flags|=2,h.memoizedState=null,a}function XE(a,h,f,g,x,w,O){if(f)return h.flags&256?(h.flags&=-257,g=ld(Error(t(422))),su(a,h,O,g)):h.memoizedState!==null?(h.child=a.child,h.flags|=128,null):(w=g.fallback,x=h.mode,g=vu({mode:"visible",children:g.children},x,0,null),w=_s(w,x,O,null),w.flags|=2,g.return=h,w.return=h,g.sibling=w,h.child=g,(h.mode&1)!==0&&oo(h,a.child,null,O),h.child.memoizedState=fd(O),h.memoizedState=dd,w);if((h.mode&1)===0)return su(a,h,O,null);if(x.data==="$!"){if(g=x.nextSibling&&x.nextSibling.dataset,g)var B=g.dgst;return g=B,w=Error(t(419)),g=ld(w,g,void 0),su(a,h,O,g)}if(B=(O&a.childLanes)!==0,Ni||B){if(g=ri,g!==null){switch(O&-O){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=(x&(g.suspendedLanes|O))!==0?0:x,x!==0&&x!==w.retryLane&&(w.retryLane=x,on(a,x),pr(g,a,x,-1))}return Od(),g=ld(Error(t(421))),su(a,h,O,g)}return x.data==="$?"?(h.flags|=128,h.child=a.child,h=n1.bind(null,a),x._reactRetry=h,null):(a=w.treeContext,zi=Cn(x.nextSibling),Hi=h,Tt=!0,hr=null,a!==null&&(Zi[Qi++]=nn,Zi[Qi++]=sn,Zi[Qi++]=hs,nn=a.id,sn=a.overflow,hs=h),h=pd(h,g.children),h.flags|=4096,h)}function Cy(a,h,f){a.lanes|=h;var g=a.alternate;g!==null&&(g.lanes|=h),Xc(a.return,h,f)}function md(a,h,f,g,x){var w=a.memoizedState;w===null?a.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:g,tail:f,tailMode:x}:(w.isBackwards=h,w.rendering=null,w.renderingStartTime=0,w.last=g,w.tail=f,w.tailMode=x)}function Ry(a,h,f){var g=h.pendingProps,x=g.revealOrder,w=g.tail;if(Ci(a,h,g.children,f),g=At.current,(g&2)!==0)g=g&1|2,h.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=h.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Cy(a,f,h);else if(a.tag===19)Cy(a,f,h);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===h)break e;for(;a.sibling===null;){if(a.return===null||a.return===h)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}g&=1}if(yt(At,g),(h.mode&1)===0)h.memoizedState=null;else switch(x){case"forwards":for(f=h.child,x=null;f!==null;)a=f.alternate,a!==null&&Jl(a)===null&&(x=f),f=f.sibling;f=x,f===null?(x=h.child,h.child=null):(x=f.sibling,f.sibling=null),md(h,!1,x,f,w);break;case"backwards":for(f=null,x=h.child,h.child=null;x!==null;){if(a=x.alternate,a!==null&&Jl(a)===null){h.child=x;break}a=x.sibling,x.sibling=f,f=x,x=a}md(h,!0,f,null,w);break;case"together":md(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function ou(a,h){(h.mode&1)===0&&a!==null&&(a.alternate=null,h.alternate=null,h.flags|=2)}function ln(a,h,f){if(a!==null&&(h.dependencies=a.dependencies),ms|=h.lanes,(f&h.childLanes)===0)return null;if(a!==null&&h.child!==a.child)throw Error(t(153));if(h.child!==null){for(a=h.child,f=kn(a,a.pendingProps),h.child=f,f.return=h;a.sibling!==null;)a=a.sibling,f=f.sibling=kn(a,a.pendingProps),f.return=h;f.sibling=null}return h.child}function WE(a,h,f){switch(h.tag){case 3:Sy(h),so();break;case 5:Gg(h);break;case 1:Mi(h.type)&&Gl(h);break;case 4:qc(h,h.stateNode.containerInfo);break;case 10:var g=h.type._context,x=h.memoizedProps.value;yt(ql,g._currentValue),g._currentValue=x;break;case 13:if(g=h.memoizedState,g!==null)return g.dehydrated!==null?(yt(At,At.current&1),h.flags|=128,null):(f&h.child.childLanes)!==0?by(a,h,f):(yt(At,At.current&1),a=ln(a,h,f),a!==null?a.sibling:null);yt(At,At.current&1);break;case 19:if(g=(f&h.childLanes)!==0,(a.flags&128)!==0){if(g)return Ry(a,h,f);h.flags|=128}if(x=h.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),yt(At,At.current),g)break;return null;case 22:case 23:return h.lanes=0,Ty(a,h,f)}return ln(a,h,f)}var Py,gd,Oy,Iy;Py=function(a,h){for(var f=h.child;f!==null;){if(f.tag===5||f.tag===6)a.appendChild(f.stateNode);else if(f.tag!==4&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===h)break;for(;f.sibling===null;){if(f.return===null||f.return===h)return;f=f.return}f.sibling.return=f.return,f=f.sibling}},gd=function(){},Oy=function(a,h,f,g){var x=a.memoizedProps;if(x!==g){a=h.stateNode,fs(Dr.current);var w=null;switch(f){case"input":x=ti(a,x),g=ti(a,g),w=[];break;case"select":x=z({},x,{value:void 0}),g=z({},g,{value:void 0}),w=[];break;case"textarea":x=Ne(a,x),g=Ne(a,g),w=[];break;default:typeof x.onClick!="function"&&typeof g.onClick=="function"&&(a.onclick=Ul)}lt(f,g);var O;f=null;for(J in x)if(!g.hasOwnProperty(J)&&x.hasOwnProperty(J)&&x[J]!=null)if(J==="style"){var B=x[J];for(O in B)B.hasOwnProperty(O)&&(f||(f={}),f[O]="")}else J!=="dangerouslySetInnerHTML"&&J!=="children"&&J!=="suppressContentEditableWarning"&&J!=="suppressHydrationWarning"&&J!=="autoFocus"&&(n.hasOwnProperty(J)?w||(w=[]):(w=w||[]).push(J,null));for(J in g){var V=g[J];if(B=x!=null?x[J]:void 0,g.hasOwnProperty(J)&&V!==B&&(V!=null||B!=null))if(J==="style")if(B){for(O in B)!B.hasOwnProperty(O)||V&&V.hasOwnProperty(O)||(f||(f={}),f[O]="");for(O in V)V.hasOwnProperty(O)&&B[O]!==V[O]&&(f||(f={}),f[O]=V[O])}else f||(w||(w=[]),w.push(J,f)),f=V;else J==="dangerouslySetInnerHTML"?(V=V?V.__html:void 0,B=B?B.__html:void 0,V!=null&&B!==V&&(w=w||[]).push(J,V)):J==="children"?typeof V!="string"&&typeof V!="number"||(w=w||[]).push(J,""+V):J!=="suppressContentEditableWarning"&&J!=="suppressHydrationWarning"&&(n.hasOwnProperty(J)?(V!=null&&J==="onScroll"&&vt("scroll",a),w||B===V||(w=[])):(w=w||[]).push(J,V))}f&&(w=w||[]).push("style",f);var J=w;(h.updateQueue=J)&&(h.flags|=4)}},Iy=function(a,h,f,g){f!==g&&(h.flags|=4)};function Ra(a,h){if(!Tt)switch(a.tailMode){case"hidden":h=a.tail;for(var f=null;h!==null;)h.alternate!==null&&(f=h),h=h.sibling;f===null?a.tail=null:f.sibling=null;break;case"collapsed":f=a.tail;for(var g=null;f!==null;)f.alternate!==null&&(g=f),f=f.sibling;g===null?h||a.tail===null?a.tail=null:a.tail.sibling=null:g.sibling=null}}function Si(a){var h=a.alternate!==null&&a.alternate.child===a.child,f=0,g=0;if(h)for(var x=a.child;x!==null;)f|=x.lanes|x.childLanes,g|=x.subtreeFlags&14680064,g|=x.flags&14680064,x.return=a,x=x.sibling;else for(x=a.child;x!==null;)f|=x.lanes|x.childLanes,g|=x.subtreeFlags,g|=x.flags,x.return=a,x=x.sibling;return a.subtreeFlags|=g,a.childLanes=f,h}function YE(a,h,f){var g=h.pendingProps;switch(kc(h),h.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Si(h),null;case 1:return Mi(h.type)&&zl(),Si(h),null;case 3:return g=h.stateNode,uo(),_t(Ii),_t(wi),Kc(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(a===null||a.child===null)&&(Wl(h)?h.flags|=4:a===null||a.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,hr!==null&&(Cd(hr),hr=null))),gd(a,h),Si(h),null;case 5:Zc(h);var x=fs(Ea.current);if(f=h.type,a!==null&&h.stateNode!=null)Oy(a,h,f,g,x),a.ref!==h.ref&&(h.flags|=512,h.flags|=2097152);else{if(!g){if(h.stateNode===null)throw Error(t(166));return Si(h),null}if(a=fs(Dr.current),Wl(h)){g=h.stateNode,f=h.type;var w=h.memoizedProps;switch(g[Nr]=h,g[va]=w,a=(h.mode&1)!==0,f){case"dialog":vt("cancel",g),vt("close",g);break;case"iframe":case"object":case"embed":vt("load",g);break;case"video":case"audio":for(x=0;x<ma.length;x++)vt(ma[x],g);break;case"source":vt("error",g);break;case"img":case"image":case"link":vt("error",g),vt("load",g);break;case"details":vt("toggle",g);break;case"input":Zt(g,w),vt("invalid",g);break;case"select":g._wrapperState={wasMultiple:!!w.multiple},vt("invalid",g);break;case"textarea":ue(g,w),vt("invalid",g)}lt(f,w),x=null;for(var O in w)if(w.hasOwnProperty(O)){var B=w[O];O==="children"?typeof B=="string"?g.textContent!==B&&(w.suppressHydrationWarning!==!0&&kl(g.textContent,B,a),x=["children",B]):typeof B=="number"&&g.textContent!==""+B&&(w.suppressHydrationWarning!==!0&&kl(g.textContent,B,a),x=["children",""+B]):n.hasOwnProperty(O)&&B!=null&&O==="onScroll"&&vt("scroll",g)}switch(f){case"input":Je(g),M(g,w,!0);break;case"textarea":Je(g),at(g);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(g.onclick=Ul)}g=x,h.updateQueue=g,g!==null&&(h.flags|=4)}else{O=x.nodeType===9?x:x.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=mt(f)),a==="http://www.w3.org/1999/xhtml"?f==="script"?(a=O.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof g.is=="string"?a=O.createElement(f,{is:g.is}):(a=O.createElement(f),f==="select"&&(O=a,g.multiple?O.multiple=!0:g.size&&(O.size=g.size))):a=O.createElementNS(a,f),a[Nr]=h,a[va]=g,Py(a,h,!1,!1),h.stateNode=a;e:{switch(O=ze(f,g),f){case"dialog":vt("cancel",a),vt("close",a),x=g;break;case"iframe":case"object":case"embed":vt("load",a),x=g;break;case"video":case"audio":for(x=0;x<ma.length;x++)vt(ma[x],a);x=g;break;case"source":vt("error",a),x=g;break;case"img":case"image":case"link":vt("error",a),vt("load",a),x=g;break;case"details":vt("toggle",a),x=g;break;case"input":Zt(a,g),x=ti(a,g),vt("invalid",a);break;case"option":x=g;break;case"select":a._wrapperState={wasMultiple:!!g.multiple},x=z({},g,{value:void 0}),vt("invalid",a);break;case"textarea":ue(a,g),x=Ne(a,g),vt("invalid",a);break;default:x=g}lt(f,x),B=x;for(w in B)if(B.hasOwnProperty(w)){var V=B[w];w==="style"?ve(a,V):w==="dangerouslySetInnerHTML"?(V=V?V.__html:void 0,V!=null&&R(a,V)):w==="children"?typeof V=="string"?(f!=="textarea"||V!=="")&&C(a,V):typeof V=="number"&&C(a,""+V):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(n.hasOwnProperty(w)?V!=null&&w==="onScroll"&&vt("scroll",a):V!=null&&A(a,w,V,O))}switch(f){case"input":Je(a),M(a,g,!1);break;case"textarea":Je(a),at(a);break;case"option":g.value!=null&&a.setAttribute("value",""+Te(g.value));break;case"select":a.multiple=!!g.multiple,w=g.value,w!=null?Ee(a,!!g.multiple,w,!1):g.defaultValue!=null&&Ee(a,!!g.multiple,g.defaultValue,!0);break;default:typeof x.onClick=="function"&&(a.onclick=Ul)}switch(f){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}}g&&(h.flags|=4)}h.ref!==null&&(h.flags|=512,h.flags|=2097152)}return Si(h),null;case 6:if(a&&h.stateNode!=null)Iy(a,h,a.memoizedProps,g);else{if(typeof g!="string"&&h.stateNode===null)throw Error(t(166));if(f=fs(Ea.current),fs(Dr.current),Wl(h)){if(g=h.stateNode,f=h.memoizedProps,g[Nr]=h,(w=g.nodeValue!==f)&&(a=Hi,a!==null))switch(a.tag){case 3:kl(g.nodeValue,f,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&kl(g.nodeValue,f,(a.mode&1)!==0)}w&&(h.flags|=4)}else g=(f.nodeType===9?f:f.ownerDocument).createTextNode(g),g[Nr]=h,h.stateNode=g}return Si(h),null;case 13:if(_t(At),g=h.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(Tt&&zi!==null&&(h.mode&1)!==0&&(h.flags&128)===0)Dg(),so(),h.flags|=98560,w=!1;else if(w=Wl(h),g!==null&&g.dehydrated!==null){if(a===null){if(!w)throw Error(t(318));if(w=h.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(t(317));w[Nr]=h}else so(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Si(h),w=!1}else hr!==null&&(Cd(hr),hr=null),w=!0;if(!w)return h.flags&65536?h:null}return(h.flags&128)!==0?(h.lanes=f,h):(g=g!==null,g!==(a!==null&&a.memoizedState!==null)&&g&&(h.child.flags|=8192,(h.mode&1)!==0&&(a===null||(At.current&1)!==0?Kt===0&&(Kt=3):Od())),h.updateQueue!==null&&(h.flags|=4),Si(h),null);case 4:return uo(),gd(a,h),a===null&&ga(h.stateNode.containerInfo),Si(h),null;case 10:return jc(h.type._context),Si(h),null;case 17:return Mi(h.type)&&zl(),Si(h),null;case 19:if(_t(At),w=h.memoizedState,w===null)return Si(h),null;if(g=(h.flags&128)!==0,O=w.rendering,O===null)if(g)Ra(w,!1);else{if(Kt!==0||a!==null&&(a.flags&128)!==0)for(a=h.child;a!==null;){if(O=Jl(a),O!==null){for(h.flags|=128,Ra(w,!1),g=O.updateQueue,g!==null&&(h.updateQueue=g,h.flags|=4),h.subtreeFlags=0,g=f,f=h.child;f!==null;)w=f,a=g,w.flags&=14680066,O=w.alternate,O===null?(w.childLanes=0,w.lanes=a,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=O.childLanes,w.lanes=O.lanes,w.child=O.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=O.memoizedProps,w.memoizedState=O.memoizedState,w.updateQueue=O.updateQueue,w.type=O.type,a=O.dependencies,w.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),f=f.sibling;return yt(At,At.current&1|2),h.child}a=a.sibling}w.tail!==null&&Ft()>po&&(h.flags|=128,g=!0,Ra(w,!1),h.lanes=4194304)}else{if(!g)if(a=Jl(O),a!==null){if(h.flags|=128,g=!0,f=a.updateQueue,f!==null&&(h.updateQueue=f,h.flags|=4),Ra(w,!0),w.tail===null&&w.tailMode==="hidden"&&!O.alternate&&!Tt)return Si(h),null}else 2*Ft()-w.renderingStartTime>po&&f!==1073741824&&(h.flags|=128,g=!0,Ra(w,!1),h.lanes=4194304);w.isBackwards?(O.sibling=h.child,h.child=O):(f=w.last,f!==null?f.sibling=O:h.child=O,w.last=O)}return w.tail!==null?(h=w.tail,w.rendering=h,w.tail=h.sibling,w.renderingStartTime=Ft(),h.sibling=null,f=At.current,yt(At,g?f&1|2:f&1),h):(Si(h),null);case 22:case 23:return Pd(),g=h.memoizedState!==null,a!==null&&a.memoizedState!==null!==g&&(h.flags|=8192),g&&(h.mode&1)!==0?(Gi&1073741824)!==0&&(Si(h),h.subtreeFlags&6&&(h.flags|=8192)):Si(h),null;case 24:return null;case 25:return null}throw Error(t(156,h.tag))}function qE(a,h){switch(kc(h),h.tag){case 1:return Mi(h.type)&&zl(),a=h.flags,a&65536?(h.flags=a&-65537|128,h):null;case 3:return uo(),_t(Ii),_t(wi),Kc(),a=h.flags,(a&65536)!==0&&(a&128)===0?(h.flags=a&-65537|128,h):null;case 5:return Zc(h),null;case 13:if(_t(At),a=h.memoizedState,a!==null&&a.dehydrated!==null){if(h.alternate===null)throw Error(t(340));so()}return a=h.flags,a&65536?(h.flags=a&-65537|128,h):null;case 19:return _t(At),null;case 4:return uo(),null;case 10:return jc(h.type._context),null;case 22:case 23:return Pd(),null;case 24:return null;default:return null}}var au=!1,Ai=!1,ZE=typeof WeakSet=="function"?WeakSet:Set,Oe=null;function co(a,h){var f=a.ref;if(f!==null)if(typeof f=="function")try{f(null)}catch(g){Lt(a,h,g)}else f.current=null}function yd(a,h,f){try{f()}catch(g){Lt(a,h,g)}}var My=!1;function QE(a,h){if(Pc=Cl,a=hg(),Tc(a)){if("selectionStart"in a)var f={start:a.selectionStart,end:a.selectionEnd};else e:{f=(f=a.ownerDocument)&&f.defaultView||window;var g=f.getSelection&&f.getSelection();if(g&&g.rangeCount!==0){f=g.anchorNode;var x=g.anchorOffset,w=g.focusNode;g=g.focusOffset;try{f.nodeType,w.nodeType}catch{f=null;break e}var O=0,B=-1,V=-1,J=0,fe=0,ye=a,ce=null;t:for(;;){for(var be;ye!==f||x!==0&&ye.nodeType!==3||(B=O+x),ye!==w||g!==0&&ye.nodeType!==3||(V=O+g),ye.nodeType===3&&(O+=ye.nodeValue.length),(be=ye.firstChild)!==null;)ce=ye,ye=be;for(;;){if(ye===a)break t;if(ce===f&&++J===x&&(B=O),ce===w&&++fe===g&&(V=O),(be=ye.nextSibling)!==null)break;ye=ce,ce=ye.parentNode}ye=be}f=B===-1||V===-1?null:{start:B,end:V}}else f=null}f=f||{start:0,end:0}}else f=null;for(Oc={focusedElem:a,selectionRange:f},Cl=!1,Oe=h;Oe!==null;)if(h=Oe,a=h.child,(h.subtreeFlags&1028)!==0&&a!==null)a.return=h,Oe=a;else for(;Oe!==null;){h=Oe;try{var Ie=h.alternate;if((h.flags&1024)!==0)switch(h.tag){case 0:case 11:case 15:break;case 1:if(Ie!==null){var Me=Ie.memoizedProps,Bt=Ie.memoizedState,Z=h.stateNode,X=Z.getSnapshotBeforeUpdate(h.elementType===h.type?Me:cr(h.type,Me),Bt);Z.__reactInternalSnapshotBeforeUpdate=X}break;case 3:var K=h.stateNode.containerInfo;K.nodeType===1?K.textContent="":K.nodeType===9&&K.documentElement&&K.removeChild(K.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(we){Lt(h,h.return,we)}if(a=h.sibling,a!==null){a.return=h.return,Oe=a;break}Oe=h.return}return Ie=My,My=!1,Ie}function Pa(a,h,f){var g=h.updateQueue;if(g=g!==null?g.lastEffect:null,g!==null){var x=g=g.next;do{if((x.tag&a)===a){var w=x.destroy;x.destroy=void 0,w!==void 0&&yd(h,f,w)}x=x.next}while(x!==g)}}function lu(a,h){if(h=h.updateQueue,h=h!==null?h.lastEffect:null,h!==null){var f=h=h.next;do{if((f.tag&a)===a){var g=f.create;f.destroy=g()}f=f.next}while(f!==h)}}function vd(a){var h=a.ref;if(h!==null){var f=a.stateNode;switch(a.tag){case 5:a=f;break;default:a=f}typeof h=="function"?h(a):h.current=a}}function Ny(a){var h=a.alternate;h!==null&&(a.alternate=null,Ny(h)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(h=a.stateNode,h!==null&&(delete h[Nr],delete h[va],delete h[Dc],delete h[ME],delete h[NE])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function Dy(a){return a.tag===5||a.tag===3||a.tag===4}function Ly(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Dy(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function _d(a,h,f){var g=a.tag;if(g===5||g===6)a=a.stateNode,h?f.nodeType===8?f.parentNode.insertBefore(a,h):f.insertBefore(a,h):(f.nodeType===8?(h=f.parentNode,h.insertBefore(a,f)):(h=f,h.appendChild(a)),f=f._reactRootContainer,f!=null||h.onclick!==null||(h.onclick=Ul));else if(g!==4&&(a=a.child,a!==null))for(_d(a,h,f),a=a.sibling;a!==null;)_d(a,h,f),a=a.sibling}function xd(a,h,f){var g=a.tag;if(g===5||g===6)a=a.stateNode,h?f.insertBefore(a,h):f.appendChild(a);else if(g!==4&&(a=a.child,a!==null))for(xd(a,h,f),a=a.sibling;a!==null;)xd(a,h,f),a=a.sibling}var pi=null,dr=!1;function Nn(a,h,f){for(f=f.child;f!==null;)Fy(a,h,f),f=f.sibling}function Fy(a,h,f){if(Mr&&typeof Mr.onCommitFiberUnmount=="function")try{Mr.onCommitFiberUnmount(Tl,f)}catch{}switch(f.tag){case 5:Ai||co(f,h);case 6:var g=pi,x=dr;pi=null,Nn(a,h,f),pi=g,dr=x,pi!==null&&(dr?(a=pi,f=f.stateNode,a.nodeType===8?a.parentNode.removeChild(f):a.removeChild(f)):pi.removeChild(f.stateNode));break;case 18:pi!==null&&(dr?(a=pi,f=f.stateNode,a.nodeType===8?Nc(a.parentNode,f):a.nodeType===1&&Nc(a,f),aa(a)):Nc(pi,f.stateNode));break;case 4:g=pi,x=dr,pi=f.stateNode.containerInfo,dr=!0,Nn(a,h,f),pi=g,dr=x;break;case 0:case 11:case 14:case 15:if(!Ai&&(g=f.updateQueue,g!==null&&(g=g.lastEffect,g!==null))){x=g=g.next;do{var w=x,O=w.destroy;w=w.tag,O!==void 0&&((w&2)!==0||(w&4)!==0)&&yd(f,h,O),x=x.next}while(x!==g)}Nn(a,h,f);break;case 1:if(!Ai&&(co(f,h),g=f.stateNode,typeof g.componentWillUnmount=="function"))try{g.props=f.memoizedProps,g.state=f.memoizedState,g.componentWillUnmount()}catch(B){Lt(f,h,B)}Nn(a,h,f);break;case 21:Nn(a,h,f);break;case 22:f.mode&1?(Ai=(g=Ai)||f.memoizedState!==null,Nn(a,h,f),Ai=g):Nn(a,h,f);break;default:Nn(a,h,f)}}function By(a){var h=a.updateQueue;if(h!==null){a.updateQueue=null;var f=a.stateNode;f===null&&(f=a.stateNode=new ZE),h.forEach(function(g){var x=s1.bind(null,a,g);f.has(g)||(f.add(g),g.then(x,x))})}}function fr(a,h){var f=h.deletions;if(f!==null)for(var g=0;g<f.length;g++){var x=f[g];try{var w=a,O=h,B=O;e:for(;B!==null;){switch(B.tag){case 5:pi=B.stateNode,dr=!1;break e;case 3:pi=B.stateNode.containerInfo,dr=!0;break e;case 4:pi=B.stateNode.containerInfo,dr=!0;break e}B=B.return}if(pi===null)throw Error(t(160));Fy(w,O,x),pi=null,dr=!1;var V=x.alternate;V!==null&&(V.return=null),x.return=null}catch(J){Lt(x,h,J)}}if(h.subtreeFlags&12854)for(h=h.child;h!==null;)ky(h,a),h=h.sibling}function ky(a,h){var f=a.alternate,g=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(fr(h,a),Fr(a),g&4){try{Pa(3,a,a.return),lu(3,a)}catch(Me){Lt(a,a.return,Me)}try{Pa(5,a,a.return)}catch(Me){Lt(a,a.return,Me)}}break;case 1:fr(h,a),Fr(a),g&512&&f!==null&&co(f,f.return);break;case 5:if(fr(h,a),Fr(a),g&512&&f!==null&&co(f,f.return),a.flags&32){var x=a.stateNode;try{C(x,"")}catch(Me){Lt(a,a.return,Me)}}if(g&4&&(x=a.stateNode,x!=null)){var w=a.memoizedProps,O=f!==null?f.memoizedProps:w,B=a.type,V=a.updateQueue;if(a.updateQueue=null,V!==null)try{B==="input"&&w.type==="radio"&&w.name!=null&&bi(x,w),ze(B,O);var J=ze(B,w);for(O=0;O<V.length;O+=2){var fe=V[O],ye=V[O+1];fe==="style"?ve(x,ye):fe==="dangerouslySetInnerHTML"?R(x,ye):fe==="children"?C(x,ye):A(x,fe,ye,J)}switch(B){case"input":b(x,w);break;case"textarea":We(x,w);break;case"select":var ce=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!w.multiple;var be=w.value;be!=null?Ee(x,!!w.multiple,be,!1):ce!==!!w.multiple&&(w.defaultValue!=null?Ee(x,!!w.multiple,w.defaultValue,!0):Ee(x,!!w.multiple,w.multiple?[]:"",!1))}x[va]=w}catch(Me){Lt(a,a.return,Me)}}break;case 6:if(fr(h,a),Fr(a),g&4){if(a.stateNode===null)throw Error(t(162));x=a.stateNode,w=a.memoizedProps;try{x.nodeValue=w}catch(Me){Lt(a,a.return,Me)}}break;case 3:if(fr(h,a),Fr(a),g&4&&f!==null&&f.memoizedState.isDehydrated)try{aa(h.containerInfo)}catch(Me){Lt(a,a.return,Me)}break;case 4:fr(h,a),Fr(a);break;case 13:fr(h,a),Fr(a),x=a.child,x.flags&8192&&(w=x.memoizedState!==null,x.stateNode.isHidden=w,!w||x.alternate!==null&&x.alternate.memoizedState!==null||(Ed=Ft())),g&4&&By(a);break;case 22:if(fe=f!==null&&f.memoizedState!==null,a.mode&1?(Ai=(J=Ai)||fe,fr(h,a),Ai=J):fr(h,a),Fr(a),g&8192){if(J=a.memoizedState!==null,(a.stateNode.isHidden=J)&&!fe&&(a.mode&1)!==0)for(Oe=a,fe=a.child;fe!==null;){for(ye=Oe=fe;Oe!==null;){switch(ce=Oe,be=ce.child,ce.tag){case 0:case 11:case 14:case 15:Pa(4,ce,ce.return);break;case 1:co(ce,ce.return);var Ie=ce.stateNode;if(typeof Ie.componentWillUnmount=="function"){g=ce,f=ce.return;try{h=g,Ie.props=h.memoizedProps,Ie.state=h.memoizedState,Ie.componentWillUnmount()}catch(Me){Lt(g,f,Me)}}break;case 5:co(ce,ce.return);break;case 22:if(ce.memoizedState!==null){zy(ye);continue}}be!==null?(be.return=ce,Oe=be):zy(ye)}fe=fe.sibling}e:for(fe=null,ye=a;;){if(ye.tag===5){if(fe===null){fe=ye;try{x=ye.stateNode,J?(w=x.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(B=ye.stateNode,V=ye.memoizedProps.style,O=V!=null&&V.hasOwnProperty("display")?V.display:null,B.style.display=ne("display",O))}catch(Me){Lt(a,a.return,Me)}}}else if(ye.tag===6){if(fe===null)try{ye.stateNode.nodeValue=J?"":ye.memoizedProps}catch(Me){Lt(a,a.return,Me)}}else if((ye.tag!==22&&ye.tag!==23||ye.memoizedState===null||ye===a)&&ye.child!==null){ye.child.return=ye,ye=ye.child;continue}if(ye===a)break e;for(;ye.sibling===null;){if(ye.return===null||ye.return===a)break e;fe===ye&&(fe=null),ye=ye.return}fe===ye&&(fe=null),ye.sibling.return=ye.return,ye=ye.sibling}}break;case 19:fr(h,a),Fr(a),g&4&&By(a);break;case 21:break;default:fr(h,a),Fr(a)}}function Fr(a){var h=a.flags;if(h&2){try{e:{for(var f=a.return;f!==null;){if(Dy(f)){var g=f;break e}f=f.return}throw Error(t(160))}switch(g.tag){case 5:var x=g.stateNode;g.flags&32&&(C(x,""),g.flags&=-33);var w=Ly(a);xd(a,w,x);break;case 3:case 4:var O=g.stateNode.containerInfo,B=Ly(a);_d(a,B,O);break;default:throw Error(t(161))}}catch(V){Lt(a,a.return,V)}a.flags&=-3}h&4096&&(a.flags&=-4097)}function KE(a,h,f){Oe=a,Uy(a)}function Uy(a,h,f){for(var g=(a.mode&1)!==0;Oe!==null;){var x=Oe,w=x.child;if(x.tag===22&&g){var O=x.memoizedState!==null||au;if(!O){var B=x.alternate,V=B!==null&&B.memoizedState!==null||Ai;B=au;var J=Ai;if(au=O,(Ai=V)&&!J)for(Oe=x;Oe!==null;)O=Oe,V=O.child,O.tag===22&&O.memoizedState!==null?Gy(x):V!==null?(V.return=O,Oe=V):Gy(x);for(;w!==null;)Oe=w,Uy(w),w=w.sibling;Oe=x,au=B,Ai=J}Hy(a)}else(x.subtreeFlags&8772)!==0&&w!==null?(w.return=x,Oe=w):Hy(a)}}function Hy(a){for(;Oe!==null;){var h=Oe;if((h.flags&8772)!==0){var f=h.alternate;try{if((h.flags&8772)!==0)switch(h.tag){case 0:case 11:case 15:Ai||lu(5,h);break;case 1:var g=h.stateNode;if(h.flags&4&&!Ai)if(f===null)g.componentDidMount();else{var x=h.elementType===h.type?f.memoizedProps:cr(h.type,f.memoizedProps);g.componentDidUpdate(x,f.memoizedState,g.__reactInternalSnapshotBeforeUpdate)}var w=h.updateQueue;w!==null&&zg(h,w,g);break;case 3:var O=h.updateQueue;if(O!==null){if(f=null,h.child!==null)switch(h.child.tag){case 5:f=h.child.stateNode;break;case 1:f=h.child.stateNode}zg(h,O,f)}break;case 5:var B=h.stateNode;if(f===null&&h.flags&4){f=B;var V=h.memoizedProps;switch(h.type){case"button":case"input":case"select":case"textarea":V.autoFocus&&f.focus();break;case"img":V.src&&(f.src=V.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(h.memoizedState===null){var J=h.alternate;if(J!==null){var fe=J.memoizedState;if(fe!==null){var ye=fe.dehydrated;ye!==null&&aa(ye)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Ai||h.flags&512&&vd(h)}catch(ce){Lt(h,h.return,ce)}}if(h===a){Oe=null;break}if(f=h.sibling,f!==null){f.return=h.return,Oe=f;break}Oe=h.return}}function zy(a){for(;Oe!==null;){var h=Oe;if(h===a){Oe=null;break}var f=h.sibling;if(f!==null){f.return=h.return,Oe=f;break}Oe=h.return}}function Gy(a){for(;Oe!==null;){var h=Oe;try{switch(h.tag){case 0:case 11:case 15:var f=h.return;try{lu(4,h)}catch(V){Lt(h,f,V)}break;case 1:var g=h.stateNode;if(typeof g.componentDidMount=="function"){var x=h.return;try{g.componentDidMount()}catch(V){Lt(h,x,V)}}var w=h.return;try{vd(h)}catch(V){Lt(h,w,V)}break;case 5:var O=h.return;try{vd(h)}catch(V){Lt(h,O,V)}}}catch(V){Lt(h,h.return,V)}if(h===a){Oe=null;break}var B=h.sibling;if(B!==null){B.return=h.return,Oe=B;break}Oe=h.return}}var JE=Math.ceil,uu=P.ReactCurrentDispatcher,Td=P.ReactCurrentOwner,$i=P.ReactCurrentBatchConfig,ut=0,ri=null,zt=null,mi=0,Gi=0,fo=Rn(0),Kt=0,Oa=null,ms=0,hu=0,wd=0,Ia=null,Di=null,Ed=0,po=1/0,un=null,cu=!1,Sd=null,Dn=null,du=!1,Ln=null,fu=0,Ma=0,Ad=null,pu=-1,mu=0;function Ri(){return(ut&6)!==0?Ft():pu!==-1?pu:pu=Ft()}function Fn(a){return(a.mode&1)===0?1:(ut&2)!==0&&mi!==0?mi&-mi:LE.transition!==null?(mu===0&&(mu=Lm()),mu):(a=ft,a!==0||(a=window.event,a=a===void 0?16:jm(a.type)),a)}function pr(a,h,f,g){if(50<Ma)throw Ma=0,Ad=null,Error(t(185));ia(a,f,g),((ut&2)===0||a!==ri)&&(a===ri&&((ut&2)===0&&(hu|=f),Kt===4&&Bn(a,mi)),Li(a,g),f===1&&ut===0&&(h.mode&1)===0&&(po=Ft()+500,Vl&&On()))}function Li(a,h){var f=a.callbackNode;Lw(a,h);var g=Sl(a,a===ri?mi:0);if(g===0)f!==null&&Mm(f),a.callbackNode=null,a.callbackPriority=0;else if(h=g&-g,a.callbackPriority!==h){if(f!=null&&Mm(f),h===1)a.tag===0?DE(jy.bind(null,a)):Pg(jy.bind(null,a)),OE(function(){(ut&6)===0&&On()}),f=null;else{switch(Fm(g)){case 1:f=nc;break;case 4:f=Nm;break;case 16:f=xl;break;case 536870912:f=Dm;break;default:f=xl}f=Jy(f,Vy.bind(null,a))}a.callbackPriority=h,a.callbackNode=f}}function Vy(a,h){if(pu=-1,mu=0,(ut&6)!==0)throw Error(t(327));var f=a.callbackNode;if(mo()&&a.callbackNode!==f)return null;var g=Sl(a,a===ri?mi:0);if(g===0)return null;if((g&30)!==0||(g&a.expiredLanes)!==0||h)h=gu(a,g);else{h=g;var x=ut;ut|=2;var w=Wy();(ri!==a||mi!==h)&&(un=null,po=Ft()+500,ys(a,h));do try{t1();break}catch(B){Xy(a,B)}while(!0);Vc(),uu.current=w,ut=x,zt!==null?h=0:(ri=null,mi=0,h=Kt)}if(h!==0){if(h===2&&(x=sc(a),x!==0&&(g=x,h=bd(a,x))),h===1)throw f=Oa,ys(a,0),Bn(a,g),Li(a,Ft()),f;if(h===6)Bn(a,g);else{if(x=a.current.alternate,(g&30)===0&&!$E(x)&&(h=gu(a,g),h===2&&(w=sc(a),w!==0&&(g=w,h=bd(a,w))),h===1))throw f=Oa,ys(a,0),Bn(a,g),Li(a,Ft()),f;switch(a.finishedWork=x,a.finishedLanes=g,h){case 0:case 1:throw Error(t(345));case 2:vs(a,Di,un);break;case 3:if(Bn(a,g),(g&130023424)===g&&(h=Ed+500-Ft(),10<h)){if(Sl(a,0)!==0)break;if(x=a.suspendedLanes,(x&g)!==g){Ri(),a.pingedLanes|=a.suspendedLanes&x;break}a.timeoutHandle=Mc(vs.bind(null,a,Di,un),h);break}vs(a,Di,un);break;case 4:if(Bn(a,g),(g&4194240)===g)break;for(h=a.eventTimes,x=-1;0<g;){var O=31-lr(g);w=1<<O,O=h[O],O>x&&(x=O),g&=~w}if(g=x,g=Ft()-g,g=(120>g?120:480>g?480:1080>g?1080:1920>g?1920:3e3>g?3e3:4320>g?4320:1960*JE(g/1960))-g,10<g){a.timeoutHandle=Mc(vs.bind(null,a,Di,un),g);break}vs(a,Di,un);break;case 5:vs(a,Di,un);break;default:throw Error(t(329))}}}return Li(a,Ft()),a.callbackNode===f?Vy.bind(null,a):null}function bd(a,h){var f=Ia;return a.current.memoizedState.isDehydrated&&(ys(a,h).flags|=256),a=gu(a,h),a!==2&&(h=Di,Di=f,h!==null&&Cd(h)),a}function Cd(a){Di===null?Di=a:Di.push.apply(Di,a)}function $E(a){for(var h=a;;){if(h.flags&16384){var f=h.updateQueue;if(f!==null&&(f=f.stores,f!==null))for(var g=0;g<f.length;g++){var x=f[g],w=x.getSnapshot;x=x.value;try{if(!ur(w(),x))return!1}catch{return!1}}}if(f=h.child,h.subtreeFlags&16384&&f!==null)f.return=h,h=f;else{if(h===a)break;for(;h.sibling===null;){if(h.return===null||h.return===a)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function Bn(a,h){for(h&=~wd,h&=~hu,a.suspendedLanes|=h,a.pingedLanes&=~h,a=a.expirationTimes;0<h;){var f=31-lr(h),g=1<<f;a[f]=-1,h&=~g}}function jy(a){if((ut&6)!==0)throw Error(t(327));mo();var h=Sl(a,0);if((h&1)===0)return Li(a,Ft()),null;var f=gu(a,h);if(a.tag!==0&&f===2){var g=sc(a);g!==0&&(h=g,f=bd(a,g))}if(f===1)throw f=Oa,ys(a,0),Bn(a,h),Li(a,Ft()),f;if(f===6)throw Error(t(345));return a.finishedWork=a.current.alternate,a.finishedLanes=h,vs(a,Di,un),Li(a,Ft()),null}function Rd(a,h){var f=ut;ut|=1;try{return a(h)}finally{ut=f,ut===0&&(po=Ft()+500,Vl&&On())}}function gs(a){Ln!==null&&Ln.tag===0&&(ut&6)===0&&mo();var h=ut;ut|=1;var f=$i.transition,g=ft;try{if($i.transition=null,ft=1,a)return a()}finally{ft=g,$i.transition=f,ut=h,(ut&6)===0&&On()}}function Pd(){Gi=fo.current,_t(fo)}function ys(a,h){a.finishedWork=null,a.finishedLanes=0;var f=a.timeoutHandle;if(f!==-1&&(a.timeoutHandle=-1,PE(f)),zt!==null)for(f=zt.return;f!==null;){var g=f;switch(kc(g),g.tag){case 1:g=g.type.childContextTypes,g!=null&&zl();break;case 3:uo(),_t(Ii),_t(wi),Kc();break;case 5:Zc(g);break;case 4:uo();break;case 13:_t(At);break;case 19:_t(At);break;case 10:jc(g.type._context);break;case 22:case 23:Pd()}f=f.return}if(ri=a,zt=a=kn(a.current,null),mi=Gi=h,Kt=0,Oa=null,wd=hu=ms=0,Di=Ia=null,ds!==null){for(h=0;h<ds.length;h++)if(f=ds[h],g=f.interleaved,g!==null){f.interleaved=null;var x=g.next,w=f.pending;if(w!==null){var O=w.next;w.next=x,g.next=O}f.pending=g}ds=null}return a}function Xy(a,h){do{var f=zt;try{if(Vc(),$l.current=ru,eu){for(var g=bt.memoizedState;g!==null;){var x=g.queue;x!==null&&(x.pending=null),g=g.next}eu=!1}if(ps=0,ii=Qt=bt=null,Sa=!1,Aa=0,Td.current=null,f===null||f.return===null){Kt=1,Oa=h,zt=null;break}e:{var w=a,O=f.return,B=f,V=h;if(h=mi,B.flags|=32768,V!==null&&typeof V=="object"&&typeof V.then=="function"){var J=V,fe=B,ye=fe.tag;if((fe.mode&1)===0&&(ye===0||ye===11||ye===15)){var ce=fe.alternate;ce?(fe.updateQueue=ce.updateQueue,fe.memoizedState=ce.memoizedState,fe.lanes=ce.lanes):(fe.updateQueue=null,fe.memoizedState=null)}var be=gy(O);if(be!==null){be.flags&=-257,yy(be,O,B,w,h),be.mode&1&&my(w,J,h),h=be,V=J;var Ie=h.updateQueue;if(Ie===null){var Me=new Set;Me.add(V),h.updateQueue=Me}else Ie.add(V);break e}else{if((h&1)===0){my(w,J,h),Od();break e}V=Error(t(426))}}else if(Tt&&B.mode&1){var Bt=gy(O);if(Bt!==null){(Bt.flags&65536)===0&&(Bt.flags|=256),yy(Bt,O,B,w,h),zc(ho(V,B));break e}}w=V=ho(V,B),Kt!==4&&(Kt=2),Ia===null?Ia=[w]:Ia.push(w),w=O;do{switch(w.tag){case 3:w.flags|=65536,h&=-h,w.lanes|=h;var Z=fy(w,V,h);Hg(w,Z);break e;case 1:B=V;var X=w.type,K=w.stateNode;if((w.flags&128)===0&&(typeof X.getDerivedStateFromError=="function"||K!==null&&typeof K.componentDidCatch=="function"&&(Dn===null||!Dn.has(K)))){w.flags|=65536,h&=-h,w.lanes|=h;var we=py(w,B,h);Hg(w,we);break e}}w=w.return}while(w!==null)}qy(f)}catch(Fe){h=Fe,zt===f&&f!==null&&(zt=f=f.return);continue}break}while(!0)}function Wy(){var a=uu.current;return uu.current=ru,a===null?ru:a}function Od(){(Kt===0||Kt===3||Kt===2)&&(Kt=4),ri===null||(ms&268435455)===0&&(hu&268435455)===0||Bn(ri,mi)}function gu(a,h){var f=ut;ut|=2;var g=Wy();(ri!==a||mi!==h)&&(un=null,ys(a,h));do try{e1();break}catch(x){Xy(a,x)}while(!0);if(Vc(),ut=f,uu.current=g,zt!==null)throw Error(t(261));return ri=null,mi=0,Kt}function e1(){for(;zt!==null;)Yy(zt)}function t1(){for(;zt!==null&&!bw();)Yy(zt)}function Yy(a){var h=Ky(a.alternate,a,Gi);a.memoizedProps=a.pendingProps,h===null?qy(a):zt=h,Td.current=null}function qy(a){var h=a;do{var f=h.alternate;if(a=h.return,(h.flags&32768)===0){if(f=YE(f,h,Gi),f!==null){zt=f;return}}else{if(f=qE(f,h),f!==null){f.flags&=32767,zt=f;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{Kt=6,zt=null;return}}if(h=h.sibling,h!==null){zt=h;return}zt=h=a}while(h!==null);Kt===0&&(Kt=5)}function vs(a,h,f){var g=ft,x=$i.transition;try{$i.transition=null,ft=1,i1(a,h,f,g)}finally{$i.transition=x,ft=g}return null}function i1(a,h,f,g){do mo();while(Ln!==null);if((ut&6)!==0)throw Error(t(327));f=a.finishedWork;var x=a.finishedLanes;if(f===null)return null;if(a.finishedWork=null,a.finishedLanes=0,f===a.current)throw Error(t(177));a.callbackNode=null,a.callbackPriority=0;var w=f.lanes|f.childLanes;if(Fw(a,w),a===ri&&(zt=ri=null,mi=0),(f.subtreeFlags&2064)===0&&(f.flags&2064)===0||du||(du=!0,Jy(xl,function(){return mo(),null})),w=(f.flags&15990)!==0,(f.subtreeFlags&15990)!==0||w){w=$i.transition,$i.transition=null;var O=ft;ft=1;var B=ut;ut|=4,Td.current=null,QE(a,f),ky(f,a),wE(Oc),Cl=!!Pc,Oc=Pc=null,a.current=f,KE(f),Cw(),ut=B,ft=O,$i.transition=w}else a.current=f;if(du&&(du=!1,Ln=a,fu=x),w=a.pendingLanes,w===0&&(Dn=null),Ow(f.stateNode),Li(a,Ft()),h!==null)for(g=a.onRecoverableError,f=0;f<h.length;f++)x=h[f],g(x.value,{componentStack:x.stack,digest:x.digest});if(cu)throw cu=!1,a=Sd,Sd=null,a;return(fu&1)!==0&&a.tag!==0&&mo(),w=a.pendingLanes,(w&1)!==0?a===Ad?Ma++:(Ma=0,Ad=a):Ma=0,On(),null}function mo(){if(Ln!==null){var a=Fm(fu),h=$i.transition,f=ft;try{if($i.transition=null,ft=16>a?16:a,Ln===null)var g=!1;else{if(a=Ln,Ln=null,fu=0,(ut&6)!==0)throw Error(t(331));var x=ut;for(ut|=4,Oe=a.current;Oe!==null;){var w=Oe,O=w.child;if((Oe.flags&16)!==0){var B=w.deletions;if(B!==null){for(var V=0;V<B.length;V++){var J=B[V];for(Oe=J;Oe!==null;){var fe=Oe;switch(fe.tag){case 0:case 11:case 15:Pa(8,fe,w)}var ye=fe.child;if(ye!==null)ye.return=fe,Oe=ye;else for(;Oe!==null;){fe=Oe;var ce=fe.sibling,be=fe.return;if(Ny(fe),fe===J){Oe=null;break}if(ce!==null){ce.return=be,Oe=ce;break}Oe=be}}}var Ie=w.alternate;if(Ie!==null){var Me=Ie.child;if(Me!==null){Ie.child=null;do{var Bt=Me.sibling;Me.sibling=null,Me=Bt}while(Me!==null)}}Oe=w}}if((w.subtreeFlags&2064)!==0&&O!==null)O.return=w,Oe=O;else e:for(;Oe!==null;){if(w=Oe,(w.flags&2048)!==0)switch(w.tag){case 0:case 11:case 15:Pa(9,w,w.return)}var Z=w.sibling;if(Z!==null){Z.return=w.return,Oe=Z;break e}Oe=w.return}}var X=a.current;for(Oe=X;Oe!==null;){O=Oe;var K=O.child;if((O.subtreeFlags&2064)!==0&&K!==null)K.return=O,Oe=K;else e:for(O=X;Oe!==null;){if(B=Oe,(B.flags&2048)!==0)try{switch(B.tag){case 0:case 11:case 15:lu(9,B)}}catch(Fe){Lt(B,B.return,Fe)}if(B===O){Oe=null;break e}var we=B.sibling;if(we!==null){we.return=B.return,Oe=we;break e}Oe=B.return}}if(ut=x,On(),Mr&&typeof Mr.onPostCommitFiberRoot=="function")try{Mr.onPostCommitFiberRoot(Tl,a)}catch{}g=!0}return g}finally{ft=f,$i.transition=h}}return!1}function Zy(a,h,f){h=ho(f,h),h=fy(a,h,1),a=Mn(a,h,1),h=Ri(),a!==null&&(ia(a,1,h),Li(a,h))}function Lt(a,h,f){if(a.tag===3)Zy(a,a,f);else for(;h!==null;){if(h.tag===3){Zy(h,a,f);break}else if(h.tag===1){var g=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(Dn===null||!Dn.has(g))){a=ho(f,a),a=py(h,a,1),h=Mn(h,a,1),a=Ri(),h!==null&&(ia(h,1,a),Li(h,a));break}}h=h.return}}function r1(a,h,f){var g=a.pingCache;g!==null&&g.delete(h),h=Ri(),a.pingedLanes|=a.suspendedLanes&f,ri===a&&(mi&f)===f&&(Kt===4||Kt===3&&(mi&130023424)===mi&&500>Ft()-Ed?ys(a,0):wd|=f),Li(a,h)}function Qy(a,h){h===0&&((a.mode&1)===0?h=1:(h=El,El<<=1,(El&130023424)===0&&(El=4194304)));var f=Ri();a=on(a,h),a!==null&&(ia(a,h,f),Li(a,f))}function n1(a){var h=a.memoizedState,f=0;h!==null&&(f=h.retryLane),Qy(a,f)}function s1(a,h){var f=0;switch(a.tag){case 13:var g=a.stateNode,x=a.memoizedState;x!==null&&(f=x.retryLane);break;case 19:g=a.stateNode;break;default:throw Error(t(314))}g!==null&&g.delete(h),Qy(a,f)}var Ky;Ky=function(a,h,f){if(a!==null)if(a.memoizedProps!==h.pendingProps||Ii.current)Ni=!0;else{if((a.lanes&f)===0&&(h.flags&128)===0)return Ni=!1,WE(a,h,f);Ni=(a.flags&131072)!==0}else Ni=!1,Tt&&(h.flags&1048576)!==0&&Og(h,Xl,h.index);switch(h.lanes=0,h.tag){case 2:var g=h.type;ou(a,h),a=h.pendingProps;var x=io(h,wi.current);lo(h,f),x=ed(null,h,g,a,x,f);var w=td();return h.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(h.tag=1,h.memoizedState=null,h.updateQueue=null,Mi(g)?(w=!0,Gl(h)):w=!1,h.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,Yc(h),x.updater=nu,h.stateNode=x,x._reactInternals=h,ad(h,g,a,f),h=cd(null,h,g,!0,w,f)):(h.tag=0,Tt&&w&&Bc(h),Ci(null,h,x,f),h=h.child),h;case 16:g=h.elementType;e:{switch(ou(a,h),a=h.pendingProps,x=g._init,g=x(g._payload),h.type=g,x=h.tag=a1(g),a=cr(g,a),x){case 0:h=hd(null,h,g,a,f);break e;case 1:h=Ey(null,h,g,a,f);break e;case 11:h=vy(null,h,g,a,f);break e;case 14:h=_y(null,h,g,cr(g.type,a),f);break e}throw Error(t(306,g,""))}return h;case 0:return g=h.type,x=h.pendingProps,x=h.elementType===g?x:cr(g,x),hd(a,h,g,x,f);case 1:return g=h.type,x=h.pendingProps,x=h.elementType===g?x:cr(g,x),Ey(a,h,g,x,f);case 3:e:{if(Sy(h),a===null)throw Error(t(387));g=h.pendingProps,w=h.memoizedState,x=w.element,Ug(a,h),Kl(h,g,null,f);var O=h.memoizedState;if(g=O.element,w.isDehydrated)if(w={element:g,isDehydrated:!1,cache:O.cache,pendingSuspenseBoundaries:O.pendingSuspenseBoundaries,transitions:O.transitions},h.updateQueue.baseState=w,h.memoizedState=w,h.flags&256){x=ho(Error(t(423)),h),h=Ay(a,h,g,f,x);break e}else if(g!==x){x=ho(Error(t(424)),h),h=Ay(a,h,g,f,x);break e}else for(zi=Cn(h.stateNode.containerInfo.firstChild),Hi=h,Tt=!0,hr=null,f=Bg(h,null,g,f),h.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling;else{if(so(),g===x){h=ln(a,h,f);break e}Ci(a,h,g,f)}h=h.child}return h;case 5:return Gg(h),a===null&&Hc(h),g=h.type,x=h.pendingProps,w=a!==null?a.memoizedProps:null,O=x.children,Ic(g,x)?O=null:w!==null&&Ic(g,w)&&(h.flags|=32),wy(a,h),Ci(a,h,O,f),h.child;case 6:return a===null&&Hc(h),null;case 13:return by(a,h,f);case 4:return qc(h,h.stateNode.containerInfo),g=h.pendingProps,a===null?h.child=oo(h,null,g,f):Ci(a,h,g,f),h.child;case 11:return g=h.type,x=h.pendingProps,x=h.elementType===g?x:cr(g,x),vy(a,h,g,x,f);case 7:return Ci(a,h,h.pendingProps,f),h.child;case 8:return Ci(a,h,h.pendingProps.children,f),h.child;case 12:return Ci(a,h,h.pendingProps.children,f),h.child;case 10:e:{if(g=h.type._context,x=h.pendingProps,w=h.memoizedProps,O=x.value,yt(ql,g._currentValue),g._currentValue=O,w!==null)if(ur(w.value,O)){if(w.children===x.children&&!Ii.current){h=ln(a,h,f);break e}}else for(w=h.child,w!==null&&(w.return=h);w!==null;){var B=w.dependencies;if(B!==null){O=w.child;for(var V=B.firstContext;V!==null;){if(V.context===g){if(w.tag===1){V=an(-1,f&-f),V.tag=2;var J=w.updateQueue;if(J!==null){J=J.shared;var fe=J.pending;fe===null?V.next=V:(V.next=fe.next,fe.next=V),J.pending=V}}w.lanes|=f,V=w.alternate,V!==null&&(V.lanes|=f),Xc(w.return,f,h),B.lanes|=f;break}V=V.next}}else if(w.tag===10)O=w.type===h.type?null:w.child;else if(w.tag===18){if(O=w.return,O===null)throw Error(t(341));O.lanes|=f,B=O.alternate,B!==null&&(B.lanes|=f),Xc(O,f,h),O=w.sibling}else O=w.child;if(O!==null)O.return=w;else for(O=w;O!==null;){if(O===h){O=null;break}if(w=O.sibling,w!==null){w.return=O.return,O=w;break}O=O.return}w=O}Ci(a,h,x.children,f),h=h.child}return h;case 9:return x=h.type,g=h.pendingProps.children,lo(h,f),x=Ki(x),g=g(x),h.flags|=1,Ci(a,h,g,f),h.child;case 14:return g=h.type,x=cr(g,h.pendingProps),x=cr(g.type,x),_y(a,h,g,x,f);case 15:return xy(a,h,h.type,h.pendingProps,f);case 17:return g=h.type,x=h.pendingProps,x=h.elementType===g?x:cr(g,x),ou(a,h),h.tag=1,Mi(g)?(a=!0,Gl(h)):a=!1,lo(h,f),cy(h,g,x),ad(h,g,x,f),cd(null,h,g,!0,a,f);case 19:return Ry(a,h,f);case 22:return Ty(a,h,f)}throw Error(t(156,h.tag))};function Jy(a,h){return Im(a,h)}function o1(a,h,f,g){this.tag=a,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function er(a,h,f,g){return new o1(a,h,f,g)}function Id(a){return a=a.prototype,!(!a||!a.isReactComponent)}function a1(a){if(typeof a=="function")return Id(a)?1:0;if(a!=null){if(a=a.$$typeof,a===H)return 11;if(a===$)return 14}return 2}function kn(a,h){var f=a.alternate;return f===null?(f=er(a.tag,h,a.key,a.mode),f.elementType=a.elementType,f.type=a.type,f.stateNode=a.stateNode,f.alternate=a,a.alternate=f):(f.pendingProps=h,f.type=a.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=a.flags&14680064,f.childLanes=a.childLanes,f.lanes=a.lanes,f.child=a.child,f.memoizedProps=a.memoizedProps,f.memoizedState=a.memoizedState,f.updateQueue=a.updateQueue,h=a.dependencies,f.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},f.sibling=a.sibling,f.index=a.index,f.ref=a.ref,f}function yu(a,h,f,g,x,w){var O=2;if(g=a,typeof a=="function")Id(a)&&(O=1);else if(typeof a=="string")O=5;else e:switch(a){case U:return _s(f.children,x,w,h);case j:O=8,x|=8;break;case q:return a=er(12,f,h,x|2),a.elementType=q,a.lanes=w,a;case F:return a=er(13,f,h,x),a.elementType=F,a.lanes=w,a;case G:return a=er(19,f,h,x),a.elementType=G,a.lanes=w,a;case ie:return vu(f,x,w,h);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case ee:O=10;break e;case pe:O=9;break e;case H:O=11;break e;case $:O=14;break e;case le:O=16,g=null;break e}throw Error(t(130,a==null?a:typeof a,""))}return h=er(O,f,h,x),h.elementType=a,h.type=g,h.lanes=w,h}function _s(a,h,f,g){return a=er(7,a,g,h),a.lanes=f,a}function vu(a,h,f,g){return a=er(22,a,g,h),a.elementType=ie,a.lanes=f,a.stateNode={isHidden:!1},a}function Md(a,h,f){return a=er(6,a,null,h),a.lanes=f,a}function Nd(a,h,f){return h=er(4,a.children!==null?a.children:[],a.key,h),h.lanes=f,h.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},h}function l1(a,h,f,g,x){this.tag=h,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=oc(0),this.expirationTimes=oc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=oc(0),this.identifierPrefix=g,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function Dd(a,h,f,g,x,w,O,B,V){return a=new l1(a,h,f,B,V),h===1?(h=1,w===!0&&(h|=8)):h=0,w=er(3,null,null,h),a.current=w,w.stateNode=a,w.memoizedState={element:g,isDehydrated:f,cache:null,transitions:null,pendingSuspenseBoundaries:null},Yc(w),a}function u1(a,h,f){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:k,key:g==null?null:""+g,children:a,containerInfo:h,implementation:f}}function $y(a){if(!a)return Pn;a=a._reactInternals;e:{if(as(a)!==a||a.tag!==1)throw Error(t(170));var h=a;do{switch(h.tag){case 3:h=h.stateNode.context;break e;case 1:if(Mi(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break e}}h=h.return}while(h!==null);throw Error(t(171))}if(a.tag===1){var f=a.type;if(Mi(f))return Cg(a,f,h)}return h}function ev(a,h,f,g,x,w,O,B,V){return a=Dd(f,g,!0,a,x,w,O,B,V),a.context=$y(null),f=a.current,g=Ri(),x=Fn(f),w=an(g,x),w.callback=h??null,Mn(f,w,x),a.current.lanes=x,ia(a,x,g),Li(a,g),a}function _u(a,h,f,g){var x=h.current,w=Ri(),O=Fn(x);return f=$y(f),h.context===null?h.context=f:h.pendingContext=f,h=an(w,O),h.payload={element:a},g=g===void 0?null:g,g!==null&&(h.callback=g),a=Mn(x,h,O),a!==null&&(pr(a,x,O,w),Ql(a,x,O)),O}function xu(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function tv(a,h){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var f=a.retryLane;a.retryLane=f!==0&&f<h?f:h}}function Ld(a,h){tv(a,h),(a=a.alternate)&&tv(a,h)}function h1(){return null}var iv=typeof reportError=="function"?reportError:function(a){console.error(a)};function Fd(a){this._internalRoot=a}Tu.prototype.render=Fd.prototype.render=function(a){var h=this._internalRoot;if(h===null)throw Error(t(409));_u(a,h,null,null)},Tu.prototype.unmount=Fd.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var h=a.containerInfo;gs(function(){_u(null,a,null,null)}),h[tn]=null}};function Tu(a){this._internalRoot=a}Tu.prototype.unstable_scheduleHydration=function(a){if(a){var h=Um();a={blockedOn:null,target:a,priority:h};for(var f=0;f<Sn.length&&h!==0&&h<Sn[f].priority;f++);Sn.splice(f,0,a),f===0&&Gm(a)}};function Bd(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function wu(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function rv(){}function c1(a,h,f,g,x){if(x){if(typeof g=="function"){var w=g;g=function(){var J=xu(O);w.call(J)}}var O=ev(h,g,a,0,null,!1,!1,"",rv);return a._reactRootContainer=O,a[tn]=O.current,ga(a.nodeType===8?a.parentNode:a),gs(),O}for(;x=a.lastChild;)a.removeChild(x);if(typeof g=="function"){var B=g;g=function(){var J=xu(V);B.call(J)}}var V=Dd(a,0,!1,null,null,!1,!1,"",rv);return a._reactRootContainer=V,a[tn]=V.current,ga(a.nodeType===8?a.parentNode:a),gs(function(){_u(h,V,f,g)}),V}function Eu(a,h,f,g,x){var w=f._reactRootContainer;if(w){var O=w;if(typeof x=="function"){var B=x;x=function(){var V=xu(O);B.call(V)}}_u(h,O,a,x)}else O=c1(f,h,a,x,g);return xu(O)}Bm=function(a){switch(a.tag){case 3:var h=a.stateNode;if(h.current.memoizedState.isDehydrated){var f=ta(h.pendingLanes);f!==0&&(ac(h,f|1),Li(h,Ft()),(ut&6)===0&&(po=Ft()+500,On()))}break;case 13:gs(function(){var g=on(a,1);if(g!==null){var x=Ri();pr(g,a,1,x)}}),Ld(a,1)}},lc=function(a){if(a.tag===13){var h=on(a,134217728);if(h!==null){var f=Ri();pr(h,a,134217728,f)}Ld(a,134217728)}},km=function(a){if(a.tag===13){var h=Fn(a),f=on(a,h);if(f!==null){var g=Ri();pr(f,a,h,g)}Ld(a,h)}},Um=function(){return ft},Hm=function(a,h){var f=ft;try{return ft=a,h()}finally{ft=f}},Ir=function(a,h,f){switch(h){case"input":if(b(a,f),h=f.name,f.type==="radio"&&h!=null){for(f=a;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll("input[name="+JSON.stringify(""+h)+'][type="radio"]'),h=0;h<f.length;h++){var g=f[h];if(g!==a&&g.form===a.form){var x=Hl(g);if(!x)throw Error(t(90));ht(g),b(g,x)}}}break;case"textarea":We(a,f);break;case"select":h=f.value,h!=null&&Ee(a,!!f.multiple,h,!1)}},Sm=Rd,Am=gs;var d1={usingClientEntryPoint:!1,Events:[_a,eo,Hl,wm,Em,Rd]},Na={findFiberByHostInstance:ls,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},f1={bundleType:Na.bundleType,version:Na.version,rendererPackageName:Na.rendererPackageName,rendererConfig:Na.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:P.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=Pm(a),a===null?null:a.stateNode},findFiberByHostInstance:Na.findFiberByHostInstance||h1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Su=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Su.isDisabled&&Su.supportsFiber)try{Tl=Su.inject(f1),Mr=Su}catch{}}return Fi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=d1,Fi.createPortal=function(a,h){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Bd(h))throw Error(t(200));return u1(a,h,null,f)},Fi.createRoot=function(a,h){if(!Bd(a))throw Error(t(299));var f=!1,g="",x=iv;return h!=null&&(h.unstable_strictMode===!0&&(f=!0),h.identifierPrefix!==void 0&&(g=h.identifierPrefix),h.onRecoverableError!==void 0&&(x=h.onRecoverableError)),h=Dd(a,1,!1,null,null,f,!1,g,x),a[tn]=h.current,ga(a.nodeType===8?a.parentNode:a),new Fd(h)},Fi.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var h=a._reactInternals;if(h===void 0)throw typeof a.render=="function"?Error(t(188)):(a=Object.keys(a).join(","),Error(t(268,a)));return a=Pm(h),a=a===null?null:a.stateNode,a},Fi.flushSync=function(a){return gs(a)},Fi.hydrate=function(a,h,f){if(!wu(h))throw Error(t(200));return Eu(null,a,h,!0,f)},Fi.hydrateRoot=function(a,h,f){if(!Bd(a))throw Error(t(405));var g=f!=null&&f.hydratedSources||null,x=!1,w="",O=iv;if(f!=null&&(f.unstable_strictMode===!0&&(x=!0),f.identifierPrefix!==void 0&&(w=f.identifierPrefix),f.onRecoverableError!==void 0&&(O=f.onRecoverableError)),h=ev(h,null,a,1,f??null,x,!1,w,O),a[tn]=h.current,ga(a),g)for(a=0;a<g.length;a++)f=g[a],x=f._getVersion,x=x(f._source),h.mutableSourceEagerHydrationData==null?h.mutableSourceEagerHydrationData=[f,x]:h.mutableSourceEagerHydrationData.push(f,x);return new Tu(h)},Fi.render=function(a,h,f){if(!wu(h))throw Error(t(200));return Eu(null,a,h,!1,f)},Fi.unmountComponentAtNode=function(a){if(!wu(a))throw Error(t(40));return a._reactRootContainer?(gs(function(){Eu(null,null,a,!1,function(){a._reactRootContainer=null,a[tn]=null})}),!0):!1},Fi.unstable_batchedUpdates=Rd,Fi.unstable_renderSubtreeIntoContainer=function(a,h,f,g){if(!wu(f))throw Error(t(200));if(a==null||a._reactInternals===void 0)throw Error(t(38));return Eu(a,h,f,!1,g)},Fi.version="18.3.1-next-f1338f8080-20240426",Fi}var cv;function w1(){if(cv)return Hd.exports;cv=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),Hd.exports=T1(),Hd.exports}var dt=Yp();const E1=Wp(dt),TD=m1({__proto__:null,default:E1},[dt]);var S1=w1();const wD=Wp(S1);var A1=(r=>(r.EDIT="EDIT",r.SELECT="SELECT",r.NONE="NONE",r))(A1||{});const gi=[];for(let r=0;r<256;++r)gi.push((r+256).toString(16).slice(1));function b1(r,e=0){return(gi[r[e+0]]+gi[r[e+1]]+gi[r[e+2]]+gi[r[e+3]]+"-"+gi[r[e+4]]+gi[r[e+5]]+"-"+gi[r[e+6]]+gi[r[e+7]]+"-"+gi[r[e+8]]+gi[r[e+9]]+"-"+gi[r[e+10]]+gi[r[e+11]]+gi[r[e+12]]+gi[r[e+13]]+gi[r[e+14]]+gi[r[e+15]]).toLowerCase()}let Vd;const C1=new Uint8Array(16);function R1(){if(!Vd){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Vd=crypto.getRandomValues.bind(crypto)}return Vd(C1)}const P1=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),dv={randomUUID:P1};function O1(r,e,t){var i;if(dv.randomUUID&&!r)return dv.randomUUID();r=r||{};const n=r.random??((i=r.rng)==null?void 0:i.call(r))??R1();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,b1(n)}const ED=(r,e,t,i)=>({id:O1(),annotation:typeof r=="string"?r:r.id,created:t||new Date,creator:i,...e});var I1=(r=>(r.LOCAL="LOCAL",r.REMOTE="REMOTE",r.SILENT="SILENT",r))(I1||{});const M1="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let N1=r=>crypto.getRandomValues(new Uint8Array(r)),D1=(r,e,t)=>{let i=(2<<Math.log2(r.length-1))-1,n=-~(1.6*i*e/r.length);return(s=e)=>{let o="";for(;;){let l=t(n),u=n|0;for(;u--;)if(o+=r[l[u]&i]||"",o.length>=s)return o}}},L1=(r,e=21)=>D1(r,e|0,N1),F1=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=M1[t[r]&63];return e};const B1=()=>({isGuest:!0,id:L1("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",20)()});F1();const Zp=dt.createContext({anno:void 0,setAnno:void 0,annotations:[],selection:{selected:[]}}),SD=dt.forwardRef((r,e)=>{const[t,i]=dt.useState(null),[n,s]=dt.useState([]),[o,l]=dt.useState({selected:[]});return dt.useImperativeHandle(e,()=>t),dt.useEffect(()=>{if(t){const{selection:u,store:c,hover:d}=t.state;c.all().length>0&&s(c.all());const p=()=>s(()=>c.all());c.observe(p);let m;const y=u.subscribe(({selected:v,..._})=>{m&&c.unobserve(m);const T=(v||[]).map(({id:E,editable:S})=>({annotation:c.getAnnotation(E),editable:S}));l({selected:T,..._}),m=E=>{const{updated:S}=E.changes;l(A=>({...A,selected:A.selected.map(({annotation:P,editable:D})=>{const k=S.find(U=>U.oldValue.id===P.id);return k?{annotation:k.newValue,editable:D}:{annotation:P,editable:D}})}))},c.observe(m,{annotations:v.map(({id:E})=>E)})});return()=>{c.unobserve(p),y()}}},[t]),qp.jsx(Zp.Provider,{value:{anno:t,setAnno:i,annotations:n,selection:o},children:r.children})}),k1=()=>{const{anno:r}=dt.useContext(Zp);return r},AD=r=>{const{onLoad:e,opts:t,plugin:i,pluginRef:n}=r,s=k1();return dt.useEffect(()=>{if(!s)return;const o=i(s,t);return n&&(n.current=o),e&&e(o),()=>{o&&"unmount"in o&&o.unmount(),n&&(n.current=null)}},[s,t,i,n]),null};var U1=Object.defineProperty,H1=(r,e,t)=>e in r?U1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,kt=(r,e,t)=>H1(r,typeof e!="symbol"?e+"":e,t);const z1="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(z1);var Wr=(r=>(r.ELLIPSE="ELLIPSE",r.MULTIPOLYGLON="MULTIPOLYGON",r.POLYGON="POLYGON",r.RECTANGLE="RECTANGLE",r))(Wr||{});const Qp=r=>{let e=1/0,t=1/0,i=-1/0,n=-1/0;return r.forEach(([s,o])=>{e=Math.min(e,s),t=Math.min(t,o),i=Math.max(i,s),n=Math.max(n,o)}),{minX:e,minY:t,maxX:i,maxY:n}},G1=(r,e=!0)=>{let t="M ";return r.forEach(([i,n],s)=>{s===0?t+=`${i},${n}`:t+=` L ${i},${n}`}),e&&(t+=" Z"),t},V1=r=>r.rings.map(e=>G1(e.points)).join(" "),j1=(r,e=!1)=>{const t=typeof r=="string"?r:r.value,i=/(xywh)=(pixel|percent)?:?(.+?),(.+?),(.+?),(.+)*/g,n=[...t.matchAll(i)][0],[s,o,l,u,c,d,p]=n;if(o!=="xywh")throw new Error("Unsupported MediaFragment: "+t);if(l&&l!=="pixel")throw new Error(`Unsupported MediaFragment unit: ${l}`);const[m,y,v,_]=[u,c,d,p].map(parseFloat);return{type:Wr.RECTANGLE,geometry:{x:m,y,w:v,h:_,bounds:{minX:m,minY:e?y-_:y,maxX:m+v,maxY:e?y:y+_}}}},X1=r=>{const{x:e,y:t,w:i,h:n}=r;return{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:`xywh=pixel:${e},${t},${i},${n}`}},Kx="http://www.w3.org/2000/svg",fv=r=>{const e=i=>{Array.from(i.attributes).forEach(n=>{n.name.startsWith("on")&&i.removeAttribute(n.name)})},t=r.getElementsByTagName("script");return Array.from(t).reverse().forEach(i=>i.parentNode.removeChild(i)),Array.from(r.querySelectorAll("*")).forEach(e),r},W1=r=>{const e=new XMLSerializer().serializeToString(r.documentElement).replace("<svg>",`<svg xmlns="${Kx}">`);return new DOMParser().parseFromString(e,"image/svg+xml").documentElement},Jx=r=>{const e=new DOMParser().parseFromString(r,"image/svg+xml"),t=e.lookupPrefix(Kx),i=e.lookupNamespaceURI(null);return t||i?fv(e).firstChild:fv(W1(e)).firstChild},Gt=" ";function Y1(r){let e="";Array.isArray(r)||(r=[r]);for(let t=0;t<r.length;t++){const i=r[t];if(i.type===se.CLOSE_PATH)e+="z";else if(i.type===se.HORIZ_LINE_TO)e+=(i.relative?"h":"H")+i.x;else if(i.type===se.VERT_LINE_TO)e+=(i.relative?"v":"V")+i.y;else if(i.type===se.MOVE_TO)e+=(i.relative?"m":"M")+i.x+Gt+i.y;else if(i.type===se.LINE_TO)e+=(i.relative?"l":"L")+i.x+Gt+i.y;else if(i.type===se.CURVE_TO)e+=(i.relative?"c":"C")+i.x1+Gt+i.y1+Gt+i.x2+Gt+i.y2+Gt+i.x+Gt+i.y;else if(i.type===se.SMOOTH_CURVE_TO)e+=(i.relative?"s":"S")+i.x2+Gt+i.y2+Gt+i.x+Gt+i.y;else if(i.type===se.QUAD_TO)e+=(i.relative?"q":"Q")+i.x1+Gt+i.y1+Gt+i.x+Gt+i.y;else if(i.type===se.SMOOTH_QUAD_TO)e+=(i.relative?"t":"T")+i.x+Gt+i.y;else if(i.type===se.ARC)e+=(i.relative?"a":"A")+i.rX+Gt+i.rY+Gt+i.xRot+Gt+ +i.lArcFlag+Gt+ +i.sweepFlag+Gt+i.x+Gt+i.y;else throw new Error(`Unexpected command type "${i==null?void 0:i.type}" at index ${t}.`)}return e}function Vf([r,e],t){return[r*Math.cos(t)-e*Math.sin(t),r*Math.sin(t)+e*Math.cos(t)]}function Sr(...r){for(let e=0;e<r.length;e++)if(typeof r[e]!="number")throw new Error(`assertNumbers arguments[${e}] is not a number. ${typeof r[e]} == typeof ${r[e]}`);return!0}const jn=Math.PI;function Kp(r,e,t){r.lArcFlag=r.lArcFlag===0?0:1,r.sweepFlag=r.sweepFlag===0?0:1;let{rX:i,rY:n}=r;const{x:s,y:o}=r;if(Math.abs(i)<1e-10||Math.abs(n)<1e-10){r.rX=0,r.rY=0,r.cX=(e+s)/2,r.cY=(t+o)/2,r.phi1=0,r.phi2=0;return}i=Math.abs(r.rX),n=Math.abs(r.rY);const l=r.xRot/180*jn,[u,c]=Vf([(e-s)/2,(t-o)/2],-l),d=Math.pow(u,2)/Math.pow(i,2)+Math.pow(c,2)/Math.pow(n,2);1<d&&(i*=Math.sqrt(d),n*=Math.sqrt(d)),r.rX=i,r.rY=n;const p=Math.pow(i,2)*Math.pow(c,2)+Math.pow(n,2)*Math.pow(u,2),m=(r.lArcFlag!==r.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(i,2)*Math.pow(n,2)-p)/p)),y=i*c/n*m,v=-n*u/i*m,_=Vf([y,v],l);r.cX=_[0]+(e+s)/2,r.cY=_[1]+(t+o)/2,r.phi1=Math.atan2((c-v)/n,(u-y)/i),r.phi2=Math.atan2((-c-v)/n,(-u-y)/i),r.sweepFlag===0&&r.phi2>r.phi1&&(r.phi2-=2*jn),r.sweepFlag===1&&r.phi2<r.phi1&&(r.phi2+=2*jn),r.phi1*=180/jn,r.phi2*=180/jn}function pv(r,e,t){Sr(r,e,t);const i=r*r+e*e-t*t;if(0>i)return[];if(i===0)return[[r*t/(r*r+e*e),e*t/(r*r+e*e)]];const n=Math.sqrt(i);return[[(r*t+e*n)/(r*r+e*e),(e*t-r*n)/(r*r+e*e)],[(r*t-e*n)/(r*r+e*e),(e*t+r*n)/(r*r+e*e)]]}const xs=Math.PI/180;function mv(r,e,t){return(1-t)*r+t*e}function gv(r,e,t,i){return r+Math.cos(i/180*jn)*e+Math.sin(i/180*jn)*t}function yv(r,e,t,i){const n=e-r,s=t-e,o=i-t,l=3*n+3*o-6*s,u=(s-n)*6,c=3*n;return Math.abs(l)<1e-6?Math.abs(u)<1e-6?[]:[-c/u]:q1(u/l,c/l,1e-6)}function vv(r,e,t,i,n){const s=1-n,o=s*s*s,l=3*s*s*n,u=3*s*n*n,c=n*n*n;return r*o+e*l+t*u+i*c}function q1(r,e,t=1e-6){const i=r*r/4-e;if(i<-t)return[];if(i<=t)return[-r/2];const n=Math.sqrt(i);return[-(r/2)-n,-(r/2)+n]}function Z1(r,e,t){r.cX||Kp(r,e,t);const i=r.xRot/180*jn;if(Math.abs(r.rX)<1e-10||Math.abs(r.rY)<1e-10)return[{relative:r.relative,type:se.CURVE_TO,x1:e+(r.x-e)/3,y1:t+(r.y-t)/3,x2:e+2*(r.x-e)/3,y2:t+2*(r.y-t)/3,x:r.x,y:r.y}];const n=Math.min(r.phi1,r.phi2),s=Math.max(r.phi1,r.phi2),o=s-n,l=Math.ceil(o/90),u=new Array(l);let c=e,d=t;const p=(m,y)=>{const[v,_]=Vf([m*r.rX,y*r.rY],i);return[r.cX+v,r.cY+_]};for(let m=0;m<l;m++){const y=mv(r.phi1,r.phi2,m/l),v=mv(r.phi1,r.phi2,(m+1)/l),_=v-y,T=4/3*Math.tan(_*xs/4),E=Math.cos(y*xs)-T*Math.sin(y*xs),S=Math.sin(y*xs)+T*Math.cos(y*xs),A=Math.cos(v*xs),P=Math.sin(v*xs),D=A+T*P,k=P-T*A,U=p(E,S),j=p(D,k),q=p(A,P),ee={relative:r.relative,type:se.CURVE_TO,x:q[0],y:q[1],x1:U[0],y1:U[1],x2:j[0],y2:j[1]};r.relative&&(ee.x1-=c,ee.y1-=d,ee.x2-=c,ee.y2-=d,ee.x-=c,ee.y-=d),c=q[0],d=q[1],u[m]=ee}return u}function jd(r,e,t){const i=e[0]-r[0],n=e[1]-r[1],s=t[0]-r[0],o=t[1]-r[1],l=i*o-n*s;if(!(Math.abs(l)<1e-10))return!1;const u=i*s+n*o,c=i*i+n*n,d=s*s+o*o;return 0<=u&&u<=d&&c<=d}function Q1(r,e=!0){if(r.length<2)return r;const t=Xt.INFO((s,o,l)=>({...s,x:s.x??o,y:s.y??l,relative:s.relative??!1})),i=[];let n=[];for(const s of r){const o=t(s);o.type===se.MOVE_TO&&n.length>0&&(e?i.push(...Au(n)):i.unshift(...Au(n)),n=[]),n.push(o)}return n.length>0&&(e?i.push(...Au(n)):i.unshift(...Au(n))),i}function Au(r){var e;const t=((e=r[r.length-1])==null?void 0:e.type)===se.CLOSE_PATH,i=t?r.length-2:r.length-1,n=[{type:se.MOVE_TO,relative:!1,x:r[i].x,y:r[i].y}];for(let s=i;s>0;s--){const o=r[s],l=r[s-1];if(o.relative)throw new Error("Relative command are not supported convert first with `toAbs()`");switch(o.type){case se.HORIZ_LINE_TO:n.push({type:se.HORIZ_LINE_TO,relative:!1,x:l.x});break;case se.VERT_LINE_TO:n.push({type:se.VERT_LINE_TO,relative:!1,y:l.y});break;case se.LINE_TO:case se.MOVE_TO:n.push({type:se.LINE_TO,relative:!1,x:l.x,y:l.y});break;case se.CURVE_TO:n.push({type:se.CURVE_TO,relative:!1,x:l.x,y:l.y,x1:o.x2,y1:o.y2,x2:o.x1,y2:o.y1});break;case se.SMOOTH_CURVE_TO:throw new Error("Unsupported command: S (smooth cubic bezier)");case se.SMOOTH_QUAD_TO:throw new Error("Unsupported command: T (smooth quadratic bezier)");case se.ARC:throw new Error("Unsupported command: A (arc)");case se.QUAD_TO:throw new Error("Unsupported command: Q (quadratic bezier)")}}return t&&n.push({type:se.CLOSE_PATH}),n}function K1(r=1e13){Sr(r);function e(t){return Math.round(t*r)/r}return function(t){return"x1"in t&&typeof t.x1<"u"&&(t.x1=e(t.x1)),"y1"in t&&typeof t.y1<"u"&&(t.y1=e(t.y1)),"x2"in t&&typeof t.x2<"u"&&(t.x2=e(t.x2)),"y2"in t&&typeof t.y2<"u"&&(t.y2=e(t.y2)),"x"in t&&typeof t.x<"u"&&(t.x=e(t.x)),"y"in t&&typeof t.y<"u"&&(t.y=e(t.y)),"rX"in t&&typeof t.rX<"u"&&(t.rX=e(t.rX)),"rY"in t&&typeof t.rY<"u"&&(t.rY=e(t.rY)),t}}function $x(){return Ar((r,e,t)=>(r.relative&&(typeof r.x1<"u"&&(r.x1+=e),typeof r.y1<"u"&&(r.y1+=t),typeof r.x2<"u"&&(r.x2+=e),typeof r.y2<"u"&&(r.y2+=t),typeof r.x<"u"&&(r.x+=e),typeof r.y<"u"&&(r.y+=t),r.relative=!1),r))}function J1(){return Ar((r,e,t)=>(r.relative||(typeof r.x1<"u"&&(r.x1-=e),typeof r.y1<"u"&&(r.y1-=t),typeof r.x2<"u"&&(r.x2-=e),typeof r.y2<"u"&&(r.y2-=t),typeof r.x<"u"&&(r.x-=e),typeof r.y<"u"&&(r.y-=t),r.relative=!0),r))}function $1(r=!0,e=!0,t=!0,i=!0){return Ar((n,s,o,l,u)=>{if(isNaN(l)&&!(n.type&se.MOVE_TO))throw new Error("path must start with moveto");if(e&&n.type&se.HORIZ_LINE_TO&&(n.type=se.LINE_TO,n.y=n.relative?0:o),t&&n.type&se.VERT_LINE_TO&&(n.type=se.LINE_TO,n.x=n.relative?0:s),r&&n.type&se.CLOSE_PATH&&(n.type=se.LINE_TO,n.x=n.relative?l-s:l,n.y=n.relative?u-o:u),n.type&se.ARC&&(n.rX===0||n.rY===0)&&(n.type=se.LINE_TO,delete n.rX,delete n.rY,delete n.xRot,delete n.lArcFlag,delete n.sweepFlag),i&&n.type&se.QUAD_TO){const c=[s,o],d=n.relative?[s+n.x1,o+n.y1]:[n.x1,n.y1],p=n.relative?[s+n.x,o+n.y]:[n.x,n.y];jd(c,d,p)&&(n.type=se.LINE_TO,delete n.x1,delete n.y1)}if(i&&n.type&se.CURVE_TO){const c=[s,o],d=n.relative?[s+n.x1,o+n.y1]:[n.x1,n.y1],p=n.relative?[s+n.x2,o+n.y2]:[n.x2,n.y2],m=n.relative?[s+n.x,o+n.y]:[n.x,n.y];jd(c,d,m)&&jd(c,p,m)&&(n.type=se.LINE_TO,delete n.x1,delete n.y1,delete n.x2,delete n.y2)}return n})}function e0(){let r=NaN,e=NaN,t=NaN,i=NaN;return Ar((n,s,o)=>(n.type&se.SMOOTH_CURVE_TO&&(n.type=se.CURVE_TO,r=isNaN(r)?s:r,e=isNaN(e)?o:e,n.x1=n.relative?s-r:2*s-r,n.y1=n.relative?o-e:2*o-e),n.type&se.CURVE_TO?(r=n.relative?s+n.x2:n.x2,e=n.relative?o+n.y2:n.y2):(r=NaN,e=NaN),n.type&se.SMOOTH_QUAD_TO&&(n.type=se.QUAD_TO,t=isNaN(t)?s:t,i=isNaN(i)?o:i,n.x1=n.relative?s-t:2*s-t,n.y1=n.relative?o-i:2*o-i),n.type&se.QUAD_TO?(t=n.relative?s+n.x1:n.x1,i=n.relative?o+n.y1:n.y1):(t=NaN,i=NaN),n))}function t0(){let r=NaN,e=NaN;return Ar((t,i,n)=>{if(t.type&se.SMOOTH_QUAD_TO&&(t.type=se.QUAD_TO,r=isNaN(r)?i:r,e=isNaN(e)?n:e,t.x1=t.relative?i-r:2*i-r,t.y1=t.relative?n-e:2*n-e),t.type&se.QUAD_TO){r=t.relative?i+t.x1:t.x1,e=t.relative?n+t.y1:t.y1;const s=t.x1,o=t.y1;t.type=se.CURVE_TO,t.x1=((t.relative?0:i)+s*2)/3,t.y1=((t.relative?0:n)+o*2)/3,t.x2=(t.x+s*2)/3,t.y2=(t.y+o*2)/3}else r=NaN,e=NaN;return t})}function Ar(r){let e=0,t=0,i=NaN,n=NaN;return function(s){if(isNaN(i)&&!(s.type&se.MOVE_TO))throw new Error("path must start with moveto");const o=r(s,e,t,i,n);return s.type&se.CLOSE_PATH&&(e=i,t=n),"x"in s&&typeof s.x<"u"&&(e=s.relative?e+s.x:s.x),"y"in s&&typeof s.y<"u"&&(t=s.relative?t+s.y:s.y),s.type&se.MOVE_TO&&(i=e,n=t),o}}function eS(r=0){Sr(r);let e=NaN,t=NaN,i=NaN,n=NaN;return Ar((s,o,l,u,c)=>{const d=Math.abs;let p=!1,m=0,y=0;if(s.type&se.SMOOTH_CURVE_TO&&(m=isNaN(e)?0:o-e,y=isNaN(t)?0:l-t),s.type&(se.CURVE_TO|se.SMOOTH_CURVE_TO)?(e=s.relative?o+s.x2:s.x2,t=s.relative?l+s.y2:s.y2):(e=NaN,t=NaN),s.type&se.SMOOTH_QUAD_TO?(i=isNaN(i)?o:2*o-i,n=isNaN(n)?l:2*l-n):s.type&se.QUAD_TO?(i=s.relative?o+s.x1:s.x1,n=s.relative?l+s.y1:s.y2):(i=NaN,n=NaN),s.type&se.LINE_COMMANDS||s.type&se.ARC&&(s.rX===0||s.rY===0||!s.lArcFlag)||s.type&se.CURVE_TO||s.type&se.SMOOTH_CURVE_TO||s.type&se.QUAD_TO||s.type&se.SMOOTH_QUAD_TO){const v=typeof s.x>"u"?0:s.relative?s.x:s.x-o,_=typeof s.y>"u"?0:s.relative?s.y:s.y-l;m=isNaN(i)?typeof s.x1>"u"?m:s.relative?s.x:s.x1-o:i-o,y=isNaN(n)?typeof s.y1>"u"?y:s.relative?s.y:s.y1-l:n-l;const T=typeof s.x2>"u"?0:s.relative?s.x:s.x2-o,E=typeof s.y2>"u"?0:s.relative?s.y:s.y2-l;d(v)<=r&&d(_)<=r&&d(m)<=r&&d(y)<=r&&d(T)<=r&&d(E)<=r&&(p=!0)}return s.type&se.CLOSE_PATH&&d(o-u)<=r&&d(l-c)<=r&&(p=!0),p?[]:s})}function rs(r,e,t,i,n,s){return Sr(r,e,t,i,n,s),Ar((o,l,u,c)=>{const d=o.x1,p=o.x2,m=o.relative&&!isNaN(c),y=typeof o.x<"u"?o.x:m?0:l,v=typeof o.y<"u"?o.y:m?0:u;o.type&se.HORIZ_LINE_TO&&e!==0&&(o.type=se.LINE_TO,o.y=o.relative?0:u),o.type&se.VERT_LINE_TO&&t!==0&&(o.type=se.LINE_TO,o.x=o.relative?0:l),typeof o.x<"u"&&(o.x=o.x*r+v*t+(m?0:n)),typeof o.y<"u"&&(o.y=y*e+o.y*i+(m?0:s)),typeof o.x1<"u"&&(o.x1=o.x1*r+o.y1*t+(m?0:n)),typeof o.y1<"u"&&(o.y1=d*e+o.y1*i+(m?0:s)),typeof o.x2<"u"&&(o.x2=o.x2*r+o.y2*t+(m?0:n)),typeof o.y2<"u"&&(o.y2=p*e+o.y2*i+(m?0:s));function _(E){return E*E}const T=r*i-e*t;if(typeof o.xRot<"u"&&(r!==1||e!==0||t!==0||i!==1))if(T===0)delete o.rX,delete o.rY,delete o.xRot,delete o.lArcFlag,delete o.sweepFlag,o.type=se.LINE_TO;else{const E=o.xRot*Math.PI/180,S=Math.sin(E),A=Math.cos(E),P=1/_(o.rX),D=1/_(o.rY),k=_(A)*P+_(S)*D,U=2*S*A*(P-D),j=_(S)*P+_(A)*D,q=k*i*i-U*e*i+j*e*e,ee=U*(r*i+e*t)-2*(k*t*i+j*r*e),pe=k*t*t-U*r*t+j*r*r,H=(Math.atan2(ee,q-pe)+Math.PI)%Math.PI/2,F=Math.sin(H),G=Math.cos(H);o.rX=Math.abs(T)/Math.sqrt(q*_(G)+ee*F*G+pe*_(F)),o.rY=Math.abs(T)/Math.sqrt(q*_(F)-ee*F*G+pe*_(G)),o.xRot=H*180/Math.PI}return typeof o.sweepFlag<"u"&&0>T&&(o.sweepFlag=+!o.sweepFlag),o})}function tS(r,e=0,t=0){Sr(r,e,t);const i=Math.sin(r),n=Math.cos(r);return rs(n,i,-i,n,e-e*n+t*i,t-e*i-t*n)}function iS(r,e=0){return Sr(r,e),rs(1,0,0,1,r,e)}function rS(r,e=r){return Sr(r,e),rs(r,0,0,e,0,0)}function nS(r){return Sr(r),rs(1,0,Math.tan(r),1,0,0)}function sS(r){return Sr(r),rs(1,Math.tan(r),0,1,0,0)}function oS(r=0){return Sr(r),rs(-1,0,0,1,r,0)}function aS(r=0){return Sr(r),rs(1,0,0,-1,0,r)}function lS(){return Ar((r,e,t)=>se.ARC===r.type?Z1(r,r.relative?0:e,r.relative?0:t):r)}function uS(){return Ar((r,e,t)=>(r.relative&&(e=0,t=0),se.ARC===r.type&&Kp(r,e,t),r))}function i0(){return r=>({...r})}function hS(){const r=i0(),e=$x(),t=t0(),i=e0(),n=Ar((s,o,l)=>{const u=i(t(e(r(s))));function c(p){p>n.maxX&&(n.maxX=p),p<n.minX&&(n.minX=p)}function d(p){p>n.maxY&&(n.maxY=p),p<n.minY&&(n.minY=p)}if(u.type&se.DRAWING_COMMANDS&&(c(o),d(l)),u.type&se.HORIZ_LINE_TO&&c(u.x),u.type&se.VERT_LINE_TO&&d(u.y),u.type&se.LINE_TO&&(c(u.x),d(u.y)),u.type&se.CURVE_TO){c(u.x),d(u.y);const p=yv(o,u.x1,u.x2,u.x);for(const y of p)0<y&&1>y&&c(vv(o,u.x1,u.x2,u.x,y));const m=yv(l,u.y1,u.y2,u.y);for(const y of m)0<y&&1>y&&d(vv(l,u.y1,u.y2,u.y,y))}if(u.type&se.ARC){c(u.x),d(u.y),Kp(u,o,l);const p=u.xRot/180*Math.PI,m=Math.cos(p)*u.rX,y=Math.sin(p)*u.rX,v=-Math.sin(p)*u.rY,_=Math.cos(p)*u.rY,[T,E]=u.phi1<u.phi2?[u.phi1,u.phi2]:-180>u.phi2?[u.phi2+360,u.phi1+360]:[u.phi2,u.phi1],S=([D,k])=>{const U=Math.atan2(k,D)*180/Math.PI;return U<T?U+360:U},A=pv(v,-m,0).map(S);for(const D of A)D>T&&D<E&&c(gv(u.cX,m,v,D));const P=pv(_,-y,0).map(S);for(const D of P)D>T&&D<E&&d(gv(u.cY,y,_,D))}return s});return n.minX=1/0,n.maxX=-1/0,n.minY=1/0,n.maxY=-1/0,n}const Xt={ROUND:K1,TO_ABS:$x,TO_REL:J1,NORMALIZE_HVZ:$1,NORMALIZE_ST:e0,QT_TO_C:t0,INFO:Ar,SANITIZE:eS,MATRIX:rs,ROTATE:tS,TRANSLATE:iS,SCALE:rS,SKEW_X:nS,SKEW_Y:sS,X_AXIS_SYMMETRY:oS,Y_AXIS_SYMMETRY:aS,A_TO_C:lS,ANNOTATE_ARCS:uS,CLONE:i0,CALCULATE_BOUNDS:hS,REVERSE_PATH:Q1};let r0=class{round(e){return this.transform(Xt.ROUND(e))}toAbs(){return this.transform(Xt.TO_ABS())}toRel(){return this.transform(Xt.TO_REL())}normalizeHVZ(e,t,i){return this.transform(Xt.NORMALIZE_HVZ(e,t,i))}normalizeST(){return this.transform(Xt.NORMALIZE_ST())}qtToC(){return this.transform(Xt.QT_TO_C())}aToC(){return this.transform(Xt.A_TO_C())}sanitize(e){return this.transform(Xt.SANITIZE(e))}translate(e,t){return this.transform(Xt.TRANSLATE(e,t))}scale(e,t){return this.transform(Xt.SCALE(e,t))}rotate(e,t,i){return this.transform(Xt.ROTATE(e,t,i))}matrix(e,t,i,n,s,o){return this.transform(Xt.MATRIX(e,t,i,n,s,o))}skewX(e){return this.transform(Xt.SKEW_X(e))}skewY(e){return this.transform(Xt.SKEW_Y(e))}xSymmetry(e){return this.transform(Xt.X_AXIS_SYMMETRY(e))}ySymmetry(e){return this.transform(Xt.Y_AXIS_SYMMETRY(e))}annotateArcs(){return this.transform(Xt.ANNOTATE_ARCS())}};const cS=r=>r===" "||r==="	"||r==="\r"||r===`
`,_v=r=>48<=r.charCodeAt(0)&&r.charCodeAt(0)<=57;class dS extends r0{constructor(){super(),kt(this,"curNumber",""),kt(this,"curCommandType",-1),kt(this,"curCommandRelative",!1),kt(this,"canParseCommandOrComma",!0),kt(this,"curNumberHasExp",!1),kt(this,"curNumberHasExpDigits",!1),kt(this,"curNumberHasDecimal",!1),kt(this,"curArgs",[])}finish(e=[]){if(this.parse(" ",e),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return e}parse(e,t=[]){const i=n=>{t.push(n),this.curArgs.length=0,this.canParseCommandOrComma=!0};for(let n=0;n<e.length;n++){const s=e[n],o=this.curCommandType===se.ARC&&(this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber.length===1&&(this.curNumber==="0"||this.curNumber==="1"),l=_v(s)&&(this.curNumber==="0"&&s==="0"||o);if(_v(s)&&!l){this.curNumber+=s,this.curNumberHasExpDigits=this.curNumberHasExp;continue}if(s==="e"||s==="E"){this.curNumber+=s,this.curNumberHasExp=!0;continue}if((s==="-"||s==="+")&&this.curNumberHasExp&&!this.curNumberHasExpDigits){this.curNumber+=s;continue}if(s==="."&&!this.curNumberHasExp&&!this.curNumberHasDecimal&&!o){this.curNumber+=s,this.curNumberHasDecimal=!0;continue}if(this.curNumber&&this.curCommandType!==-1){const u=Number(this.curNumber);if(isNaN(u))throw new SyntaxError(`Invalid number ending at ${n}`);if(this.curCommandType===se.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>u)throw new SyntaxError(`Expected positive number, got "${u}" at index "${n}"`)}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError(`Expected a flag, got "${this.curNumber}" at index "${n}"`)}this.curArgs.push(u),this.curArgs.length===fS[this.curCommandType]&&(se.HORIZ_LINE_TO===this.curCommandType?i({type:se.HORIZ_LINE_TO,relative:this.curCommandRelative,x:u}):se.VERT_LINE_TO===this.curCommandType?i({type:se.VERT_LINE_TO,relative:this.curCommandRelative,y:u}):this.curCommandType===se.MOVE_TO||this.curCommandType===se.LINE_TO||this.curCommandType===se.SMOOTH_QUAD_TO?(i({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),se.MOVE_TO===this.curCommandType&&(this.curCommandType=se.LINE_TO)):this.curCommandType===se.CURVE_TO?i({type:se.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===se.SMOOTH_CURVE_TO?i({type:se.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===se.QUAD_TO?i({type:se.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===se.ARC&&i({type:se.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!cS(s)){if(s===","&&this.canParseCommandOrComma){this.canParseCommandOrComma=!1;continue}if(s==="+"||s==="-"||s==="."){this.curNumber=s,this.curNumberHasDecimal=s===".";continue}if(l){this.curNumber=s,this.curNumberHasDecimal=!1;continue}if(this.curArgs.length!==0)throw new SyntaxError(`Unterminated command at index ${n}.`);if(!this.canParseCommandOrComma)throw new SyntaxError(`Unexpected character "${s}" at index ${n}. Command cannot follow comma`);if(this.canParseCommandOrComma=!1,s==="z"||s==="Z"){t.push({type:se.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1;continue}else if(s==="h"||s==="H")this.curCommandType=se.HORIZ_LINE_TO,this.curCommandRelative=s==="h";else if(s==="v"||s==="V")this.curCommandType=se.VERT_LINE_TO,this.curCommandRelative=s==="v";else if(s==="m"||s==="M")this.curCommandType=se.MOVE_TO,this.curCommandRelative=s==="m";else if(s==="l"||s==="L")this.curCommandType=se.LINE_TO,this.curCommandRelative=s==="l";else if(s==="c"||s==="C")this.curCommandType=se.CURVE_TO,this.curCommandRelative=s==="c";else if(s==="s"||s==="S")this.curCommandType=se.SMOOTH_CURVE_TO,this.curCommandRelative=s==="s";else if(s==="q"||s==="Q")this.curCommandType=se.QUAD_TO,this.curCommandRelative=s==="q";else if(s==="t"||s==="T")this.curCommandType=se.SMOOTH_QUAD_TO,this.curCommandRelative=s==="t";else if(s==="a"||s==="A")this.curCommandType=se.ARC,this.curCommandRelative=s==="a";else throw new SyntaxError(`Unexpected character "${s}" at index ${n}.`)}}return t}transform(e){return Object.create(this,{parse:{value(t,i=[]){const n=Object.getPrototypeOf(this).parse.call(this,t);for(const s of n){const o=e(s);Array.isArray(o)?i.push(...o):i.push(o)}return i}}})}}const wt=class jf extends r0{constructor(e){super(),kt(this,"commands"),typeof e=="string"?this.commands=jf.parse(e):this.commands=e}encode(){return jf.encode(this.commands)}getBounds(){const e=Xt.CALCULATE_BOUNDS();return this.transform(e),e}transform(e){const t=[];for(const i of this.commands){const n=e(i);Array.isArray(n)?t.push(...n):t.push(n)}return this.commands=t,this}reverse(e=!0){return this.commands=Xt.REVERSE_PATH(this.commands,e),this}static encode(e){return Y1(e)}static parse(e){const t=new dS,i=[];return t.parse(e,i),t.finish(i),i}};kt(wt,"CLOSE_PATH",1),kt(wt,"MOVE_TO",2),kt(wt,"HORIZ_LINE_TO",4),kt(wt,"VERT_LINE_TO",8),kt(wt,"LINE_TO",16),kt(wt,"CURVE_TO",32),kt(wt,"SMOOTH_CURVE_TO",64),kt(wt,"QUAD_TO",128),kt(wt,"SMOOTH_QUAD_TO",256),kt(wt,"ARC",512),kt(wt,"LINE_COMMANDS",wt.LINE_TO|wt.HORIZ_LINE_TO|wt.VERT_LINE_TO),kt(wt,"DRAWING_COMMANDS",wt.HORIZ_LINE_TO|wt.VERT_LINE_TO|wt.LINE_TO|wt.CURVE_TO|wt.SMOOTH_CURVE_TO|wt.QUAD_TO|wt.SMOOTH_QUAD_TO|wt.ARC);let se=wt;const fS={[se.MOVE_TO]:2,[se.LINE_TO]:2,[se.HORIZ_LINE_TO]:1,[se.VERT_LINE_TO]:1,[se.CLOSE_PATH]:0,[se.QUAD_TO]:4,[se.SMOOTH_QUAD_TO]:2,[se.CURVE_TO]:6,[se.SMOOTH_CURVE_TO]:4,[se.ARC]:7},pS=r=>{const e=new se(r).toAbs().commands,t=[];let i=[],n=null;for(const s of e)switch(s.type){case se.MOVE_TO:i.length>0&&(t.push({points:i}),i=[]),n=[s.x,s.y],i.push(n);break;case se.LINE_TO:i.push([s.x,s.y]);break;case se.HORIZ_LINE_TO:const o=i[i.length-1][1];i.push([s.x,o]);break;case se.VERT_LINE_TO:const l=i[i.length-1][0];i.push([l,s.y]);break;case se.CURVE_TO:case se.SMOOTH_CURVE_TO:case se.QUAD_TO:case se.SMOOTH_QUAD_TO:case se.ARC:i.push([s.x,s.y]);break}if(i.length>2&&t.push({points:i}),t.length>0){const s=Qp(t[0].points);return{rings:t,bounds:s}}},mS=r=>{const[e,t,i]=r.match(/(<polygon points=["|'])([^("|')]*)/)||[],n=i.split(" ").map(s=>s.split(",").map(parseFloat));return{type:Wr.POLYGON,geometry:{points:n,bounds:Qp(n)}}},gS=r=>{const e=Jx(r),t=parseFloat(e.getAttribute("cx")),i=parseFloat(e.getAttribute("cy")),n=parseFloat(e.getAttribute("rx")),s=parseFloat(e.getAttribute("ry")),o={minX:t-n,minY:i-s,maxX:t+n,maxY:i+s};return{type:Wr.ELLIPSE,geometry:{cx:t,cy:i,rx:n,ry:s,bounds:o}}},yS=r=>{const e=Jx(r),t=(e.nodeName==="path"?[e]:Array.from(e.querySelectorAll("path"))).map(s=>s.getAttribute("d")||"").map(s=>pS(s)).filter(Boolean),i=t.reduce((s,o)=>[...s,...o.rings[0].points],[]),n=Qp(i);return t.length===1&&t[0].rings.length===1?{type:Wr.POLYGON,geometry:{points:i,bounds:n}}:{type:Wr.MULTIPOLYGLON,geometry:{polygons:t,bounds:n}}},vS=r=>{const e=typeof r=="string"?r:r.value;if(e.includes("<polygon points="))return mS(e);if(e.includes("<path "))return yS(e);if(e.includes("<ellipse "))return gS(e);throw"Unsupported SVG shape: "+e},_S=r=>`<g>${r.polygons.map(e=>`<path fill-rule="evenodd" d="${V1(e)}" />`).join("")}</g>`,xS=r=>{let e;if(r.type===Wr.POLYGON){const t=r.geometry,{points:i}=t;e=`<svg><polygon points="${i.map(n=>n.join(",")).join(" ")}" /></svg>`}else if(r.type===Wr.ELLIPSE){const t=r.geometry;e=`<svg><ellipse cx="${t.cx}" cy="${t.cy}" rx="${t.rx}" ry="${t.ry}" /></svg>`}else if(r.type===Wr.MULTIPOLYGLON){const t=r.geometry;e=`<svg>${_S(t)}</svg>`}if(e)return{type:"SvgSelector",value:e};throw`Unsupported shape type: ${r.type}`},yi=[];for(let r=0;r<256;++r)yi.push((r+256).toString(16).slice(1));function TS(r,e=0){return(yi[r[e+0]]+yi[r[e+1]]+yi[r[e+2]]+yi[r[e+3]]+"-"+yi[r[e+4]]+yi[r[e+5]]+"-"+yi[r[e+6]]+yi[r[e+7]]+"-"+yi[r[e+8]]+yi[r[e+9]]+"-"+yi[r[e+10]]+yi[r[e+11]]+yi[r[e+12]]+yi[r[e+13]]+yi[r[e+14]]+yi[r[e+15]]).toLowerCase()}let Xd;const wS=new Uint8Array(16);function ES(){if(!Xd){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Xd=crypto.getRandomValues.bind(crypto)}return Xd(wS)}const SS=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),xv={randomUUID:SS};function AS(r,e,t){var i;if(xv.randomUUID&&!r)return xv.randomUUID();r=r||{};const n=r.random??((i=r.rng)==null?void 0:i.call(r))??ES();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,TS(n)}const bS=[];for(let r=0;r<256;++r)bS.push((r+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const CS="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let RS=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=CS[t[r]&63];return e};const PS=r=>{const e=JSON.stringify(r);let t=0;for(let i=0,n=e.length;i<n;i++){let s=e.charCodeAt(i);t=(t<<5)-t+s,t|=0}return`${t}`},n0=r=>r?typeof r=="object"?{...r}:r:void 0,OS=(r,e)=>(Array.isArray(r)?r:[r]).map(t=>{const{id:i,type:n,purpose:s,value:o,created:l,modified:u,creator:c,...d}=t;return{id:i||`temp-${PS(t)}`,annotation:e,type:n,purpose:s,value:o,creator:n0(c),created:l?new Date(l):void 0,updated:u?new Date(u):void 0,...d}}),IS=r=>r.map(e=>{var t;const{annotation:i,created:n,updated:s,...o}=e,l={...o,created:n==null?void 0:n.toISOString(),modified:s==null?void 0:s.toISOString()};return(t=l.id)!=null&&t.startsWith("temp-")&&delete l.id,l});RS();const CD=(r,e={strict:!0,invertY:!1})=>({parse:t=>MS(t,e),serialize:t=>NS(t,r,e)}),MS=(r,e={strict:!0,invertY:!1})=>{const t=r.id||AS(),{creator:i,created:n,modified:s,body:o,...l}=r,u=OS(o||[],t),c=Array.isArray(r.target)?r.target[0]:r.target,d=typeof c=="string"?c:Array.isArray(c.selector)?c.selector[0]:c.selector,p=typeof d=="string"||(d==null?void 0:d.type)==="FragmentSelector"?j1(d,e.invertY):(d==null?void 0:d.type)==="SvgSelector"?vS(d):void 0,m=Array.isArray(l.target)?l.target[0]:l.targret;return p||!e.strict?{parsed:{...l,id:t,bodies:u,target:{created:n?new Date(n):void 0,creator:n0(i),updated:s?new Date(s):void 0,...typeof m=="string"?{}:m,annotation:t,selector:p||d}}}:{error:Error(`Invalid selector: ${JSON.stringify(d)}`)}},NS=(r,e,t={strict:!0,invertY:!1})=>{const{selector:i,creator:n,created:s,updated:o,updatedBy:l,...u}=r.target;let c;try{c=i.type==Wr.RECTANGLE?X1(i.geometry):xS(i)}catch(p){if(t.strict)throw p;c=i}const d={...r,"@context":"http://www.w3.org/ns/anno.jsonld",id:r.id,type:"Annotation",body:IS(r.bodies),created:s==null?void 0:s.toISOString(),creator:n,modified:o==null?void 0:o.toISOString(),target:{...u,source:e,type:"SpecificResource",selector:c}};return delete d.bodies,"annotation"in d.target&&delete d.target.annotation,d};typeof navigator>"u"||navigator.userAgent.indexOf("Mac OS X");var th={exports:{}},DS=th.exports,Tv;function LS(){return Tv||(Tv=1,function(r){//! openseadragon 5.0.1
//! Built on 2024-12-09
//! Git commit: v5.0.1-0-480de92d
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function e(t){return new e.Viewer(t)}(function(t){t.version={versionStr:"5.0.1",major:parseInt("5",10),minor:parseInt("0",10),revision:parseInt("1",10)};var i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object AsyncFunction]":"function","[object Promise]":"promise","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},n=Object.prototype.toString,s=Object.prototype.hasOwnProperty;t.isFunction=function(o){return t.type(o)==="function"},t.isArray=Array.isArray||function(o){return t.type(o)==="array"},t.isWindow=function(o){return o&&typeof o=="object"&&"setInterval"in o},t.type=function(o){return o==null?String(o):i[n.call(o)]||"object"},t.isPlainObject=function(o){if(!o||e.type(o)!=="object"||o.nodeType||t.isWindow(o)||o.constructor&&!s.call(o,"constructor")&&!s.call(o.constructor.prototype,"isPrototypeOf"))return!1;var l;for(var u in o)l=u;return l===void 0||s.call(o,l)},t.isEmptyObject=function(o){for(var l in o)return!1;return!0},t.freezeObject=function(o){return Object.freeze?t.freezeObject=Object.freeze:t.freezeObject=function(l){return l},t.freezeObject(o)},t.supportsCanvas=function(){var o=document.createElement("canvas");return!!(t.isFunction(o.getContext)&&o.getContext("2d"))}(),t.isCanvasTainted=function(o){var l=!1;try{o.getContext("2d").getImageData(0,0,1,1)}catch{l=!0}return l},t.supportsAddEventListener=function(){return!!(document.documentElement.addEventListener&&document.addEventListener)}(),t.supportsRemoveEventListener=function(){return!!(document.documentElement.removeEventListener&&document.removeEventListener)}(),t.supportsEventListenerOptions=function(){var o=0;if(t.supportsAddEventListener)try{var l={get capture(){return o++,!1},get once(){return o++,!1},get passive(){return o++,!1}};window.addEventListener("test",null,l),window.removeEventListener("test",null,l)}catch{o=0}return o>=3}(),t.getCurrentPixelDensityRatio=function(){if(t.supportsCanvas){var o=document.createElement("canvas").getContext("2d"),l=window.devicePixelRatio||1,u=o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1;return Math.max(l,1)/u}else return 1},t.pixelDensityRatio=t.getCurrentPixelDensityRatio()})(e),function(t){t.extend=function(){var u,c,d,p,m,y,v=arguments[0]||{},_=arguments.length,T=!1,E=1;for(typeof v=="boolean"&&(T=v,v=arguments[1]||{},E=2),typeof v!="object"&&!e.isFunction(v)&&(v={}),_===E&&(v=this,--E);E<_;E++)if(u=arguments[E],u!==null||u!==void 0)for(c in u){var S=Object.getOwnPropertyDescriptor(u,c);if(S!==void 0){if(S.get||S.set){Object.defineProperty(v,c,S);continue}p=S.value}else{t.console.warn('Could not copy inherited property "'+c+'".');continue}v!==p&&(T&&p&&(e.isPlainObject(p)||(m=e.isArray(p)))?(d=v[c],m?(m=!1,y=d&&e.isArray(d)?d:[]):y=d&&e.isPlainObject(d)?d:{},v[c]=e.extend(T,y,p)):p!==void 0&&(v[c]=p))}return v};var i=function(){if(typeof navigator!="object")return!1;var u=navigator.userAgent;return typeof u!="string"?!1:u.indexOf("iPhone")!==-1||u.indexOf("iPad")!==-1||u.indexOf("iPod")!==-1};t.extend(t,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!1,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerDblClickDrag:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:i(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,maxTilesPerFrame:1,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorElement:null,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,overlayPreserveContentDirection:!0,opacity:1,compositeOperation:null,drawer:["webgl","canvas","html"],drawerOptions:{webgl:{},canvas:{},html:{},custom:{}},preload:!1,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,tileRetryMax:0,tileRetryDelay:2500,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},delegate:function(u,c){return function(){var d=arguments;return d===void 0&&(d=[]),c.apply(u,d)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(u){return t._viewers.get(this.getElement(u))},getElement:function(u){return typeof u=="string"&&(u=document.getElementById(u)),u},getElementPosition:function(u){var c=new t.Point,d,p;for(u=t.getElement(u),d=t.getElementStyle(u).position==="fixed",p=l(u,d);p;)c.x+=u.offsetLeft,c.y+=u.offsetTop,d&&(c=c.plus(t.getPageScroll())),u=p,d=t.getElementStyle(u).position==="fixed",p=l(u,d);return c},getElementOffset:function(u){u=t.getElement(u);var c=u&&u.ownerDocument,d,p,m={top:0,left:0};return c?(d=c.documentElement,typeof u.getBoundingClientRect<"u"&&(m=u.getBoundingClientRect()),p=c===c.window?c:c.nodeType===9?c.defaultView||c.parentWindow:!1,new t.Point(m.left+(p.pageXOffset||d.scrollLeft)-(d.clientLeft||0),m.top+(p.pageYOffset||d.scrollTop)-(d.clientTop||0))):new t.Point},getElementSize:function(u){return u=t.getElement(u),new t.Point(u.clientWidth,u.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(u){return u=t.getElement(u),u.currentStyle}:function(u){return u=t.getElement(u),window.getComputedStyle(u,"")},getCssPropertyWithVendorPrefix:function(u){var c={};return t.getCssPropertyWithVendorPrefix=function(d){if(c[d]!==void 0)return c[d];var p=document.createElement("div").style,m=null;if(p[d]!==void 0)m=d;else for(var y=["Webkit","Moz","MS","O","webkit","moz","ms","o"],v=t.capitalizeFirstLetter(d),_=0;_<y.length;_++){var T=y[_]+v;if(p[T]!==void 0){m=T;break}}return c[d]=m,m},t.getCssPropertyWithVendorPrefix(u)},capitalizeFirstLetter:function(u){return u.charAt(0).toUpperCase()+u.slice(1)},positiveModulo:function(u,c){var d=u%c;return d<0&&(d+=c),d},pointInElement:function(u,c){u=t.getElement(u);var d=t.getElementOffset(u),p=t.getElementSize(u);return c.x>=d.x&&c.x<d.x+p.x&&c.y<d.y+p.y&&c.y>=d.y},getMousePosition:function(u){if(typeof u.pageX=="number")t.getMousePosition=function(c){var d=new t.Point;return d.x=c.pageX,d.y=c.pageY,d};else if(typeof u.clientX=="number")t.getMousePosition=function(c){var d=new t.Point;return d.x=c.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,d.y=c.clientY+document.body.scrollTop+document.documentElement.scrollTop,d};else throw new Error("Unknown event mouse position, no known technique.");return t.getMousePosition(u)},getPageScroll:function(){var u=document.documentElement||{},c=document.body||{};if(typeof window.pageXOffset=="number")t.getPageScroll=function(){return new t.Point(window.pageXOffset,window.pageYOffset)};else if(c.scrollLeft||c.scrollTop)t.getPageScroll=function(){return new t.Point(document.body.scrollLeft,document.body.scrollTop)};else if(u.scrollLeft||u.scrollTop)t.getPageScroll=function(){return new t.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new t.Point(0,0);return t.getPageScroll()},setPageScroll:function(u){if(typeof window.scrollTo<"u")t.setPageScroll=function(p){window.scrollTo(p.x,p.y)};else{var c=t.getPageScroll();if(c.x===u.x&&c.y===u.y)return;document.body.scrollLeft=u.x,document.body.scrollTop=u.y;var d=t.getPageScroll();if(d.x!==c.x&&d.y!==c.y){t.setPageScroll=function(p){document.body.scrollLeft=p.x,document.body.scrollTop=p.y};return}if(document.documentElement.scrollLeft=u.x,document.documentElement.scrollTop=u.y,d=t.getPageScroll(),d.x!==c.x&&d.y!==c.y){t.setPageScroll=function(p){document.documentElement.scrollLeft=p.x,document.documentElement.scrollTop=p.y};return}t.setPageScroll=function(p){}}t.setPageScroll(u)},getWindowSize:function(){var u=document.documentElement||{},c=document.body||{};if(typeof window.innerWidth=="number")t.getWindowSize=function(){return new t.Point(window.innerWidth,window.innerHeight)};else if(u.clientWidth||u.clientHeight)t.getWindowSize=function(){return new t.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(c.clientWidth||c.clientHeight)t.getWindowSize=function(){return new t.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return t.getWindowSize()},makeCenteredNode:function(u){u=t.getElement(u);var c=[t.makeNeutralElement("div"),t.makeNeutralElement("div"),t.makeNeutralElement("div")];return t.extend(c[0].style,{display:"table",height:"100%",width:"100%"}),t.extend(c[1].style,{display:"table-row"}),t.extend(c[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),c[0].appendChild(c[1]),c[1].appendChild(c[2]),c[2].appendChild(u),c[0]},makeNeutralElement:function(u){var c=document.createElement(u),d=c.style;return d.background="transparent none",d.border="none",d.margin="0px",d.padding="0px",d.position="static",c},now:function(){return Date.now?t.now=Date.now:t.now=function(){return new Date().getTime()},t.now()},makeTransparentImage:function(u){var c=t.makeNeutralElement("img");return c.src=u,c},setElementOpacity:function(u,c,d){var p,m;u=t.getElement(u),d&&!t.Browser.alpha&&(c=Math.round(c)),t.Browser.opacity?u.style.opacity=c<1?c:"":c<1?(p=Math.round(100*c),m="alpha(opacity="+p+")",u.style.filter=m):u.style.filter=""},setElementTouchActionNone:function(u){u=t.getElement(u),typeof u.style.touchAction<"u"?u.style.touchAction="none":typeof u.style.msTouchAction<"u"&&(u.style.msTouchAction="none")},setElementPointerEvents:function(u,c){u=t.getElement(u),typeof u.style<"u"&&typeof u.style.pointerEvents<"u"&&(u.style.pointerEvents=c)},setElementPointerEventsNone:function(u){t.setElementPointerEvents(u,"none")},addClass:function(u,c){u=t.getElement(u),u.className?(" "+u.className+" ").indexOf(" "+c+" ")===-1&&(u.className+=" "+c):u.className=c},indexOf:function(u,c,d){return Array.prototype.indexOf?this.indexOf=function(p,m,y){return p.indexOf(m,y)}:this.indexOf=function(p,m,y){var v,_=y||0,T;if(!p)throw new TypeError;if(T=p.length,T===0||_>=T)return-1;for(_<0&&(_=T-Math.abs(_)),v=_;v<T;v++)if(p[v]===m)return v;return-1},this.indexOf(u,c,d)},removeClass:function(u,c){var d,p=[],m;for(u=t.getElement(u),d=u.className.split(/\s+/),m=0;m<d.length;m++)d[m]&&d[m]!==c&&p.push(d[m]);u.className=p.join(" ")},normalizeEventListenerOptions:function(u){var c;return typeof u<"u"?typeof u=="boolean"?c=t.supportsEventListenerOptions?{capture:u}:u:c=t.supportsEventListenerOptions?u:typeof u.capture<"u"?u.capture:!1:c=t.supportsEventListenerOptions?{capture:!1}:!1,c},addEvent:function(){if(t.supportsAddEventListener)return function(u,c,d,p){p=t.normalizeEventListenerOptions(p),u=t.getElement(u),u.addEventListener(c,d,p)};if(document.documentElement.attachEvent&&document.attachEvent)return function(u,c,d){u=t.getElement(u),u.attachEvent("on"+c,d)};throw new Error("No known event model.")}(),removeEvent:function(){if(t.supportsRemoveEventListener)return function(u,c,d,p){p=t.normalizeEventListenerOptions(p),u=t.getElement(u),u.removeEventListener(c,d,p)};if(document.documentElement.detachEvent&&document.detachEvent)return function(u,c,d){u=t.getElement(u),u.detachEvent("on"+c,d)};throw new Error("No known event model.")}(),cancelEvent:function(u){u.preventDefault()},eventIsCanceled:function(u){return u.defaultPrevented},stopEvent:function(u){u.stopPropagation()},createCallback:function(u,c){console.error("The createCallback function is deprecated and will be removed in future versions. Please use alternativeFunction instead.");var d=[],p;for(p=2;p<arguments.length;p++)d.push(arguments[p]);return function(){var m=d.concat([]),y;for(y=0;y<arguments.length;y++)m.push(arguments[y]);return c.apply(u,m)}},getUrlParameter:function(u){var c=o[u];return c||null},getUrlProtocol:function(u){var c=u.match(/^([a-z]+:)\/\//i);return c===null?window.location.protocol:c[1].toLowerCase()},createAjaxRequest:function(){if(window.XMLHttpRequest)return t.createAjaxRequest=function(){return new XMLHttpRequest},new XMLHttpRequest;throw new Error("Browser doesn't support XMLHttpRequest.")},makeAjaxRequest:function(u,c,d){var p,m,y,v;t.isPlainObject(u)&&(c=u.success,d=u.error,p=u.withCredentials,m=u.headers,y=u.responseType||null,v=u.postData||null,u=u.url);var _=t.getUrlProtocol(u),T=t.createAjaxRequest();if(!t.isFunction(c))throw new Error("makeAjaxRequest requires a success callback");T.onreadystatechange=function(){T.readyState===4&&(T.onreadystatechange=function(){},T.status>=200&&T.status<300||T.status===0&&_!=="http:"&&_!=="https:"?c(T):t.isFunction(d)?d(T):t.console.error("AJAX request returned %d: %s",T.status,u))};var E=v?"POST":"GET";try{if(T.open(E,u,!0),y&&(T.responseType=y),m)for(var S in m)Object.prototype.hasOwnProperty.call(m,S)&&m[S]&&T.setRequestHeader(S,m[S]);p&&(T.withCredentials=!0),T.send(v)}catch(A){t.console.error("%s while making AJAX request: %s",A.name,A.message),T.onreadystatechange=function(){},t.isFunction(d)&&d(T,A)}return T},jsonp:function(u){var c,d=u.url,p=document.head||document.getElementsByTagName("head")[0]||document.documentElement,m=u.callbackName||"openseadragon"+t.now(),y=window[m],v="$1"+m+"$2",_=u.param||"callback",T=u.callback;d=d.replace(/(=)\?(&|$)|\?\?/i,v),d+=(/\?/.test(d)?"&":"?")+_+"="+m,window[m]=function(E){if(y)window[m]=y;else try{delete window[m]}catch{}T&&t.isFunction(T)&&T(E)},c=document.createElement("script"),(u.async!==void 0||u.async!==!1)&&(c.async="async"),u.scriptCharset&&(c.charset=u.scriptCharset),c.src=d,c.onload=c.onreadystatechange=function(E,S){(S||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,p&&c.parentNode&&p.removeChild(c),c=void 0)},p.insertBefore(c,p.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(u){if(window.DOMParser)t.parseXml=function(c){var d=null,p;return p=new DOMParser,d=p.parseFromString(c,"text/xml"),d};else throw new Error("Browser doesn't support XML DOM.");return t.parseXml(u)},parseJSON:function(u){return t.parseJSON=window.JSON.parse,t.parseJSON(u)},imageFormatSupported:function(u){return u=u||"",!!s[u.toLowerCase()]},setImageFormatsSupported:function(u){t.extend(s,u)}});var n=function(u){};t.console=window.console||{log:n,debug:n,info:n,warn:n,error:n,assert:n},t.Browser={vendor:t.BROWSERS.UNKNOWN,version:0,alpha:!0};var s={avif:!0,bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1,webp:!0},o={};(function(){var u=navigator.appVersion,c=navigator.userAgent,d;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(t.Browser.vendor=t.BROWSERS.IE,t.Browser.version=parseFloat(c.substring(c.indexOf("MSIE")+5,c.indexOf(";",c.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(c.indexOf("Edge")>=0?(t.Browser.vendor=t.BROWSERS.EDGE,t.Browser.version=parseFloat(c.substring(c.indexOf("Edge")+5))):c.indexOf("Edg")>=0?(t.Browser.vendor=t.BROWSERS.CHROMEEDGE,t.Browser.version=parseFloat(c.substring(c.indexOf("Edg")+4))):c.indexOf("Firefox")>=0?(t.Browser.vendor=t.BROWSERS.FIREFOX,t.Browser.version=parseFloat(c.substring(c.indexOf("Firefox")+8))):c.indexOf("Safari")>=0?(t.Browser.vendor=c.indexOf("Chrome")>=0?t.BROWSERS.CHROME:t.BROWSERS.SAFARI,t.Browser.version=parseFloat(c.substring(c.substring(0,c.indexOf("Safari")).lastIndexOf("/")+1,c.indexOf("Safari")))):(d=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),d.exec(c)!==null&&(t.Browser.vendor=t.BROWSERS.IE,t.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":t.Browser.vendor=t.BROWSERS.OPERA,t.Browser.version=parseFloat(u);break}var p=window.location.search.substring(1),m=p.split("&"),y,v,_;for(_=0;_<m.length;_++)if(y=m[_],v=y.indexOf("="),v>0){var T=y.substring(0,v),E=y.substring(v+1);try{o[T]=decodeURIComponent(E)}catch{t.console.error("Ignoring malformed URL parameter: %s=%s",T,E)}}t.Browser.alpha=!(t.Browser.vendor===t.BROWSERS.CHROME&&t.Browser.version<2),t.Browser.opacity=!0,t.Browser.vendor===t.BROWSERS.IE&&t.console.error("Internet Explorer is not supported by OpenSeadragon")})(),function(u){var c=u.requestAnimationFrame||u.mozRequestAnimationFrame||u.webkitRequestAnimationFrame||u.msRequestAnimationFrame,d=u.cancelAnimationFrame||u.mozCancelAnimationFrame||u.webkitCancelAnimationFrame||u.msCancelAnimationFrame;if(c&&d)t.requestAnimationFrame=function(){return c.apply(u,arguments)},t.cancelAnimationFrame=function(){return d.apply(u,arguments)};else{var p=[],m=[],y=0,v;t.requestAnimationFrame=function(_){return p.push([++y,_]),v||(v=setInterval(function(){if(p.length){var T=t.now(),E=m;for(m=p,p=E;m.length;)m.shift()[1](T)}else clearInterval(v),v=void 0},1e3/50)),y},t.cancelAnimationFrame=function(_){var T,E;for(T=0,E=p.length;T<E;T+=1)if(p[T][0]===_){p.splice(T,1);return}for(T=0,E=m.length;T<E;T+=1)if(m[T][0]===_){m.splice(T,1);return}}}}(window);function l(u,c){return c&&u!==document.body?document.body:u.offsetParent}}(e),function(t,i){r.exports?r.exports=i():t.OpenSeadragon=i()}(DS,function(){return e}),function(t){class i{constructor(s){s||(s=[0,0,0,0,0,0,0,0,0]),this.values=s}static makeIdentity(){return new i([1,0,0,0,1,0,0,0,1])}static makeTranslation(s,o){return new i([1,0,0,0,1,0,s,o,1])}static makeRotation(s){var o=Math.cos(s),l=Math.sin(s);return new i([o,-l,0,l,o,0,0,0,1])}static makeScaling(s,o){return new i([s,0,0,0,o,0,0,0,1])}multiply(s){let o=this.values,l=s.values;var u=o[0*3+0],c=o[0*3+1],d=o[0*3+2],p=o[1*3+0],m=o[1*3+1],y=o[1*3+2],v=o[2*3+0],_=o[2*3+1],T=o[2*3+2],E=l[0*3+0],S=l[0*3+1],A=l[0*3+2],P=l[1*3+0],D=l[1*3+1],k=l[1*3+2],U=l[2*3+0],j=l[2*3+1],q=l[2*3+2];return new i([E*u+S*p+A*v,E*c+S*m+A*_,E*d+S*y+A*T,P*u+D*p+k*v,P*c+D*m+k*_,P*d+D*y+k*T,U*u+j*p+q*v,U*c+j*m+q*_,U*d+j*y+q*T])}}t.Mat3=i}(e),function(t){var i={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.fullscreenElement},i.requestFullScreen=function(n){return n.requestFullscreen().catch(function(s){t.console.error("Fullscreen request failed: ",s)})},i.exitFullScreen=function(){document.exitFullscreen().catch(function(n){t.console.error("Error while exiting fullscreen: ",n)})},i.fullScreenEventName="fullscreenchange",i.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.msFullscreenElement},i.requestFullScreen=function(n){return n.msRequestFullscreen()},i.exitFullScreen=function(){document.msExitFullscreen()},i.fullScreenEventName="MSFullscreenChange",i.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitFullscreenElement},i.requestFullScreen=function(n){return n.webkitRequestFullscreen()},i.exitFullScreen=function(){document.webkitExitFullscreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},i.requestFullScreen=function(n){return n.webkitRequestFullScreen()},i.exitFullScreen=function(){document.webkitCancelFullScreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.mozFullScreenElement},i.requestFullScreen=function(n){return n.mozRequestFullScreen()},i.exitFullScreen=function(){document.mozCancelFullScreen()},i.fullScreenEventName="mozfullscreenchange",i.fullScreenErrorEventName="mozfullscreenerror"),i.isFullScreen=function(){return i.getFullScreenElement()!==null},i.cancelFullScreen=function(){t.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),i.exitFullScreen()},t.extend(t,i)}(e),function(t){t.EventSource=function(){this.events={},this._rejectedEventList={}},t.EventSource.prototype={addOnceHandler:function(i,n,s,o,l){var u=this;o=o||1;var c=0,d=function(p){return c++,c===o&&u.removeHandler(i,d),n(p)};return this.addHandler(i,d,s,l)},addHandler:function(i,n,s,o){if(Object.prototype.hasOwnProperty.call(this._rejectedEventList,i))return t.console.error(`Error adding handler for ${i}. ${this._rejectedEventList[i]}`),!1;var l=this.events[i];if(l||(this.events[i]=l=[]),n&&t.isFunction(n)){var u=l.length,c={handler:n,userData:s||null,priority:o||0};for(l[u]=c;u>0&&l[u-1].priority<l[u].priority;)l[u]=l[u-1],l[u-1]=c,u--}return!0},removeHandler:function(i,n){var s=this.events[i],o=[],l;if(s&&t.isArray(s)){for(l=0;l<s.length;l++)s[l].handler!==n&&o.push(s[l]);this.events[i]=o}},numberOfHandlers:function(i){var n=this.events[i];return n?n.length:0},removeAllHandlers:function(i){if(i)this.events[i]=[];else for(var n in this.events)this.events[n]=[]},getHandler:function(i){var n=this.events[i];return!n||!n.length?null:(n=n.length===1?[n[0]]:Array.apply(null,n),function(s,o){var l,u=n.length;for(l=0;l<u;l++)n[l]&&(o.eventSource=s,o.userData=n[l].userData,n[l].handler(o))})},raiseEvent:function(i,n){if(Object.prototype.hasOwnProperty.call(this._rejectedEventList,i))return t.console.error(`Error adding handler for ${i}. ${this._rejectedEventList[i]}`),!1;var s=this.getHandler(i);return s&&s(this,n||{}),!0},rejectEventHandler(i,n=""){this._rejectedEventList[i]=n},allowEventHandler(i){delete this._rejectedEventList[i]}}}(e),function(t){var i={};t.MouseTracker=function(R){var C=arguments;t.isPlainObject(R)||(R={element:C[0],clickTimeThreshold:C[1],clickDistThreshold:C[2]}),this.hash=Math.random(),this.element=t.getElement(R.element),this.clickTimeThreshold=R.clickTimeThreshold||t.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=R.clickDistThreshold||t.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=R.dblClickTimeThreshold||t.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=R.dblClickDistThreshold||t.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=R.userData||null,this.stopDelay=R.stopDelay||50,this.preProcessEventHandler=R.preProcessEventHandler||null,this.contextMenuHandler=R.contextMenuHandler||null,this.enterHandler=R.enterHandler||null,this.leaveHandler=R.leaveHandler||null,this.exitHandler=R.exitHandler||null,this.overHandler=R.overHandler||null,this.outHandler=R.outHandler||null,this.pressHandler=R.pressHandler||null,this.nonPrimaryPressHandler=R.nonPrimaryPressHandler||null,this.releaseHandler=R.releaseHandler||null,this.nonPrimaryReleaseHandler=R.nonPrimaryReleaseHandler||null,this.moveHandler=R.moveHandler||null,this.scrollHandler=R.scrollHandler||null,this.clickHandler=R.clickHandler||null,this.dblClickHandler=R.dblClickHandler||null,this.dragHandler=R.dragHandler||null,this.dragEndHandler=R.dragEndHandler||null,this.pinchHandler=R.pinchHandler||null,this.stopHandler=R.stopHandler||null,this.keyDownHandler=R.keyDownHandler||null,this.keyUpHandler=R.keyUpHandler||null,this.keyHandler=R.keyHandler||null,this.focusHandler=R.focusHandler||null,this.blurHandler=R.blurHandler||null;var I=this;i[this.hash]={click:function(L){A(I,L)},dblclick:function(L){P(I,L)},keydown:function(L){D(I,L)},keyup:function(L){k(I,L)},keypress:function(L){U(I,L)},focus:function(L){j(I,L)},blur:function(L){q(I,L)},contextmenu:function(L){ee(I,L)},wheel:function(L){pe(I,L)},mousewheel:function(L){H(I,L)},DOMMouseScroll:function(L){H(I,L)},MozMousePixelScroll:function(L){H(I,L)},losecapture:function(L){G(I,L)},mouseenter:function(L){re(I,L)},mouseleave:function(L){_e(I,L)},mouseover:function(L){me(I,L)},mouseout:function(L){Pe(I,L)},mousedown:function(L){Ue(I,L)},mouseup:function(L){Te(I,L)},mousemove:function(L){Je(I,L)},touchstart:function(L){$(I,L)},touchend:function(L){le(I,L)},touchmove:function(L){ie(I,L)},touchcancel:function(L){Y(I,L)},gesturestart:function(L){de(I,L)},gesturechange:function(L){z(I,L)},gotpointercapture:function(L){N(I,L)},lostpointercapture:function(L){W(I,L)},pointerenter:function(L){re(I,L)},pointerleave:function(L){_e(I,L)},pointerover:function(L){me(I,L)},pointerout:function(L){Pe(I,L)},pointerdown:function(L){Ue(I,L)},pointerup:function(L){Te(I,L)},pointermove:function(L){Je(I,L)},pointercancel:function(L){ti(I,L)},pointerupcaptured:function(L){ge(I,L)},pointermovecaptured:function(L){ht(I,L)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,t.MouseTracker.havePointerEvents&&t.setElementPointerEvents(this.element,"auto"),this.exitHandler&&t.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),R.startDisabled||this.setTracking(!0)},t.MouseTracker.prototype={destroy:function(){u(this),this.element=null,i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(R){return R?l(this):u(this),this},getActivePointersListByType:function(R){var C=i[this.hash],I,L=C?C.activePointersLists.length:0,ne;for(I=0;I<L;I++)if(C.activePointersLists[I].type===R)return C.activePointersLists[I];return ne=new t.MouseTracker.GesturePointList(R),C&&C.activePointersLists.push(ne),ne},getActivePointerCount:function(){var R=i[this.hash],C,I=R.activePointersLists.length,L=0;for(C=0;C<I;C++)L+=R.activePointersLists[C].getLength();return L},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var n=function(){try{return window.self!==window.top}catch{return!0}}();function s(R){try{return R.addEventListener&&R.removeEventListener}catch{return!1}}t.MouseTracker.gesturePointVelocityTracker=function(){var R=[],C=0,I=0,L=function(lt,ze){return lt.hash.toString()+ze.type+ze.id.toString()},ne=function(){var lt,ze=R.length,fi,Dt,Ir=t.now(),$r,en,Ko;for($r=Ir-I,I=Ir,lt=0;lt<ze;lt++)fi=R[lt],Dt=fi.gPoint,Dt.direction=Math.atan2(Dt.currentPos.y-fi.lastPos.y,Dt.currentPos.x-fi.lastPos.x),en=fi.lastPos.distanceTo(Dt.currentPos),fi.lastPos=Dt.currentPos,Ko=1e3*en/($r+1),Dt.speed=.75*Ko+.25*Dt.speed},ve=function(lt,ze){var fi=L(lt,ze);R.push({guid:fi,gPoint:ze,lastPos:ze.currentPos}),R.length===1&&(I=t.now(),C=window.setInterval(ne,50))},He=function(lt,ze){var fi=L(lt,ze),Dt,Ir=R.length;for(Dt=0;Dt<Ir;Dt++)if(R[Dt].guid===fi){R.splice(Dt,1),Ir--,Ir===0&&window.clearInterval(C);break}};return{addPoint:ve,removePoint:He}}(),t.MouseTracker.captureElement=document,t.MouseTracker.wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",t.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",t.MouseTracker.wheelEventName],t.MouseTracker.wheelEventName==="DOMMouseScroll"&&t.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),t.MouseTracker.havePointerCapture=function(){var R=document.createElement("div");return t.isFunction(R.setPointerCapture)&&t.isFunction(R.releasePointerCapture)}(),t.MouseTracker.havePointerCapture&&t.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(t.MouseTracker.havePointerEvents=!1,t.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),t.MouseTracker.mousePointerId="legacy-mouse",t.MouseTracker.havePointerCapture=function(){var R=document.createElement("div");return t.isFunction(R.setCapture)&&t.isFunction(R.releaseCapture)}(),t.MouseTracker.havePointerCapture&&t.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&t.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&t.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),t.MouseTracker.GesturePointList=function(R){this._gPoints=[],this.type=R,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},t.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(R){return this._gPoints.push(R)},removeById:function(R){var C,I=this._gPoints.length;for(C=0;C<I;C++)if(this._gPoints[C].id===R){this._gPoints.splice(C,1);break}return this._gPoints.length},getByIndex:function(R){return R<this._gPoints.length?this._gPoints[R]:null},getById:function(R){var C,I=this._gPoints.length;for(C=0;C<I;C++)if(this._gPoints[C].id===R)return this._gPoints[C];return null},getPrimary:function(R){var C,I=this._gPoints.length;for(C=0;C<I;C++)if(this._gPoints[C].isPrimary)return this._gPoints[C];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(t.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function o(R){var C=i[R.hash],I,L,ne,ve,He,lt=C.activePointersLists.length;for(I=0;I<lt;I++)if(ne=C.activePointersLists[I],ne.getLength()>0){for(He=[],ve=ne.asArray(),L=0;L<ve.length;L++)He.push(ve[L]);for(L=0;L<He.length;L++)bi(R,ne,He[L])}for(I=0;I<lt;I++)C.activePointersLists.pop();C.sentDragEvent=!1}function l(R){var C=i[R.hash],I,L;if(!C.tracking){for(L=0;L<t.MouseTracker.subscribeEvents.length;L++)I=t.MouseTracker.subscribeEvents[L],t.addEvent(R.element,I,C[I],I===t.MouseTracker.wheelEventName?{passive:!1,capture:!1}:!1);o(R),C.tracking=!0}}function u(R){var C=i[R.hash],I,L;if(C.tracking){for(L=0;L<t.MouseTracker.subscribeEvents.length;L++)I=t.MouseTracker.subscribeEvents[L],t.removeEvent(R.element,I,C[I],!1);o(R),C.tracking=!1}}function c(R,C){var I=i[R.hash];if(C==="pointerevent")return{upName:"pointerup",upHandler:I.pointerupcaptured,moveName:"pointermove",moveHandler:I.pointermovecaptured};if(C==="mouse")return{upName:"pointerup",upHandler:I.pointerupcaptured,moveName:"pointermove",moveHandler:I.pointermovecaptured};if(C==="touch")return{upName:"touchend",upHandler:I.touchendcaptured,moveName:"touchmove",moveHandler:I.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function d(R,C){var I;if(t.MouseTracker.havePointerCapture)if(t.MouseTracker.havePointerEvents)try{R.element.setPointerCapture(C.id)}catch{t.console.warn("setPointerCapture() called on invalid pointer ID");return}else R.element.setCapture(!0);else I=c(R,t.MouseTracker.havePointerEvents?"pointerevent":C.type),n&&s(window.top)&&t.addEvent(window.top,I.upName,I.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,I.upName,I.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,I.moveName,I.moveHandler,!0);Q(R,C,!0)}function p(R,C){var I,L,ne;if(t.MouseTracker.havePointerCapture)if(t.MouseTracker.havePointerEvents){if(L=R.getActivePointersListByType(C.type),ne=L.getById(C.id),!ne||!ne.captured)return;try{R.element.releasePointerCapture(C.id)}catch{}}else R.element.releaseCapture();else I=c(R,t.MouseTracker.havePointerEvents?"pointerevent":C.type),n&&s(window.top)&&t.removeEvent(window.top,I.upName,I.upHandler,!0),t.removeEvent(t.MouseTracker.captureElement,I.moveName,I.moveHandler,!0),t.removeEvent(t.MouseTracker.captureElement,I.upName,I.upHandler,!0);Q(R,C,!1)}function m(R){return t.MouseTracker.havePointerEvents?R.pointerId:t.MouseTracker.mousePointerId}function y(R){return t.MouseTracker.havePointerEvents&&R.pointerType?R.pointerType:"mouse"}function v(R){return t.MouseTracker.havePointerEvents?R.isPrimary:!0}function _(R){return t.getMousePosition(R)}function T(R,C){return E(_(R),C)}function E(R,C){var I=t.getElementOffset(C);return R.minus(I)}function S(R,C){return new t.Point((R.x+C.x)/2,(R.y+C.y)/2)}function A(R,C){var I={originalEvent:C,eventType:"click",pointerType:"mouse",isEmulated:!1};M(R,I),I.preventDefault&&!I.defaultPrevented&&t.cancelEvent(C),I.stopPropagation&&t.stopEvent(C)}function P(R,C){var I={originalEvent:C,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};M(R,I),I.preventDefault&&!I.defaultPrevented&&t.cancelEvent(C),I.stopPropagation&&t.stopEvent(C)}function D(R,C){var I=null,L={originalEvent:C,eventType:"keydown",pointerType:"",isEmulated:!1};M(R,L),R.keyDownHandler&&!L.preventGesture&&!L.defaultPrevented&&(I={eventSource:R,keyCode:C.keyCode?C.keyCode:C.charCode,ctrl:C.ctrlKey,shift:C.shiftKey,alt:C.altKey,meta:C.metaKey,originalEvent:C,preventDefault:L.preventDefault||L.defaultPrevented,userData:R.userData},R.keyDownHandler(I)),(I&&I.preventDefault||L.preventDefault&&!L.defaultPrevented)&&t.cancelEvent(C),L.stopPropagation&&t.stopEvent(C)}function k(R,C){var I=null,L={originalEvent:C,eventType:"keyup",pointerType:"",isEmulated:!1};M(R,L),R.keyUpHandler&&!L.preventGesture&&!L.defaultPrevented&&(I={eventSource:R,keyCode:C.keyCode?C.keyCode:C.charCode,ctrl:C.ctrlKey,shift:C.shiftKey,alt:C.altKey,meta:C.metaKey,originalEvent:C,preventDefault:L.preventDefault||L.defaultPrevented,userData:R.userData},R.keyUpHandler(I)),(I&&I.preventDefault||L.preventDefault&&!L.defaultPrevented)&&t.cancelEvent(C),L.stopPropagation&&t.stopEvent(C)}function U(R,C){var I=null,L={originalEvent:C,eventType:"keypress",pointerType:"",isEmulated:!1};M(R,L),R.keyHandler&&!L.preventGesture&&!L.defaultPrevented&&(I={eventSource:R,keyCode:C.keyCode?C.keyCode:C.charCode,ctrl:C.ctrlKey,shift:C.shiftKey,alt:C.altKey,meta:C.metaKey,originalEvent:C,preventDefault:L.preventDefault||L.defaultPrevented,userData:R.userData},R.keyHandler(I)),(I&&I.preventDefault||L.preventDefault&&!L.defaultPrevented)&&t.cancelEvent(C),L.stopPropagation&&t.stopEvent(C)}function j(R,C){var I={originalEvent:C,eventType:"focus",pointerType:"",isEmulated:!1};M(R,I),R.focusHandler&&!I.preventGesture&&R.focusHandler({eventSource:R,originalEvent:C,userData:R.userData})}function q(R,C){var I={originalEvent:C,eventType:"blur",pointerType:"",isEmulated:!1};M(R,I),R.blurHandler&&!I.preventGesture&&R.blurHandler({eventSource:R,originalEvent:C,userData:R.userData})}function ee(R,C){var I=null,L={originalEvent:C,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};M(R,L),R.contextMenuHandler&&!L.preventGesture&&!L.defaultPrevented&&(I={eventSource:R,position:E(_(C),R.element),originalEvent:L.originalEvent,preventDefault:L.preventDefault||L.defaultPrevented,userData:R.userData},R.contextMenuHandler(I)),(I&&I.preventDefault||L.preventDefault&&!L.defaultPrevented)&&t.cancelEvent(C),L.stopPropagation&&t.stopEvent(C)}function pe(R,C){F(R,C,C)}function H(R,C){var I={target:C.target||C.srcElement,type:"wheel",shiftKey:C.shiftKey||!1,clientX:C.clientX,clientY:C.clientY,pageX:C.pageX?C.pageX:C.clientX,pageY:C.pageY?C.pageY:C.clientY,deltaMode:C.type==="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};t.MouseTracker.wheelEventName==="mousewheel"?I.deltaY=-C.wheelDelta/t.DEFAULT_SETTINGS.pixelsPerWheelLine:I.deltaY=C.detail,F(R,I,C)}function F(R,C,I){var L=0,ne,ve=null;L=C.deltaY?C.deltaY<0?1:-1:0,ne={originalEvent:C,eventType:"wheel",pointerType:"mouse",isEmulated:C!==I},M(R,ne),R.scrollHandler&&!ne.preventGesture&&!ne.defaultPrevented&&(ve={eventSource:R,pointerType:"mouse",position:T(C,R.element),scroll:L,shift:C.shiftKey,isTouchEvent:!1,originalEvent:I,preventDefault:ne.preventDefault||ne.defaultPrevented,userData:R.userData},R.scrollHandler(ve)),ne.stopPropagation&&t.stopEvent(I),(ve&&ve.preventDefault||ne.preventDefault&&!ne.defaultPrevented)&&t.cancelEvent(I)}function G(R,C){var I={id:t.MouseTracker.mousePointerId,type:"mouse"},L={originalEvent:C,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};M(R,L),C.target===R.element&&Q(R,I,!1),L.stopPropagation&&t.stopEvent(C)}function $(R,C){var I,L,ne=C.changedTouches.length,ve,He=R.getActivePointersListByType("touch");I=t.now(),He.getLength()>C.touches.length-ne&&t.console.warn("Tracked touch contact count doesn't match event.touches.length");var lt={originalEvent:C,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(M(R,lt),L=0;L<ne;L++)ve={id:C.changedTouches[L].identifier,type:"touch",isPrimary:He.getLength()===0,currentPos:_(C.changedTouches[L]),currentTime:I},he(R,lt,ve),We(R,lt,ve,0),Q(R,ve,!0);lt.preventDefault&&!lt.defaultPrevented&&t.cancelEvent(C),lt.stopPropagation&&t.stopEvent(C)}function le(R,C){var I,L,ne=C.changedTouches.length,ve;I=t.now();var He={originalEvent:C,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(M(R,He),L=0;L<ne;L++)ve={id:C.changedTouches[L].identifier,type:"touch",currentPos:_(C.changedTouches[L]),currentTime:I},at(R,He,ve,0),Q(R,ve,!1),Ee(R,He,ve);He.preventDefault&&!He.defaultPrevented&&t.cancelEvent(C),He.stopPropagation&&t.stopEvent(C)}function ie(R,C){var I,L,ne=C.changedTouches.length,ve;I=t.now();var He={originalEvent:C,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(M(R,He),L=0;L<ne;L++)ve={id:C.changedTouches[L].identifier,type:"touch",currentPos:_(C.changedTouches[L]),currentTime:I},mt(R,He,ve);He.preventDefault&&!He.defaultPrevented&&t.cancelEvent(C),He.stopPropagation&&t.stopEvent(C)}function Y(R,C){var I=C.changedTouches.length,L,ne,ve={originalEvent:C,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(M(R,ve),L=0;L<I;L++)ne={id:C.changedTouches[L].identifier,type:"touch"},Xe(R,ve,ne);ve.stopPropagation&&t.stopEvent(C)}function de(R,C){return t.eventIsCanceled(C)||C.preventDefault(),!1}function z(R,C){return t.eventIsCanceled(C)||C.preventDefault(),!1}function N(R,C){var I={originalEvent:C,eventType:"gotpointercapture",pointerType:y(C),isEmulated:!1};M(R,I),C.target===R.element&&Q(R,{id:C.pointerId,type:y(C)},!0),I.stopPropagation&&t.stopEvent(C)}function W(R,C){var I={originalEvent:C,eventType:"lostpointercapture",pointerType:y(C),isEmulated:!1};M(R,I),C.target===R.element&&Q(R,{id:C.pointerId,type:y(C)},!1),I.stopPropagation&&t.stopEvent(C)}function re(R,C){var I={id:m(C),type:y(C),isPrimary:v(C),currentPos:_(C),currentTime:t.now()},L={originalEvent:C,eventType:"pointerenter",pointerType:I.type,isEmulated:!1};M(R,L),he(R,L,I)}function _e(R,C){var I={id:m(C),type:y(C),isPrimary:v(C),currentPos:_(C),currentTime:t.now()},L={originalEvent:C,eventType:"pointerleave",pointerType:I.type,isEmulated:!1};M(R,L),Ee(R,L,I)}function me(R,C){var I={id:m(C),type:y(C),isPrimary:v(C),currentPos:_(C),currentTime:t.now()},L={originalEvent:C,eventType:"pointerover",pointerType:I.type,isEmulated:!1};M(R,L),Ne(R,L,I),L.preventDefault&&!L.defaultPrevented&&t.cancelEvent(C),L.stopPropagation&&t.stopEvent(C)}function Pe(R,C){var I={id:m(C),type:y(C),isPrimary:v(C),currentPos:_(C),currentTime:t.now()},L={originalEvent:C,eventType:"pointerout",pointerType:I.type,isEmulated:!1};M(R,L),ue(R,L,I),L.preventDefault&&!L.defaultPrevented&&t.cancelEvent(C),L.stopPropagation&&t.stopEvent(C)}function Ue(R,C){var I={id:m(C),type:y(C),isPrimary:v(C),currentPos:_(C),currentTime:t.now()},L=t.MouseTracker.havePointerEvents&&I.type==="touch",ne={originalEvent:C,eventType:"pointerdown",pointerType:I.type,isEmulated:!1};M(R,ne),We(R,ne,I,C.button),ne.preventDefault&&!ne.defaultPrevented&&t.cancelEvent(C),ne.stopPropagation&&t.stopEvent(C),ne.shouldCapture&&(L?Q(R,I,!0):d(R,I))}function Te(R,C){Ke(R,C)}function ge(R,C){var I=R.getActivePointersListByType(y(C));I.getById(C.pointerId)&&Ke(R,C),t.stopEvent(C)}function Ke(R,C){var I;I={id:m(C),type:y(C),isPrimary:v(C),currentPos:_(C),currentTime:t.now()};var L={originalEvent:C,eventType:"pointerup",pointerType:I.type,isEmulated:!1};M(R,L),at(R,L,I,C.button),L.preventDefault&&!L.defaultPrevented&&t.cancelEvent(C),L.stopPropagation&&t.stopEvent(C),L.shouldReleaseCapture&&(C.target===R.element?p(R,I):Q(R,I,!1))}function Je(R,C){st(R,C)}function ht(R,C){var I=R.getActivePointersListByType(y(C));I.getById(C.pointerId)&&st(R,C),t.stopEvent(C)}function st(R,C){var I={id:m(C),type:y(C),isPrimary:v(C),currentPos:_(C),currentTime:t.now()},L={originalEvent:C,eventType:"pointermove",pointerType:I.type,isEmulated:!1};M(R,L),mt(R,L,I),L.preventDefault&&!L.defaultPrevented&&t.cancelEvent(C),L.stopPropagation&&t.stopEvent(C)}function ti(R,C){var I={id:C.pointerId,type:y(C)},L={originalEvent:C,eventType:"pointercancel",pointerType:I.type,isEmulated:!1};M(R,L),Xe(R,L,I),L.stopPropagation&&t.stopEvent(C)}function Zt(R,C){return C.speed=0,C.direction=0,C.contactPos=C.currentPos,C.contactTime=C.currentTime,C.lastPos=C.currentPos,C.lastTime=C.currentTime,R.add(C)}function bi(R,C,I){var L,ne=C.getById(I.id);return ne?(ne.captured&&(t.console.warn("stopTrackingPointer() called on captured pointer"),p(R,ne)),C.removeContact(),L=C.removeById(I.id)):L=C.getLength(),L}function b(R,C){switch(C.eventType){case"pointermove":C.isStoppable=!0,C.isCancelable=!0,C.preventDefault=!1,C.preventGesture=!R.hasGestureHandlers,C.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":C.isStoppable=!0,C.isCancelable=!0,C.preventDefault=!1,C.preventGesture=!1,C.stopPropagation=!1;break;case"pointerdown":C.isStoppable=!0,C.isCancelable=!0,C.preventDefault=!1,C.preventGesture=!R.hasGestureHandlers,C.stopPropagation=!1;break;case"pointerup":C.isStoppable=!0,C.isCancelable=!0,C.preventDefault=!1,C.preventGesture=!R.hasGestureHandlers,C.stopPropagation=!1;break;case"wheel":C.isStoppable=!0,C.isCancelable=!0,C.preventDefault=!1,C.preventGesture=!R.hasScrollHandler,C.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":C.isStoppable=!0,C.isCancelable=!1,C.preventDefault=!1,C.preventGesture=!1,C.stopPropagation=!1;break;case"click":C.isStoppable=!0,C.isCancelable=!0,C.preventDefault=!!R.clickHandler,C.preventGesture=!1,C.stopPropagation=!1;break;case"dblclick":C.isStoppable=!0,C.isCancelable=!0,C.preventDefault=!!R.dblClickHandler,C.preventGesture=!1,C.stopPropagation=!1;break;case"focus":case"blur":case"pointerenter":case"pointerleave":default:C.isStoppable=!1,C.isCancelable=!1,C.preventDefault=!1,C.preventGesture=!1,C.stopPropagation=!1;break}}function M(R,C){C.eventSource=R,C.eventPhase=C.originalEvent&&typeof C.originalEvent.eventPhase<"u"?C.originalEvent.eventPhase:0,C.defaultPrevented=t.eventIsCanceled(C.originalEvent),C.shouldCapture=!1,C.shouldReleaseCapture=!1,C.userData=R.userData,b(R,C),R.preProcessEventHandler&&R.preProcessEventHandler(C)}function Q(R,C,I){var L=R.getActivePointersListByType(C.type),ne=L.getById(C.id);ne?I&&!ne.captured?(ne.captured=!0,L.captureCount++):!I&&ne.captured&&(ne.captured=!1,L.captureCount--,L.captureCount<0&&(L.captureCount=0,t.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):t.console.warn("updatePointerCaptured() called on untracked pointer")}function he(R,C,I){var L=R.getActivePointersListByType(I.type),ne;ne=L.getById(I.id),ne?(ne.insideElement=!0,ne.lastPos=ne.currentPos,ne.lastTime=ne.currentTime,ne.currentPos=I.currentPos,ne.currentTime=I.currentTime,I=ne):(I.captured=!1,I.insideElementPressed=!1,I.insideElement=!0,Zt(L,I)),R.enterHandler&&R.enterHandler({eventSource:R,pointerType:I.type,position:E(I.currentPos,R.element),buttons:L.buttons,pointers:R.getActivePointerCount(),insideElementPressed:I.insideElementPressed,buttonDownAny:L.buttons!==0,isTouchEvent:I.type==="touch",originalEvent:C.originalEvent,userData:R.userData})}function Ee(R,C,I){var L=R.getActivePointersListByType(I.type),ne,ve;ne=L.getById(I.id),ne?(ne.captured?(ne.insideElement=!1,ne.lastPos=ne.currentPos,ne.lastTime=ne.currentTime,ne.currentPos=I.currentPos,ne.currentTime=I.currentTime):bi(R,L,ne),I=ne):(I.captured=!1,I.insideElementPressed=!1),(R.leaveHandler||R.exitHandler)&&(ve={eventSource:R,pointerType:I.type,position:I.currentPos&&E(I.currentPos,R.element),buttons:L.buttons,pointers:R.getActivePointerCount(),insideElementPressed:I.insideElementPressed,buttonDownAny:L.buttons!==0,isTouchEvent:I.type==="touch",originalEvent:C.originalEvent,userData:R.userData},R.leaveHandler&&R.leaveHandler(ve),R.exitHandler&&R.exitHandler(ve))}function Ne(R,C,I){var L,ne;L=R.getActivePointersListByType(I.type),ne=L.getById(I.id),ne?I=ne:(I.captured=!1,I.insideElementPressed=!1),R.overHandler&&R.overHandler({eventSource:R,pointerType:I.type,position:E(I.currentPos,R.element),buttons:L.buttons,pointers:R.getActivePointerCount(),insideElementPressed:I.insideElementPressed,buttonDownAny:L.buttons!==0,isTouchEvent:I.type==="touch",originalEvent:C.originalEvent,userData:R.userData})}function ue(R,C,I){var L,ne;L=R.getActivePointersListByType(I.type),ne=L.getById(I.id),ne?I=ne:(I.captured=!1,I.insideElementPressed=!1),R.outHandler&&R.outHandler({eventSource:R,pointerType:I.type,position:I.currentPos&&E(I.currentPos,R.element),buttons:L.buttons,pointers:R.getActivePointerCount(),insideElementPressed:I.insideElementPressed,buttonDownAny:L.buttons!==0,isTouchEvent:I.type==="touch",originalEvent:C.originalEvent,userData:R.userData})}function We(R,C,I,L){var ne=i[R.hash],ve=R.getActivePointersListByType(I.type),He;if(typeof C.originalEvent.buttons<"u"?ve.buttons=C.originalEvent.buttons:L===0?ve.buttons|=1:L===1?ve.buttons|=4:L===2?ve.buttons|=2:L===3?ve.buttons|=8:L===4?ve.buttons|=16:L===5&&(ve.buttons|=32),L!==0){C.shouldCapture=!1,C.shouldReleaseCapture=!1,R.nonPrimaryPressHandler&&!C.preventGesture&&!C.defaultPrevented&&(C.preventDefault=!0,R.nonPrimaryPressHandler({eventSource:R,pointerType:I.type,position:E(I.currentPos,R.element),button:L,buttons:ve.buttons,isTouchEvent:I.type==="touch",originalEvent:C.originalEvent,userData:R.userData}));return}He=ve.getById(I.id),He?(He.insideElementPressed=!0,He.insideElement=!0,He.originalTarget=C.originalEvent.target,He.contactPos=I.currentPos,He.contactTime=I.currentTime,He.lastPos=He.currentPos,He.lastTime=He.currentTime,He.currentPos=I.currentPos,He.currentTime=I.currentTime,I=He):(I.captured=!1,I.insideElementPressed=!0,I.insideElement=!0,I.originalTarget=C.originalEvent.target,Zt(ve,I)),ve.addContact(),!C.preventGesture&&!C.defaultPrevented?(C.shouldCapture=!0,C.shouldReleaseCapture=!1,C.preventDefault=!0,(R.dragHandler||R.dragEndHandler||R.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.addPoint(R,I),ve.contacts===1?R.pressHandler&&!C.preventGesture&&R.pressHandler({eventSource:R,pointerType:I.type,position:E(I.contactPos,R.element),buttons:ve.buttons,isTouchEvent:I.type==="touch",originalEvent:C.originalEvent,userData:R.userData}):ve.contacts===2&&R.pinchHandler&&I.type==="touch"&&(ne.pinchGPoints=ve.asArray(),ne.lastPinchDist=ne.currentPinchDist=ne.pinchGPoints[0].currentPos.distanceTo(ne.pinchGPoints[1].currentPos),ne.lastPinchCenter=ne.currentPinchCenter=S(ne.pinchGPoints[0].currentPos,ne.pinchGPoints[1].currentPos))):(C.shouldCapture=!1,C.shouldReleaseCapture=!1)}function at(R,C,I,L){var ne=i[R.hash],ve=R.getActivePointersListByType(I.type),He,lt,ze,fi=!1,Dt;if(typeof C.originalEvent.buttons<"u"?ve.buttons=C.originalEvent.buttons:L===0?ve.buttons^=-2:L===1?ve.buttons^=-5:L===2?ve.buttons^=-3:L===3?ve.buttons^=-9:L===4?ve.buttons^=-17:L===5&&(ve.buttons^=-33),C.shouldCapture=!1,L!==0){C.shouldReleaseCapture=!1,R.nonPrimaryReleaseHandler&&!C.preventGesture&&!C.defaultPrevented&&(C.preventDefault=!0,R.nonPrimaryReleaseHandler({eventSource:R,pointerType:I.type,position:E(I.currentPos,R.element),button:L,buttons:ve.buttons,isTouchEvent:I.type==="touch",originalEvent:C.originalEvent,userData:R.userData}));return}ze=ve.getById(I.id),ze?(ve.removeContact(),ze.captured&&(fi=!0),ze.lastPos=ze.currentPos,ze.lastTime=ze.currentTime,ze.currentPos=I.currentPos,ze.currentTime=I.currentTime,ze.insideElement||bi(R,ve,ze),He=ze.currentPos,lt=ze.currentTime):(I.captured=!1,I.insideElementPressed=!1,I.insideElement=!0,Zt(ve,I),ze=I),!C.preventGesture&&!C.defaultPrevented&&(fi?(C.shouldReleaseCapture=!0,C.preventDefault=!0,(R.dragHandler||R.dragEndHandler||R.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.removePoint(R,ze),ve.contacts===0?(R.releaseHandler&&He&&R.releaseHandler({eventSource:R,pointerType:ze.type,position:E(He,R.element),buttons:ve.buttons,insideElementPressed:ze.insideElementPressed,insideElementReleased:ze.insideElement,isTouchEvent:ze.type==="touch",originalEvent:C.originalEvent,userData:R.userData}),R.dragEndHandler&&ne.sentDragEvent&&R.dragEndHandler({eventSource:R,pointerType:ze.type,position:E(ze.currentPos,R.element),speed:ze.speed,direction:ze.direction,shift:C.originalEvent.shiftKey,isTouchEvent:ze.type==="touch",originalEvent:C.originalEvent,userData:R.userData}),ne.sentDragEvent=!1,(R.clickHandler||R.dblClickHandler)&&ze.insideElement&&(Dt=lt-ze.contactTime<=R.clickTimeThreshold&&ze.contactPos.distanceTo(He)<=R.clickDistThreshold,R.clickHandler&&R.clickHandler({eventSource:R,pointerType:ze.type,position:E(ze.currentPos,R.element),quick:Dt,shift:C.originalEvent.shiftKey,isTouchEvent:ze.type==="touch",originalEvent:C.originalEvent,originalTarget:ze.originalTarget,userData:R.userData}),R.dblClickHandler&&Dt&&(ve.clicks++,ve.clicks===1?(ne.lastClickPos=He,ne.dblClickTimeOut=setTimeout(function(){ve.clicks=0},R.dblClickTimeThreshold)):ve.clicks===2&&(clearTimeout(ne.dblClickTimeOut),ve.clicks=0,ne.lastClickPos.distanceTo(He)<=R.dblClickDistThreshold&&R.dblClickHandler({eventSource:R,pointerType:ze.type,position:E(ze.currentPos,R.element),shift:C.originalEvent.shiftKey,isTouchEvent:ze.type==="touch",originalEvent:C.originalEvent,userData:R.userData}),ne.lastClickPos=null)))):ve.contacts===2&&R.pinchHandler&&ze.type==="touch"&&(ne.pinchGPoints=ve.asArray(),ne.lastPinchDist=ne.currentPinchDist=ne.pinchGPoints[0].currentPos.distanceTo(ne.pinchGPoints[1].currentPos),ne.lastPinchCenter=ne.currentPinchCenter=S(ne.pinchGPoints[0].currentPos,ne.pinchGPoints[1].currentPos))):(C.shouldReleaseCapture=!1,R.releaseHandler&&He&&(R.releaseHandler({eventSource:R,pointerType:ze.type,position:E(He,R.element),buttons:ve.buttons,insideElementPressed:ze.insideElementPressed,insideElementReleased:ze.insideElement,isTouchEvent:ze.type==="touch",originalEvent:C.originalEvent,userData:R.userData}),C.preventDefault=!0)))}function mt(R,C,I){var L=i[R.hash],ne=R.getActivePointersListByType(I.type),ve,He,lt;if(typeof C.originalEvent.buttons<"u"&&(ne.buttons=C.originalEvent.buttons),ve=ne.getById(I.id),ve)ve.lastPos=ve.currentPos,ve.lastTime=ve.currentTime,ve.currentPos=I.currentPos,ve.currentTime=I.currentTime;else return;C.shouldCapture=!1,C.shouldReleaseCapture=!1,R.stopHandler&&I.type==="mouse"&&(clearTimeout(R.stopTimeOut),R.stopTimeOut=setTimeout(function(){gt(R,C.originalEvent,I.type)},R.stopDelay)),ne.contacts===0?R.moveHandler&&R.moveHandler({eventSource:R,pointerType:I.type,position:E(I.currentPos,R.element),buttons:ne.buttons,isTouchEvent:I.type==="touch",originalEvent:C.originalEvent,userData:R.userData}):ne.contacts===1?(R.moveHandler&&(ve=ne.asArray()[0],R.moveHandler({eventSource:R,pointerType:ve.type,position:E(ve.currentPos,R.element),buttons:ne.buttons,isTouchEvent:ve.type==="touch",originalEvent:C.originalEvent,userData:R.userData})),R.dragHandler&&!C.preventGesture&&!C.defaultPrevented&&(ve=ne.asArray()[0],lt=ve.currentPos.minus(ve.lastPos),R.dragHandler({eventSource:R,pointerType:ve.type,position:E(ve.currentPos,R.element),buttons:ne.buttons,delta:lt,speed:ve.speed,direction:ve.direction,shift:C.originalEvent.shiftKey,isTouchEvent:ve.type==="touch",originalEvent:C.originalEvent,userData:R.userData}),C.preventDefault=!0,L.sentDragEvent=!0)):ne.contacts===2&&(R.moveHandler&&(He=ne.asArray(),R.moveHandler({eventSource:R,pointerType:He[0].type,position:E(S(He[0].currentPos,He[1].currentPos),R.element),buttons:ne.buttons,isTouchEvent:He[0].type==="touch",originalEvent:C.originalEvent,userData:R.userData})),R.pinchHandler&&I.type==="touch"&&!C.preventGesture&&!C.defaultPrevented&&(lt=L.pinchGPoints[0].currentPos.distanceTo(L.pinchGPoints[1].currentPos),lt!==L.currentPinchDist&&(L.lastPinchDist=L.currentPinchDist,L.currentPinchDist=lt,L.lastPinchCenter=L.currentPinchCenter,L.currentPinchCenter=S(L.pinchGPoints[0].currentPos,L.pinchGPoints[1].currentPos),R.pinchHandler({eventSource:R,pointerType:"touch",gesturePoints:L.pinchGPoints,lastCenter:E(L.lastPinchCenter,R.element),center:E(L.currentPinchCenter,R.element),lastDistance:L.lastPinchDist,distance:L.currentPinchDist,shift:C.originalEvent.shiftKey,originalEvent:C.originalEvent,userData:R.userData}),C.preventDefault=!0)))}function Xe(R,C,I){var L=R.getActivePointersListByType(I.type),ne;ne=L.getById(I.id),ne&&bi(R,L,ne)}function gt(R,C,I){R.stopHandler&&R.stopHandler({eventSource:R,pointerType:I,position:T(C,R.element),buttons:R.getActivePointersListByType(I).buttons,isTouchEvent:I==="touch",originalEvent:C,userData:R.userData})}}(e),function(t){t.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},t.Control=function(i,n,s){var o=i.parentNode;typeof n=="number"&&(t.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),n={anchor:n}),n.attachToViewer=typeof n.attachToViewer>"u"?!0:n.attachToViewer,this.autoFade=typeof n.autoFade>"u"?!0:n.autoFade,this.element=i,this.anchor=n.anchor,this.container=s,this.anchor===t.ControlAnchor.ABSOLUTE?(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof n.top=="number"?n.top+"px":n.top,this.wrapper.style.left=typeof n.left=="number"?n.left+"px":n.left,this.wrapper.style.height=typeof n.height=="number"?n.height+"px":n.height,this.wrapper.style.width=typeof n.width=="number"?n.width+"px":n.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===t.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),n.attachToViewer?this.anchor===t.ControlAnchor.TOP_RIGHT||this.anchor===t.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):o.appendChild(this.wrapper)},t.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==t.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!=="none"},setVisible:function(i){this.wrapper.style.display=i?this.anchor===t.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(i){t.setElementOpacity(this.wrapper,i,!0)}}}(e),function(t){t.ControlDock=function(n){var s=["topleft","topright","bottomright","bottomleft"],o,l;for(t.extend(!0,this,{id:"controldock-"+t.now()+"-"+Math.floor(Math.random()*1e6),container:t.makeNeutralElement("div"),controls:[]},n),this.container.onsubmit=function(){return!1},this.element&&(this.element=t.getElement(this.element),this.element.appendChild(this.container),t.getElementStyle(this.element).position==="static"&&(this.element.style.position="relative"),this.container.style.width="100%",this.container.style.height="100%"),l=0;l<s.length;l++)o=s[l],this.controls[o]=t.makeNeutralElement("div"),this.controls[o].style.position="absolute",o.match("left")&&(this.controls[o].style.left="0px"),o.match("right")&&(this.controls[o].style.right="0px"),o.match("top")&&(this.controls[o].style.top="0px"),o.match("bottom")&&(this.controls[o].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},t.ControlDock.prototype={addControl:function(n,s){n=t.getElement(n);var o=null;if(!(i(this,n)>=0)){switch(s.anchor){case t.ControlAnchor.TOP_RIGHT:o=this.controls.topright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingTop="0px";break;case t.ControlAnchor.BOTTOM_RIGHT:o=this.controls.bottomright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingBottom="0px";break;case t.ControlAnchor.BOTTOM_LEFT:o=this.controls.bottomleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingBottom="0px";break;case t.ControlAnchor.TOP_LEFT:o=this.controls.topleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingTop="0px";break;case t.ControlAnchor.ABSOLUTE:o=this.container,n.style.margin="0px",n.style.padding="0px";break;default:case t.ControlAnchor.NONE:o=this.container,n.style.margin="0px",n.style.padding="0px";break}this.controls.push(new t.Control(n,s,o)),n.style.display="inline-block"}},removeControl:function(n){n=t.getElement(n);var s=i(this,n);return s>=0&&(this.controls[s].destroy(),this.controls.splice(s,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var n;for(n=this.controls.length-1;n>=0;n--)if(this.controls[n].isVisible())return!0;return!1},setControlsEnabled:function(n){var s;for(s=this.controls.length-1;s>=0;s--)this.controls[s].setVisible(n);return this}};function i(n,s){var o=n.controls,l;for(l=o.length-1;l>=0;l--)if(o[l].element===s)return l;return-1}}(e),function(t){t.Placement=t.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(e),function(t){var i={},n=1;t.Viewer=function(b){var M=arguments,Q=this,he;t.isPlainObject(b)||(b={id:M[0],xmlPath:M.length>1?M[1]:void 0,prefixUrl:M.length>2?M[2]:void 0,controls:M.length>3?M[3]:void 0,overlays:M.length>4?M[4]:void 0}),b.config&&(t.extend(!0,b,b.config),delete b.config);let Ee=["useCanvas"];if(b.drawerOptions=Object.assign({},Ee.reduce((ue,We)=>(ue[We]=b[We],delete b[We],ue),{}),b.drawerOptions),t.extend(!0,this,{id:b.id,hash:b.hash||n++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttonGroup:null,profiler:null},t.DEFAULT_SETTINGS,b),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");typeof i[this.hash]<"u"&&t.console.warn("Hash "+this.hash+" has already been used."),i[this.hash]={fsBoundsDelta:new t.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,needsResize:!1,forceResize:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null,lastClickTime:null,draggingToZoom:!1},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=t.now(),t.EventSource.call(this),this.addHandler("open-failed",function(ue){var We=t.getString("Errors.OpenFailed",ue.eventSource,ue.message);Q._showMessage(We)}),t.ControlDock.call(this,b),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=t.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(ue){ue.width="100%",ue.height="100%",ue.overflow="hidden",ue.position="absolute",ue.top="0px",ue.left="0px"}(this.canvas.style),t.setElementTouchActionNone(this.canvas),b.tabIndex!==""&&(this.canvas.tabIndex=b.tabIndex===void 0?0:b.tabIndex),this.container.className="openseadragon-container",function(ue){ue.width="100%",ue.height="100%",ue.position="relative",ue.overflow="hidden",ue.left="0px",ue.top="0px",ue.textAlign="left"}(this.container.style),t.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new t.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:t.delegate(this,T),keyDownHandler:t.delegate(this,E),keyHandler:t.delegate(this,S),clickHandler:t.delegate(this,A),dblClickHandler:t.delegate(this,P),dragHandler:t.delegate(this,D),dragEndHandler:t.delegate(this,k),enterHandler:t.delegate(this,U),leaveHandler:t.delegate(this,j),pressHandler:t.delegate(this,q),releaseHandler:t.delegate(this,ee),nonPrimaryPressHandler:t.delegate(this,pe),nonPrimaryReleaseHandler:t.delegate(this,H),scrollHandler:t.delegate(this,le),pinchHandler:t.delegate(this,F),focusHandler:t.delegate(this,G),blurHandler:t.delegate(this,$)}),this.outerTracker=new t.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:t.delegate(this,ie),leaveHandler:t.delegate(this,Y)}),this.toolbar&&(this.toolbar=new t.ControlDock({element:this.toolbar})),this.bindStandardControls(),i[this.hash].prevContainerSize=s(this.container),window.ResizeObserver?(this._autoResizePolling=!1,this._resizeObserver=new ResizeObserver(function(){i[Q.hash].needsResize=!0}),this._resizeObserver.observe(this.container,{})):this._autoResizePolling=!0,this.world=new t.World({viewer:this}),this.world.addHandler("add-item",function(ue){Q.source=Q.world.getItemAt(0).source,i[Q.hash].forceRedraw=!0,Q._updateRequestId||(Q._updateRequestId=c(Q,de))}),this.world.addHandler("remove-item",function(ue){Q.world.getItemCount()?Q.source=Q.world.getItemAt(0).source:Q.source=null,i[Q.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(ue){Q.viewport&&Q.viewport._setContentBounds(Q.world.getHomeBounds(),Q.world.getContentFactor())}),this.world.addHandler("item-index-change",function(ue){Q.source=Q.world.getItemAt(0).source}),this.viewport=new t.Viewport({containerSize:i[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,overlayPreserveContentDirection:this.overlayPreserveContentDirection,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new t.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:b.timeout,tileRetryMax:this.tileRetryMax,tileRetryDelay:this.tileRetryDelay}),this.tileCache=new t.TileCache({maxImageCacheCount:this.maxImageCacheCount}),Object.prototype.hasOwnProperty.call(this.drawerOptions,"useCanvas")&&(t.console.error('useCanvas is deprecated, use the "drawer" option to indicate preferred drawer(s)'),this.drawerOptions.useCanvas||(this.drawer=t.HTMLDrawer),delete this.drawerOptions.useCanvas);let Ne=Array.isArray(this.drawer)?this.drawer:[this.drawer];Ne.length===0&&(Ne=[t.DEFAULT_SETTINGS.drawer].flat(),t.console.warn("No valid drawers were selected. Using the default value.")),this.drawer=null;for(const ue of Ne)if(this.requestDrawer(ue,{mainDrawer:!0,redrawImmediately:!1}))break;if(!this.drawer)throw t.console.error("No drawer could be created!"),"Error with creating the selected drawer(s)";for(this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),this.overlaysContainer=t.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(he=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(he,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(he=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(he,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new t.Navigator({element:this.navigatorElement,id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy,animationTime:this.animationTime,drawer:this.drawer.getType(),loadTilesWithAjax:this.loadTilesWithAjax,ajaxHeaders:this.ajaxHeaders,ajaxWithCredentials:this.ajaxWithCredentials})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),he=0;he<this.customControls.length;he++)this.addControl(this.customControls[he].id,{anchor:this.customControls[he].anchor});t.requestAnimationFrame(function(){p(Q)}),t._viewers.set(this.element,this)},t.extend(t.Viewer.prototype,t.EventSource.prototype,t.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(b){return t.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(b)},openTileSource:function(b){return t.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(b)},get buttons(){return t.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(b,M){var Q=this;if(this.close(),!b)return this;if(this.sequenceMode&&t.isArray(b))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof M<"u"&&!isNaN(M)&&(this.initialPage=M),this.tileSources=b,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(t.isArray(b)||(b=[b]),!b.length)return this;this._opening=!0;for(var he=b.length,Ee=0,Ne=0,ue,We=function(){if(Ee+Ne===he)if(Ee){(Q._firstOpen||!Q.preserveViewport)&&(Q.viewport.goHome(!0),Q.viewport.update()),Q._firstOpen=!1;var Xe=b[0];if(Xe.tileSource&&(Xe=Xe.tileSource),Q.overlays&&!Q.preserveOverlays)for(var gt=0;gt<Q.overlays.length;gt++)Q.currentOverlays[gt]=l(Q,Q.overlays[gt]);Q._drawOverlays(),Q._opening=!1,Q.raiseEvent("open",{source:Xe})}else Q._opening=!1,Q.raiseEvent("open-failed",ue)},at=function(Xe){(!t.isPlainObject(Xe)||!Xe.tileSource)&&(Xe={tileSource:Xe}),Xe.index!==void 0&&(t.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete Xe.index),Xe.collectionImmediately===void 0&&(Xe.collectionImmediately=!0);var gt=Xe.success;Xe.success=function(C){if(Ee++,Xe.tileSource.overlays)for(var I=0;I<Xe.tileSource.overlays.length;I++)Q.addOverlay(Xe.tileSource.overlays[I]);gt&&gt(C),We()};var R=Xe.error;Xe.error=function(C){Ne++,ue||(ue=C),R&&R(C),We()},Q.addTiledImage(Xe)},mt=0;mt<b.length;mt++)at(b[mt]);return this},close:function(){return i[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),i[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(i[this.hash]){if(this.raiseEvent("before-destroy"),this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this._resizeObserver&&this._resizeObserver.disconnect(),this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(t.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),i[this.navigator.hash]=null,delete i[this.navigator.hash],this.navigator=null),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),i[this.hash]=null,delete i[this.hash],this.canvas=null,this.container=null,t._viewers.delete(this.element),this.element=null,this.raiseEvent("destroy"),this.removeAllHandlers()}},requestDrawer(b,M){const Q={mainDrawer:!0,redrawImmediately:!0,drawerOptions:null};M=t.extend(!0,Q,M);const he=M.mainDrawer,Ee=M.redrawImmediately,Ne=M.drawerOptions,ue=this.drawer;let We=null;if(b&&b.prototype instanceof t.DrawerBase?(We=b,b="custom"):typeof b=="string"&&(We=t.determineDrawer(b)),We||t.console.warn("Unsupported drawer! Drawer must be an existing string type, or a class that extends OpenSeadragon.DrawerBase."),We&&We.isSupported()){ue&&he&&ue.destroy();const at=new We({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor,options:Ne||this.drawerOptions[b]});return he&&(this.drawer=at,Ee&&this.forceRedraw()),at}return!1},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(b){return this.innerTracker.setTracking(b),this.outerTracker.setTracking(b),this.raiseEvent("mouse-enabled",{enabled:b}),this},areControlsEnabled:function(){var b=this.controls.length,M;for(M=0;M<this.controls.length;M++)b=b&&this.controls[M].isVisible();return b},setControlsEnabled:function(b){return b?y(this):p(this),this.raiseEvent("controls-enabled",{enabled:b}),this},setDebugMode:function(b){for(var M=0;M<this.world.getItemCount();M++)this.world.getItemAt(M).debugMode=b;this.debugMode=b,this.forceRedraw()},setAjaxHeaders:function(b,M){if(b===null&&(b={}),!t.isPlainObject(b)){console.error("[Viewer.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}if(M===void 0&&(M=!0),this.ajaxHeaders=b,M){for(var Q=0;Q<this.world.getItemCount();Q++)this.world.getItemAt(Q)._updateAjaxHeaders(!0);if(this.navigator&&this.navigator.setAjaxHeaders(this.ajaxHeaders,!0),this.referenceStrip&&this.referenceStrip.miniViewers)for(var he in this.referenceStrip.miniViewers)this.referenceStrip.miniViewers[he].setAjaxHeaders(this.ajaxHeaders,!0)}},addButton:function(b){this.buttonGroup.addButton(b)},isFullPage:function(){return i[this.hash]&&i[this.hash].fullPage},setFullPage:function(b){var M=document.body,Q=M.style,he=document.documentElement.style,Ee=this,Ne,ue;if(b===this.isFullPage())return this;var We={fullPage:b,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",We),We.preventDefaultAction)return this;if(b&&this.element){for(this.elementSize=t.getElementSize(this.element),this.pageScroll=t.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=Q.margin,this.docMargin=he.margin,Q.margin="0",he.margin="0",this.bodyPadding=Q.padding,this.docPadding=he.padding,Q.padding="0",he.padding="0",this.bodyWidth=Q.width,this.docWidth=he.width,Q.width="100%",he.width="100%",this.bodyHeight=Q.height,this.docHeight=he.height,Q.height="100%",he.height="100%",this.bodyDisplay=Q.display,Q.display="block",this.previousBody=[],i[this.hash].prevElementParent=this.element.parentNode,i[this.hash].prevNextSibling=this.element.nextSibling,i[this.hash].prevElementWidth=this.element.style.width,i[this.hash].prevElementHeight=this.element.style.height,Ne=M.childNodes.length,ue=0;ue<Ne;ue++)this.previousBody.push(M.childNodes[0]),M.removeChild(M.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,M.appendChild(this.toolbar.element),t.addClass(this.toolbar.element,"fullpage")),t.addClass(this.element,"fullpage"),M.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=t.getElementSize(this.element).y-t.getElementSize(this.toolbar.element).y+"px"),i[this.hash].fullPage=!0,t.delegate(this,ie)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,Q.margin=this.bodyMargin,he.margin=this.docMargin,Q.padding=this.bodyPadding,he.padding=this.docPadding,Q.width=this.bodyWidth,he.width=this.docWidth,Q.height=this.bodyHeight,he.height=this.docHeight,Q.display=this.bodyDisplay,M.removeChild(this.element),Ne=this.previousBody.length,ue=0;ue<Ne;ue++)M.appendChild(this.previousBody.shift());t.removeClass(this.element,"fullpage"),i[this.hash].prevElementParent.insertBefore(this.element,i[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(M.removeChild(this.toolbar.element),t.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=i[this.hash].prevElementWidth,this.element.style.height=i[this.hash].prevElementHeight;var at=0,mt=function(){t.setPageScroll(Ee.pageScroll);var Xe=t.getPageScroll();at++,at<10&&(Xe.x!==Ee.pageScroll.x||Xe.y!==Ee.pageScroll.y)&&t.requestAnimationFrame(mt)};t.requestAnimationFrame(mt),i[this.hash].fullPage=!1,t.delegate(this,Y)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:b}),this},setFullScreen:function(b){var M=this;if(!t.supportsFullScreen)return this.setFullPage(b);if(t.isFullScreen()===b)return this;var Q={fullScreen:b,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",Q),Q.preventDefaultAction)return this;if(b){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var he=function(){var Ee=t.isFullScreen();Ee||(t.removeEvent(document,t.fullScreenEventName,he),t.removeEvent(document,t.fullScreenErrorEventName,he),M.setFullPage(!1),M.isFullPage()&&(M.element.style.width=M.fullPageStyleWidth,M.element.style.height=M.fullPageStyleHeight)),M.navigator&&M.viewport&&setTimeout(function(){M.navigator.update(M.viewport)}),M.raiseEvent("full-screen",{fullScreen:Ee})};t.addEvent(document,t.fullScreenEventName,he),t.addEvent(document,t.fullScreenErrorEventName,he),t.requestFullScreen(document.body)}else t.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!=="hidden"},isFullScreen:function(){return t.isFullScreen()&&this.isFullPage()},setVisible:function(b){return this.container.style.visibility=b?"":"hidden",this.raiseEvent("visible",{visible:b}),this},addTiledImage:function(b){t.console.assert(b,"[Viewer.addTiledImage] options is required"),t.console.assert(b.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),t.console.assert(!b.replace||b.index>-1&&b.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var M=this;b.replace&&(b.replaceItem=M.world.getItemAt(b.index)),this._hideMessage(),b.placeholderFillStyle===void 0&&(b.placeholderFillStyle=this.placeholderFillStyle),b.opacity===void 0&&(b.opacity=this.opacity),b.preload===void 0&&(b.preload=this.preload),b.compositeOperation===void 0&&(b.compositeOperation=this.compositeOperation),b.crossOriginPolicy===void 0&&(b.crossOriginPolicy=b.tileSource.crossOriginPolicy!==void 0?b.tileSource.crossOriginPolicy:this.crossOriginPolicy),b.ajaxWithCredentials===void 0&&(b.ajaxWithCredentials=this.ajaxWithCredentials),b.loadTilesWithAjax===void 0&&(b.loadTilesWithAjax=this.loadTilesWithAjax),t.isPlainObject(b.ajaxHeaders)||(b.ajaxHeaders={});var Q={options:b};function he(ue){for(var We=0;We<M._loadQueue.length;We++)if(M._loadQueue[We]===Q){M._loadQueue.splice(We,1);break}M._loadQueue.length===0&&Ee(Q),M.raiseEvent("add-item-failed",ue),b.error&&b.error(ue)}function Ee(ue){M.collectionMode&&(M.world.arrange({immediately:ue.options.collectionImmediately,rows:M.collectionRows,columns:M.collectionColumns,layout:M.collectionLayout,tileSize:M.collectionTileSize,tileMargin:M.collectionTileMargin}),M.world.setAutoRefigureSizes(!0))}if(t.isArray(b.tileSource)){setTimeout(function(){he({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:b.tileSource,options:b})});return}this._loadQueue.push(Q);function Ne(){for(var ue,We,at;M._loadQueue.length&&(ue=M._loadQueue[0],!!ue.tileSource);){if(M._loadQueue.splice(0,1),ue.options.replace){var mt=M.world.getIndexOfItem(ue.options.replaceItem);mt!==-1&&(ue.options.index=mt),M.world.removeItem(ue.options.replaceItem)}We=new t.TiledImage({viewer:M,source:ue.tileSource,viewport:M.viewport,drawer:M.drawer,tileCache:M.tileCache,imageLoader:M.imageLoader,x:ue.options.x,y:ue.options.y,width:ue.options.width,height:ue.options.height,fitBounds:ue.options.fitBounds,fitBoundsPlacement:ue.options.fitBoundsPlacement,clip:ue.options.clip,placeholderFillStyle:ue.options.placeholderFillStyle,opacity:ue.options.opacity,preload:ue.options.preload,degrees:ue.options.degrees,flipped:ue.options.flipped,compositeOperation:ue.options.compositeOperation,springStiffness:M.springStiffness,animationTime:M.animationTime,minZoomImageRatio:M.minZoomImageRatio,wrapHorizontal:M.wrapHorizontal,wrapVertical:M.wrapVertical,maxTilesPerFrame:M.maxTilesPerFrame,immediateRender:M.immediateRender,blendTime:M.blendTime,alwaysBlend:M.alwaysBlend,minPixelRatio:M.minPixelRatio,smoothTileEdgesMinZoom:M.smoothTileEdgesMinZoom,iOSDevice:M.iOSDevice,crossOriginPolicy:ue.options.crossOriginPolicy,ajaxWithCredentials:ue.options.ajaxWithCredentials,loadTilesWithAjax:ue.options.loadTilesWithAjax,ajaxHeaders:ue.options.ajaxHeaders,debugMode:M.debugMode,subPixelRoundingForTransparency:M.subPixelRoundingForTransparency}),M.collectionMode&&M.world.setAutoRefigureSizes(!1),M.navigator&&(at=t.extend({},ue.options,{replace:!1,originalTiledImage:We,tileSource:ue.tileSource}),M.navigator.addTiledImage(at)),M.world.addItem(We,{index:ue.options.index}),M._loadQueue.length===0&&Ee(ue),M.world.getItemCount()===1&&!M.preserveViewport&&M.viewport.goHome(!0),ue.options.success&&ue.options.success({item:We})}}o(this,b.tileSource,b,function(ue){Q.tileSource=ue,Ne()},function(ue){ue.options=b,he(ue),Ne()})},addSimpleImage:function(b){t.console.assert(b,"[Viewer.addSimpleImage] options is required"),t.console.assert(b.url,"[Viewer.addSimpleImage] options.url is required");var M=t.extend({},b,{tileSource:{type:"image",url:b.url}});delete M.url,this.addTiledImage(M)},addLayer:function(b){var M=this;t.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var Q=t.extend({},b,{success:function(he){M.raiseEvent("add-layer",{options:b,drawer:he.item})},error:function(he){M.raiseEvent("add-layer-failed",he)}});return this.addTiledImage(Q),this},getLayerAtLevel:function(b){return t.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(b)},getLevelOfLayer:function(b){return t.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(b)},getLayersCount:function(){return t.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(b,M){return t.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(b,M)},removeLayer:function(b){return t.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(b)},forceRedraw:function(){return i[this.hash].forceRedraw=!0,this},forceResize:function(){i[this.hash].needsResize=!0,i[this.hash].forceResize=!0},bindSequenceControls:function(){var b=t.delegate(this,v),M=t.delegate(this,_),Q=t.delegate(this,this.goToNextPage),he=t.delegate(this,this.goToPreviousPage),Ee=this.navImages,Ne=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(Ne=!1),this.previousButton=new t.Button({element:this.previousButton?t.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.PreviousPage"),srcRest:re(this.prefixUrl,Ee.previous.REST),srcGroup:re(this.prefixUrl,Ee.previous.GROUP),srcHover:re(this.prefixUrl,Ee.previous.HOVER),srcDown:re(this.prefixUrl,Ee.previous.DOWN),onRelease:he,onFocus:b,onBlur:M}),this.nextButton=new t.Button({element:this.nextButton?t.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.NextPage"),srcRest:re(this.prefixUrl,Ee.next.REST),srcGroup:re(this.prefixUrl,Ee.next.GROUP),srcHover:re(this.prefixUrl,Ee.next.HOVER),srcDown:re(this.prefixUrl,Ee.next.DOWN),onRelease:Q,onFocus:b,onBlur:M}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),Ne&&(this.paging=new t.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:t.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var b=t.delegate(this,_e),M=t.delegate(this,Pe),Q=t.delegate(this,ge),he=t.delegate(this,me),Ee=t.delegate(this,Ke),Ne=t.delegate(this,ht),ue=t.delegate(this,st),We=t.delegate(this,ti),at=t.delegate(this,Zt),mt=t.delegate(this,bi),Xe=t.delegate(this,v),gt=t.delegate(this,_),R=this.navImages,C=[],I=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(I=!1),this.showZoomControl&&(C.push(this.zoomInButton=new t.Button({element:this.zoomInButton?t.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomIn"),srcRest:re(this.prefixUrl,R.zoomIn.REST),srcGroup:re(this.prefixUrl,R.zoomIn.GROUP),srcHover:re(this.prefixUrl,R.zoomIn.HOVER),srcDown:re(this.prefixUrl,R.zoomIn.DOWN),onPress:b,onRelease:M,onClick:Q,onEnter:b,onExit:M,onFocus:Xe,onBlur:gt})),C.push(this.zoomOutButton=new t.Button({element:this.zoomOutButton?t.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomOut"),srcRest:re(this.prefixUrl,R.zoomOut.REST),srcGroup:re(this.prefixUrl,R.zoomOut.GROUP),srcHover:re(this.prefixUrl,R.zoomOut.HOVER),srcDown:re(this.prefixUrl,R.zoomOut.DOWN),onPress:he,onRelease:M,onClick:Ee,onEnter:he,onExit:M,onFocus:Xe,onBlur:gt}))),this.showHomeControl&&C.push(this.homeButton=new t.Button({element:this.homeButton?t.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Home"),srcRest:re(this.prefixUrl,R.home.REST),srcGroup:re(this.prefixUrl,R.home.GROUP),srcHover:re(this.prefixUrl,R.home.HOVER),srcDown:re(this.prefixUrl,R.home.DOWN),onRelease:Ne,onFocus:Xe,onBlur:gt})),this.showFullPageControl&&C.push(this.fullPageButton=new t.Button({element:this.fullPageButton?t.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.FullPage"),srcRest:re(this.prefixUrl,R.fullpage.REST),srcGroup:re(this.prefixUrl,R.fullpage.GROUP),srcHover:re(this.prefixUrl,R.fullpage.HOVER),srcDown:re(this.prefixUrl,R.fullpage.DOWN),onRelease:ue,onFocus:Xe,onBlur:gt})),this.showRotationControl&&(C.push(this.rotateLeftButton=new t.Button({element:this.rotateLeftButton?t.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateLeft"),srcRest:re(this.prefixUrl,R.rotateleft.REST),srcGroup:re(this.prefixUrl,R.rotateleft.GROUP),srcHover:re(this.prefixUrl,R.rotateleft.HOVER),srcDown:re(this.prefixUrl,R.rotateleft.DOWN),onRelease:We,onFocus:Xe,onBlur:gt})),C.push(this.rotateRightButton=new t.Button({element:this.rotateRightButton?t.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateRight"),srcRest:re(this.prefixUrl,R.rotateright.REST),srcGroup:re(this.prefixUrl,R.rotateright.GROUP),srcHover:re(this.prefixUrl,R.rotateright.HOVER),srcDown:re(this.prefixUrl,R.rotateright.DOWN),onRelease:at,onFocus:Xe,onBlur:gt}))),this.showFlipControl&&C.push(this.flipButton=new t.Button({element:this.flipButton?t.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Flip"),srcRest:re(this.prefixUrl,R.flip.REST),srcGroup:re(this.prefixUrl,R.flip.GROUP),srcHover:re(this.prefixUrl,R.flip.HOVER),srcDown:re(this.prefixUrl,R.flip.DOWN),onRelease:mt,onFocus:Xe,onBlur:gt})),I?(this.buttonGroup=new t.ButtonGroup({buttons:C,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",t.delegate(this,Je)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT})):this.customButtons=C),this},currentPage:function(){return this._sequenceIndex},goToPage:function(b){return this.tileSources&&b>=0&&b<this.tileSources.length&&(this._sequenceIndex=b,this._updateSequenceButtons(b),this.open(this.tileSources[b]),this.referenceStrip&&this.referenceStrip.setFocus(b),this.raiseEvent("page",{page:b})),this},addOverlay:function(b,M,Q,he){var Ee;if(t.isPlainObject(b)?Ee=b:Ee={element:b,location:M,placement:Q,onDraw:he},b=t.getElement(Ee.element),u(this.currentOverlays,b)>=0)return this;var Ne=l(this,Ee);return this.currentOverlays.push(Ne),Ne.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:b,location:Ee.location,placement:Ee.placement}),this},updateOverlay:function(b,M,Q){var he;return b=t.getElement(b),he=u(this.currentOverlays,b),he>=0&&(this.currentOverlays[he].update(M,Q),i[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:b,location:M,placement:Q})),this},removeOverlay:function(b){var M;return b=t.getElement(b),M=u(this.currentOverlays,b),M>=0&&(this.currentOverlays[M].destroy(),this.currentOverlays.splice(M,1),i[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:b})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return i[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(b){var M;return b=t.getElement(b),M=u(this.currentOverlays,b),M>=0?this.currentOverlays[M]:null},_updateSequenceButtons:function(b){this.nextButton&&(!this.tileSources||this.tileSources.length-1===b?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(b>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(b){this._hideMessage();var M=t.makeNeutralElement("div");M.appendChild(document.createTextNode(b)),this.messageDiv=t.makeCenteredNode(M),t.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var b=this.messageDiv;b&&(b.parentNode.removeChild(b),delete this.messageDiv)},gestureSettingsByDeviceType:function(b){switch(b){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var b,M=this.currentOverlays.length;for(b=0;b<M;b++)this.currentOverlays[b].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new t.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else t.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),t.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){t.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var b=t.pixelDensityRatio,M=t.getCurrentPixelDensityRatio();b!==M&&(t.pixelDensityRatio=M,this.forceResize())},goToPreviousPage:function(){var b=this._sequenceIndex-1;this.navPrevNextWrap&&b<0&&(b+=this.tileSources.length),this.goToPage(b)},goToNextPage:function(){var b=this._sequenceIndex+1;this.navPrevNextWrap&&b>=this.tileSources.length&&(b=0),this.goToPage(b)},isAnimating:function(){return i[this.hash].animating}});function s(b){return b=t.getElement(b),new t.Point(b.clientWidth===0?1:b.clientWidth,b.clientHeight===0?1:b.clientHeight)}function o(b,M,Q,he,Ee){var Ne=b;if(t.type(M)==="string"){if(M.match(/^\s*<.*>\s*$/))M=t.parseXml(M);else if(M.match(/^\s*[{[].*[}\]]\s*$/))try{var ue=t.parseJSON(M);M=ue}catch{}}function We(at,mt){at.ready?he(at):(at.addHandler("ready",function(){he(at)}),at.addHandler("open-failed",function(Xe){Ee({message:Xe.message,source:mt})}))}setTimeout(function(){if(t.type(M)==="string")M=new t.TileSource({url:M,crossOriginPolicy:Q.crossOriginPolicy!==void 0?Q.crossOriginPolicy:b.crossOriginPolicy,ajaxWithCredentials:b.ajaxWithCredentials,ajaxHeaders:Q.ajaxHeaders?Q.ajaxHeaders:b.ajaxHeaders,splitHashDataForPost:b.splitHashDataForPost,success:function(gt){he(gt.tileSource)}}),M.addHandler("open-failed",function(gt){Ee(gt)});else if(t.isPlainObject(M)||M.nodeType)if(M.crossOriginPolicy===void 0&&(Q.crossOriginPolicy!==void 0||b.crossOriginPolicy!==void 0)&&(M.crossOriginPolicy=Q.crossOriginPolicy!==void 0?Q.crossOriginPolicy:b.crossOriginPolicy),M.ajaxWithCredentials===void 0&&(M.ajaxWithCredentials=b.ajaxWithCredentials),t.isFunction(M.getTileUrl)){var at=new t.TileSource(M);at.getTileUrl=M.getTileUrl,he(at)}else{var mt=t.TileSource.determineType(Ne,M);if(!mt){Ee({message:"Unable to load TileSource",source:M});return}var Xe=mt.prototype.configure.apply(Ne,[M]);We(new mt(Xe),M)}else We(M,M)})}function l(b,M){if(M instanceof t.Overlay)return M;var Q=null;if(M.element)Q=t.getElement(M.element);else{var he=M.id?M.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);Q=t.getElement(M.id),Q||(Q=document.createElement("a"),Q.href="#/overlay/"+he),Q.id=he,t.addClass(Q,M.className?M.className:"openseadragon-overlay")}var Ee=M.location,Ne=M.width,ue=M.height;if(!Ee){var We=M.x,at=M.y;if(M.px!==void 0){var mt=b.viewport.imageToViewportRectangle(new t.Rect(M.px,M.py,Ne||0,ue||0));We=mt.x,at=mt.y,Ne=Ne!==void 0?mt.width:void 0,ue=ue!==void 0?mt.height:void 0}Ee=new t.Point(We,at)}var Xe=M.placement;return Xe&&t.type(Xe)==="string"&&(Xe=t.Placement[M.placement.toUpperCase()]),new t.Overlay({element:Q,location:Ee,placement:Xe,onDraw:M.onDraw,checkResize:M.checkResize,width:Ne,height:ue,rotationMode:M.rotationMode})}function u(b,M){var Q;for(Q=b.length-1;Q>=0;Q--)if(b[Q].element===M)return Q;return-1}function c(b,M){return t.requestAnimationFrame(function(){M(b)})}function d(b){t.requestAnimationFrame(function(){m(b)})}function p(b){b.autoHideControls&&(b.controlsShouldFade=!0,b.controlsFadeBeginTime=t.now()+b.controlsFadeDelay,window.setTimeout(function(){d(b)},b.controlsFadeDelay))}function m(b){var M,Q,he,Ee;if(b.controlsShouldFade){for(M=t.now(),Q=M-b.controlsFadeBeginTime,he=1-Q/b.controlsFadeLength,he=Math.min(1,he),he=Math.max(0,he),Ee=b.controls.length-1;Ee>=0;Ee--)b.controls[Ee].autoFade&&b.controls[Ee].setOpacity(he);he>0&&d(b)}}function y(b){var M;for(b.controlsShouldFade=!1,M=b.controls.length-1;M>=0;M--)b.controls[M].setOpacity(1)}function v(){y(this)}function _(){p(this)}function T(b){var M={tracker:b.eventSource,position:b.position,originalEvent:b.originalEvent,preventDefault:b.preventDefault};this.raiseEvent("canvas-contextmenu",M),b.preventDefault=M.preventDefault}function E(b){var M={originalEvent:b.originalEvent,preventDefaultAction:!1,preventVerticalPan:b.preventVerticalPan||!this.panVertical,preventHorizontalPan:b.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",M),!M.preventDefaultAction&&!b.ctrl&&!b.alt&&!b.meta)switch(b.keyCode){case 38:M.preventVerticalPan||(b.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 40:M.preventVerticalPan||(b.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 37:M.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 39:M.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 187:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),b.preventDefault=!0;break;case 189:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),b.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),b.preventDefault=!0;break;case 87:M.preventVerticalPan||(b.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-40))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 83:M.preventVerticalPan||(b.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,40))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 65:M.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-40,0))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 68:M.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(40,0))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 82:b.shift?this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement),this.viewport.applyConstraints(),b.preventDefault=!0;break;case 70:this.viewport.toggleFlip(),b.preventDefault=!0;break;case 74:this.goToPreviousPage();break;case 75:this.goToNextPage();break;default:b.preventDefault=!1;break}else b.preventDefault=!1}function S(b){var M={originalEvent:b.originalEvent};this.raiseEvent("canvas-key-press",M)}function A(b){var M,Q=document.activeElement===this.canvas;Q||this.canvas.focus(),this.viewport.flipped&&(b.position.x=this.viewport.getContainerSize().x-b.position.x);var he={tracker:b.eventSource,position:b.position,quick:b.quick,shift:b.shift,originalEvent:b.originalEvent,originalTarget:b.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",he),!he.preventDefaultAction&&this.viewport&&b.quick&&(M=this.gestureSettingsByDeviceType(b.pointerType),M.clickToZoom===!0&&(this.viewport.zoomBy(b.shift?1/this.zoomPerClick:this.zoomPerClick,M.zoomToRefPoint?this.viewport.pointFromPixel(b.position,!0):null),this.viewport.applyConstraints()),M.dblClickDragToZoom&&(i[this.hash].draggingToZoom===!0?(i[this.hash].lastClickTime=null,i[this.hash].draggingToZoom=!1):i[this.hash].lastClickTime=t.now()))}function P(b){var M,Q={tracker:b.eventSource,position:b.position,shift:b.shift,originalEvent:b.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",Q),!Q.preventDefaultAction&&this.viewport&&(M=this.gestureSettingsByDeviceType(b.pointerType),M.dblClickToZoom&&(this.viewport.zoomBy(b.shift?1/this.zoomPerClick:this.zoomPerClick,M.zoomToRefPoint?this.viewport.pointFromPixel(b.position,!0):null),this.viewport.applyConstraints()))}function D(b){var M,Q={tracker:b.eventSource,pointerType:b.pointerType,position:b.position,delta:b.delta,speed:b.speed,direction:b.direction,shift:b.shift,originalEvent:b.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",Q),M=this.gestureSettingsByDeviceType(b.pointerType),!Q.preventDefaultAction&&this.viewport){if(M.dblClickDragToZoom&&i[this.hash].draggingToZoom){var he=Math.pow(this.zoomPerDblClickDrag,b.delta.y/50);this.viewport.zoomBy(he)}else if(M.dragToPan&&!i[this.hash].draggingToZoom){if(this.panHorizontal||(b.delta.x=0),this.panVertical||(b.delta.y=0),this.viewport.flipped&&(b.delta.x=-b.delta.x),this.constrainDuringPan){var Ee=this.viewport.deltaPointsFromPixels(b.delta.negate());this.viewport.centerSpringX.target.value+=Ee.x,this.viewport.centerSpringY.target.value+=Ee.y;var Ne=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=Ee.x,this.viewport.centerSpringY.target.value-=Ee.y,Ne.xConstrained&&(b.delta.x=0),Ne.yConstrained&&(b.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(b.delta.negate()),M.flickEnabled&&!this.constrainDuringPan)}}}function k(b){var M,Q={tracker:b.eventSource,pointerType:b.pointerType,position:b.position,speed:b.speed,direction:b.direction,shift:b.shift,originalEvent:b.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",Q),M=this.gestureSettingsByDeviceType(b.pointerType),!Q.preventDefaultAction&&this.viewport){if(!i[this.hash].draggingToZoom&&M.dragToPan&&M.flickEnabled&&b.speed>=M.flickMinSpeed){var he=0;this.panHorizontal&&(he=M.flickMomentum*b.speed*Math.cos(b.direction));var Ee=0;this.panVertical&&(Ee=M.flickMomentum*b.speed*Math.sin(b.direction));var Ne=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),ue=this.viewport.pointFromPixel(new t.Point(Ne.x-he,Ne.y-Ee));this.viewport.panTo(ue,!1)}this.viewport.applyConstraints()}M.dblClickDragToZoom&&i[this.hash].draggingToZoom===!0&&(i[this.hash].draggingToZoom=!1)}function U(b){this.raiseEvent("canvas-enter",{tracker:b.eventSource,pointerType:b.pointerType,position:b.position,buttons:b.buttons,pointers:b.pointers,insideElementPressed:b.insideElementPressed,buttonDownAny:b.buttonDownAny,originalEvent:b.originalEvent})}function j(b){this.raiseEvent("canvas-exit",{tracker:b.eventSource,pointerType:b.pointerType,position:b.position,buttons:b.buttons,pointers:b.pointers,insideElementPressed:b.insideElementPressed,buttonDownAny:b.buttonDownAny,originalEvent:b.originalEvent})}function q(b){var M;if(this.raiseEvent("canvas-press",{tracker:b.eventSource,pointerType:b.pointerType,position:b.position,insideElementPressed:b.insideElementPressed,insideElementReleased:b.insideElementReleased,originalEvent:b.originalEvent}),M=this.gestureSettingsByDeviceType(b.pointerType),M.dblClickDragToZoom){var Q=i[this.hash].lastClickTime,he=t.now();if(Q===null)return;he-Q<this.dblClickTimeThreshold&&(i[this.hash].draggingToZoom=!0),i[this.hash].lastClickTime=null}}function ee(b){this.raiseEvent("canvas-release",{tracker:b.eventSource,pointerType:b.pointerType,position:b.position,insideElementPressed:b.insideElementPressed,insideElementReleased:b.insideElementReleased,originalEvent:b.originalEvent})}function pe(b){this.raiseEvent("canvas-nonprimary-press",{tracker:b.eventSource,position:b.position,pointerType:b.pointerType,button:b.button,buttons:b.buttons,originalEvent:b.originalEvent})}function H(b){this.raiseEvent("canvas-nonprimary-release",{tracker:b.eventSource,position:b.position,pointerType:b.pointerType,button:b.button,buttons:b.buttons,originalEvent:b.originalEvent})}function F(b){var M,Q,he,Ee,Ne={tracker:b.eventSource,pointerType:b.pointerType,gesturePoints:b.gesturePoints,lastCenter:b.lastCenter,center:b.center,lastDistance:b.lastDistance,distance:b.distance,shift:b.shift,originalEvent:b.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};if(this.raiseEvent("canvas-pinch",Ne),this.viewport&&(M=this.gestureSettingsByDeviceType(b.pointerType),M.pinchToZoom&&(!Ne.preventDefaultPanAction||!Ne.preventDefaultZoomAction)&&(Q=this.viewport.pointFromPixel(b.center,!0),M.zoomToRefPoint&&!Ne.preventDefaultPanAction&&(he=this.viewport.pointFromPixel(b.lastCenter,!0),Ee=he.minus(Q),this.panHorizontal||(Ee.x=0),this.panVertical||(Ee.y=0),this.viewport.panBy(Ee,!0)),Ne.preventDefaultZoomAction||this.viewport.zoomBy(b.distance/b.lastDistance,Q,!0),this.viewport.applyConstraints()),M.pinchRotate&&!Ne.preventDefaultRotateAction)){var ue=Math.atan2(b.gesturePoints[0].currentPos.y-b.gesturePoints[1].currentPos.y,b.gesturePoints[0].currentPos.x-b.gesturePoints[1].currentPos.x),We=Math.atan2(b.gesturePoints[0].lastPos.y-b.gesturePoints[1].lastPos.y,b.gesturePoints[0].lastPos.x-b.gesturePoints[1].lastPos.x);Q=this.viewport.pointFromPixel(b.center,!0),this.viewport.rotateTo(this.viewport.getRotation(!0)+(ue-We)*(180/Math.PI),Q,!0)}}function G(b){this.raiseEvent("canvas-focus",{tracker:b.eventSource,originalEvent:b.originalEvent})}function $(b){this.raiseEvent("canvas-blur",{tracker:b.eventSource,originalEvent:b.originalEvent})}function le(b){var M,Q,he,Ee,Ne;Ee=t.now(),Ne=Ee-this._lastScrollTime,Ne>this.minScrollDeltaTime?(this._lastScrollTime=Ee,M={tracker:b.eventSource,position:b.position,scroll:b.scroll,shift:b.shift,originalEvent:b.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",M),!M.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(b.position.x=this.viewport.getContainerSize().x-b.position.x),Q=this.gestureSettingsByDeviceType(b.pointerType),Q.scrollToZoom&&(he=Math.pow(this.zoomPerScroll,b.scroll),this.viewport.zoomBy(he,Q.zoomToRefPoint?this.viewport.pointFromPixel(b.position,!0):null),this.viewport.applyConstraints())),b.preventDefault=M.preventDefault):b.preventDefault=!0}function ie(b){i[this.hash].mouseInside=!0,y(this),this.raiseEvent("container-enter",{tracker:b.eventSource,pointerType:b.pointerType,position:b.position,buttons:b.buttons,pointers:b.pointers,insideElementPressed:b.insideElementPressed,buttonDownAny:b.buttonDownAny,originalEvent:b.originalEvent})}function Y(b){b.pointers<1&&(i[this.hash].mouseInside=!1,i[this.hash].animating||p(this)),this.raiseEvent("container-exit",{tracker:b.eventSource,pointerType:b.pointerType,position:b.position,buttons:b.buttons,pointers:b.pointers,insideElementPressed:b.insideElementPressed,buttonDownAny:b.buttonDownAny,originalEvent:b.originalEvent})}function de(b){N(b),b.isOpen()?b._updateRequestId=c(b,de):b._updateRequestId=!1}function z(b,M){var Q=b.viewport,he=Q.getZoom(),Ee=Q.getCenter();Q.resize(M,b.preserveImageSizeOnResize),Q.panTo(Ee,!0);var Ne;if(b.preserveImageSizeOnResize)Ne=i[b.hash].prevContainerSize.x/M.x;else{var ue=new t.Point(0,0),We=new t.Point(i[b.hash].prevContainerSize.x,i[b.hash].prevContainerSize.y).distanceTo(ue),at=new t.Point(M.x,M.y).distanceTo(ue);Ne=at/We*i[b.hash].prevContainerSize.x/M.x}Q.zoomTo(he*Ne,null,!0),i[b.hash].prevContainerSize=M,i[b.hash].forceRedraw=!0,i[b.hash].needsResize=!1,i[b.hash].forceResize=!1}function N(b){if(!(b._opening||!i[b.hash])){if(b.autoResize||i[b.hash].forceResize){var M;if(b._autoResizePolling){M=s(b.container);var Q=i[b.hash].prevContainerSize;M.equals(Q)||(i[b.hash].needsResize=!0)}i[b.hash].needsResize&&z(b,M||s(b.container))}var he=b.viewport.update(),Ee=b.world.update(he)||he;he&&b.raiseEvent("viewport-change"),b.referenceStrip&&(Ee=b.referenceStrip.update(b.viewport)||Ee);var Ne=i[b.hash].animating;!Ne&&Ee&&(b.raiseEvent("animation-start"),y(b));var ue=Ne&&!Ee;ue&&(i[b.hash].animating=!1),(Ee||ue||i[b.hash].forceRedraw||b.world.needsDraw())&&(W(b),b._drawOverlays(),b.navigator&&b.navigator.update(b.viewport),i[b.hash].forceRedraw=!1,Ee&&b.raiseEvent("animation")),ue&&(b.raiseEvent("animation-finish"),i[b.hash].mouseInside||p(b)),i[b.hash].animating=Ee}}function W(b){b.imageLoader.clear(),b.world.draw(),b.raiseEvent("update-viewport",{})}function re(b,M){return b?b+M:M}function _e(){i[this.hash].lastZoomTime=t.now(),i[this.hash].zoomFactor=this.zoomPerSecond,i[this.hash].zooming=!0,Ue(this)}function me(){i[this.hash].lastZoomTime=t.now(),i[this.hash].zoomFactor=1/this.zoomPerSecond,i[this.hash].zooming=!0,Ue(this)}function Pe(){i[this.hash].zooming=!1}function Ue(b){t.requestAnimationFrame(t.delegate(b,Te))}function Te(){var b,M,Q;i[this.hash].zooming&&this.viewport&&(b=t.now(),M=b-i[this.hash].lastZoomTime,Q=Math.pow(i[this.hash].zoomFactor,M/1e3),this.viewport.zoomBy(Q),this.viewport.applyConstraints(),i[this.hash].lastZoomTime=b,Ue(this))}function ge(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function Ke(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function Je(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function ht(){this.viewport&&this.viewport.goHome()}function st(){this.isFullPage()&&!t.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function ti(){if(this.viewport){var b=this.viewport.getRotation();this.viewport.flipped?b+=this.rotationIncrement:b-=this.rotationIncrement,this.viewport.setRotation(b)}}function Zt(){if(this.viewport){var b=this.viewport.getRotation();this.viewport.flipped?b-=this.rotationIncrement:b+=this.rotationIncrement,this.viewport.setRotation(b)}}function bi(){this.viewport.toggleFlip()}t.determineDrawer=function(b){for(let M in e){const Q=e[M],he=Q.prototype;if(he&&he instanceof e.DrawerBase&&t.isFunction(he.getType)&&he.getType.call(Q)===b)return Q}return null}}(e),function(t){t.Navigator=function(c){var d=c.viewer,p=this,m,y;c.element||c.id?(c.element?(c.id&&t.console.warn("Given option.id for Navigator was ignored since option.element was provided and is being used instead."),c.element.id?c.id=c.element.id:c.id="navigator-"+t.now(),this.element=c.element):this.element=document.getElementById(c.id),c.controlOptions={anchor:t.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(c.id="navigator-"+t.now(),this.element=t.makeNeutralElement("div"),c.controlOptions={anchor:t.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:c.autoFade},c.position&&(c.position==="BOTTOM_RIGHT"?c.controlOptions.anchor=t.ControlAnchor.BOTTOM_RIGHT:c.position==="BOTTOM_LEFT"?c.controlOptions.anchor=t.ControlAnchor.BOTTOM_LEFT:c.position==="TOP_RIGHT"?c.controlOptions.anchor=t.ControlAnchor.TOP_RIGHT:c.position==="TOP_LEFT"?c.controlOptions.anchor=t.ControlAnchor.TOP_LEFT:c.position==="ABSOLUTE"&&(c.controlOptions.anchor=t.ControlAnchor.ABSOLUTE,c.controlOptions.top=c.top,c.controlOptions.left=c.left,c.controlOptions.height=c.height,c.controlOptions.width=c.width))),this.element.id=c.id,this.element.className+=" navigator",c=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.navigatorSizeRatio},c,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:c.animationTime,autoResize:!1,minZoomImageRatio:1,background:c.background,opacity:c.opacity,borderColor:c.borderColor,displayRegionColor:c.displayRegionColor}),c.minPixelRatio=this.minPixelRatio=d.minPixelRatio,t.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new t.Point(1,1),this.totalBorderWidths=new t.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),c.controlOptions.anchor!==t.ControlAnchor.NONE&&function(T,E){T.margin="0px",T.border=E+"px solid "+c.borderColor,T.padding="0px",T.background=c.background,T.opacity=c.opacity,T.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=t.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(T,E){T.position="relative",T.top="0px",T.left="0px",T.fontSize="0px",T.overflow="hidden",T.border=E+"px solid "+c.displayRegionColor,T.margin="0px",T.padding="0px",T.background="transparent",T.float="left",T.cssFloat="left",T.zIndex=999999999,T.cursor="default",T.boxSizing="content-box"}(this.displayRegion.style,this.borderWidth),t.setElementPointerEventsNone(this.displayRegion),t.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=t.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",t.setElementPointerEventsNone(this.displayRegionContainer),t.setElementTouchActionNone(this.displayRegionContainer),d.addControl(this.element,c.controlOptions),this._resizeWithViewer=c.controlOptions.anchor!==t.ControlAnchor.ABSOLUTE&&c.controlOptions.anchor!==t.ControlAnchor.NONE,c.width&&c.height?(this.setWidth(c.width),this.setHeight(c.height)):this._resizeWithViewer&&(m=t.getElementSize(d.element),this.element.style.height=Math.round(m.y*c.sizeRatio)+"px",this.element.style.width=Math.round(m.x*c.sizeRatio)+"px",this.oldViewerSize=m,y=t.getElementSize(this.element),this.elementArea=y.x*y.y),this.oldContainerSize=new t.Point(0,0),t.Viewer.apply(this,[c]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function v(T,E){l(p.displayRegionContainer,T),l(p.displayRegion,-T),p.viewport.setRotation(T,E)}if(c.navigatorRotate){var _=c.viewer.viewport?c.viewer.viewport.getRotation():c.viewer.degrees||0;v(_,!0),c.viewer.addHandler("rotate",function(T){v(T.degrees,T.immediately)})}this.innerTracker.destroy(),this.innerTracker=new t.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:t.delegate(this,n),clickHandler:t.delegate(this,i),releaseHandler:t.delegate(this,s),scrollHandler:t.delegate(this,o),preProcessEventHandler:function(T){T.eventType==="wheel"&&(T.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",t.setElementPointerEventsNone(this.canvas),t.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){p.viewport&&p.viewport.goHome(!0)}),d.world.addHandler("item-index-change",function(T){window.setTimeout(function(){var E=p.world.getItemAt(T.previousIndex);p.world.setItemIndex(E,T.newIndex)},1)}),d.world.addHandler("remove-item",function(T){var E=T.item,S=p._getMatchingItem(E);S&&p.world.removeItem(S)}),this.update(d.viewport)},t.extend(t.Navigator.prototype,t.EventSource.prototype,t.Viewer.prototype,{updateSize:function(){if(this.viewport){var c=new t.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);c.equals(this.oldContainerSize)||(this.viewport.resize(c,!0),this.viewport.goHome(!0),this.oldContainerSize=c,this.world.update(),this.world.draw(),this.update(this.viewer.viewport))}},setWidth:function(c){this.width=c,this.element.style.width=typeof c=="number"?c+"px":c,this._resizeWithViewer=!1,this.updateSize()},setHeight:function(c){this.height=c,this.element.style.height=typeof c=="number"?c+"px":c,this._resizeWithViewer=!1,this.updateSize()},setFlip:function(c){return this.viewport.setFlip(c),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(c){u(this.canvas,c),u(this.element,c)},update:function(c){var d,p,m,y,v,_;if(c||(c=this.viewer.viewport),d=t.getElementSize(this.viewer.element),this._resizeWithViewer&&d.x&&d.y&&!d.equals(this.oldViewerSize)&&(this.oldViewerSize=d,this.maintainSizeRatio||!this.elementArea?(p=d.x*this.sizeRatio,m=d.y*this.sizeRatio):(p=Math.sqrt(this.elementArea*(d.x/d.y)),m=this.elementArea/p),this.element.style.width=Math.round(p)+"px",this.element.style.height=Math.round(m)+"px",this.elementArea||(this.elementArea=p*m),this.updateSize()),c&&this.viewport){if(y=c.getBoundsNoRotate(!0),v=this.viewport.pixelFromPointNoRotate(y.getTopLeft(),!1),_=this.viewport.pixelFromPointNoRotate(y.getBottomRight(),!1).minus(this.totalBorderWidths),!this.navigatorRotate){var T=c.getRotation(!0);l(this.displayRegion,-T)}var E=this.displayRegion.style;E.display=this.world.getItemCount()?"block":"none",E.top=v.y.toFixed(2)+"px",E.left=v.x.toFixed(2)+"px";var S=_.x-v.x,A=_.y-v.y;E.width=Math.round(Math.max(S,0))+"px",E.height=Math.round(Math.max(A,0))+"px"}},addTiledImage:function(c){var d=this,p=c.originalTiledImage;delete c.original;var m=t.extend({},c,{success:function(y){var v=y.item;v._originalForNavigator=p,d._matchBounds(v,p,!0),d._matchOpacity(v,p),d._matchCompositeOperation(v,p);function _(){d._matchBounds(v,p)}function T(){d._matchOpacity(v,p)}function E(){d._matchCompositeOperation(v,p)}p.addHandler("bounds-change",_),p.addHandler("clip-change",_),p.addHandler("opacity-change",T),p.addHandler("composite-operation-change",E)}});return t.Viewer.prototype.addTiledImage.apply(this,[m])},destroy:function(){return t.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(c){for(var d=this.world.getItemCount(),p,m=0;m<d;m++)if(p=this.world.getItemAt(m),p._originalForNavigator===c)return p;return null},_matchBounds:function(c,d,p){var m=d.getBoundsNoRotate();c.setPosition(m.getTopLeft(),p),c.setWidth(m.width,p),c.setRotation(d.getRotation(),p),c.setClip(d.getClip()),c.setFlip(d.getFlip())},_matchOpacity:function(c,d){c.setOpacity(d.opacity)},_matchCompositeOperation:function(c,d){c.setCompositeOperation(d.compositeOperation)}});function i(c){var d={tracker:c.eventSource,position:c.position,quick:c.quick,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:!1};if(this.viewer.raiseEvent("navigator-click",d),!d.preventDefaultAction&&c.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(c.position.x=this.viewport.getContainerSize().x-c.position.x);var p=this.viewport.pointFromPixel(c.position);this.panVertical?this.panHorizontal||(p.x=this.viewer.viewport.getCenter(!0).x):p.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(p),this.viewer.viewport.applyConstraints()}}function n(c){var d={tracker:c.eventSource,position:c.position,delta:c.delta,speed:c.speed,direction:c.direction,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",d),!d.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(c.delta.x=0),this.panVertical||(c.delta.y=0),this.viewer.viewport.flipped&&(c.delta.x=-c.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(c.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function s(c){c.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function o(c){var d={tracker:c.eventSource,position:c.position,scroll:c.scroll,shift:c.shift,originalEvent:c.originalEvent,preventDefault:c.preventDefault};this.viewer.raiseEvent("navigator-scroll",d),c.preventDefault=d.preventDefault}function l(c,d){u(c,"rotate("+d+"deg)")}function u(c,d){c.style.webkitTransform=d,c.style.mozTransform=d,c.style.msTransform=d,c.style.oTransform=d,c.style.transform=d}}(e),function(t){var i={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};t.extend(t,{getString:function(n){var s=n.split("."),o=null,l=arguments,u=i,c;for(c=0;c<s.length-1;c++)u=u[s[c]]||{};return o=u[s[c]],typeof o!="string"&&(t.console.error("Untranslated source string:",n),o=""),o.replace(/\{\d+\}/g,function(d){var p=parseInt(d.match(/\d+/),10)+1;return p<l.length?l[p]:""})},setString:function(n,s){var o=n.split("."),l=i,u;for(u=0;u<o.length-1;u++)l[o[u]]||(l[o[u]]={}),l=l[o[u]];l[o[u]]=s}})}(e),function(t){t.Point=function(i,n){this.x=typeof i=="number"?i:0,this.y=typeof n=="number"?n:0},t.Point.prototype={clone:function(){return new t.Point(this.x,this.y)},plus:function(i){return new t.Point(this.x+i.x,this.y+i.y)},minus:function(i){return new t.Point(this.x-i.x,this.y-i.y)},times:function(i){return new t.Point(this.x*i,this.y*i)},divide:function(i){return new t.Point(this.x/i,this.y/i)},negate:function(){return new t.Point(-this.x,-this.y)},distanceTo:function(i){return Math.sqrt(Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2))},squaredDistanceTo:function(i){return Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2)},apply:function(i){return new t.Point(i(this.x),i(this.y))},equals:function(i){return i instanceof t.Point&&this.x===i.x&&this.y===i.y},rotate:function(i,n){n=n||new t.Point(0,0);var s,o;if(i%90===0){var l=t.positiveModulo(i,360);switch(l){case 0:s=1,o=0;break;case 90:s=0,o=1;break;case 180:s=-1,o=0;break;case 270:s=0,o=-1;break}}else{var u=i*Math.PI/180;s=Math.cos(u),o=Math.sin(u)}var c=s*(this.x-n.x)-o*(this.y-n.y)+n.x,d=o*(this.x-n.x)+s*(this.y-n.y)+n.y;return new t.Point(c,d)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(e),function(t){t.TileSource=function(n,s,o,l,u,c){var d=this,p=arguments,m,y;if(t.isPlainObject(n)?m=n:m={width:p[0],height:p[1],tileSize:p[2],tileOverlap:p[3],minLevel:p[4],maxLevel:p[5]},t.EventSource.call(this),t.extend(!0,this,m),!this.success){for(y=0;y<arguments.length;y++)if(t.isFunction(arguments[y])){this.success=arguments[y];break}}this.success&&this.addHandler("ready",function(v){d.success(v)}),t.type(arguments[0])==="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new t.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=m.width&&m.height?m.width/m.height:1,this.dimensions=new t.Point(m.width,m.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=m.tileOverlap?m.tileOverlap:0,this.minLevel=m.minLevel?m.minLevel:0,this.maxLevel=m.maxLevel!==void 0&&m.maxLevel!==null?m.maxLevel:m.width&&m.height?Math.ceil(Math.log(Math.max(m.width,m.height))/Math.log(2)):0,this.success&&t.isFunction(this.success)&&this.success(this))},t.TileSource.prototype={getTileSize:function(n){return t.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(n){return this._tileWidth?this._tileWidth:this.getTileSize(n)},getTileHeight:function(n){return this._tileHeight?this._tileHeight:this.getTileSize(n)},setMaxLevel:function(n){this.maxLevel=n,this._memoizeLevelScale()},getLevelScale:function(n){return this._memoizeLevelScale(),this.getLevelScale(n)},_memoizeLevelScale:function(){var n={},s;for(s=0;s<=this.maxLevel;s++)n[s]=1/Math.pow(2,this.maxLevel-s);this.getLevelScale=function(o){return n[o]}},getNumTiles:function(n){var s=this.getLevelScale(n),o=Math.ceil(s*this.dimensions.x/this.getTileWidth(n)),l=Math.ceil(s*this.dimensions.y/this.getTileHeight(n));return new t.Point(o,l)},getPixelRatio:function(n){var s=this.dimensions.times(this.getLevelScale(n)),o=1/s.x*t.pixelDensityRatio,l=1/s.y*t.pixelDensityRatio;return new t.Point(o,l)},getClosestLevel:function(){var n,s;for(n=this.minLevel+1;n<=this.maxLevel&&(s=this.getNumTiles(n),!(s.x>1||s.y>1));n++);return n-1},getTileAtPoint:function(n,s){var o=s.x>=0&&s.x<=1&&s.y>=0&&s.y<=1/this.aspectRatio;t.console.assert(o,"[TileSource.getTileAtPoint] must be called with a valid point.");var l=this.dimensions.x*this.getLevelScale(n),u=s.x*l,c=s.y*l,d=Math.floor(u/this.getTileWidth(n)),p=Math.floor(c/this.getTileHeight(n));s.x>=1&&(d=this.getNumTiles(n).x-1);var m=1e-15;return s.y>=1/this.aspectRatio-m&&(p=this.getNumTiles(n).y-1),new t.Point(d,p)},getTileBounds:function(n,s,o,l){var u=this.dimensions.times(this.getLevelScale(n)),c=this.getTileWidth(n),d=this.getTileHeight(n),p=s===0?0:c*s-this.tileOverlap,m=o===0?0:d*o-this.tileOverlap,y=c+(s===0?1:2)*this.tileOverlap,v=d+(o===0?1:2)*this.tileOverlap,_=1/u.x;return y=Math.min(y,u.x-p),v=Math.min(v,u.y-m),l?new t.Rect(0,0,y,v):new t.Rect(p*_,m*_,y*_,v*_)},getImageInfo:function(n){var s=this,o,l,u,c,d,p,m;n&&(d=n.split("/"),p=d[d.length-1],m=p.lastIndexOf("."),m>-1&&(d[d.length-1]=p.slice(0,m)));var y=null;if(this.splitHashDataForPost){var v=n.indexOf("#");v!==-1&&(y=n.substring(v+1),n=n.substr(0,v))}l=function(_){typeof _=="string"&&(_=t.parseXml(_));var T=t.TileSource.determineType(s,_,n);if(!T){s.raiseEvent("open-failed",{message:"Unable to load TileSource",source:n});return}c=T.prototype.configure.apply(s,[_,n,y]),c.ajaxWithCredentials===void 0&&(c.ajaxWithCredentials=s.ajaxWithCredentials),u=new T(c),s.ready=!0,s.raiseEvent("ready",{tileSource:u})},n.match(/\.js$/)?(o=n.split("/").pop().replace(".js",""),t.jsonp({url:n,async:!1,callbackName:o,callback:l})):t.makeAjaxRequest({url:n,postData:y,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(_){var T=i(_);l(T)},error:function(_,T){var E;try{E="HTTP "+_.status+" attempting to load TileSource: "+n}catch{var S;typeof T>"u"||!T.toString?S="Unknown error":S=T.toString(),E=S+" attempting to load TileSource: "+n}t.console.error(E),s.raiseEvent("open-failed",{message:E,source:n,postData:y})}})},supports:function(n,s){return!1},configure:function(n,s,o){throw new Error("Method not implemented.")},getTileUrl:function(n,s,o){throw new Error("Method not implemented.")},getTilePostData:function(n,s,o){return null},getTileAjaxHeaders:function(n,s,o){return{}},getTileHashKey:function(n,s,o,l,u,c){function d(p){return u?p+"+"+JSON.stringify(u):p}return d(typeof l!="string"?n+"/"+s+"_"+o:l)},tileExists:function(n,s,o){var l=this.getNumTiles(n);return n>=this.minLevel&&n<=this.maxLevel&&s>=0&&o>=0&&s<l.x&&o<l.y},hasTransparency:function(n,s,o,l){return!!n||s.match(".png")},downloadTileStart:function(n){var s=n.userData,o=new Image;s.image=o,s.request=null;var l=function(u){if(!o){n.finish(null,s.request,"Image load failed: undefined Image instance.");return}o.onload=o.onerror=o.onabort=null,n.finish(u?null:o,s.request,u)};o.onload=function(){l()},o.onabort=o.onerror=function(){l("Image load aborted.")},n.loadWithAjax?s.request=t.makeAjaxRequest({url:n.src,withCredentials:n.ajaxWithCredentials,headers:n.ajaxHeaders,responseType:"arraybuffer",postData:n.postData,success:function(u){var c;try{c=new window.Blob([u.response])}catch(m){var d=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(m.name==="TypeError"&&d){var p=new d;p.append(u.response),c=p.getBlob()}}c.size===0?l("Empty image response."):o.src=(window.URL||window.webkitURL).createObjectURL(c)},error:function(u){l("Image load aborted - XHR error")}}):(n.crossOriginPolicy!==!1&&(o.crossOrigin=n.crossOriginPolicy),o.src=n.src)},downloadTileAbort:function(n){n.userData.request&&n.userData.request.abort();var s=n.userData.image;n.userData.image&&(s.onload=s.onerror=s.onabort=null)},createTileCache:function(n,s,o){n._data=s},destroyTileCache:function(n){n._data=null,n._renderedContext=null},getTileCacheData:function(n){return n._data},getTileCacheDataAsImage:function(n){return n._data},getTileCacheDataAsContext2D:function(n){if(!n._renderedContext){var s=document.createElement("canvas");s.width=n._data.width,s.height=n._data.height,n._renderedContext=s.getContext("2d"),n._renderedContext.drawImage(n._data,0,0),n._data=null}return n._renderedContext}},t.extend(!0,t.TileSource.prototype,t.EventSource.prototype);function i(n){var s=n.responseText,o=n.status,l,u;if(n){if(n.status!==200&&n.status!==0)throw o=n.status,l=o===404?"Not Found":n.statusText,new Error(t.getString("Errors.Status",o,l))}else throw new Error(t.getString("Errors.Security"));if(s.match(/^\s*<.*/))try{u=n.responseXML&&n.responseXML.documentElement?n.responseXML:t.parseXml(s)}catch{u=n.responseText}else if(s.match(/\s*[{[].*/))try{u=t.parseJSON(s)}catch{u=s}else u=s;return u}t.TileSource.determineType=function(n,s,o){var l;for(l in e)if(l.match(/.+TileSource$/)&&t.isFunction(e[l])&&t.isFunction(e[l].prototype.supports)&&e[l].prototype.supports.call(n,s,o))return e[l];return t.console.error("No TileSource was able to open %s %s",o,s),null}}(e),function(t){t.DziTileSource=function(s,o,l,u,c,d,p,m,y){var v,_,T,E;if(t.isPlainObject(s)?E=s:E={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=E.tilesUrl,this.fileFormat=E.fileFormat,this.displayRects=E.displayRects,this.displayRects)for(v=this.displayRects.length-1;v>=0;v--)for(_=this.displayRects[v],T=_.minLevel;T<=_.maxLevel;T++)this._levelRects[T]||(this._levelRects[T]=[]),this._levelRects[T].push(_);t.TileSource.apply(this,[E])},t.extend(t.DziTileSource.prototype,t.TileSource.prototype,{supports:function(s,o){var l;return s.Image?l=s.Image.xmlns:s.documentElement&&(s.documentElement.localName==="Image"||s.documentElement.tagName==="Image")&&(l=s.documentElement.namespaceURI),l=(l||"").toLowerCase(),l.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||l.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(s,o,l){var u;return t.isPlainObject(s)?u=n(this,s):u=i(this,s),o&&!u.tilesUrl&&(u.tilesUrl=o.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),o.search(/\.(dzi|xml|js)\?/)!==-1?u.queryParams=o.match(/\?.*/):u.queryParams=""),u},getTileUrl:function(s,o,l){return[this.tilesUrl,s,"/",o,"_",l,".",this.fileFormat,this.queryParams].join("")},tileExists:function(s,o,l){var u=this._levelRects[s],c,d,p,m,y,v,_;if(this.minLevel&&s<this.minLevel||this.maxLevel&&s>this.maxLevel)return!1;if(!u||!u.length)return!0;for(_=u.length-1;_>=0;_--)if(c=u[_],!(s<c.minLevel||s>c.maxLevel)&&(d=this.getLevelScale(s),p=c.x*d,m=c.y*d,y=p+c.width*d,v=m+c.height*d,p=Math.floor(p/this._tileWidth),m=Math.floor(m/this._tileWidth),y=Math.ceil(y/this._tileWidth),v=Math.ceil(v/this._tileWidth),p<=o&&o<y&&m<=l&&l<v))return!0;return!1}});function i(s,o){if(!o||!o.documentElement)throw new Error(t.getString("Errors.Xml"));var l=o.documentElement,u=l.localName||l.tagName,c=o.documentElement.namespaceURI,d=null,p=[],m,y,v,_,T;if(u==="Image")try{if(_=l.getElementsByTagName("Size")[0],_===void 0&&(_=l.getElementsByTagNameNS(c,"Size")[0]),d={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:l.getAttribute("Url"),Format:l.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(l.getAttribute("Overlap"),10),TileSize:parseInt(l.getAttribute("TileSize"),10),Size:{Height:parseInt(_.getAttribute("Height"),10),Width:parseInt(_.getAttribute("Width"),10)}}},!t.imageFormatSupported(d.Image.Format))throw new Error(t.getString("Errors.ImageFormat",d.Image.Format.toUpperCase()));for(m=l.getElementsByTagName("DisplayRect"),m===void 0&&(m=l.getElementsByTagNameNS(c,"DisplayRect")[0]),T=0;T<m.length;T++)y=m[T],v=y.getElementsByTagName("Rect")[0],v===void 0&&(v=y.getElementsByTagNameNS(c,"Rect")[0]),p.push({Rect:{X:parseInt(v.getAttribute("X"),10),Y:parseInt(v.getAttribute("Y"),10),Width:parseInt(v.getAttribute("Width"),10),Height:parseInt(v.getAttribute("Height"),10),MinLevel:parseInt(y.getAttribute("MinLevel"),10),MaxLevel:parseInt(y.getAttribute("MaxLevel"),10)}});return p.length&&(d.Image.DisplayRect=p),n(s,d)}catch(A){throw A instanceof Error?A:new Error(t.getString("Errors.Dzi"))}else{if(u==="Collection")throw new Error(t.getString("Errors.Dzc"));if(u==="Error"){var E=l.getElementsByTagName("Message")[0],S=E.firstChild.nodeValue;throw new Error(S)}}throw new Error(t.getString("Errors.Dzi"))}function n(s,o){var l=o.Image,u=l.Url,c=l.Format,d=l.Size,p=l.DisplayRect||[],m=parseInt(d.Width,10),y=parseInt(d.Height,10),v=parseInt(l.TileSize,10),_=parseInt(l.Overlap,10),T=[],E,S;for(S=0;S<p.length;S++)E=p[S].Rect,T.push(new t.DisplayRect(parseInt(E.X,10),parseInt(E.Y,10),parseInt(E.Width,10),parseInt(E.Height,10),parseInt(E.MinLevel,10),parseInt(E.MaxLevel,10)));return t.extend(!0,{width:m,height:y,tileSize:v,tileOverlap:_,minLevel:null,maxLevel:null,tilesUrl:u,fileFormat:c,displayRects:T},o)}}(e),function(t){t.IIIFTileSource=function(l){if(t.extend(!0,this,l),this._id=this["@id"]||this.id||this.identifier||null,!(this.height&&this.width&&this._id))throw new Error("IIIF required parameters (width, height, or id) not provided.");if(l.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=l.version,this.tile_width&&this.tile_height)l.tileWidth=this.tile_width,l.tileHeight=this.tile_height;else if(this.tile_width)l.tileSize=this.tile_width;else if(this.tile_height)l.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length===1)l.tileWidth=this.tiles[0].width,l.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var u=0;u<this.tiles.length;u++)for(var c=0;c<this.tiles[u].scaleFactors.length;c++){var d=this.tiles[u].scaleFactors[c];this.scale_factors.push(d),l.tileSizePerScaleFactor[d]={width:this.tiles[u].width,height:this.tiles[u].height||this.tiles[u].width}}}else if(i(l)){for(var p=Math.min(this.height,this.width),m=[256,512,1024],y=[],v=0;v<m.length;v++)m[v]<=p&&y.push(m[v]);y.length>0?l.tileSize=Math.max.apply(null,y):l.tileSize=p}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,l.levels=n(this),t.extend(!0,l,{width:l.levels[l.levels.length-1].width,height:l.levels[l.levels.length-1].height,tileSize:Math.max(l.height,l.width),tileOverlap:0,minLevel:0,maxLevel:l.levels.length-1}),this.levels=l.levels):t.console.error("Nothing in the info.json to construct image pyramids from");if(!l.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)l.maxLevel=Number(Math.round(Math.log(Math.max(this.width,this.height),2)));else{var _=Math.max.apply(null,this.scale_factors);l.maxLevel=Math.round(Math.log(_)*Math.LOG2E)}if(this.sizes){var T=this.sizes.length;(T===l.maxLevel||T===l.maxLevel+1)&&(this.levelSizes=this.sizes.slice().sort((E,S)=>E.width-S.width),T===l.maxLevel&&this.levelSizes.push({width:this.width,height:this.height}))}t.TileSource.apply(this,[l])},t.extend(t.IIIFTileSource.prototype,t.TileSource.prototype,{supports:function(l,u){return l.protocol&&l.protocol==="http://iiif.io/api/image"||l["@context"]&&(l["@context"]==="http://library.stanford.edu/iiif/image-api/1.1/context.json"||l["@context"]==="http://iiif.io/api/image/1/context.json")||l.profile&&l.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||l.identifier&&l.width&&l.height?!0:!!(l.documentElement&&l.documentElement.tagName==="info"&&l.documentElement.namespaceURI==="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(l,u,c){if(t.isPlainObject(l)){if(!l["@context"])l["@context"]="http://iiif.io/api/image/1.0/context.json",l["@id"]=u.replace("/info.json",""),l.version=1;else{var p=l["@context"];if(Array.isArray(p)){for(var m=0;m<p.length;m++)if(typeof p[m]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(p[m])||p[m]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){p=p[m];break}}switch(p){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":l.version=1;break;case"http://iiif.io/api/image/2/context.json":l.version=2;break;case"http://iiif.io/api/image/3/context.json":l.version=3;break;default:t.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(l.preferredFormats){for(var y=0;y<l.preferredFormats.length;y++)if(e.imageFormatSupported(l.preferredFormats[y])){l.tileFormat=l.preferredFormats[y];break}}return l}else{var d=s(l);return d["@context"]="http://iiif.io/api/image/1.0/context.json",d["@id"]=u.replace("/info.xml",""),d.version=1,d}},getTileWidth:function(l){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileWidth.call(this,l);var u=Math.pow(2,this.maxLevel-l);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[u]?this.tileSizePerScaleFactor[u].width:this._tileWidth},getTileHeight:function(l){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileHeight.call(this,l);var u=Math.pow(2,this.maxLevel-l);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[u]?this.tileSizePerScaleFactor[u].height:this._tileHeight},getLevelScale:function(l){if(this.emulateLegacyImagePyramid){var u=NaN;return this.levels.length>0&&l>=this.minLevel&&l<=this.maxLevel&&(u=this.levels[l].width/this.levels[this.maxLevel].width),u}return t.TileSource.prototype.getLevelScale.call(this,l)},getNumTiles:function(l){if(this.emulateLegacyImagePyramid){var u=this.getLevelScale(l);return u?new t.Point(1,1):new t.Point(0,0)}if(this.levelSizes){var c=this.levelSizes[l],d=Math.ceil(c.width/this.getTileWidth(l)),p=Math.ceil(c.height/this.getTileHeight(l));return new t.Point(d,p)}else return t.TileSource.prototype.getNumTiles.call(this,l)},getTileAtPoint:function(l,u){if(this.emulateLegacyImagePyramid)return new t.Point(0,0);if(this.levelSizes){var c=u.x>=0&&u.x<=1&&u.y>=0&&u.y<=1/this.aspectRatio;t.console.assert(c,"[TileSource.getTileAtPoint] must be called with a valid point.");var d=this.levelSizes[l].width,p=u.x*d,m=u.y*d,y=Math.floor(p/this.getTileWidth(l)),v=Math.floor(m/this.getTileHeight(l));u.x>=1&&(y=this.getNumTiles(l).x-1);var _=1e-15;return u.y>=1/this.aspectRatio-_&&(v=this.getNumTiles(l).y-1),new t.Point(y,v)}return t.TileSource.prototype.getTileAtPoint.call(this,l,u)},getTileUrl:function(l,u,c){if(this.emulateLegacyImagePyramid){var d=null;return this.levels.length>0&&l>=this.minLevel&&l<=this.maxLevel&&(d=this.levels[l].url),d}var p="0",m=Math.pow(.5,this.maxLevel-l),y,v,_,T,E,S,A,P,D,k,U,j,q,ee,pe,H;return this.levelSizes?(y=this.levelSizes[l].width,v=this.levelSizes[l].height):(y=Math.ceil(this.width*m),v=Math.ceil(this.height*m)),_=this.getTileWidth(l),T=this.getTileHeight(l),E=Math.round(_/m),S=Math.round(T/m),this.version===1?pe="native."+this.tileFormat:pe="default."+this.tileFormat,y<_&&v<T?(this.version===2&&y===this.width?j="full":this.version===3&&y===this.width&&v===this.height?j="max":this.version===3?j=y+","+v:j=y+",",A="full"):(P=u*E,D=c*S,k=Math.min(E,this.width-P),U=Math.min(S,this.height-D),u===0&&c===0&&k===this.width&&U===this.height?A="full":A=[P,D,k,U].join(","),q=Math.min(_,y-u*_),ee=Math.min(T,v-c*T),this.version===2&&q===this.width?j="full":this.version===3&&q===this.width&&ee===this.height?j="max":this.version===3?j=q+","+ee:j=q+","),H=[this._id,A,j,p,pe].join("/"),H},__testonly__:{canBeTiled:i,constructLevels:n}});function i(l){var u=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],c=Array.isArray(l.profile)?l.profile[0]:l.profile,d=u.indexOf(c)!==-1,p=!1;return l.version===2&&l.profile.length>1&&l.profile[1].supports&&(p=l.profile[1].supports.indexOf("sizeByW")!==-1),l.version===3&&l.extraFeatures&&(p=l.extraFeatures.indexOf("sizeByWh")!==-1),!d||p}function n(l){for(var u=[],c=0;c<l.sizes.length;c++)u.push({url:l._id+"/full/"+l.sizes[c].width+","+(l.version===3?l.sizes[c].height:"")+"/0/default."+l.tileFormat,width:l.sizes[c].width,height:l.sizes[c].height});return u.sort(function(d,p){return d.width-p.width})}function s(l){if(!l||!l.documentElement)throw new Error(t.getString("Errors.Xml"));var u=l.documentElement,c=u.tagName,d=null;if(c==="info")try{return d={},o(u,d),d}catch(p){throw p instanceof Error?p:new Error(t.getString("Errors.IIIF"))}throw new Error(t.getString("Errors.IIIF"))}function o(l,u,c){var d,p;if(l.nodeType===3&&c)p=l.nodeValue.trim(),p.match(/^\d*$/)&&(p=Number(p)),u[c]?(t.isArray(u[c])||(u[c]=[u[c]]),u[c].push(p)):u[c]=p;else if(l.nodeType===1)for(d=0;d<l.childNodes.length;d++)o(l.childNodes[d],u,l.nodeName)}}(e),function(t){t.OsmTileSource=function(i,n,s,o,l){var u;t.isPlainObject(i)?u=i:u={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!u.width||!u.height)&&(u.width=65572864,u.height=65572864),u.tileSize||(u.tileSize=256,u.tileOverlap=0),u.tilesUrl||(u.tilesUrl="http://tile.openstreetmap.org/"),u.minLevel=8,t.TileSource.apply(this,[u])},t.extend(t.OsmTileSource.prototype,t.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="openstreetmaps"},configure:function(i,n,s){return i},getTileUrl:function(i,n,s){return this.tilesUrl+(i-8)+"/"+n+"/"+s+".png"}})}(e),function(t){t.TmsTileSource=function(i,n,s,o,l){var u;t.isPlainObject(i)?u=i:u={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var c=Math.ceil(u.width/256)*256,d=Math.ceil(u.height/256)*256,p;c>d?p=c/256:p=d/256,u.maxLevel=Math.ceil(Math.log(p)/Math.log(2))-1,u.tileSize=256,u.width=c,u.height=d,t.TileSource.apply(this,[u])},t.extend(t.TmsTileSource.prototype,t.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="tiledmapservice"},configure:function(i,n,s){return i},getTileUrl:function(i,n,s){var o=this.getNumTiles(i).y-1;return this.tilesUrl+i+"/"+n+"/"+(o-s)+".png"}})}(e),function(t){t.ZoomifyTileSource=function(i){typeof i.tileSize>"u"&&(i.tileSize=256),typeof i.fileFormat>"u"&&(i.fileFormat="jpg",this.fileFormat=i.fileFormat);var n={x:i.width,y:i.height};for(i.imageSizes=[{x:i.width,y:i.height}],i.gridSize=[this._getGridSize(i.width,i.height,i.tileSize)];parseInt(n.x,10)>i.tileSize||parseInt(n.y,10)>i.tileSize;)n.x=Math.floor(n.x/2),n.y=Math.floor(n.y/2),i.imageSizes.push({x:n.x,y:n.y}),i.gridSize.push(this._getGridSize(n.x,n.y,i.tileSize));i.imageSizes.reverse(),i.gridSize.reverse(),i.minLevel=0,i.maxLevel=i.gridSize.length-1,e.TileSource.apply(this,[i])},t.extend(t.ZoomifyTileSource.prototype,t.TileSource.prototype,{_getGridSize:function(i,n,s){return{x:Math.ceil(i/s),y:Math.ceil(n/s)}},_calculateAbsoluteTileNumber:function(i,n,s){for(var o=0,l={},u=0;u<i;u++)l=this.gridSize[u],o+=l.x*l.y;return l=this.gridSize[i],o+=l.x*s+n,o},supports:function(i,n){return i.type&&i.type==="zoomifytileservice"},configure:function(i,n,s){return i},getTileUrl:function(i,n,s){var o=0,l=this._calculateAbsoluteTileNumber(i,n,s);return o=Math.floor(l/256),this.tilesUrl+"TileGroup"+o+"/"+i+"-"+n+"-"+s+"."+this.fileFormat}})}(e),function(t){t.LegacyTileSource=function(o){var l,u,c;t.isArray(o)&&(l={type:"legacy-image-pyramid",levels:o}),l.levels=i(l.levels),l.levels.length>0?(u=l.levels[l.levels.length-1].width,c=l.levels[l.levels.length-1].height):(u=0,c=0,t.console.error("No supported image formats found")),t.extend(!0,l,{width:u,height:c,tileSize:Math.max(c,u),tileOverlap:0,minLevel:0,maxLevel:l.levels.length>0?l.levels.length-1:0}),t.TileSource.apply(this,[l]),this.levels=l.levels},t.extend(t.LegacyTileSource.prototype,t.TileSource.prototype,{supports:function(o,l){return o.type&&o.type==="legacy-image-pyramid"||o.documentElement&&o.documentElement.getAttribute("type")==="legacy-image-pyramid"},configure:function(o,l,u){var c;return t.isPlainObject(o)?c=s(this,o):c=n(this,o),c},getLevelScale:function(o){var l=NaN;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(l=this.levels[o].width/this.levels[this.maxLevel].width),l},getNumTiles:function(o){var l=this.getLevelScale(o);return l?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(o,l,u){var c=null;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(c=this.levels[o].url),c}});function i(o){var l=[],u,c;for(c=0;c<o.length;c++)u=o[c],u.height&&u.width&&u.url?l.push({url:u.url,width:Number(u.width),height:Number(u.height)}):t.console.error("Unsupported image format: %s",u.url?u.url:"<no URL>");return l.sort(function(d,p){return d.height-p.height})}function n(o,l){if(!l||!l.documentElement)throw new Error(t.getString("Errors.Xml"));var u=l.documentElement,c=u.tagName,d=null,p=[],m,y;if(c==="image")try{for(d={type:u.getAttribute("type"),levels:[]},p=u.getElementsByTagName("level"),y=0;y<p.length;y++)m=p[y],d.levels.push({url:m.getAttribute("url"),width:parseInt(m.getAttribute("width"),10),height:parseInt(m.getAttribute("height"),10)});return s(o,d)}catch(v){throw v instanceof Error?v:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(c==="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(c==="error")throw new Error("Error: "+l)}throw new Error("Unknown element "+c)}function s(o,l){return l.levels}}(e),function(t){t.ImageTileSource=function(i){i=t.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1},i),t.TileSource.apply(this,[i])},t.extend(t.ImageTileSource.prototype,t.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="image"},configure:function(i,n,s){return i},getImageInfo:function(i){var n=this._image=new Image,s=this;this.crossOriginPolicy&&(n.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(n.useCredentials=this.ajaxWithCredentials),t.addEvent(n,"load",function(){s.width=n.naturalWidth,s.height=n.naturalHeight,s.aspectRatio=s.width/s.height,s.dimensions=new t.Point(s.width,s.height),s._tileWidth=s.width,s._tileHeight=s.height,s.tileOverlap=0,s.minLevel=0,s.levels=s._buildLevels(),s.maxLevel=s.levels.length-1,s.ready=!0,s.raiseEvent("ready",{tileSource:s})}),t.addEvent(n,"error",function(){s.raiseEvent("open-failed",{message:"Error loading image at "+i,source:i})}),n.src=i},getLevelScale:function(i){var n=NaN;return i>=this.minLevel&&i<=this.maxLevel&&(n=this.levels[i].width/this.levels[this.maxLevel].width),n},getNumTiles:function(i){var n=this.getLevelScale(i);return n?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(i,n,s){var o=null;return i>=this.minLevel&&i<=this.maxLevel&&(o=this.levels[i].url),o},getContext2D:function(i,n,s){var o=null;return i>=this.minLevel&&i<=this.maxLevel&&(o=this.levels[i].context2D),o},destroy:function(i){this._freeupCanvasMemory(i)},_buildLevels:function(){var i=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!t.supportsCanvas)return delete this._image,i;var n=this._image.naturalWidth,s=this._image.naturalHeight,o=document.createElement("canvas"),l=o.getContext("2d");if(o.width=n,o.height=s,l.drawImage(this._image,0,0,n,s),i[0].context2D=l,delete this._image,t.isCanvasTainted(o))return i;for(;n>=2&&s>=2;){n=Math.floor(n/2),s=Math.floor(s/2);var u=document.createElement("canvas"),c=u.getContext("2d");u.width=n,u.height=s,c.drawImage(o,0,0,n,s),i.splice(0,0,{context2D:c,width:n,height:s}),o=u,l=c}return i},_freeupCanvasMemory:function(i){for(var n=0;n<this.levels.length;n++)this.levels[n].context2D&&(this.levels[n].context2D.canvas.height=0,this.levels[n].context2D.canvas.width=0,i&&i.raiseEvent("image-unloaded",{context2D:this.levels[n].context2D}))}})}(e),function(t){t.TileSourceCollection=function(i,n,s,o){t.console.error("TileSourceCollection is deprecated; use World instead")}}(e),function(t){t.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},t.Button=function(c){var d=this;t.EventSource.call(this),t.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},c),this.element=c.element||t.makeNeutralElement("div"),c.element||(this.imgRest=t.makeTransparentImage(this.srcRest),this.imgGroup=t.makeTransparentImage(this.srcGroup),this.imgHover=t.makeTransparentImage(this.srcHover),this.imgDown=t.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,t.setElementPointerEventsNone(this.imgRest),t.setElementPointerEventsNone(this.imgGroup),t.setElementPointerEventsNone(this.imgHover),t.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",t.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=t.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new t.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(p){p.insideElementPressed?(l(d,t.ButtonState.DOWN),d.raiseEvent("enter",{originalEvent:p.originalEvent})):p.buttonDownAny||l(d,t.ButtonState.HOVER)},focusHandler:function(p){d.tracker.enterHandler(p),d.raiseEvent("focus",{originalEvent:p.originalEvent})},leaveHandler:function(p){u(d,t.ButtonState.GROUP),p.insideElementPressed&&d.raiseEvent("exit",{originalEvent:p.originalEvent})},blurHandler:function(p){d.tracker.leaveHandler(p),d.raiseEvent("blur",{originalEvent:p.originalEvent})},pressHandler:function(p){l(d,t.ButtonState.DOWN),d.raiseEvent("press",{originalEvent:p.originalEvent})},releaseHandler:function(p){p.insideElementPressed&&p.insideElementReleased?(u(d,t.ButtonState.HOVER),d.raiseEvent("release",{originalEvent:p.originalEvent})):p.insideElementPressed?u(d,t.ButtonState.GROUP):l(d,t.ButtonState.HOVER)},clickHandler:function(p){p.quick&&d.raiseEvent("click",{originalEvent:p.originalEvent})},keyHandler:function(p){p.keyCode===13?(d.raiseEvent("click",{originalEvent:p.originalEvent}),d.raiseEvent("release",{originalEvent:p.originalEvent}),p.preventDefault=!0):p.preventDefault=!1}}),u(this,t.ButtonState.REST)},t.extend(t.Button.prototype,t.EventSource.prototype,{notifyGroupEnter:function(){l(this,t.ButtonState.GROUP)},notifyGroupExit:function(){u(this,t.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,this.tracker.setTracking(!1),t.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,this.tracker.setTracking(!0),t.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}});function i(c){t.requestAnimationFrame(function(){n(c)})}function n(c){var d,p,m;c.shouldFade&&(d=t.now(),p=d-c.fadeBeginTime,m=1-p/c.fadeLength,m=Math.min(1,m),m=Math.max(0,m),c.imgGroup&&t.setElementOpacity(c.imgGroup,m,!0),m>0&&i(c))}function s(c){c.shouldFade=!0,c.fadeBeginTime=t.now()+c.fadeDelay,window.setTimeout(function(){i(c)},c.fadeDelay)}function o(c){c.shouldFade=!1,c.imgGroup&&t.setElementOpacity(c.imgGroup,1,!0)}function l(c,d){c.element.disabled||(d>=t.ButtonState.GROUP&&c.currentState===t.ButtonState.REST&&(o(c),c.currentState=t.ButtonState.GROUP),d>=t.ButtonState.HOVER&&c.currentState===t.ButtonState.GROUP&&(c.imgHover&&(c.imgHover.style.visibility=""),c.currentState=t.ButtonState.HOVER),d>=t.ButtonState.DOWN&&c.currentState===t.ButtonState.HOVER&&(c.imgDown&&(c.imgDown.style.visibility=""),c.currentState=t.ButtonState.DOWN))}function u(c,d){c.element.disabled||(d<=t.ButtonState.HOVER&&c.currentState===t.ButtonState.DOWN&&(c.imgDown&&(c.imgDown.style.visibility="hidden"),c.currentState=t.ButtonState.HOVER),d<=t.ButtonState.GROUP&&c.currentState===t.ButtonState.HOVER&&(c.imgHover&&(c.imgHover.style.visibility="hidden"),c.currentState=t.ButtonState.GROUP),d<=t.ButtonState.REST&&c.currentState===t.ButtonState.GROUP&&(s(c),c.currentState=t.ButtonState.REST))}}(e),function(t){t.ButtonGroup=function(i){t.extend(!0,this,{buttons:[],clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},i);var n=this.buttons.concat([]),s=this,o;if(this.element=i.element||t.makeNeutralElement("div"),!i.group)for(this.element.style.display="inline-block",o=0;o<n.length;o++)this.element.appendChild(n[o].element);t.setElementTouchActionNone(this.element),this.tracker=new t.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(l){var u;for(u=0;u<s.buttons.length;u++)s.buttons[u].notifyGroupEnter()},leaveHandler:function(l){var u;if(!l.insideElementPressed)for(u=0;u<s.buttons.length;u++)s.buttons[u].notifyGroupExit()}})},t.ButtonGroup.prototype={addButton:function(i){this.buttons.push(i),this.element.appendChild(i.element)},emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var i=this.buttons.pop();this.element.removeChild(i.element),i.destroy()}this.tracker.destroy(),this.element=null}}}(e),function(t){t.Rect=function(i,n,s,o,l){this.x=typeof i=="number"?i:0,this.y=typeof n=="number"?n:0,this.width=typeof s=="number"?s:0,this.height=typeof o=="number"?o:0,this.degrees=typeof l=="number"?l:0,this.degrees=t.positiveModulo(this.degrees,360);var u,c;this.degrees>=270?(u=this.getTopRight(),this.x=u.x,this.y=u.y,c=this.height,this.height=this.width,this.width=c,this.degrees-=270):this.degrees>=180?(u=this.getBottomRight(),this.x=u.x,this.y=u.y,this.degrees-=180):this.degrees>=90&&(u=this.getBottomLeft(),this.x=u.x,this.y=u.y,c=this.height,this.height=this.width,this.width=c,this.degrees-=90)},t.Rect.fromSummits=function(i,n,s){var o=i.distanceTo(n),l=i.distanceTo(s),u=n.minus(i),c=Math.atan(u.y/u.x);return u.x<0?c+=Math.PI:u.y<0&&(c+=2*Math.PI),new t.Rect(i.x,i.y,o,l,c/Math.PI*180)},t.Rect.prototype={clone:function(){return new t.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new t.Point(this.x,this.y)},getBottomRight:function(){return new t.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new t.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new t.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new t.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new t.Point(this.width,this.height)},equals:function(i){return i instanceof t.Rect&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height&&this.degrees===i.degrees},times:function(i){return new t.Rect(this.x*i,this.y*i,this.width*i,this.height*i,this.degrees)},translate:function(i){return new t.Rect(this.x+i.x,this.y+i.y,this.width,this.height,this.degrees)},union:function(i){var n=this.getBoundingBox(),s=i.getBoundingBox(),o=Math.min(n.x,s.x),l=Math.min(n.y,s.y),u=Math.max(n.x+n.width,s.x+s.width),c=Math.max(n.y+n.height,s.y+s.height);return new t.Rect(o,l,u-o,c-l)},intersection:function(i){var n=1e-10,s=[],o=this.getTopLeft();i.containsPoint(o,n)&&s.push(o);var l=this.getTopRight();i.containsPoint(l,n)&&s.push(l);var u=this.getBottomLeft();i.containsPoint(u,n)&&s.push(u);var c=this.getBottomRight();i.containsPoint(c,n)&&s.push(c);var d=i.getTopLeft();this.containsPoint(d,n)&&s.push(d);var p=i.getTopRight();this.containsPoint(p,n)&&s.push(p);var m=i.getBottomLeft();this.containsPoint(m,n)&&s.push(m);var y=i.getBottomRight();this.containsPoint(y,n)&&s.push(y);for(var v=this._getSegments(),_=i._getSegments(),T=0;T<v.length;T++)for(var E=v[T],S=0;S<_.length;S++){var A=_[S],P=D(E[0],E[1],A[0],A[1]);P&&s.push(P)}function D(H,F,G,$){var le=F.minus(H),ie=$.minus(G),Y=-ie.x*le.y+le.x*ie.y;if(Y===0)return null;var de=(le.x*(H.y-G.y)-le.y*(H.x-G.x))/Y,z=(ie.x*(H.y-G.y)-ie.y*(H.x-G.x))/Y;return-1e-10<=de&&de<=1-n&&-1e-10<=z&&z<=1-n?new t.Point(H.x+z*le.x,H.y+z*le.y):null}if(s.length===0)return null;for(var k=s[0].x,U=s[0].x,j=s[0].y,q=s[0].y,ee=1;ee<s.length;ee++){var pe=s[ee];pe.x<k&&(k=pe.x),pe.x>U&&(U=pe.x),pe.y<j&&(j=pe.y),pe.y>q&&(q=pe.y)}return new t.Rect(k,j,U-k,q-j)},_getSegments:function(){var i=this.getTopLeft(),n=this.getTopRight(),s=this.getBottomLeft(),o=this.getBottomRight();return[[i,n],[n,o],[o,s],[s,i]]},rotate:function(i,n){if(i=t.positiveModulo(i,360),i===0)return this.clone();n=n||this.getCenter();var s=this.getTopLeft().rotate(i,n),o=this.getTopRight().rotate(i,n),l=o.minus(s);l=l.apply(function(c){var d=1e-15;return Math.abs(c)<d?0:c});var u=Math.atan(l.y/l.x);return l.x<0?u+=Math.PI:l.y<0&&(u+=2*Math.PI),new t.Rect(s.x,s.y,this.width,this.height,u/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var i=this.getTopLeft(),n=this.getTopRight(),s=this.getBottomLeft(),o=this.getBottomRight(),l=Math.min(i.x,n.x,s.x,o.x),u=Math.max(i.x,n.x,s.x,o.x),c=Math.min(i.y,n.y,s.y,o.y),d=Math.max(i.y,n.y,s.y,o.y);return new t.Rect(l,c,u-l,d-c)},getIntegerBoundingBox:function(){var i=this.getBoundingBox(),n=Math.floor(i.x),s=Math.floor(i.y),o=Math.ceil(i.width+i.x-n),l=Math.ceil(i.height+i.y-s);return new t.Rect(n,s,o,l)},containsPoint:function(i,n){n=n||0;var s=this.getTopLeft(),o=this.getTopRight(),l=this.getBottomLeft(),u=o.minus(s),c=l.minus(s);return(i.x-s.x)*u.x+(i.y-s.y)*u.y>=-n&&(i.x-o.x)*u.x+(i.y-o.y)*u.y<=n&&(i.x-s.x)*c.x+(i.y-s.y)*c.y>=-n&&(i.x-l.x)*c.x+(i.y-l.y)*c.y<=n},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(e),function(t){var i={};t.ReferenceStrip=function(m){var y=this,v=m.viewer,_=t.getElementSize(v.element),T,E,S;for(m.id||(m.id="referencestrip-"+t.now(),this.element=t.makeNeutralElement("div"),this.element.id=m.id,this.element.className="referencestrip"),m=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.referenceStripSizeRatio,position:t.DEFAULT_SETTINGS.referenceStripPosition,scroll:t.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold},m,{element:this.element}),t.extend(this,m),i[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,E=this.element.style,E.marginTop="0px",E.marginRight="0px",E.marginBottom="0px",E.marginLeft="0px",E.left="0px",E.bottom="0px",E.border="0px",E.background="#000",E.position="relative",t.setElementTouchActionNone(this.element),t.setElementOpacity(this.element,.8),this.viewer=v,this.tracker=new t.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:t.delegate(this,n),dragHandler:t.delegate(this,s),scrollHandler:t.delegate(this,o),enterHandler:t.delegate(this,u),leaveHandler:t.delegate(this,c),keyDownHandler:t.delegate(this,d),keyHandler:t.delegate(this,p),preProcessEventHandler:function(A){A.eventType==="wheel"&&(A.preventDefault=!0)}}),m.width&&m.height?(this.element.style.width=m.width+"px",this.element.style.height=m.height+"px",v.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):m.scroll==="horizontal"?(this.element.style.width=_.x*m.sizeRatio*v.tileSources.length+12*v.tileSources.length+"px",this.element.style.height=_.y*m.sizeRatio+"px",v.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=_.y*m.sizeRatio*v.tileSources.length+12*v.tileSources.length+"px",this.element.style.width=_.x*m.sizeRatio+"px",v.addControl(this.element,{anchor:t.ControlAnchor.TOP_LEFT})),this.panelWidth=_.x*this.sizeRatio+8,this.panelHeight=_.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},S=0;S<v.tileSources.length;S++)T=t.makeNeutralElement("div"),T.id=this.element.id+"-"+S,T.style.width=y.panelWidth+"px",T.style.height=y.panelHeight+"px",T.style.display="inline",T.style.float="left",T.style.cssFloat="left",T.style.padding="2px",t.setElementTouchActionNone(T),t.setElementPointerEventsNone(T),this.element.appendChild(T),T.activePanel=!1,this.panels.push(T);l(this,this.scroll==="vertical"?_.y:_.x,0),this.setFocus(0)},t.ReferenceStrip.prototype={setFocus:function(m){var y=this.element.querySelector("#"+this.element.id+"-"+m),v=t.getElementSize(this.viewer.canvas),_=Number(this.element.style.width.replace("px","")),T=Number(this.element.style.height.replace("px","")),E=-Number(this.element.style.marginLeft.replace("px","")),S=-Number(this.element.style.marginTop.replace("px","")),A;this.currentSelected!==y&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=y,this.currentSelected.style.background="#999",this.scroll==="horizontal"?(A=Number(m)*(this.panelWidth+3),A>E+v.x-this.panelWidth?(A=Math.min(A,_-v.x),this.element.style.marginLeft=-A+"px",l(this,v.x,-A)):A<E&&(A=Math.max(0,A-v.x/2),this.element.style.marginLeft=-A+"px",l(this,v.x,-A))):(A=Number(m)*(this.panelHeight+3),A>S+v.y-this.panelHeight?(A=Math.min(A,T-v.y),this.element.style.marginTop=-A+"px",l(this,v.y,-A)):A<S&&(A=Math.max(0,A-v.y/2),this.element.style.marginTop=-A+"px",l(this,v.y,-A))),this.currentPage=m,u.call(this,{eventSource:this.tracker}))},update:function(){return!!i[this.id].animating},destroy:function(){if(this.miniViewers)for(var m in this.miniViewers)this.miniViewers[m].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}};function n(m){if(m.quick){var y;this.scroll==="horizontal"?y=Math.floor(m.position.x/(this.panelWidth+4)):y=Math.floor(m.position.y/this.panelHeight),this.viewer.goToPage(y)}this.element.focus()}function s(m){if(this.dragging=!0,this.element){var y=Number(this.element.style.marginLeft.replace("px","")),v=Number(this.element.style.marginTop.replace("px","")),_=Number(this.element.style.width.replace("px","")),T=Number(this.element.style.height.replace("px","")),E=t.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?-m.delta.x>0?y>-(_-E.x)&&(this.element.style.marginLeft=y+m.delta.x*2+"px",l(this,E.x,y+m.delta.x*2)):-m.delta.x<0&&y<0&&(this.element.style.marginLeft=y+m.delta.x*2+"px",l(this,E.x,y+m.delta.x*2)):-m.delta.y>0?v>-(T-E.y)&&(this.element.style.marginTop=v+m.delta.y*2+"px",l(this,E.y,v+m.delta.y*2)):-m.delta.y<0&&v<0&&(this.element.style.marginTop=v+m.delta.y*2+"px",l(this,E.y,v+m.delta.y*2))}}function o(m){if(this.element){var y=Number(this.element.style.marginLeft.replace("px","")),v=Number(this.element.style.marginTop.replace("px","")),_=Number(this.element.style.width.replace("px","")),T=Number(this.element.style.height.replace("px","")),E=t.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?m.scroll>0?y>-(_-E.x)&&(this.element.style.marginLeft=y-m.scroll*60+"px",l(this,E.x,y-m.scroll*60)):m.scroll<0&&y<0&&(this.element.style.marginLeft=y-m.scroll*60+"px",l(this,E.x,y-m.scroll*60)):m.scroll<0?v>E.y-T&&(this.element.style.marginTop=v+m.scroll*60+"px",l(this,E.y,v+m.scroll*60)):m.scroll>0&&v<0&&(this.element.style.marginTop=v+m.scroll*60+"px",l(this,E.y,v+m.scroll*60)),m.preventDefault=!0}}function l(m,y,v){var _,T,E,S,A,P;for(m.scroll==="horizontal"?_=m.panelWidth:_=m.panelHeight,T=Math.ceil(y/_)+5,E=Math.ceil((Math.abs(v)+y)/_)+1,T=E-T,T=T<0?0:T,A=T;A<E&&A<m.panels.length;A++)if(P=m.panels[A],!P.activePanel){var D,k=m.viewer.tileSources[A];k.referenceStripThumbnailUrl?D={type:"image",url:k.referenceStripThumbnailUrl}:D=k,S=new t.Viewer({id:P.id,tileSources:[D],element:P,navigatorSizeRatio:m.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:m.viewer.loadTilesWithAjax,ajaxHeaders:m.viewer.ajaxHeaders,drawer:"canvas"}),t.setElementPointerEventsNone(S.canvas),t.setElementPointerEventsNone(S.container),S.innerTracker.setTracking(!1),S.outerTracker.setTracking(!1),m.miniViewers[P.id]=S,P.activePanel=!0}}function u(m){var y=m.eventSource.element;this.scroll==="horizontal"?y.style.marginBottom="0px":y.style.marginLeft="0px"}function c(m){var y=m.eventSource.element;this.scroll==="horizontal"?y.style.marginBottom="-"+t.getElementSize(y).y/2+"px":y.style.marginLeft="-"+t.getElementSize(y).x/2+"px"}function d(m){if(!m.ctrl&&!m.alt&&!m.meta)switch(m.keyCode){case 38:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;case 40:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 37:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 39:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;default:m.preventDefault=!1;break}else m.preventDefault=!1}function p(m){if(!m.ctrl&&!m.alt&&!m.meta)switch(m.keyCode){case 61:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;case 45:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 48:case 119:case 87:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;case 115:case 83:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 97:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 100:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;default:m.preventDefault=!1;break}else m.preventDefault=!1}}(e),function(t){t.DisplayRect=function(i,n,s,o,l,u){t.Rect.apply(this,[i,n,s,o]),this.minLevel=l,this.maxLevel=u},t.extend(t.DisplayRect.prototype,t.Rect.prototype)}(e),function(t){t.Spring=function(n){var s=arguments;typeof n!="object"&&(n={initial:s.length&&typeof s[0]=="number"?s[0]:void 0,springStiffness:s.length>1?s[1].springStiffness:5,animationTime:s.length>1?s[1].animationTime:1.5}),t.console.assert(typeof n.springStiffness=="number"&&n.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),t.console.assert(typeof n.animationTime=="number"&&n.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),n.exponential&&(this._exponential=!0,delete n.exponential),t.extend(!0,this,n),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:t.now()},t.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},t.Spring.prototype={resetTo:function(n){t.console.assert(!this._exponential||n!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=n,this.start.time=this.target.time=this.current.time=t.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(n){t.console.assert(!this._exponential||n!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=n,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(n){this.start.value+=n,this.target.value+=n,this._exponential&&(t.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(n){this._exponential=n,this._exponential&&(t.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=t.now();let n,s;if(this._exponential?(n=this.start._logValue,s=this.target._logValue):(n=this.start.value,s=this.target.value),this.current.time>=this.target.time)this.current.value=this.target.value;else{let o=n+(s-n)*i(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time));this._exponential?this.current.value=Math.exp(o):this.current.value=o}return this.current.value!==this.target.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function i(n,s){return(1-Math.exp(n*-s))/(1-Math.exp(-n))}}(e),function(t){t.ImageJob=function(n){t.extend(!0,this,{timeout:t.DEFAULT_SETTINGS.timeout,jobId:null,tries:0},n),this.data=null,this.userData={},this.errorMsg=null},t.ImageJob.prototype={start:function(){this.tries++;var n=this,s=this.abort;this.jobId=window.setTimeout(function(){n.finish(null,null,"Image load exceeded timeout ("+n.timeout+" ms)")},this.timeout),this.abort=function(){n.source.downloadTileAbort(n),typeof s=="function"&&s()},this.source.downloadTileStart(this)},finish:function(n,s,o){this.data=n,this.request=s,this.errorMsg=o,this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},t.ImageLoader=function(n){t.extend(!0,this,{jobLimit:t.DEFAULT_SETTINGS.imageLoaderLimit,timeout:t.DEFAULT_SETTINGS.timeout,jobQueue:[],failedTiles:[],jobsInProgress:0},n)},t.ImageLoader.prototype={addJob:function(n){if(!n.source){t.console.error("ImageLoader.prototype.addJob() requires [options.source]. TileSource since new API defines how images are fetched. Creating a dummy TileSource.");var s=t.TileSource.prototype;n.source={downloadTileStart:s.downloadTileStart,downloadTileAbort:s.downloadTileAbort}}var o=this,l=function(d){i(o,d,n.callback)},u={src:n.src,tile:n.tile||{},source:n.source,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.loadWithAjax?n.ajaxHeaders:null,crossOriginPolicy:n.crossOriginPolicy,ajaxWithCredentials:n.ajaxWithCredentials,postData:n.postData,callback:l,abort:n.abort,timeout:this.timeout},c=new t.ImageJob(u);!this.jobLimit||this.jobsInProgress<this.jobLimit?(c.start(),this.jobsInProgress++):this.jobQueue.push(c)},clear:function(){for(var n=0;n<this.jobQueue.length;n++){var s=this.jobQueue[n];typeof s.abort=="function"&&s.abort()}this.jobQueue=[]}};function i(n,s,o){s.errorMsg!==""&&(s.data===null||s.data===void 0)&&s.tries<1+n.tileRetryMax&&n.failedTiles.push(s);var l;n.jobsInProgress--,(!n.jobLimit||n.jobsInProgress<n.jobLimit)&&n.jobQueue.length>0&&(l=n.jobQueue.shift(),l.start(),n.jobsInProgress++),n.tileRetryMax>0&&n.jobQueue.length===0&&(!n.jobLimit||n.jobsInProgress<n.jobLimit)&&n.failedTiles.length>0&&(l=n.failedTiles.shift(),setTimeout(function(){l.start()},n.tileRetryDelay),n.jobsInProgress++),o(s.data,s.errorMsg,s.request)}}(e),function(t){t.Tile=function(i,n,s,o,l,u,c,d,p,m,y,v){this.level=i,this.x=n,this.y=s,this.bounds=o,this.positionedBounds=new e.Rect(o.x,o.y,o.width,o.height),this.sourceBounds=m,this.exists=l,this._url=u,this.postData=y,this.context2D=c,this.loadWithAjax=d,this.ajaxHeaders=p,v===void 0&&(t.console.warn("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),v=t.TileSource.prototype.getTileHashKey(i,n,s,u,p,y)),this.cacheKey=v,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.hasTransparency=!1,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},t.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return console.warn("Tile.prototype._hasTransparencyChannel() has been deprecated and will be removed in the future. Use TileSource.prototype.hasTransparency() instead."),!!this.context2D||this.getUrl().match(".png")},get image(){return t.console.error("[Tile.image] property has been deprecated. Use [Tile.prototype.getImage] instead."),this.getImage()},get url(){return t.console.error("[Tile.url] property has been deprecated. Use [Tile.prototype.getUrl] instead."),this.getUrl()},getImage:function(){return this.cacheImageRecord.getImage()},getUrl:function(){return typeof this._url=="function"?this._url():this._url},getCanvasContext:function(){return this.context2D||this.cacheImageRecord&&this.cacheImageRecord.getRenderedContext()},getScaleForEdgeSmoothing:function(){var i;if(this.cacheImageRecord)i=this.cacheImageRecord.getRenderedContext();else if(this.context2D)i=this.context2D;else return t.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return i.canvas.width/(this.size.x*t.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(i,n,s){var o=Math.max(1,Math.ceil((s.x-n.x)/2)),l=Math.max(1,Math.ceil((s.y-n.y)/2));return new t.Point(o,l).minus(this.position.times(t.pixelDensityRatio).times(i||1).apply(function(u){return u%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(e),function(t){t.OverlayPlacement=t.Placement,t.OverlayRotationMode=t.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),t.Overlay=function(i,n,s){var o;t.isPlainObject(i)?o=i:o={element:i,location:n,placement:s},this.elementWrapper=document.createElement("div"),this.element=o.element,this.elementWrapper.appendChild(this.element),this.element.id?this.elementWrapper.id="overlay-wrapper-"+this.element.id:this.elementWrapper.id="overlay-wrapper",this.style=this.elementWrapper.style,this._init(o)},t.Overlay.prototype={_init:function(i){this.location=i.location,this.placement=i.placement===void 0?t.Placement.TOP_LEFT:i.placement,this.onDraw=i.onDraw,this.checkResize=i.checkResize===void 0?!0:i.checkResize,this.width=i.width===void 0?null:i.width,this.height=i.height===void 0?null:i.height,this.rotationMode=i.rotationMode||t.OverlayRotationMode.EXACT,this.location instanceof t.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=t.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new t.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(i,n){var s=t.Placement.properties[this.placement];s&&(s.isHorizontallyCentered?i.x-=n.x/2:s.isRight&&(i.x-=n.x),s.isVerticallyCentered?i.y-=n.y/2:s.isBottom&&(i.y-=n.y))},destroy:function(){var i=this.elementWrapper,n=this.style;i.parentNode&&(i.parentNode.removeChild(i),i.prevElementParent&&(n.display="none",document.body.appendChild(i))),this.onDraw=null,n.top="",n.left="",n.position="",this.width!==null&&(n.width=""),this.height!==null&&(n.height="");var s=t.getCssPropertyWithVendorPrefix("transformOrigin"),o=t.getCssPropertyWithVendorPrefix("transform");s&&o&&(n[s]="",n[o]="")},drawHTML:function(i,n){var s=this.elementWrapper;s.parentNode!==i&&(s.prevElementParent=s.parentNode,s.prevNextSibling=s.nextSibling,i.appendChild(s),this.style.position="absolute",this.size=t.getElementSize(this.elementWrapper));var o=this._getOverlayPositionAndSize(n),l=o.position,u=this.size=o.size,c="";n.overlayPreserveContentDirection&&(c=n.flipped?" scaleX(-1)":" scaleX(1)");var d=n.flipped?-o.rotate:o.rotate,p=n.flipped?" scaleX(-1)":"";if(this.onDraw)this.onDraw(l,u,this.element);else{var m=this.style,y=this.element.style;y.display="block",m.left=l.x+"px",m.top=l.y+"px",this.width!==null&&(y.width=u.x+"px"),this.height!==null&&(y.height=u.y+"px");var v=t.getCssPropertyWithVendorPrefix("transformOrigin"),_=t.getCssPropertyWithVendorPrefix("transform");v&&_&&(d&&!n.flipped?(y[_]="",m[v]=this._getTransformOrigin(),m[_]="rotate("+d+"deg)"):!d&&n.flipped?(y[_]=c,m[v]=this._getTransformOrigin(),m[_]=p):d&&n.flipped?(y[_]=c,m[v]=this._getTransformOrigin(),m[_]="rotate("+d+"deg)"+p):(y[_]="",m[v]="",m[_]="")),m.display="flex"}},_getOverlayPositionAndSize:function(i){var n=i.pixelFromPoint(this.location,!0),s=this._getSizeInPixels(i);this.adjust(n,s);var o=0;if(i.getRotation(!0)&&this.rotationMode!==t.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var l=new t.Rect(n.x,n.y,s.x,s.y),u=this._getBoundingBox(l,i.getRotation(!0));n=u.getTopLeft(),s=u.getSize()}else o=i.getRotation(!0);return i.flipped&&(n.x=i.getContainerSize().x-n.x),{position:n,size:s,rotate:o}},_getSizeInPixels:function(i){var n=this.size.x,s=this.size.y;if(this.width!==null||this.height!==null){var o=i.deltaPixelsFromPointsNoRotate(new t.Point(this.width||0,this.height||0),!0);this.width!==null&&(n=o.x),this.height!==null&&(s=o.y)}if(this.checkResize&&(this.width===null||this.height===null)){var l=this.size=t.getElementSize(this.elementWrapper);this.width===null&&(n=l.x),this.height===null&&(s=l.y)}return new t.Point(n,s)},_getBoundingBox:function(i,n){var s=this._getPlacementPoint(i);return i.rotate(n,s).getBoundingBox()},_getPlacementPoint:function(i){var n=new t.Point(i.x,i.y),s=t.Placement.properties[this.placement];return s&&(s.isHorizontallyCentered?n.x+=i.width/2:s.isRight&&(n.x+=i.width),s.isVerticallyCentered?n.y+=i.height/2:s.isBottom&&(n.y+=i.height)),n},_getTransformOrigin:function(){var i="",n=t.Placement.properties[this.placement];return n&&(n.isLeft?i="left":n.isRight&&(i="right"),n.isTop?i+=" top":n.isBottom&&(i+=" bottom")),i},update:function(i,n){var s=t.isPlainObject(i)?i:{location:i,placement:n};this._init({location:s.location||this.location,placement:s.placement!==void 0?s.placement:this.placement,onDraw:s.onDraw||this.onDraw,checkResize:s.checkResize||this.checkResize,width:s.width!==void 0?s.width:this.width,height:s.height!==void 0?s.height:this.height,rotationMode:s.rotationMode||this.rotationMode})},getBounds:function(i){t.console.assert(i,"A viewport must now be passed to Overlay.getBounds.");var n=this.width,s=this.height;if(n===null||s===null){var o=i.deltaPointsFromPixelsNoRotate(this.size,!0);n===null&&(n=o.x),s===null&&(s=o.y)}var l=this.location.clone();return this.adjust(l,new t.Point(n,s)),this._adjustBoundsForRotation(i,new t.Rect(l.x,l.y,n,s))},_adjustBoundsForRotation:function(i,n){if(!i||i.getRotation(!0)===0||this.rotationMode===t.OverlayRotationMode.EXACT)return n;if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return n;var s=this._getOverlayPositionAndSize(i);return i.viewerElementToViewportRectangle(new t.Rect(s.position.x,s.position.y,s.size.x,s.size.y))}return n.rotate(-i.getRotation(!0),this._getPlacementPoint(n))}}}(e),function(t){const i=t;i.DrawerBase=class{constructor(s){t.console.assert(s.viewer,"[Drawer] options.viewer is required"),t.console.assert(s.viewport,"[Drawer] options.viewport is required"),t.console.assert(s.element,"[Drawer] options.element is required"),this.viewer=s.viewer,this.viewport=s.viewport,this.debugGridColor=typeof s.debugGridColor=="string"?[s.debugGridColor]:s.debugGridColor||t.DEFAULT_SETTINGS.debugGridColor,this.options=s.options||{},this.container=t.getElement(s.element),this._renderingTarget=this._createDrawingElement(),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",this.canvas.style.left="0",t.setElementOpacity(this.canvas,this.viewer.opacity,!0),t.setElementPointerEventsNone(this.canvas),t.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._checkForAPIOverrides()}get canvas(){return this._renderingTarget}get element(){return t.console.error("Drawer.element is deprecated. Use Drawer.container instead."),this.container}getType(){t.console.error("Drawer.getType must be implemented by child class")}static isSupported(){t.console.error("Drawer.isSupported must be implemented by child class")}_createDrawingElement(){return t.console.error("Drawer._createDrawingElement must be implemented by child class"),null}draw(s){t.console.error("Drawer.draw must be implemented by child class")}canRotate(){t.console.error("Drawer.canRotate must be implemented by child class")}destroy(){t.console.error("Drawer.destroy must be implemented by child class")}minimumOverlapRequired(s){return!1}setImageSmoothingEnabled(s){t.console.error("Drawer.setImageSmoothingEnabled must be implemented by child class")}drawDebuggingRect(s){t.console.warn("[drawer].drawDebuggingRect is not implemented by this drawer")}clear(){t.console.warn("[drawer].clear() is deprecated. The drawer is responsible for clearing itself as needed before drawing tiles.")}_checkForAPIOverrides(){if(this._createDrawingElement===t.DrawerBase.prototype._createDrawingElement)throw new Error("[drawer]._createDrawingElement must be implemented by child class");if(this.draw===t.DrawerBase.prototype.draw)throw new Error("[drawer].draw must be implemented by child class");if(this.canRotate===t.DrawerBase.prototype.canRotate)throw new Error("[drawer].canRotate must be implemented by child class");if(this.destroy===t.DrawerBase.prototype.destroy)throw new Error("[drawer].destroy must be implemented by child class");if(this.setImageSmoothingEnabled===t.DrawerBase.prototype.setImageSmoothingEnabled)throw new Error("[drawer].setImageSmoothingEnabled must be implemented by child class")}viewportToDrawerRectangle(s){var o=this.viewport.pixelFromPointNoRotate(s.getTopLeft(),!0),l=this.viewport.deltaPixelsFromPointsNoRotate(s.getSize(),!0);return new t.Rect(o.x*t.pixelDensityRatio,o.y*t.pixelDensityRatio,l.x*t.pixelDensityRatio,l.y*t.pixelDensityRatio)}viewportCoordToDrawerCoord(s){var o=this.viewport.pixelFromPointNoRotate(s,!0);return new t.Point(o.x*t.pixelDensityRatio,o.y*t.pixelDensityRatio)}_calculateCanvasSize(){var s=t.pixelDensityRatio,o=this.viewport.getContainerSize();return new i.Point(Math.round(o.x*s),Math.round(o.y*s))}_raiseTiledImageDrawnEvent(s,o){this.viewer&&this.viewer.raiseEvent("tiled-image-drawn",{tiledImage:s,tiles:o})}_raiseDrawerErrorEvent(s,o){this.viewer&&this.viewer.raiseEvent("drawer-error",{tiledImage:s,drawer:this,error:o})}}}(e),function(t){const i=t;class n extends i.DrawerBase{constructor(o){super(o),this.viewer.rejectEventHandler("tile-drawing","The HTMLDrawer does not raise the tile-drawing event"),this.viewer.allowEventHandler("tile-drawn")}static isSupported(){return!0}getType(){return"html"}minimumOverlapRequired(o){return!0}_createDrawingElement(){return t.makeNeutralElement("div")}draw(o){var l=this;this._prepareNewFrame(),o.forEach(function(u){u.opacity!==0&&l._drawTiles(u)})}canRotate(){return!1}destroy(){this.container.removeChild(this.canvas)}setImageSmoothingEnabled(){}_prepareNewFrame(){this.canvas.innerHTML=""}_drawTiles(o){var l=o.getTilesToDraw().map(d=>d.tile);if(!(o.opacity===0||l.length===0&&!o.placeholderFillStyle))for(var u=l.length-1;u>=0;u--){var c=l[u];this._drawTile(c),this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:o,tile:c})}}_drawTile(o){t.console.assert(o,"[Drawer._drawTile] tile is required");let l=this.canvas;if(!o.cacheImageRecord){t.console.warn("[Drawer._drawTileToHTML] attempting to draw tile %s when it's not cached",o.toString());return}if(!o.loaded){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",o.toString());return}if(!o.element){var u=o.getImage();if(!u)return;o.element=t.makeNeutralElement("div"),o.imgElement=u.cloneNode(),o.imgElement.style.msInterpolationMode="nearest-neighbor",o.imgElement.style.width="100%",o.imgElement.style.height="100%",o.style=o.element.style,o.style.position="absolute"}o.element.parentNode!==l&&l.appendChild(o.element),o.imgElement.parentNode!==o.element&&o.element.appendChild(o.imgElement),o.style.top=o.position.y+"px",o.style.left=o.position.x+"px",o.style.height=o.size.y+"px",o.style.width=o.size.x+"px",o.flipped&&(o.style.transform="scaleX(-1)"),t.setElementOpacity(o.element,o.opacity)}}t.HTMLDrawer=n}(e),function(t){const i=t;class n extends i.DrawerBase{constructor(d){super(d),this.context=this.canvas.getContext("2d"),this.sketchCanvas=null,this.sketchContext=null,this._imageSmoothingEnabled=!0,this.viewer.allowEventHandler("tile-drawn"),this.viewer.allowEventHandler("tile-drawing")}static isSupported(){return t.supportsCanvas}getType(){return"canvas"}_createDrawingElement(){let d=t.makeNeutralElement("canvas"),p=this._calculateCanvasSize();return d.width=p.x,d.height=p.y,d}draw(d){this._prepareNewFrame(),this.viewer.viewport.getFlip()!==this._viewportFlipped&&this._flip();for(const p of d)p.opacity!==0&&this._drawTiles(p)}canRotate(){return!0}destroy(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null,this.container.removeChild(this.canvas)}minimumOverlapRequired(d){return!0}setImageSmoothingEnabled(d){this._imageSmoothingEnabled=!!d,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw()}drawDebuggingRect(d){var p=this.context;p.save(),p.lineWidth=2*t.pixelDensityRatio,p.strokeStyle=this.debugGridColor[0],p.fillStyle=this.debugGridColor[0],p.strokeRect(d.x*t.pixelDensityRatio,d.y*t.pixelDensityRatio,d.width*t.pixelDensityRatio,d.height*t.pixelDensityRatio),p.restore()}get _viewportFlipped(){return this.context.getTransform().a<0}_raiseTileDrawingEvent(d,p,m,y){this.viewer.raiseEvent("tile-drawing",{tiledImage:d,context:p,tile:m,rendered:y})}_prepareNewFrame(){var d=this._calculateCanvasSize();if((this.canvas.width!==d.x||this.canvas.height!==d.y)&&(this.canvas.width=d.x,this.canvas.height=d.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var p=this._calculateSketchCanvasSize();this.sketchCanvas.width=p.x,this.sketchCanvas.height=p.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}_clear(d,p){var m=this._getContext(d);if(p)m.clearRect(p.x,p.y,p.width,p.height);else{var y=m.canvas;m.clearRect(0,0,y.width,y.height)}}_drawTiles(d){var p=d.getTilesToDraw().map(H=>H.tile);if(!(d.opacity===0||p.length===0&&!d.placeholderFillStyle)){var m=p[0],y;m&&(y=d.opacity<1||d.compositeOperation&&d.compositeOperation!=="source-over"||!d._isBottomItem()&&d.source.hasTransparency(m.context2D,m.getUrl(),m.ajaxHeaders,m.postData));var v,_,T=this.viewport.getZoom(!0),E=d.viewportToImageZoom(T);p.length>1&&E>d.smoothTileEdgesMinZoom&&!d.iOSDevice&&d.getRotation(!0)%360===0&&(y=!0,v=m.getScaleForEdgeSmoothing(),_=m.getTranslationForEdgeSmoothing(v,this._getCanvasSize(!1),this._getCanvasSize(!0)));var S;y&&(v||(S=this.viewport.viewportToViewerElementRectangle(d.getClippedBounds(!0)).getIntegerBoundingBox(),S=S.times(t.pixelDensityRatio)),this._clear(!0,S)),v||this._setRotations(d,y);var A=!1;if(d._clip){this._saveContext(y);var P=d.imageToViewportRectangle(d._clip,!0);P=P.rotate(-d.getRotation(!0),d._getRotationPoint(!0));var D=this.viewportToDrawerRectangle(P);v&&(D=D.times(v)),_&&(D=D.translate(_)),this._setClip(D,y),A=!0}if(d._croppingPolygons){var k=this;A||this._saveContext(y);try{var U=d._croppingPolygons.map(function(H){return H.map(function(F){var G=d.imageToViewportCoordinates(F.x,F.y,!0).rotate(-d.getRotation(!0),d._getRotationPoint(!0)),$=k.viewportCoordToDrawerCoord(G);return v&&($=$.times(v)),_&&($=$.plus(_)),$})});this._clipWithPolygons(U,y)}catch(H){t.console.error(H)}A=!0}if(d._hasOpaqueTile=!1,d.placeholderFillStyle&&d._hasOpaqueTile===!1){let H=this.viewportToDrawerRectangle(d.getBoundsNoRotate(!0));v&&(H=H.times(v)),_&&(H=H.translate(_));let F=null;typeof d.placeholderFillStyle=="function"?F=d.placeholderFillStyle(d,this.context):F=d.placeholderFillStyle,this._drawRectangle(H,F,y)}var j=u(d.subPixelRoundingForTransparency),q=!1;if(j===t.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS)q=!0;else if(j===t.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST){var ee=this.viewer&&this.viewer.isAnimating();q=!ee}for(var pe=0;pe<p.length;pe++)m=p[pe],this._drawTile(m,d,y,v,_,q,d.source),this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:d,tile:m});A&&this._restoreContext(y),v||(d.getRotation(!0)%360!==0&&this._restoreRotationChanges(y),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(y)),y&&(v&&this._setRotations(d),this.blendSketch({opacity:d.opacity,scale:v,translate:_,compositeOperation:d.compositeOperation,bounds:S}),v&&(d.getRotation(!0)%360!==0&&this._restoreRotationChanges(!1),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(!1))),this._drawDebugInfo(d,p),this._raiseTiledImageDrawnEvent(d,p)}}_drawDebugInfo(d,p){if(d.debugMode)for(var m=p.length-1;m>=0;m--){var y=p[m];try{this._drawDebugInfoOnTile(y,p.length,m,d)}catch(v){t.console.error(v)}}}_clipWithPolygons(d,p){var m=this._getContext(p);m.beginPath();for(const y of d)for(const[v,_]of y.entries())m[v===0?"moveTo":"lineTo"](_.x,_.y);m.clip()}_drawTile(d,p,m,y,v,_,T){t.console.assert(d,"[Drawer._drawTile] tile is required"),t.console.assert(p,"[Drawer._drawTile] drawingHandler is required");var E=this._getContext(m);y=y||1,this._drawTileToCanvas(d,E,p,y,v,_,T)}_drawTileToCanvas(d,p,m,y,v,_,T){var E=d.position.times(t.pixelDensityRatio),S=d.size.times(t.pixelDensityRatio),A;if(!d.context2D&&!d.cacheImageRecord){t.console.warn("[Drawer._drawTileToCanvas] attempting to draw tile %s when it's not cached",d.toString());return}if(A=d.getCanvasContext(),!d.loaded||!A){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",d.toString());return}p.save(),typeof y=="number"&&y!==1&&(E=E.times(y),S=S.times(y)),v instanceof t.Point&&(E=E.plus(v)),p.globalAlpha===1&&d.hasTransparency&&(_&&(E.x=Math.round(E.x),E.y=Math.round(E.y),S.x=Math.round(S.x),S.y=Math.round(S.y)),p.clearRect(E.x,E.y,S.x,S.y)),this._raiseTileDrawingEvent(m,p,d,A);var P,D;d.sourceBounds?(P=Math.min(d.sourceBounds.width,A.canvas.width),D=Math.min(d.sourceBounds.height,A.canvas.height)):(P=A.canvas.width,D=A.canvas.height),p.translate(E.x+S.x/2,0),d.flipped&&p.scale(-1,1),p.drawImage(A.canvas,0,0,P,D,-S.x/2,E.y,S.x,S.y),p.restore()}_getContext(d){var p=this.context;if(d){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var m=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=m.x,this.sketchCanvas.height=m.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var y=this;this.viewer.addHandler("rotate",function v(){if(y.viewport.getRotation()!==0){y.viewer.removeHandler("rotate",v);var _=y._calculateSketchCanvasSize();y.sketchCanvas.width=_.x,y.sketchCanvas.height=_.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}p=this.sketchContext}return p}_saveContext(d){this._getContext(d).save()}_restoreContext(d){this._getContext(d).restore()}_setClip(d,p){var m=this._getContext(p);m.beginPath(),m.rect(d.x,d.y,d.width,d.height),m.clip()}_drawRectangle(d,p,m){var y=this._getContext(m);y.save(),y.fillStyle=p,y.fillRect(d.x,d.y,d.width,d.height),y.restore()}blendSketch(d,p,m,y){var v=d;t.isPlainObject(v)||(v={opacity:d,scale:p,translate:m,compositeOperation:y}),d=v.opacity,y=v.compositeOperation;var _=v.bounds;if(this.context.save(),this.context.globalAlpha=d,y&&(this.context.globalCompositeOperation=y),_)_.x<0&&(_.width+=_.x,_.x=0),_.x+_.width>this.canvas.width&&(_.width=this.canvas.width-_.x),_.y<0&&(_.height+=_.y,_.y=0),_.y+_.height>this.canvas.height&&(_.height=this.canvas.height-_.y),this.context.drawImage(this.sketchCanvas,_.x,_.y,_.width,_.height,_.x,_.y,_.width,_.height);else{p=v.scale||1,m=v.translate;var T=m instanceof t.Point?m:new t.Point(0,0),E=0,S=0;if(m){var A=this.sketchCanvas.width-this.canvas.width,P=this.sketchCanvas.height-this.canvas.height;E=Math.round(A/2),S=Math.round(P/2)}this.context.drawImage(this.sketchCanvas,T.x-E*p,T.y-S*p,(this.canvas.width+2*E)*p,(this.canvas.height+2*S)*p,-E,-S,this.canvas.width+2*E,this.canvas.height+2*S)}this.context.restore()}_drawDebugInfoOnTile(d,p,m,y){var v=this.viewer.world.getIndexOfItem(y)%this.debugGridColor.length,_=this.context;_.save(),_.lineWidth=2*t.pixelDensityRatio,_.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",_.strokeStyle=this.debugGridColor[v],_.fillStyle=this.debugGridColor[v],this._setRotations(y),this._viewportFlipped&&this._flip({point:d.position.plus(d.size.divide(2))}),_.strokeRect(d.position.x*t.pixelDensityRatio,d.position.y*t.pixelDensityRatio,d.size.x*t.pixelDensityRatio,d.size.y*t.pixelDensityRatio);var T=(d.position.x+d.size.x/2)*t.pixelDensityRatio,E=(d.position.y+d.size.y/2)*t.pixelDensityRatio;_.translate(T,E);const S=this.viewport.getRotation(!0);_.rotate(Math.PI/180*-S),_.translate(-T,-E),d.x===0&&d.y===0&&(_.fillText("Zoom: "+this.viewport.getZoom(),d.position.x*t.pixelDensityRatio,(d.position.y-30)*t.pixelDensityRatio),_.fillText("Pan: "+this.viewport.getBounds().toString(),d.position.x*t.pixelDensityRatio,(d.position.y-20)*t.pixelDensityRatio)),_.fillText("Level: "+d.level,(d.position.x+10)*t.pixelDensityRatio,(d.position.y+20)*t.pixelDensityRatio),_.fillText("Column: "+d.x,(d.position.x+10)*t.pixelDensityRatio,(d.position.y+30)*t.pixelDensityRatio),_.fillText("Row: "+d.y,(d.position.x+10)*t.pixelDensityRatio,(d.position.y+40)*t.pixelDensityRatio),_.fillText("Order: "+m+" of "+p,(d.position.x+10)*t.pixelDensityRatio,(d.position.y+50)*t.pixelDensityRatio),_.fillText("Size: "+d.size.toString(),(d.position.x+10)*t.pixelDensityRatio,(d.position.y+60)*t.pixelDensityRatio),_.fillText("Position: "+d.position.toString(),(d.position.x+10)*t.pixelDensityRatio,(d.position.y+70)*t.pixelDensityRatio),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(),y.getRotation(!0)%360!==0&&this._restoreRotationChanges(),_.restore()}_updateImageSmoothingEnabled(d){d.msImageSmoothingEnabled=this._imageSmoothingEnabled,d.imageSmoothingEnabled=this._imageSmoothingEnabled}_getCanvasSize(d){var p=this._getContext(d).canvas;return new t.Point(p.width,p.height)}_getCanvasCenter(){return new t.Point(this.canvas.width/2,this.canvas.height/2)}_setRotations(d,p=!1){var m=!1;this.viewport.getRotation(!0)%360!==0&&(this._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:p,saveContext:m}),m=!1),d.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:d.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(d._getRotationPoint(!0),!0),useSketch:p,saveContext:m})}_offsetForRotation(d){var p=d.point?d.point.times(t.pixelDensityRatio):this._getCanvasCenter(),m=this._getContext(d.useSketch);m.save(),m.translate(p.x,p.y),m.rotate(Math.PI/180*d.degrees),m.translate(-p.x,-p.y)}_flip(d){d=d||{};var p=d.point?d.point.times(t.pixelDensityRatio):this._getCanvasCenter(),m=this._getContext(d.useSketch);m.translate(p.x,0),m.scale(-1,1),m.translate(-p.x,0)}_restoreRotationChanges(d){var p=this._getContext(d);p.restore()}_calculateCanvasSize(){var d=t.pixelDensityRatio,p=this.viewport.getContainerSize();return{x:Math.round(p.x*d),y:Math.round(p.y*d)}}_calculateSketchCanvasSize(){var d=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return d;var p=Math.ceil(Math.sqrt(d.x*d.x+d.y*d.y));return{x:p,y:p}}}t.CanvasDrawer=n;var s=t.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER;function o(c){return c!==t.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&c!==t.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&c!==t.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function l(c){return o(c)?s:c}function u(c){if(typeof c=="number")return l(c);if(!c||!t.Browser)return s;var d=c[t.Browser.vendor];return o(d)&&(d=c["*"]),l(d)}}(e),function(t){const i=t;i.WebGLDrawer=class extends i.DrawerBase{constructor(s){super(s),this._destroyed=!1,this._TextureMap=new Map,this._TileMap=new Map,this._gl=null,this._firstPass=null,this._secondPass=null,this._glFrameBuffer=null,this._renderToTexture=null,this._glFramebufferToCanvasTransform=null,this._outputCanvas=null,this._outputContext=null,this._clippingCanvas=null,this._clippingContext=null,this._renderingCanvas=null,this._backupCanvasDrawer=null,this._imageSmoothingEnabled=!0,this._boundToTileReady=o=>this._tileReadyHandler(o),this._boundToImageUnloaded=o=>this._imageUnloadedHandler(o),this.viewer.addHandler("tile-ready",this._boundToTileReady),this.viewer.addHandler("image-unloaded",this._boundToImageUnloaded),this.viewer.rejectEventHandler("tile-drawn","The WebGLDrawer does not raise the tile-drawn event"),this.viewer.rejectEventHandler("tile-drawing","The WebGLDrawer does not raise the tile-drawing event"),this._setupCanvases(),this._setupRenderer(),this.context=this._outputContext}destroy(){if(this._destroyed)return;let s=this._gl;var o=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS);for(let u=0;u<o;++u)s.activeTexture(s.TEXTURE0+u),s.bindTexture(s.TEXTURE_2D,null),s.bindTexture(s.TEXTURE_CUBE_MAP,null);s.bindBuffer(s.ARRAY_BUFFER,null),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null),s.bindRenderbuffer(s.RENDERBUFFER,null),s.bindFramebuffer(s.FRAMEBUFFER,null),this._unloadTextures(),s.deleteBuffer(this._secondPass.bufferOutputPosition),s.deleteFramebuffer(this._glFrameBuffer),this._renderingCanvas.width=this._renderingCanvas.height=1,this._clippingCanvas.width=this._clippingCanvas.height=1,this._outputCanvas.width=this._outputCanvas.height=1,this._renderingCanvas=null,this._clippingCanvas=this._clippingContext=null,this._outputCanvas=this._outputContext=null;let l=s.getExtension("WEBGL_lose_context");l&&l.loseContext(),this.viewer.removeHandler("tile-ready",this._boundToTileReady),this.viewer.removeHandler("image-unloaded",this._boundToImageUnloaded),this.viewer.removeHandler("resize",this._resizeHandler),this._gl=null,this._backupCanvasDrawer&&(this._backupCanvasDrawer.destroy(),this._backupCanvasDrawer=null),this.container.removeChild(this.canvas),this.viewer.drawer===this&&(this.viewer.drawer=null),this._destroyed=!0}canRotate(){return!0}static isSupported(){let s=document.createElement("canvas"),o=t.isFunction(s.getContext)&&s.getContext("webgl"),l=o&&o.getExtension("WEBGL_lose_context");return l&&l.loseContext(),!!o}getType(){return"webgl"}minimumOverlapRequired(s){return s.isTainted()}_createDrawingElement(){let s=t.makeNeutralElement("canvas"),o=this._calculateCanvasSize();return s.width=o.x,s.height=o.y,s}_getBackupCanvasDrawer(){return this._backupCanvasDrawer||(this._backupCanvasDrawer=this.viewer.requestDrawer("canvas",{mainDrawer:!1}),this._backupCanvasDrawer.canvas.style.setProperty("visibility","hidden")),this._backupCanvasDrawer}draw(s){let o=this._gl;const l=this.viewport.getBoundsNoRotateWithMargins(!0);let u={bounds:l,center:new i.Point(l.x+l.width/2,l.y+l.height/2),rotation:this.viewport.getRotation(!0)*Math.PI/180},c=this.viewport.flipped?-1:1,d=t.Mat3.makeTranslation(-u.center.x,-u.center.y),p=t.Mat3.makeScaling(2/u.bounds.width*c,-2/u.bounds.height),m=t.Mat3.makeRotation(-u.rotation),y=p.multiply(m).multiply(d);o.bindFramebuffer(o.FRAMEBUFFER,null),o.clear(o.COLOR_BUFFER_BIT),this._outputContext.clearRect(0,0,this._outputCanvas.width,this._outputCanvas.height);let v=!1;s.forEach((_,T)=>{if(_.isTainted()){v&&(this._outputContext.drawImage(this._renderingCanvas,0,0),o.bindFramebuffer(o.FRAMEBUFFER,null),o.clear(o.COLOR_BUFFER_BIT),v=!1);const E=this._getBackupCanvasDrawer();E.draw([_]),this._outputContext.drawImage(E.canvas,0,0)}else{let E=_.getTilesToDraw();if(_.placeholderFillStyle&&_._hasOpaqueTile===!1&&this._drawPlaceholder(_),E.length===0||_.getOpacity()===0)return;let S=E[0],A=_.compositeOperation||this.viewer.compositeOperation||_._clip||_._croppingPolygons||_.debugMode,P=A||_.opacity<1||S.hasTransparency;A&&(v&&this._outputContext.drawImage(this._renderingCanvas,0,0),o.bindFramebuffer(o.FRAMEBUFFER,null),o.clear(o.COLOR_BUFFER_BIT)),o.useProgram(this._firstPass.shaderProgram),P?(o.bindFramebuffer(o.FRAMEBUFFER,this._glFrameBuffer),o.clear(o.COLOR_BUFFER_BIT)):o.bindFramebuffer(o.FRAMEBUFFER,null);let D=y,k=_.getRotation(!0);if(k%360!==0){let H=t.Mat3.makeRotation(-k*Math.PI/180),F=_.getBoundsNoRotate(!0).getCenter(),G=t.Mat3.makeTranslation(F.x,F.y),$=t.Mat3.makeTranslation(-F.x,-F.y),le=G.multiply(H).multiply($);D=y.multiply(le)}let U=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS);if(U<=0)throw new Error(`WegGL error: bad value for gl parameter MAX_TEXTURE_IMAGE_UNITS (${U}). This could happen
                        if too many contexts have been created and not released, or there is another problem with the graphics card.`);let j=new Float32Array(U*12),q=new Array(U),ee=new Array(U),pe=new Array(U);for(let H=0;H<E.length;H++){let F=E[H].tile,G=H%U,$=G+1,le=F.getCanvasContext(),ie=le?this._TextureMap.get(le.canvas):null;if(ie||(this._tileReadyHandler({tile:F,tiledImage:_}),ie=le?this._TextureMap.get(le.canvas):null),ie&&this._getTileData(F,_,ie,D,G,j,q,ee,pe),$===U||H===E.length-1){for(let Y=0;Y<=$;Y++)o.activeTexture(o.TEXTURE0+Y),o.bindTexture(o.TEXTURE_2D,q[Y]);o.bindBuffer(o.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),o.bufferData(o.ARRAY_BUFFER,j,o.DYNAMIC_DRAW),ee.forEach((Y,de)=>{o.uniformMatrix3fv(this._firstPass.uTransformMatrices[de],!1,Y)}),o.uniform1fv(this._firstPass.uOpacities,new Float32Array(pe)),o.bindBuffer(o.ARRAY_BUFFER,this._firstPass.bufferOutputPosition),o.vertexAttribPointer(this._firstPass.aOutputPosition,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),o.vertexAttribPointer(this._firstPass.aTexturePosition,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._firstPass.bufferIndex),o.vertexAttribPointer(this._firstPass.aIndex,1,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLES,0,6*$)}}P&&(o.useProgram(this._secondPass.shaderProgram),o.bindFramebuffer(o.FRAMEBUFFER,null),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this._renderToTexture),this._gl.uniform1f(this._secondPass.uOpacityMultiplier,_.opacity),o.bindBuffer(o.ARRAY_BUFFER,this._secondPass.bufferTexturePosition),o.vertexAttribPointer(this._secondPass.aTexturePosition,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._secondPass.bufferOutputPosition),o.vertexAttribPointer(this._secondPass.aOutputPosition,2,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLES,0,6)),v=!0,A&&(this._applyContext2dPipeline(_,E,T),v=!1,o.bindFramebuffer(o.FRAMEBUFFER,null),o.clear(o.COLOR_BUFFER_BIT)),T===0&&this._raiseTiledImageDrawnEvent(_,E.map(H=>H.tile))}}),v&&this._outputContext.drawImage(this._renderingCanvas,0,0)}setImageSmoothingEnabled(s){this._imageSmoothingEnabled!==s&&(this._imageSmoothingEnabled=s,this._unloadTextures(),this.viewer.world.draw())}drawDebuggingRect(s){let o=this._outputContext;o.save(),o.lineWidth=2*t.pixelDensityRatio,o.strokeStyle=this.debugGridColor[0],o.fillStyle=this.debugGridColor[0],o.strokeRect(s.x*t.pixelDensityRatio,s.y*t.pixelDensityRatio,s.width*t.pixelDensityRatio,s.height*t.pixelDensityRatio),o.restore()}_getTextureDataFromTile(s){return s.getCanvasContext().canvas}_applyContext2dPipeline(s,o,l){if(this._outputContext.save(),this._outputContext.globalCompositeOperation=l===0?null:s.compositeOperation||this.viewer.compositeOperation,s._croppingPolygons||s._clip?(this._renderToClippingCanvas(s),this._outputContext.drawImage(this._clippingCanvas,0,0)):this._outputContext.drawImage(this._renderingCanvas,0,0),this._outputContext.restore(),s.debugMode){const u=this.viewer.viewport.getFlip();u&&this._flip(),this._drawDebugInfo(o,s,u),u&&this._flip()}}_getTileData(s,o,l,u,c,d,p,m,y){let v=l.texture,_=l.position;d.set(_,c*12);let T=this._calculateOverlapFraction(s,o),E=s.positionedBounds.width*T.x,S=s.positionedBounds.height*T.y,A=s.positionedBounds.x+(s.x===0?0:E),P=s.positionedBounds.y+(s.y===0?0:S),D=s.positionedBounds.x+s.positionedBounds.width-(s.isRightMost?0:E),k=s.positionedBounds.y+s.positionedBounds.height-(s.isBottomMost?0:S),U=D-A,j=k-P,q=new t.Mat3([U,0,0,0,j,0,A,P,1]);if(s.flipped){let pe=t.Mat3.makeTranslation(.5,0),H=t.Mat3.makeTranslation(-.5,0),F=pe.multiply(t.Mat3.makeScaling(-1,1)).multiply(H);q=q.multiply(F)}let ee=u.multiply(q);y[c]=s.opacity,p[c]=v,m[c]=ee.values}_textureFilter(){return this._imageSmoothingEnabled?this._gl.LINEAR:this._gl.NEAREST}_setupRenderer(){let s=this._gl;s||t.console.error("_setupCanvases must be called before _setupRenderer"),this._unitQuad=this._makeQuadVertexBuffer(0,1,0,1),this._makeFirstPassShaderProgram(),this._makeSecondPassShaderProgram(),this._renderToTexture=s.createTexture(),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this._renderToTexture),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this._renderingCanvas.width,this._renderingCanvas.height,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this._textureFilter()),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),this._glFrameBuffer=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,this._glFrameBuffer),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this._renderToTexture,0),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA)}_makeFirstPassShaderProgram(){let s=this._glNumTextures=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),o=()=>[...Array(s).keys()].map(v=>`uniform mat3 u_matrix_${v};`).join(`
`),l=()=>[...Array(s).keys()].map(v=>`${v>0?"else ":""}if(int(a_index) == ${v}) { transform_matrix = u_matrix_${v}; }`).join(`
`);const u=`
            attribute vec2 a_output_position;
            attribute vec2 a_texture_position;
            attribute float a_index;

            ${o()} // create a uniform mat3 for each potential tile to draw

            varying vec2 v_texture_position;
            varying float v_image_index;

            void main() {

                mat3 transform_matrix; // value will be set by the if/elses in makeConditional()

                ${l()}

                gl_Position = vec4(transform_matrix * vec3(a_output_position, 1), 1);

                v_texture_position = a_texture_position;
                v_image_index = a_index;
            }
            `,c=`
            precision mediump float;

            // our textures
            uniform sampler2D u_images[${s}];
            // our opacities
            uniform float u_opacities[${s}];

            // the varyings passed in from the vertex shader.
            varying vec2 v_texture_position;
            varying float v_image_index;

            void main() {
                // can't index directly with a variable, need to use a loop iterator hack
                for(int i = 0; i < ${s}; ++i){
                    if(i == int(v_image_index)){
                        gl_FragColor = texture2D(u_images[i], v_texture_position) * u_opacities[i];
                    }
                }
            }
            `;let d=this._gl,p=this.constructor.initShaderProgram(d,u,c);d.useProgram(p),this._firstPass={shaderProgram:p,aOutputPosition:d.getAttribLocation(p,"a_output_position"),aTexturePosition:d.getAttribLocation(p,"a_texture_position"),aIndex:d.getAttribLocation(p,"a_index"),uTransformMatrices:[...Array(this._glNumTextures).keys()].map(v=>d.getUniformLocation(p,`u_matrix_${v}`)),uImages:d.getUniformLocation(p,"u_images"),uOpacities:d.getUniformLocation(p,"u_opacities"),bufferOutputPosition:d.createBuffer(),bufferTexturePosition:d.createBuffer(),bufferIndex:d.createBuffer()},d.uniform1iv(this._firstPass.uImages,[...Array(s).keys()]);let m=new Float32Array(s*12);for(let v=0;v<s;++v)m.set(Float32Array.from(this._unitQuad),v*12);d.bindBuffer(d.ARRAY_BUFFER,this._firstPass.bufferOutputPosition),d.bufferData(d.ARRAY_BUFFER,m,d.STATIC_DRAW),d.enableVertexAttribArray(this._firstPass.aOutputPosition),d.bindBuffer(d.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),d.enableVertexAttribArray(this._firstPass.aTexturePosition),d.bindBuffer(d.ARRAY_BUFFER,this._firstPass.bufferIndex);let y=[...Array(this._glNumTextures).keys()].map(v=>Array(6).fill(v)).flat();d.bufferData(d.ARRAY_BUFFER,new Float32Array(y),d.STATIC_DRAW),d.enableVertexAttribArray(this._firstPass.aIndex)}_makeSecondPassShaderProgram(){const s=`
            attribute vec2 a_output_position;
            attribute vec2 a_texture_position;

            uniform mat3 u_matrix;

            varying vec2 v_texture_position;

            void main() {
                gl_Position = vec4(u_matrix * vec3(a_output_position, 1), 1);

                v_texture_position = a_texture_position;
            }
            `,o=`
            precision mediump float;

            // our texture
            uniform sampler2D u_image;

            // the texCoords passed in from the vertex shader.
            varying vec2 v_texture_position;

            // the opacity multiplier for the image
            uniform float u_opacity_multiplier;

            void main() {
                gl_FragColor = texture2D(u_image, v_texture_position);
                gl_FragColor *= u_opacity_multiplier;
            }
            `;let l=this._gl,u=this.constructor.initShaderProgram(l,s,o);l.useProgram(u),this._secondPass={shaderProgram:u,aOutputPosition:l.getAttribLocation(u,"a_output_position"),aTexturePosition:l.getAttribLocation(u,"a_texture_position"),uMatrix:l.getUniformLocation(u,"u_matrix"),uImage:l.getUniformLocation(u,"u_image"),uOpacityMultiplier:l.getUniformLocation(u,"u_opacity_multiplier"),bufferOutputPosition:l.createBuffer(),bufferTexturePosition:l.createBuffer()},l.bindBuffer(l.ARRAY_BUFFER,this._secondPass.bufferOutputPosition),l.bufferData(l.ARRAY_BUFFER,this._unitQuad,l.STATIC_DRAW),l.enableVertexAttribArray(this._secondPass.aOutputPosition),l.bindBuffer(l.ARRAY_BUFFER,this._secondPass.bufferTexturePosition),l.bufferData(l.ARRAY_BUFFER,this._unitQuad,l.DYNAMIC_DRAW),l.enableVertexAttribArray(this._secondPass.aTexturePosition);let c=t.Mat3.makeScaling(2,2).multiply(t.Mat3.makeTranslation(-.5,-.5));l.uniformMatrix3fv(this._secondPass.uMatrix,!1,c.values)}_resizeRenderer(){let s=this._gl,o=this._renderingCanvas.width,l=this._renderingCanvas.height;s.viewport(0,0,o,l),s.deleteTexture(this._renderToTexture),this._renderToTexture=s.createTexture(),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this._renderToTexture),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,o,l,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this._textureFilter()),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindFramebuffer(s.FRAMEBUFFER,this._glFrameBuffer),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this._renderToTexture,0)}_setupCanvases(){let s=this;this._outputCanvas=this.canvas,this._outputContext=this._outputCanvas.getContext("2d"),this._renderingCanvas=document.createElement("canvas"),this._clippingCanvas=document.createElement("canvas"),this._clippingContext=this._clippingCanvas.getContext("2d"),this._renderingCanvas.width=this._clippingCanvas.width=this._outputCanvas.width,this._renderingCanvas.height=this._clippingCanvas.height=this._outputCanvas.height,this._gl=this._renderingCanvas.getContext("webgl"),this._resizeHandler=function(){s._outputCanvas!==s.viewer.drawer.canvas&&(s._outputCanvas.style.width=s.viewer.drawer.canvas.clientWidth+"px",s._outputCanvas.style.height=s.viewer.drawer.canvas.clientHeight+"px");let o=s._calculateCanvasSize();(s._outputCanvas.width!==o.x||s._outputCanvas.height!==o.y)&&(s._outputCanvas.width=o.x,s._outputCanvas.height=o.y),s._renderingCanvas.style.width=s._outputCanvas.clientWidth+"px",s._renderingCanvas.style.height=s._outputCanvas.clientHeight+"px",s._renderingCanvas.width=s._clippingCanvas.width=s._outputCanvas.width,s._renderingCanvas.height=s._clippingCanvas.height=s._outputCanvas.height,s._resizeRenderer()},this.viewer.addHandler("resize",this._resizeHandler)}_makeQuadVertexBuffer(s,o,l,u){return new Float32Array([s,u,o,u,s,l,s,l,o,u,o,l])}_tileReadyHandler(s){let o=s.tile,l=s.tiledImage;if(l.isTainted())return;let u=o.getCanvasContext(),c=u&&u.canvas;if(!c||t.isCanvasTainted(c)){l.isTainted()||(l.setTainted(!0),t.console.warn("WebGL cannot be used to draw this TiledImage because it has tainted data. Does crossOriginPolicy need to be set?"),this._raiseDrawerErrorEvent(l,"Tainted data cannot be used by the WebGLDrawer. Falling back to CanvasDrawer for this TiledImage."));return}if(!this._TextureMap.get(c)){let p=this._gl,m=p.createTexture(),y,v=l.source.tileOverlap,_,T;if(o.sourceBounds?(_=Math.min(o.sourceBounds.width,c.width)/c.width,T=Math.min(o.sourceBounds.height,c.height)/c.height):(_=1,T=1),v>0){let S=this._calculateOverlapFraction(o,l),A=(o.x===0?0:S.x)*_,P=(o.y===0?0:S.y)*T,D=(o.isRightMost?1:1-S.x)*_,k=(o.isBottomMost?1:1-S.y)*T;y=this._makeQuadVertexBuffer(A,D,P,k)}else _===1&&T===1?y=this._unitQuad:y=this._makeQuadVertexBuffer(0,_,0,T);let E={texture:m,position:y};this._TextureMap.set(c,E),p.activeTexture(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,m),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this._textureFilter()),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,this._textureFilter()),this._uploadImageData(u)}}_calculateOverlapFraction(s,o){let l=o.source.tileOverlap,u=s.sourceBounds.width,c=s.sourceBounds.height,d=(s.x===0?0:l)+(s.isRightMost?0:l),p=(s.y===0?0:l)+(s.isBottomMost?0:l),m=l/(u+d),y=l/(c+p);return{x:m,y}}_unloadTextures(){Array.from(this._TextureMap.keys()).forEach(o=>{this._cleanupImageData(o)})}_uploadImageData(s){let o=this._gl,l=s.canvas;try{if(!l)throw s;o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,l)}catch(u){t.console.error("Error uploading image data to WebGL",u)}}_imageUnloadedHandler(s){let o=s.context2D.canvas;this._cleanupImageData(o)}_cleanupImageData(s){let o=this._TextureMap.get(s);this._TextureMap.delete(s),o&&this._gl.deleteTexture(o.texture)}_setClip(){}_renderToClippingCanvas(s){if(this._clippingContext.clearRect(0,0,this._clippingCanvas.width,this._clippingCanvas.height),this._clippingContext.save(),this.viewer.viewport.getFlip()){const o=new t.Point(this.canvas.width/2,this.canvas.height/2);this._clippingContext.translate(o.x,0),this._clippingContext.scale(-1,1),this._clippingContext.translate(-o.x,0)}if(s._clip){let l=[{x:s._clip.x,y:s._clip.y},{x:s._clip.x+s._clip.width,y:s._clip.y},{x:s._clip.x+s._clip.width,y:s._clip.y+s._clip.height},{x:s._clip.x,y:s._clip.y+s._clip.height}].map(u=>{let c=s.imageToViewportCoordinates(u.x,u.y,!0).rotate(this.viewer.viewport.getRotation(!0),this.viewer.viewport.getCenter(!0));return this.viewportCoordToDrawerCoord(c)});this._clippingContext.beginPath(),l.forEach((u,c)=>{this._clippingContext[c===0?"moveTo":"lineTo"](u.x,u.y)}),this._clippingContext.clip(),this._setClip()}if(s._croppingPolygons){let o=s._croppingPolygons.map(l=>l.map(u=>{let c=s.imageToViewportCoordinates(u.x,u.y,!0).rotate(this.viewer.viewport.getRotation(!0),this.viewer.viewport.getCenter(!0));return this.viewportCoordToDrawerCoord(c)}));this._clippingContext.beginPath(),o.forEach(l=>{l.forEach((u,c)=>{this._clippingContext[c===0?"moveTo":"lineTo"](u.x,u.y)})}),this._clippingContext.clip()}if(this.viewer.viewport.getFlip()){const o=new t.Point(this.canvas.width/2,this.canvas.height/2);this._clippingContext.translate(o.x,0),this._clippingContext.scale(-1,1),this._clippingContext.translate(-o.x,0)}this._clippingContext.drawImage(this._renderingCanvas,0,0),this._clippingContext.restore()}_setRotations(s){var o=!1;this.viewport.getRotation(!0)%360!==0&&(this._offsetForRotation({degrees:this.viewport.getRotation(!0),saveContext:o}),o=!1),s.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:s.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(s._getRotationPoint(!0),!0),saveContext:o})}_offsetForRotation(s){var o=s.point?s.point.times(t.pixelDensityRatio):this._getCanvasCenter(),l=this._outputContext;l.save(),l.translate(o.x,o.y),l.rotate(Math.PI/180*s.degrees),l.translate(-o.x,-o.y)}_flip(s){s=s||{};var o=s.point?s.point.times(t.pixelDensityRatio):this._getCanvasCenter(),l=this._outputContext;l.translate(o.x,0),l.scale(-1,1),l.translate(-o.x,0)}_drawDebugInfo(s,o,l){for(var u=s.length-1;u>=0;u--){var c=s[u].tile;try{this._drawDebugInfoOnTile(c,s.length,u,o,l)}catch(d){t.console.error(d)}}}_drawDebugInfoOnTile(s,o,l,u,c){var d=this.viewer.world.getIndexOfItem(u)%this.debugGridColor.length,p=this.context;p.save(),p.lineWidth=2*t.pixelDensityRatio,p.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",p.strokeStyle=this.debugGridColor[d],p.fillStyle=this.debugGridColor[d],this._setRotations(u),c&&this._flip({point:s.position.plus(s.size.divide(2))}),p.strokeRect(s.position.x*t.pixelDensityRatio,s.position.y*t.pixelDensityRatio,s.size.x*t.pixelDensityRatio,s.size.y*t.pixelDensityRatio);var m=(s.position.x+s.size.x/2)*t.pixelDensityRatio,y=(s.position.y+s.size.y/2)*t.pixelDensityRatio;p.translate(m,y);const v=this.viewport.getRotation(!0);p.rotate(Math.PI/180*-v),p.translate(-m,-y),s.x===0&&s.y===0&&(p.fillText("Zoom: "+this.viewport.getZoom(),s.position.x*t.pixelDensityRatio,(s.position.y-30)*t.pixelDensityRatio),p.fillText("Pan: "+this.viewport.getBounds().toString(),s.position.x*t.pixelDensityRatio,(s.position.y-20)*t.pixelDensityRatio)),p.fillText("Level: "+s.level,(s.position.x+10)*t.pixelDensityRatio,(s.position.y+20)*t.pixelDensityRatio),p.fillText("Column: "+s.x,(s.position.x+10)*t.pixelDensityRatio,(s.position.y+30)*t.pixelDensityRatio),p.fillText("Row: "+s.y,(s.position.x+10)*t.pixelDensityRatio,(s.position.y+40)*t.pixelDensityRatio),p.fillText("Order: "+l+" of "+o,(s.position.x+10)*t.pixelDensityRatio,(s.position.y+50)*t.pixelDensityRatio),p.fillText("Size: "+s.size.toString(),(s.position.x+10)*t.pixelDensityRatio,(s.position.y+60)*t.pixelDensityRatio),p.fillText("Position: "+s.position.toString(),(s.position.x+10)*t.pixelDensityRatio,(s.position.y+70)*t.pixelDensityRatio),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(),u.getRotation(!0)%360!==0&&this._restoreRotationChanges(),p.restore()}_drawPlaceholder(s){const o=s.getBounds(!0),l=this.viewportToDrawerRectangle(s.getBounds(!0)),u=this._outputContext;let c;typeof s.placeholderFillStyle=="function"?c=s.placeholderFillStyle(s,u):c=s.placeholderFillStyle,this._offsetForRotation({degrees:this.viewer.viewport.getRotation(!0)}),u.fillStyle=c,u.translate(l.x,l.y),u.rotate(Math.PI/180*o.degrees),u.translate(-l.x,-l.y),u.fillRect(l.x,l.y,l.width,l.height),this._restoreRotationChanges()}_getCanvasCenter(){return new t.Point(this.canvas.width/2,this.canvas.height/2)}_restoreRotationChanges(){var s=this._outputContext;s.restore()}static initShaderProgram(s,o,l){function u(m,y,v){const _=m.createShader(y);return m.shaderSource(_,v),m.compileShader(_),m.getShaderParameter(_,m.COMPILE_STATUS)?_:(t.console.error(`An error occurred compiling the shaders: ${m.getShaderInfoLog(_)}`),m.deleteShader(_),null)}const c=u(s,s.VERTEX_SHADER,o),d=u(s,s.FRAGMENT_SHADER,l),p=s.createProgram();return s.attachShader(p,c),s.attachShader(p,d),s.linkProgram(p),s.getProgramParameter(p,s.LINK_STATUS)?p:(t.console.error(`Unable to initialize the shader program: ${s.getProgramInfoLog(p)}`),null)}}}(e),function(t){t.Viewport=function(i){var n=arguments;n.length&&n[0]instanceof t.Point&&(i={containerSize:n[0],contentSize:n[1],config:n[2]}),i.config&&(t.extend(!0,i,i.config),delete i.config),this._margins=t.extend({left:0,top:0,right:0,bottom:0},i.margins||{}),delete i.margins,i.initialDegrees=i.degrees,delete i.degrees,t.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,rotationPivot:null,viewer:null,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:t.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:t.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:t.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:t.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:t.DEFAULT_SETTINGS.maxZoomLevel,initialDegrees:t.DEFAULT_SETTINGS.degrees,flipped:t.DEFAULT_SETTINGS.flipped,homeFillsViewer:t.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:t.DEFAULT_SETTINGS.silenceMultiImageWarnings},i),this._updateContainerInnerSize(),this.centerSpringX=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new t.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.degreesSpring=new t.Spring({initial:i.initialDegrees,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,this._setContentBounds(new t.Rect(0,0,1,1),1),this.goHome(!0),this.update()},t.Viewport.prototype={get degrees(){return t.console.warn("Accessing [Viewport.degrees] is deprecated. Use viewport.getRotation instead."),this.getRotation()},set degrees(i){t.console.warn("Setting [Viewport.degrees] is deprecated. Use viewport.rotateTo, viewport.rotateBy, or viewport.setRotation instead."),this.rotateTo(i)},resetContentSize:function(i){return t.console.assert(i,"[Viewport.resetContentSize] contentSize is required"),t.console.assert(i instanceof t.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),t.console.assert(i.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),t.console.assert(i.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new t.Rect(0,0,1,i.y/i.x),i.x),this},setHomeBounds:function(i,n){t.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(i,n)},_setContentBounds:function(i,n){t.console.assert(i,"[Viewport._setContentBounds] bounds is required"),t.console.assert(i instanceof t.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),t.console.assert(i.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),t.console.assert(i.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=i.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(n),this._contentBounds=i.rotate(this.getRotation()).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(n),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:n,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var i=this._contentAspectRatio/this.getAspectRatio(),n;return this.homeFillsViewer?n=i>=1?i:1:n=i>=1?1:i,n/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var i=this._contentBounds.getCenter(),n=1/this.getHomeZoom(),s=n/this.getAspectRatio();return new t.Rect(i.x-n/2,i.y-s/2,n,s)},goHome:function(i){return this.viewer&&this.viewer.raiseEvent("home",{immediately:i}),this.fitBounds(this.getHomeBounds(),i)},getMinZoom:function(){var i=this.getHomeZoom(),n=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*i;return n},getMaxZoom:function(){var i=this.maxZoomLevel;return i||(i=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,i/=this._contentBounds.width),Math.max(i,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new t.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return t.extend({},this._margins)},setMargins:function(i){t.console.assert(t.type(i)==="object","[Viewport.setMargins] margins must be an object"),this._margins=t.extend({left:0,top:0,right:0,bottom:0},i),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(i){return this.getBoundsNoRotate(i).rotate(-this.getRotation(i))},getBoundsNoRotate:function(i){var n=this.getCenter(i),s=1/this.getZoom(i),o=s/this.getAspectRatio();return new t.Rect(n.x-s/2,n.y-o/2,s,o)},getBoundsWithMargins:function(i){return this.getBoundsNoRotateWithMargins(i).rotate(-this.getRotation(i),this.getCenter(i))},getBoundsNoRotateWithMargins:function(i){var n=this.getBoundsNoRotate(i),s=this._containerInnerSize.x*this.getZoom(i);return n.x-=this._margins.left/s,n.y-=this._margins.top/s,n.width+=(this._margins.left+this._margins.right)/s,n.height+=(this._margins.top+this._margins.bottom)/s,n},getCenter:function(i){var n=new t.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),s=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),o,l,u,c,d,p,m,y;return i?n:this.zoomPoint?(o=this.pixelFromPoint(this.zoomPoint,!0),l=this.getZoom(),u=1/l,c=u/this.getAspectRatio(),d=new t.Rect(n.x-u/2,n.y-c/2,u,c),p=this._pixelFromPoint(this.zoomPoint,d),m=p.minus(o).rotate(-this.getRotation(!0)),y=m.divide(this._containerInnerSize.x*l),s.plus(y)):s},getZoom:function(i){return i?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(i){return Math.max(Math.min(i,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(i){var n=this.viewportToViewerElementRectangle(i).getBoundingBox(),s=this.viewportToViewerElementRectangle(this._contentBoundsNoRotate).getBoundingBox(),o=!1,l=!1;if(!this.wrapHorizontal){var u=n.x+n.width,c=s.x+s.width,d,p,m;n.width>s.width?d=this.visibilityRatio*s.width:d=this.visibilityRatio*n.width,p=s.x-u+d,m=c-n.x-d,d>s.width?(n.x+=(p+m)/2,o=!0):m<0?(n.x+=m,o=!0):p>0&&(n.x+=p,o=!0)}if(!this.wrapVertical){var y=n.y+n.height,v=s.y+s.height,_,T,E;n.height>s.height?_=this.visibilityRatio*s.height:_=this.visibilityRatio*n.height,T=s.y-y+_,E=v-n.y-_,_>s.height?(n.y+=(T+E)/2,l=!0):E<0?(n.y+=E,l=!0):T>0&&(n.y+=T,l=!0)}var S=o||l,A=S?this.viewerElementToViewportRectangle(n):i.clone();return A.xConstrained=o,A.yConstrained=l,A.constraintApplied=S,A},_raiseConstraintsEvent:function(i){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:i})},applyConstraints:function(i){var n=this.getZoom(),s=this._applyZoomConstraints(n);n!==s&&this.zoomTo(s,this.zoomPoint,i);var o=this.getConstrainedBounds(!1);return o.constraintApplied&&(this.fitBounds(o,i),this._raiseConstraintsEvent(i)),this},ensureVisible:function(i){return this.applyConstraints(i)},_fitBounds:function(i,n){n=n||{};var s=n.immediately||!1,o=n.constraints||!1,l=this.getAspectRatio(),u=i.getCenter(),c=new t.Rect(i.x,i.y,i.width,i.height,i.degrees+this.getRotation()).getBoundingBox();c.getAspectRatio()>=l?c.height=c.width/l:c.width=c.height*l,c.x=u.x-c.width/2,c.y=u.y-c.height/2;var d=1/c.width;if(s)return this.panTo(u,!0),this.zoomTo(d,null,!0),o&&this.applyConstraints(!0),this;var p=this.getCenter(!0),m=this.getZoom(!0);this.panTo(p,!0),this.zoomTo(m,null,!0);var y=this.getBounds(),v=this.getZoom();if(v===0||Math.abs(d/v-1)<1e-8)return this.zoomTo(d,null,!0),this.panTo(u,s),o&&this.applyConstraints(!1),this;if(o){this.panTo(u,!1),d=this._applyZoomConstraints(d),this.zoomTo(d,null,!1);var _=this.getConstrainedBounds();this.panTo(p,!0),this.zoomTo(m,null,!0),this.fitBounds(_)}else{var T=c.rotate(-this.getRotation()),E=T.getTopLeft().times(d).minus(y.getTopLeft().times(v)).divide(d-v);this.zoomTo(d,E,s)}return this},fitBounds:function(i,n){return this._fitBounds(i,{immediately:n,constraints:!1})},fitBoundsWithConstraints:function(i,n){return this._fitBounds(i,{immediately:n,constraints:!0})},fitVertically:function(i){var n=new t.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(n,i)},fitHorizontally:function(i){var n=new t.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(n,i)},getConstrainedBounds:function(i){var n,s;return n=this.getBounds(i),s=this._applyBoundaryConstraints(n),s},panBy:function(i,n){var s=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(s.plus(i),n)},panTo:function(i,n){return n?(this.centerSpringX.resetTo(i.x),this.centerSpringY.resetTo(i.y)):(this.centerSpringX.springTo(i.x),this.centerSpringY.springTo(i.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:i,immediately:n}),this},zoomBy:function(i,n,s){return this.zoomTo(this.zoomSpring.target.value*i,n,s)},zoomTo:function(i,n,s){var o=this;return this.zoomPoint=n instanceof t.Point&&!isNaN(n.x)&&!isNaN(n.y)?n:null,s?this._adjustCenterSpringsForZoomPoint(function(){o.zoomSpring.resetTo(i)}):this.zoomSpring.springTo(i),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:i,refPoint:n,immediately:s}),this},setRotation:function(i,n){return this.rotateTo(i,null,n)},getRotation:function(i){return i?this.degreesSpring.current.value:this.degreesSpring.target.value},setRotationWithPivot:function(i,n,s){return this.rotateTo(i,n,s)},rotateTo:function(i,n,s){if(!this.viewer||!this.viewer.drawer.canRotate())return this;if(this.degreesSpring.target.value===i&&this.degreesSpring.isAtTargetValue())return this;if(this.rotationPivot=n instanceof t.Point&&!isNaN(n.x)&&!isNaN(n.y)?n:null,s)if(this.rotationPivot){var o=i-this._oldDegrees;if(!o)return this.rotationPivot=null,this;this._rotateAboutPivot(i)}else this.degreesSpring.resetTo(i);else{var l=t.positiveModulo(this.degreesSpring.current.value,360),u=t.positiveModulo(i,360),c=u-l;c>180?u-=360:c<-180&&(u+=360);var d=l-u;this.degreesSpring.resetTo(i+d),this.degreesSpring.springTo(i)}return this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:i,immediately:!!s,pivot:this.rotationPivot||this.getCenter()}),this},rotateBy:function(i,n,s){return this.rotateTo(this.degreesSpring.target.value+i,n,s)},resize:function(i,n){var s=this.getBoundsNoRotate(),o=s,l;this.containerSize.x=i.x,this.containerSize.y=i.y,this._updateContainerInnerSize(),n&&(l=i.x/this.containerSize.x,o.width=s.width*l,o.height=o.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:i,maintain:n});var u=this.fitBounds(o,!0);return this.viewer&&this.viewer.raiseEvent("after-resize",{newContainerSize:i,maintain:n}),u},_updateContainerInnerSize:function(){this._containerInnerSize=new t.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var i=this;this._adjustCenterSpringsForZoomPoint(function(){i.zoomSpring.update()}),this.degreesSpring.isAtTargetValue()&&(this.rotationPivot=null),this.centerSpringX.update(),this.centerSpringY.update(),this.rotationPivot?this._rotateAboutPivot(!0):this.degreesSpring.update();var n=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom||this.degreesSpring.current.value!==this._oldDegrees;this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value;var s=n||!this.zoomSpring.isAtTargetValue()||!this.centerSpringX.isAtTargetValue()||!this.centerSpringY.isAtTargetValue()||!this.degreesSpring.isAtTargetValue();return s},_rotateAboutPivot:function(i){var n=i===!0,s=this.rotationPivot.minus(this.getCenter());this.centerSpringX.shiftBy(s.x),this.centerSpringY.shiftBy(s.y),n?this.degreesSpring.update():this.degreesSpring.resetTo(i);var o=this.degreesSpring.current.value-this._oldDegrees,l=s.rotate(o*-1).times(-1);this.centerSpringX.shiftBy(l.x),this.centerSpringY.shiftBy(l.y)},_adjustCenterSpringsForZoomPoint:function(i){if(this.zoomPoint){var n=this.pixelFromPoint(this.zoomPoint,!0);i();var s=this.pixelFromPoint(this.zoomPoint,!0),o=s.minus(n),l=this.deltaPointsFromPixels(o,!0);this.centerSpringX.shiftBy(l.x),this.centerSpringY.shiftBy(l.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else i()},deltaPixelsFromPointsNoRotate:function(i,n){return i.times(this._containerInnerSize.x*this.getZoom(n))},deltaPixelsFromPoints:function(i,n){return this.deltaPixelsFromPointsNoRotate(i.rotate(this.getRotation(n)),n)},deltaPointsFromPixelsNoRotate:function(i,n){return i.divide(this._containerInnerSize.x*this.getZoom(n))},deltaPointsFromPixels:function(i,n){return this.deltaPointsFromPixelsNoRotate(i,n).rotate(-this.getRotation(n))},pixelFromPointNoRotate:function(i,n){return this._pixelFromPointNoRotate(i,this.getBoundsNoRotate(n))},pixelFromPoint:function(i,n){return this._pixelFromPoint(i,this.getBoundsNoRotate(n))},_pixelFromPointNoRotate:function(i,n){return i.minus(n.getTopLeft()).times(this._containerInnerSize.x/n.width).plus(new t.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(i,n){return this._pixelFromPointNoRotate(i.rotate(this.getRotation(!0),this.getCenter(!0)),n)},pointFromPixelNoRotate:function(i,n){var s=this.getBoundsNoRotate(n);return i.minus(new t.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/s.width).plus(s.getTopLeft())},pointFromPixel:function(i,n){return this.pointFromPixelNoRotate(i,n).rotate(-this.getRotation(n),this.getCenter(n))},_viewportToImageDelta:function(i,n){var s=this._contentBoundsNoRotate.width;return new t.Point(i*this._contentSizeNoRotate.x/s,n*this._contentSizeNoRotate.x/s)},viewportToImageCoordinates:function(i,n){if(i instanceof t.Point)return this.viewportToImageCoordinates(i.x,i.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(s===1){var o=this.viewer.world.getItemAt(0);return o.viewportToImageCoordinates(i,n,!0)}}return this._viewportToImageDelta(i-this._contentBoundsNoRotate.x,n-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(i,n){var s=this._contentBoundsNoRotate.width;return new t.Point(i/this._contentSizeNoRotate.x*s,n/this._contentSizeNoRotate.x*s)},imageToViewportCoordinates:function(i,n){if(i instanceof t.Point)return this.imageToViewportCoordinates(i.x,i.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(s===1){var o=this.viewer.world.getItemAt(0);return o.imageToViewportCoordinates(i,n,!0)}}var l=this._imageToViewportDelta(i,n);return l.x+=this._contentBoundsNoRotate.x,l.y+=this._contentBoundsNoRotate.y,l},imageToViewportRectangle:function(i,n,s,o){var l=i;if(l instanceof t.Rect||(l=new t.Rect(i,n,s,o)),this.viewer){var u=this.viewer.world.getItemCount();if(u>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(u===1){var c=this.viewer.world.getItemAt(0);return c.imageToViewportRectangle(i,n,s,o,!0)}}var d=this.imageToViewportCoordinates(l.x,l.y),p=this._imageToViewportDelta(l.width,l.height);return new t.Rect(d.x,d.y,p.x,p.y,l.degrees)},viewportToImageRectangle:function(i,n,s,o){var l=i;if(l instanceof t.Rect||(l=new t.Rect(i,n,s,o)),this.viewer){var u=this.viewer.world.getItemCount();if(u>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(u===1){var c=this.viewer.world.getItemAt(0);return c.viewportToImageRectangle(i,n,s,o,!0)}}var d=this.viewportToImageCoordinates(l.x,l.y),p=this._viewportToImageDelta(l.width,l.height);return new t.Rect(d.x,d.y,p.x,p.y,l.degrees)},viewerElementToImageCoordinates:function(i){var n=this.pointFromPixel(i,!0);return this.viewportToImageCoordinates(n)},imageToViewerElementCoordinates:function(i){var n=this.imageToViewportCoordinates(i);return this.pixelFromPoint(n,!0)},windowToImageCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var n=i.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(n)},imageToWindowCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var n=this.imageToViewerElementCoordinates(i);return n.plus(t.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(i){return this.pointFromPixel(i,!0)},viewportToViewerElementCoordinates:function(i){return this.pixelFromPoint(i,!0)},viewerElementToViewportRectangle:function(i){return t.Rect.fromSummits(this.pointFromPixel(i.getTopLeft(),!0),this.pointFromPixel(i.getTopRight(),!0),this.pointFromPixel(i.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(i){return t.Rect.fromSummits(this.pixelFromPoint(i.getTopLeft(),!0),this.pixelFromPoint(i.getTopRight(),!0),this.pixelFromPoint(i.getBottomLeft(),!0))},windowToViewportCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var n=i.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(n)},viewportToWindowCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var n=this.viewportToViewerElementCoordinates(i);return n.plus(t.getElementPosition(this.viewer.element))},viewportToImageZoom:function(i){if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(n===1){var s=this.viewer.world.getItemAt(0);return s.viewportToImageZoom(i)}}var o=this._contentSizeNoRotate.x,l=this._containerInnerSize.x,u=this._contentBoundsNoRotate.width,c=l/o*u;return i*c},imageToViewportZoom:function(i){if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image. Instead, use [TiledImage.imageToViewportZoom] for the specific image of interest");else if(n===1){var s=this.viewer.world.getItemAt(0);return s.imageToViewportZoom(i)}}var o=this._contentSizeNoRotate.x,l=this._containerInnerSize.x,u=this._contentBoundsNoRotate.width,c=o/l/u;return i*c},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(i){return this.flipped===i?this:(this.flipped=i,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:i}),this)},getMaxZoomPixelRatio:function(){return this.maxZoomPixelRatio},setMaxZoomPixelRatio:function(i,n=!0,s=!1){t.console.assert(!isNaN(i),"[Viewport.setMaxZoomPixelRatio] ratio must be a number"),!isNaN(i)&&(this.maxZoomPixelRatio=i,n&&this.getZoom()>this.getMaxZoom()&&this.applyConstraints(s))}}}(e),function(t){t.TiledImage=function(i){this._initialized=!1,t.console.assert(i.tileCache,"[TiledImage] options.tileCache is required"),t.console.assert(i.drawer,"[TiledImage] options.drawer is required"),t.console.assert(i.viewer,"[TiledImage] options.viewer is required"),t.console.assert(i.imageLoader,"[TiledImage] options.imageLoader is required"),t.console.assert(i.source,"[TiledImage] options.source is required"),t.console.assert(!i.clip||i.clip instanceof t.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),t.EventSource.call(this),this._tileCache=i.tileCache,delete i.tileCache,this._drawer=i.drawer,delete i.drawer,this._imageLoader=i.imageLoader,delete i.imageLoader,i.clip instanceof t.Rect&&(this._clip=i.clip.clone()),delete i.clip;var n=i.x||0;delete i.x;var s=i.y||0;delete i.y,this.normHeight=i.source.dimensions.y/i.source.dimensions.x,this.contentAspectX=i.source.dimensions.x/i.source.dimensions.y;var o=1;i.width?(o=i.width,delete i.width,i.height&&(t.console.error("specifying both width and height to a tiledImage is not supported"),delete i.height)):i.height&&(o=i.height/this.normHeight,delete i.height);var l=i.fitBounds;delete i.fitBounds;var u=i.fitBoundsPlacement||e.Placement.CENTER;delete i.fitBoundsPlacement;var c=i.degrees||0;delete i.degrees;var d=i.ajaxHeaders;delete i.ajaxHeaders,t.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_needsDraw:!0,_needsUpdate:!0,_hasOpaqueTile:!1,_tilesLoading:0,_tilesToDraw:[],_lastDrawn:[],_isBlending:!1,_wasBlending:!1,_isTainted:!1,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,immediateRender:t.DEFAULT_SETTINGS.immediateRender,blendTime:t.DEFAULT_SETTINGS.blendTime,alwaysBlend:t.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:t.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:t.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:t.DEFAULT_SETTINGS.iOSDevice,debugMode:t.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:t.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:t.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:t.DEFAULT_SETTINGS.placeholderFillStyle,opacity:t.DEFAULT_SETTINGS.opacity,preload:t.DEFAULT_SETTINGS.preload,compositeOperation:t.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:t.DEFAULT_SETTINGS.subPixelRoundingForTransparency,maxTilesPerFrame:t.DEFAULT_SETTINGS.maxTilesPerFrame},i),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new t.Spring({initial:n,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new t.Spring({initial:s,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new t.Spring({initial:o,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new t.Spring({initial:c,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),l&&this.fitBounds(l,u,!0),this._ownAjaxHeaders={},this.setAjaxHeaders(d,!1),this._initialized=!0},t.extend(t.TiledImage.prototype,t.EventSource.prototype,{needsDraw:function(){return this._needsDraw},redraw:function(){this._needsDraw=!0},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(i){i!==this._fullyLoaded&&(this._fullyLoaded=i,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=t.now(),this._needsDraw=!0},update:function(i){let n=this._xSpring.update(),s=this._ySpring.update(),o=this._scaleSpring.update(),l=this._degreesSpring.update(),u=n||s||o||l||this._needsUpdate;if(u||i||!this._fullyLoaded){let c=this._updateLevelsForViewport();this._setFullyLoaded(c)}return this._needsUpdate=!1,u?(this._updateForScale(),this._raiseBoundsChange(),this._needsDraw=!0,!0):!1},setDrawn:function(){return this._needsDraw=this._isBlending||this._wasBlending,this._needsDraw},setTainted(i){this._isTainted=i},isTainted(){return this._isTainted},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy(this.viewer)},getBounds:function(i){return this.getBoundsNoRotate(i).rotate(this.getRotation(i),this._getRotationPoint(i))},getBoundsNoRotate:function(i){return i?new t.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new t.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return t.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(i){var n=this.getBoundsNoRotate(i);if(this._clip){var s=i?this._worldWidthCurrent:this._worldWidthTarget,o=s/this.source.dimensions.x,l=this._clip.times(o);n=new t.Rect(n.x+l.x,n.y+l.y,l.width,l.height)}return n.rotate(this.getRotation(i),this._getRotationPoint(i))},getTileBounds:function(i,n,s){var o=this.source.getNumTiles(i),l=(o.x+n%o.x)%o.x,u=(o.y+s%o.y)%o.y,c=this.source.getTileBounds(i,l,u);return this.getFlip()&&(c.x=Math.max(0,1-c.x-c.width)),c.x+=(n-l)/o.x,c.y+=this._worldHeightCurrent/this._worldWidthCurrent*((s-u)/o.y),c},getContentSize:function(){return new t.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var i=this.imageToWindowCoordinates(new t.Point(0,0)),n=this.imageToWindowCoordinates(this.getContentSize());return new t.Point(n.x-i.x,n.y-i.y)},_viewportToImageDelta:function(i,n,s){var o=s?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(i*(this.source.dimensions.x/o),n*(this.source.dimensions.y*this.contentAspectX/o))},viewportToImageCoordinates:function(i,n,s){var o;return i instanceof t.Point?(s=n,o=i):o=new t.Point(i,n),o=o.rotate(-this.getRotation(s),this._getRotationPoint(s)),s?this._viewportToImageDelta(o.x-this._xSpring.current.value,o.y-this._ySpring.current.value):this._viewportToImageDelta(o.x-this._xSpring.target.value,o.y-this._ySpring.target.value)},_imageToViewportDelta:function(i,n,s){var o=s?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(i/this.source.dimensions.x*o,n/this.source.dimensions.y/this.contentAspectX*o)},imageToViewportCoordinates:function(i,n,s){i instanceof t.Point&&(s=n,n=i.y,i=i.x);var o=this._imageToViewportDelta(i,n,s);return s?(o.x+=this._xSpring.current.value,o.y+=this._ySpring.current.value):(o.x+=this._xSpring.target.value,o.y+=this._ySpring.target.value),o.rotate(this.getRotation(s),this._getRotationPoint(s))},imageToViewportRectangle:function(i,n,s,o,l){var u=i;u instanceof t.Rect?l=n:u=new t.Rect(i,n,s,o);var c=this.imageToViewportCoordinates(u.getTopLeft(),l),d=this._imageToViewportDelta(u.width,u.height,l);return new t.Rect(c.x,c.y,d.x,d.y,u.degrees+this.getRotation(l))},viewportToImageRectangle:function(i,n,s,o,l){var u=i;i instanceof t.Rect?l=n:u=new t.Rect(i,n,s,o);var c=this.viewportToImageCoordinates(u.getTopLeft(),l),d=this._viewportToImageDelta(u.width,u.height,l);return new t.Rect(c.x,c.y,d.x,d.y,u.degrees-this.getRotation(l))},viewerElementToImageCoordinates:function(i){var n=this.viewport.pointFromPixel(i,!0);return this.viewportToImageCoordinates(n)},imageToViewerElementCoordinates:function(i){var n=this.imageToViewportCoordinates(i);return this.viewport.pixelFromPoint(n,!0)},windowToImageCoordinates:function(i){var n=i.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(n)},imageToWindowCoordinates:function(i){var n=this.imageToViewerElementCoordinates(i);return n.plus(e.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(i){var n=this._scaleSpring.current.value;return i=i.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new t.Rect((i.x-this._xSpring.current.value)/n,(i.y-this._ySpring.current.value)/n,i.width/n,i.height/n,i.degrees)},viewportToImageZoom:function(i){var n=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return n*i},imageToViewportZoom:function(i){var n=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return i/n},setPosition:function(i,n){var s=this._xSpring.target.value===i.x&&this._ySpring.target.value===i.y;if(n){if(s&&this._xSpring.current.value===i.x&&this._ySpring.current.value===i.y)return;this._xSpring.resetTo(i.x),this._ySpring.resetTo(i.y),this._needsDraw=!0,this._needsUpdate=!0}else{if(s)return;this._xSpring.springTo(i.x),this._ySpring.springTo(i.y),this._needsDraw=!0,this._needsUpdate=!0}s||this._raiseBoundsChange()},setWidth:function(i,n){this._setScale(i,n)},setHeight:function(i,n){this._setScale(i/this.normHeight,n)},setCroppingPolygons:function(i){var n=function(o){return o instanceof t.Point||typeof o.x=="number"&&typeof o.y=="number"},s=function(o){return o.map(function(l){try{if(n(l))return{x:l.x,y:l.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!t.isArray(i))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=i.map(function(o){return s(o)}),this._needsDraw=!0}catch(o){t.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),t.console.error(o),this.resetCroppingPolygons()}},resetCroppingPolygons:function(){this._croppingPolygons=null,this._needsDraw=!0},fitBounds:function(i,n,s){n=n||t.Placement.CENTER;var o=t.Placement.properties[n],l=this.contentAspectX,u=0,c=0,d=1,p=1;if(this._clip&&(l=this._clip.getAspectRatio(),d=this._clip.width/this.source.dimensions.x,p=this._clip.height/this.source.dimensions.y,i.getAspectRatio()>l?(u=this._clip.x/this._clip.height*i.height,c=this._clip.y/this._clip.height*i.height):(u=this._clip.x/this._clip.width*i.width,c=this._clip.y/this._clip.width*i.width)),i.getAspectRatio()>l){var m=i.height/p,y=0;o.isHorizontallyCentered?y=(i.width-i.height*l)/2:o.isRight&&(y=i.width-i.height*l),this.setPosition(new t.Point(i.x-u+y,i.y-c),s),this.setHeight(m,s)}else{var v=i.width/d,_=0;o.isVerticallyCentered?_=(i.height-i.width/l)/2:o.isBottom&&(_=i.height-i.width/l),this.setPosition(new t.Point(i.x-u,i.y-c+_),s),this.setWidth(v,s)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(i){t.console.assert(!i||i instanceof t.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),i instanceof t.Rect?this._clip=i.clone():this._clip=null,this._needsUpdate=!0,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return this.flipped},setFlip:function(i){this.flipped=i},get flipped(){return this._flipped},set flipped(i){let n=this._flipped!==!!i;this._flipped=!!i,n&&(this.update(!0),this._needsDraw=!0,this._raiseBoundsChange())},get wrapHorizontal(){return this._wrapHorizontal},set wrapHorizontal(i){let n=this._wrapHorizontal!==!!i;this._wrapHorizontal=!!i,this._initialized&&n&&(this.update(!0),this._needsDraw=!0)},get wrapVertical(){return this._wrapVertical},set wrapVertical(i){let n=this._wrapVertical!==!!i;this._wrapVertical=!!i,this._initialized&&n&&(this.update(!0),this._needsDraw=!0)},get debugMode(){return this._debugMode},set debugMode(i){this._debugMode=!!i,this._needsDraw=!0},getOpacity:function(){return this.opacity},setOpacity:function(i){this.opacity=i},get opacity(){return this._opacity},set opacity(i){i!==this.opacity&&(this._opacity=i,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(i){this._preload=!!i,this._needsDraw=!0},getRotation:function(i){return i?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(i,n){this._degreesSpring.target.value===i&&this._degreesSpring.isAtTargetValue()||(n?this._degreesSpring.resetTo(i):this._degreesSpring.springTo(i),this._needsDraw=!0,this._needsUpdate=!0,this._raiseBoundsChange())},getDrawArea:function(){if(this._opacity===0&&!this._preload)return!1;var i=this._viewportToTiledImageRectangle(this.viewport.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var n=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));i=i.intersection(n)}return i},getTilesToDraw:function(){let i=this._tilesToDraw.flat();return this._updateTilesInViewport(i),i=this._tilesToDraw.flat(),i.forEach(n=>{n.tile.beingDrawn=!0}),this._lastDrawn=i,i},_getRotationPoint:function(i){return this.getBoundsNoRotate(i).getCenter()},get compositeOperation(){return this._compositeOperation},set compositeOperation(i){i!==this._compositeOperation&&(this._compositeOperation=i,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this._compositeOperation}))},getCompositeOperation:function(){return this._compositeOperation},setCompositeOperation:function(i){this.compositeOperation=i},setAjaxHeaders:function(i,n){if(i===null&&(i={}),!t.isPlainObject(i)){console.error("[TiledImage.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}this._ownAjaxHeaders=i,this._updateAjaxHeaders(n)},_updateAjaxHeaders:function(i){if(i===void 0&&(i=!0),t.isPlainObject(this.viewer.ajaxHeaders)?this.ajaxHeaders=t.extend({},this.viewer.ajaxHeaders,this._ownAjaxHeaders):this.ajaxHeaders=this._ownAjaxHeaders,i){var n,s,o,l;for(var u in this.tilesMatrix){n=this.source.getNumTiles(u);for(var c in this.tilesMatrix[u]){s=(n.x+c%n.x)%n.x;for(var d in this.tilesMatrix[u][c])if(o=(n.y+d%n.y)%n.y,l=this.tilesMatrix[u][c][d],l.loadWithAjax=this.loadTilesWithAjax,l.loadWithAjax){var p=this.source.getTileAjaxHeaders(u,s,o);l.ajaxHeaders=t.extend({},this.ajaxHeaders,p)}else l.ajaxHeaders=null}}for(var m=0;m<this._imageLoader.jobQueue.length;m++){var y=this._imageLoader.jobQueue[m];y.loadWithAjax=y.tile.loadWithAjax,y.ajaxHeaders=y.tile.loadWithAjax?y.tile.ajaxHeaders:null}}},_setScale:function(i,n){var s=this._scaleSpring.target.value===i;if(n){if(s&&this._scaleSpring.current.value===i)return;this._scaleSpring.resetTo(i),this._updateForScale(),this._needsDraw=!0,this._needsUpdate=!0}else{if(s)return;this._scaleSpring.springTo(i),this._updateForScale(),this._needsDraw=!0,this._needsUpdate=!0}s||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var i=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),n=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,s=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(n/this.minPixelRatio)/Math.log(2))));return s=Math.max(s,this.source.minLevel||0),i=Math.min(i,s),{lowestLevel:i,highestLevel:s}},_updateLevelsForViewport:function(){var i=this._getLevelsInterval(),n=i.lowestLevel,s=i.highestLevel,o=[],l=this.getDrawArea(),u=t.now();if(this._lastDrawn.forEach(D=>{D.tile.beingDrawn=!1}),this._tilesToDraw=[],this._tilesLoading=0,this.loadingCoverage={},!l)return this._needsDraw=!1,this._fullyLoaded;var c=new Array(s-n+1);for(let D=0,k=s;k>=n;k--,D++)c[D]=k;for(let D=s+1;D<=this.source.maxLevel;D++){var d=this.tilesMatrix[D]&&this.tilesMatrix[D][0]&&this.tilesMatrix[D][0][0];if(d&&d.isBottomMost&&d.isRightMost&&d.loaded){c.push(D);break}}let p=!1;for(let D=0;D<c.length;D++){let k=c[D];var m=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(k),!0).x*this._scaleSpring.current.value;if(D===c.length-1||m>=this.minPixelRatio)p=!0;else if(!p)continue;var y=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(k),!1).x*this._scaleSpring.current.value,v=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,_=this.immediateRender?1:v,T=Math.min(1,(m-.5)/.5),E=_/Math.abs(_-y),S=this._updateLevel(k,T,E,l,u,o);o=S.bestTiles;var A=S.updatedTiles.filter(U=>U.loaded),P=function(U,j,q){return function(ee){return{tile:ee,level:U,levelOpacity:j,currentTime:q}}}(k,T,u);if(this._tilesToDraw[k]=A.map(P),this._providesCoverage(this.coverage,k))break}return o&&o.length>0?(o.forEach(function(D){D&&!D.context2D&&this._loadTile(D,u)},this),this._needsDraw=!0,!1):this._tilesLoading===0},_updateTilesInViewport:function(i){let n=t.now(),s=this;this._tilesLoading=0,this._wasBlending=this._isBlending,this._isBlending=!1,this.loadingCoverage={};let o=i.length?i[0].level:0;if(!this.getDrawArea())return;function u(d){let p=d.tile;if(p&&p.loaded){let m=s._blendTile(p,p.x,p.y,d.level,d.levelOpacity,n,o);s._isBlending=s._isBlending||m,s._needsDraw=s._needsDraw||m||s._wasBlending}}let c=0;for(let d=0;d<i.length;d++){let p=i[d];u(p),this._providesCoverage(this.coverage,p.level)&&(c=Math.max(c,p.level))}if(c>0)for(let d in this._tilesToDraw)d<c&&delete this._tilesToDraw[d]},_blendTile:function(i,n,s,o,l,u,c){let d=1e3*this.blendTime,p,m;return i.blendStart||(i.blendStart=u),p=u-i.blendStart,m=d?Math.min(1,p/d):1,o===c&&(m=1,p=d),this.alwaysBlend&&(m*=l),i.opacity=m,m===1&&(this._setCoverage(this.coverage,o,n,s,!0),this._hasOpaqueTile=!0),p<d},_updateLevel:function(i,n,s,o,l,u){var c=o.getBoundingBox().getTopLeft(),d=o.getBoundingBox().getBottomRight();this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:!0,level:i,opacity:n,visibility:s,drawArea:o,topleft:c,bottomright:d,currenttime:l,best:u}),this._resetCoverage(this.coverage,i),this._resetCoverage(this.loadingCoverage,i);var p=this._getCornerTiles(i,c,d),m=p.topLeft,y=p.bottomRight,v=this.source.getNumTiles(i),_=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(y.x+=1,this.wrapHorizontal||(y.x=Math.min(y.x,v.x-1)));for(var T=Math.max(0,(y.x-m.x)*(y.y-m.y)),E=new Array(T),S=0,A=m.x;A<=y.x;A++)for(var P=m.y;P<=y.y;P++){var D;if(this.getFlip()){var k=(v.x+A%v.x)%v.x;D=A+v.x-k-k-1}else D=A;if(o.intersection(this.getTileBounds(i,D,P))!==null){var U=this._updateTile(D,P,i,s,_,v,l,u);u=U.bestTiles,E[S]=U.tile,S+=1}}return{bestTiles:u,updatedTiles:E}},_positionTile:function(i,n,s,o,l){var u=i.bounds.getTopLeft();u.x*=this._scaleSpring.current.value,u.y*=this._scaleSpring.current.value,u.x+=this._xSpring.current.value,u.y+=this._ySpring.current.value;var c=i.bounds.getSize();c.x*=this._scaleSpring.current.value,c.y*=this._scaleSpring.current.value,i.positionedBounds.x=u.x,i.positionedBounds.y=u.y,i.positionedBounds.width=c.x,i.positionedBounds.height=c.y;var d=s.pixelFromPointNoRotate(u,!0),p=s.pixelFromPointNoRotate(u,!1),m=s.deltaPixelsFromPointsNoRotate(c,!0),y=s.deltaPixelsFromPointsNoRotate(c,!1),v=p.plus(y.divide(2)),_=o.squaredDistanceTo(v);this.viewer.drawer.minimumOverlapRequired(this)&&(n||(m=m.plus(new t.Point(1,1))),i.isRightMost&&this.wrapHorizontal&&(m.x+=.75),i.isBottomMost&&this.wrapVertical&&(m.y+=.75)),i.position=d,i.size=m,i.squaredDistance=_,i.visibility=l},_updateTile:function(i,n,s,o,l,u,c,d){var p=this._getTile(i,n,s,c,u);this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:p}),this._setCoverage(this.coverage,s,i,n,!1);var m=p.loaded||p.loading||this._isCovered(this.loadingCoverage,s,i,n);if(this._setCoverage(this.loadingCoverage,s,i,n,m),!p.exists)return{bestTiles:d,tile:p};if(p.loaded&&p.opacity===1&&this._setCoverage(this.coverage,s,i,n,!0),this._positionTile(p,this.source.tileOverlap,this.viewport,l,o),!p.loaded)if(p.context2D)this._setTileLoaded(p);else{var y=this._tileCache.getImageRecord(p.cacheKey);y&&this._setTileLoaded(p,y.getData())}return p.loading?this._tilesLoading++:m||(d=this._compareTiles(d,p,this.maxTilesPerFrame)),{bestTiles:d,tile:p}},_getCornerTiles:function(i,n,s){var o,l;this.wrapHorizontal?(o=t.positiveModulo(n.x,1),l=t.positiveModulo(s.x,1)):(o=Math.max(0,n.x),l=Math.min(1,s.x));var u,c,d=1/this.source.aspectRatio;this.wrapVertical?(u=t.positiveModulo(n.y,d),c=t.positiveModulo(s.y,d)):(u=Math.max(0,n.y),c=Math.min(d,s.y));var p=this.source.getTileAtPoint(i,new t.Point(o,u)),m=this.source.getTileAtPoint(i,new t.Point(l,c)),y=this.source.getNumTiles(i);return this.wrapHorizontal&&(p.x+=y.x*Math.floor(n.x),m.x+=y.x*Math.floor(s.x)),this.wrapVertical&&(p.y+=y.y*Math.floor(n.y/d),m.y+=y.y*Math.floor(s.y/d)),{topLeft:p,bottomRight:m}},_getTile:function(i,n,s,o,l){var u,c,d,p,m,y,v,_,T,E,S=this.tilesMatrix,A=this.source;return S[s]||(S[s]={}),S[s][i]||(S[s][i]={}),(!S[s][i][n]||!S[s][i][n].flipped!=!this.flipped)&&(u=(l.x+i%l.x)%l.x,c=(l.y+n%l.y)%l.y,d=this.getTileBounds(s,i,n),p=A.getTileBounds(s,u,c,!0),m=A.tileExists(s,u,c),y=A.getTileUrl(s,u,c),v=A.getTilePostData(s,u,c),this.loadTilesWithAjax?(_=A.getTileAjaxHeaders(s,u,c),t.isPlainObject(this.ajaxHeaders)&&(_=t.extend({},this.ajaxHeaders,_))):_=null,T=A.getContext2D?A.getContext2D(s,u,c):void 0,E=new t.Tile(s,i,n,d,m,y,T,this.loadTilesWithAjax,_,p,v,A.getTileHashKey(s,u,c,y,_,v)),this.getFlip()?u===0&&(E.isRightMost=!0):u===l.x-1&&(E.isRightMost=!0),c===l.y-1&&(E.isBottomMost=!0),E.flipped=this.flipped,S[s][i][n]=E),E=S[s][i][n],E.lastTouchTime=o,E},_loadTile:function(i,n){var s=this;i.loading=!0,this._imageLoader.addJob({src:i.getUrl(),tile:i,source:this.source,postData:i.postData,loadWithAjax:i.loadWithAjax,ajaxHeaders:i.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(o,l,u){s._onTileLoad(i,n,o,l,u)},abort:function(){i.loading=!1}})},_onTileLoad:function(i,n,s,o,l){if(s)i.exists=!0;else{t.console.error("Tile %s failed to load: %s - error: %s",i,i.getUrl(),o),this.viewer.raiseEvent("tile-load-failed",{tile:i,tiledImage:this,time:n,message:o,tileRequest:l}),i.loading=!1,i.exists=!1;return}if(n<this.lastResetTime){t.console.warn("Ignoring tile %s loaded before reset: %s",i,i.getUrl()),i.loading=!1;return}var u=this,c=function(){var d=u.source,p=d.getClosestLevel();u._setTileLoaded(i,s,p,l)};c()},_setTileLoaded:function(i,n,s,o){var l=0,u=!1,c=this;function d(){return u&&t.console.error("Event 'tile-loaded' argument getCompletionCallback must be called synchronously. Its return value should be called asynchronously."),l++,p}function p(){l--,l===0&&(i.loading=!1,i.loaded=!0,i.hasTransparency=c.source.hasTransparency(i.context2D,i.getUrl(),i.ajaxHeaders,i.postData),i.context2D||c._tileCache.cacheTile({data:n,tile:i,cutoff:s,tiledImage:c}),c.viewer.raiseEvent("tile-ready",{tile:i,tiledImage:c,tileRequest:o}),c._needsDraw=!0)}var m=d();this.viewer.raiseEvent("tile-loaded",{tile:i,tiledImage:this,tileRequest:o,get image(){return t.console.error("[tile-loaded] event 'image' has been deprecated. Use 'data' property instead."),n},data:n,getCompletionCallback:d}),u=!0,m()},_compareTiles:function(i,n,s){return i?(i.push(n),this._sortTiles(i),i.length>s&&i.pop(),i):[n]},_sortTiles:function(i){i.sort(function(n,s){return n===null?1:s===null?-1:n.visibility===s.visibility?n.squaredDistance-s.squaredDistance:s.visibility-n.visibility})},_providesCoverage:function(i,n,s,o){var l,u,c,d;if(!i[n])return!1;if(s===void 0||o===void 0){l=i[n];for(c in l)if(Object.prototype.hasOwnProperty.call(l,c)){u=l[c];for(d in u)if(Object.prototype.hasOwnProperty.call(u,d)&&!u[d])return!1}return!0}return i[n][s]===void 0||i[n][s][o]===void 0||i[n][s][o]===!0},_isCovered:function(i,n,s,o){return s===void 0||o===void 0?this._providesCoverage(i,n+1):this._providesCoverage(i,n+1,2*s,2*o)&&this._providesCoverage(i,n+1,2*s,2*o+1)&&this._providesCoverage(i,n+1,2*s+1,2*o)&&this._providesCoverage(i,n+1,2*s+1,2*o+1)},_setCoverage:function(i,n,s,o,l){if(!i[n]){t.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",n);return}i[n][s]||(i[n][s]={}),i[n][s][o]=l},_resetCoverage:function(i,n){i[n]={}}})}(e),function(t){var i=function(s){t.console.assert(s,"[TileCache.cacheTile] options is required"),t.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=s.tile,this.tiledImage=s.tiledImage},n=function(s){t.console.assert(s,"[ImageRecord] options is required"),t.console.assert(s.data,"[ImageRecord] options.data is required"),this._tiles=[],s.create.apply(null,[this,s.data,s.ownerTile]),this._destroyImplementation=s.destroy.bind(null,this),this.getImage=s.getImage.bind(null,this),this.getData=s.getData.bind(null,this),this.getRenderedContext=s.getRenderedContext.bind(null,this)};n.prototype={destroy:function(){this._destroyImplementation(),this._tiles=null},addTile:function(s){t.console.assert(s,"[ImageRecord.addTile] tile is required"),this._tiles.push(s)},removeTile:function(s){for(var o=0;o<this._tiles.length;o++)if(this._tiles[o]===s){this._tiles.splice(o,1);return}t.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",s)},getTileCount:function(){return this._tiles.length}},t.TileCache=function(s){s=s||{},this._maxImageCacheCount=s.maxImageCacheCount||t.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},t.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(s){t.console.assert(s,"[TileCache.cacheTile] options is required"),t.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(s.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),t.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var o=s.cutoff||0,l=this._tilesLoaded.length,u=this._imagesLoaded[s.tile.cacheKey];if(u||(s.data||(t.console.error("[TileCache.cacheTile] options.image was renamed to options.data. '.image' attribute has been deprecated and will be removed in the future."),s.data=s.image),t.console.assert(s.data,"[TileCache.cacheTile] options.data is required to create an ImageRecord"),u=this._imagesLoaded[s.tile.cacheKey]=new n({data:s.data,ownerTile:s.tile,create:s.tiledImage.source.createTileCache,destroy:s.tiledImage.source.destroyTileCache,getImage:s.tiledImage.source.getTileCacheDataAsImage,getData:s.tiledImage.source.getTileCacheData,getRenderedContext:s.tiledImage.source.getTileCacheDataAsContext2D}),this._imagesLoadedCount++),u.addTile(s.tile),s.tile.cacheImageRecord=u,this._imagesLoadedCount>this._maxImageCacheCount){for(var c=null,d=-1,p=null,m,y,v,_,T,E,S=this._tilesLoaded.length-1;S>=0;S--)if(E=this._tilesLoaded[S],m=E.tile,!(m.level<=o||m.beingDrawn)){if(!c){c=m,d=S,p=E;continue}_=m.lastTouchTime,y=c.lastTouchTime,T=m.level,v=c.level,(_<y||_===y&&T>v)&&(c=m,d=S,p=E)}c&&d>=0&&(this._unloadTile(p),l=d)}this._tilesLoaded[l]=new i({tile:s.tile,tiledImage:s.tiledImage})},clearTilesFor:function(s){t.console.assert(s,"[TileCache.clearTilesFor] tiledImage is required");for(var o,l=0;l<this._tilesLoaded.length;++l)o=this._tilesLoaded[l],o.tiledImage===s&&(this._unloadTile(o),this._tilesLoaded.splice(l,1),l--)},getImageRecord:function(s){return t.console.assert(s,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[s]},_unloadTile:function(s){t.console.assert(s,"[TileCache._unloadTile] tileRecord is required");var o=s.tile,l=s.tiledImage;let u=o.getCanvasContext&&o.getCanvasContext();o.unload(),o.cacheImageRecord=null;var c=this._imagesLoaded[o.cacheKey];c&&(c.removeTile(o),c.getTileCount()||(c.destroy(),delete this._imagesLoaded[o.cacheKey],this._imagesLoadedCount--,u&&(u.canvas.width=0,u.canvas.height=0,l.viewer.raiseEvent("image-unloaded",{context2D:u,tile:o}))),l.viewer.raiseEvent("tile-unloaded",{tile:o,tiledImage:l}))}}}(e),function(t){t.World=function(i){var n=this;t.console.assert(i.viewer,"[World] options.viewer is required"),t.EventSource.call(this),this.viewer=i.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(s){n._autoRefigureSizes?n._figureSizes():n._needsSizesFigured=!0},this._figureSizes()},t.extend(t.World.prototype,t.EventSource.prototype,{addItem:function(i,n){if(t.console.assert(i,"[World.addItem] item is required"),t.console.assert(i instanceof t.TiledImage,"[World.addItem] only TiledImages supported at this time"),n=n||{},n.index!==void 0){var s=Math.max(0,Math.min(this._items.length,n.index));this._items.splice(s,0,i)}else this._items.push(i);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,i.addHandler("bounds-change",this._delegatedFigureSizes),i.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:i})},getItemAt:function(i){return t.console.assert(i!==void 0,"[World.getItemAt] index is required"),this._items[i]},getIndexOfItem:function(i){return t.console.assert(i,"[World.getIndexOfItem] item is required"),t.indexOf(this._items,i)},getItemCount:function(){return this._items.length},setItemIndex:function(i,n){t.console.assert(i,"[World.setItemIndex] item is required"),t.console.assert(n!==void 0,"[World.setItemIndex] index is required");var s=this.getIndexOfItem(i);if(n>=this._items.length)throw new Error("Index bigger than number of layers.");n===s||s===-1||(this._items.splice(s,1),this._items.splice(n,0,i),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:i,previousIndex:s,newIndex:n}))},removeItem:function(i){t.console.assert(i,"[World.removeItem] item is required");var n=t.indexOf(this._items,i);n!==-1&&(i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy(),this._items.splice(n,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(i))},removeAll:function(){this.viewer._cancelPendingImages();var i,n;for(n=0;n<this._items.length;n++)i=this._items[n],i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy();var s=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,n=0;n<s.length;n++)i=s[n],this._raiseRemoveItem(i)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(i){for(var n=!1,s=0;s<this._items.length;s++)n=this._items[s].update(i)||n;return n},draw:function(){this.viewer.drawer.draw(this._items),this._needsDraw=!1,this._items.forEach(i=>{this._needsDraw=i.setDrawn()||this._needsDraw})},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(i){this._autoRefigureSizes=i,i&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(i){i=i||{};var n=i.immediately||!1,s=i.layout||t.DEFAULT_SETTINGS.collectionLayout,o=i.rows||t.DEFAULT_SETTINGS.collectionRows,l=i.columns||t.DEFAULT_SETTINGS.collectionColumns,u=i.tileSize||t.DEFAULT_SETTINGS.collectionTileSize,c=i.tileMargin||t.DEFAULT_SETTINGS.collectionTileMargin,d=u+c,p;!i.rows&&l?p=l:p=Math.ceil(this._items.length/o);var m=0,y=0,v,_,T,E,S;this.setAutoRefigureSizes(!1);for(var A=0;A<this._items.length;A++)A&&A%p===0&&(s==="horizontal"?(y+=d,m=0):(m+=d,y=0)),v=this._items[A],_=v.getBounds(),_.width>_.height?T=u:T=u*(_.width/_.height),E=T*(_.height/_.width),S=new t.Point(m+(u-T)/2,y+(u-E)/2),v.setPosition(S,n),v.setWidth(T,n),s==="horizontal"?m+=d:y+=d;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var i=this._homeBounds?this._homeBounds.clone():null,n=this._contentSize?this._contentSize.clone():null,s=this._contentFactor||0;if(!this._items.length)this._homeBounds=new t.Rect(0,0,1,1),this._contentSize=new t.Point(1,1),this._contentFactor=1;else{var o=this._items[0],l=o.getBounds();this._contentFactor=o.getContentSize().x/l.width;for(var u=o.getClippedBounds().getBoundingBox(),c=u.x,d=u.y,p=u.x+u.width,m=u.y+u.height,y=1;y<this._items.length;y++)o=this._items[y],l=o.getBounds(),this._contentFactor=Math.max(this._contentFactor,o.getContentSize().x/l.width),u=o.getClippedBounds().getBoundingBox(),c=Math.min(c,u.x),d=Math.min(d,u.y),p=Math.max(p,u.x+u.width),m=Math.max(m,u.y+u.height);this._homeBounds=new t.Rect(c,d,p-c,m-d),this._contentSize=new t.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==s||!this._homeBounds.equals(i)||!this._contentSize.equals(n))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(i){this.raiseEvent("remove-item",{item:i})}})}(e)}(th)),th.exports}var FS=LS();const el=Wp(FS);var BS=Object.defineProperty,kS=(r,e,t)=>e in r?BS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Rt=(r,e,t)=>kS(r,typeof e!="symbol"?e+"":e,t),wv=Object.prototype.hasOwnProperty;function Ds(r,e){var t,i;if(r===e)return!0;if(r&&e&&(t=r.constructor)===e.constructor){if(t===Date)return r.getTime()===e.getTime();if(t===RegExp)return r.toString()===e.toString();if(t===Array){if((i=r.length)===e.length)for(;i--&&Ds(r[i],e[i]););return i===-1}if(!t||typeof r=="object"){i=0;for(t in r)if(wv.call(r,t)&&++i&&!wv.call(e,t)||!(t in e)||!Ds(r[t],e[t]))return!1;return Object.keys(e).length===i}}return r!==r&&e!==e}var s0=(r=>(r.EDIT="EDIT",r.SELECT="SELECT",r.NONE="NONE",r))(s0||{});const US=[];for(let r=0;r<256;++r)US.push((r+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Wd=r=>{const e=t=>{const i={...t};return t.created&&typeof t.created=="string"&&(i.created=new Date(t.created)),t.updated&&typeof t.updated=="string"&&(i.updated=new Date(t.updated)),i};return{...r,bodies:(r.bodies||[]).map(e),target:e(r.target)}},HS=(r,e)=>{const t=new Set(r.bodies.map(i=>i.id));return e.bodies.filter(i=>!t.has(i.id))},zS=(r,e)=>{const t=new Set(e.bodies.map(i=>i.id));return r.bodies.filter(i=>!t.has(i.id))},GS=(r,e)=>e.bodies.map(t=>{const i=r.bodies.find(n=>n.id===t.id);return{newBody:t,oldBody:i&&!Ds(i,t)?i:void 0}}).filter(({oldBody:t})=>t).map(({oldBody:t,newBody:i})=>({oldBody:t,newBody:i})),VS=(r,e)=>!Ds(r.target,e.target),jS=(r,e)=>{const t=HS(r,e),i=zS(r,e),n=GS(r,e);return{oldValue:r,newValue:e,bodiesCreated:t.length>0?t:void 0,bodiesDeleted:i.length>0?i:void 0,bodiesUpdated:n.length>0?n:void 0,targetUpdated:VS(r,e)?{oldTarget:r.target,newTarget:e.target}:void 0}};var Zn=(r=>(r.LOCAL="LOCAL",r.REMOTE="REMOTE",r.SILENT="SILENT",r))(Zn||{});const XS=(r,e)=>{const t=new Set((r.created||[]).map(p=>p.id)),i=new Set((r.updated||[]).map(({newValue:p})=>p.id)),n=new Set((e.created||[]).map(p=>p.id)),s=new Set((e.deleted||[]).map(p=>p.id)),o=new Set((e.updated||[]).map(({oldValue:p})=>p.id)),l=new Set((e.updated||[]).filter(({oldValue:p})=>t.has(p.id)||i.has(p.id)).map(({oldValue:p})=>p.id)),u=[...(r.created||[]).filter(p=>!s.has(p.id)).map(p=>o.has(p.id)?e.updated.find(({oldValue:m})=>m.id===p.id).newValue:p),...e.created||[]],c=[...(r.deleted||[]).filter(p=>!n.has(p.id)),...(e.deleted||[]).filter(p=>!t.has(p.id))],d=[...(r.updated||[]).filter(({newValue:p})=>!s.has(p.id)).map(p=>{const{oldValue:m,newValue:y}=p;if(o.has(y.id)){const v=e.updated.find(_=>_.oldValue.id===y.id).newValue;return jS(m,v)}else return p}),...(e.updated||[]).filter(({oldValue:p})=>!l.has(p.id))];return{created:u,deleted:c,updated:d}};let WS=()=>({emit(r,...e){for(let t=this.events[r]||[],i=0,n=t.length;i<n;i++)t[i](...e)},events:{},on(r,e){var t;return((t=this.events)[r]||(t[r]=[])).push(e),()=>{var i;this.events[r]=(i=this.events[r])==null?void 0:i.filter(n=>e!==n)}}});const YS=250,qS=(r,e)=>{const t=WS(),i=(e==null?void 0:e.changes)||[];let n=e?e.pointer:-1,s=!1,o=0;const l=v=>{if(!s){const{changes:_}=v,T=performance.now();if(T-o>YS)i.splice(n+1),i.push(_),n=i.length-1;else{const E=i.length-1;i[E]=XS(i[E],_)}o=T}s=!1};r.observe(l,{origin:Zn.LOCAL});const u=v=>v&&v.length>0&&r.bulkDeleteAnnotations(v),c=v=>v&&v.length>0&&r.bulkAddAnnotations(v,!1),d=v=>v&&v.length>0&&r.bulkUpdateAnnotations(v.map(({oldValue:_})=>_)),p=v=>v&&v.length>0&&r.bulkUpdateAnnotations(v.map(({newValue:_})=>_)),m=v=>v&&v.length>0&&r.bulkAddAnnotations(v,!1),y=v=>v&&v.length>0&&r.bulkDeleteAnnotations(v);return{canRedo:()=>i.length-1>n,canUndo:()=>n>-1,destroy:()=>r.unobserve(l),getHistory:()=>({changes:[...i],pointer:n}),on:(v,_)=>t.on(v,_),redo:()=>{if(i.length-1>n){s=!0;const{created:v,updated:_,deleted:T}=i[n+1];c(v),p(_),y(T),t.emit("redo",i[n+1]),n+=1}},undo:()=>{if(n>-1){s=!0;const{created:v,updated:_,deleted:T}=i[n];u(v),d(_),m(T),t.emit("undo",i[n]),n-=1}}}},ZS=(r,e,t,i)=>{const{hover:n,selection:s,store:o,viewport:l}=r,u=new Map;let c=[],d,p;const m=(E,S)=>{u.has(E)?u.get(E).push(S):u.set(E,[S])},y=(E,S)=>{const A=u.get(E);if(A){const P=A.indexOf(S);P!==-1&&A.splice(P,1)}},v=(E,S,A)=>{u.has(E)&&setTimeout(()=>{u.get(E).forEach(P=>{if(t){const D=Array.isArray(S)?S.map(U=>t.serialize(U)):t.serialize(S),k=A?A instanceof PointerEvent?A:t.serialize(A):void 0;P(D,k)}else P(S,A)})},1)},_=()=>{const{selected:E}=s,S=(E||[]).map(({id:A})=>o.getAnnotation(A));S.forEach(A=>{const P=c.find(D=>D.id===A.id);(!P||!Ds(P,A))&&v("updateAnnotation",A,P)}),c=c.map(A=>S.find(({id:P})=>P===A.id)||A)};s.subscribe(({selected:E})=>{if(!(c.length===0&&E.length===0)){if(c.length===0&&E.length>0)c=E.map(({id:S})=>o.getAnnotation(S));else if(c.length>0&&E.length===0)c.forEach(S=>{const A=o.getAnnotation(S.id);A&&!Ds(A,S)&&v("updateAnnotation",A,S)}),c=[];else{const S=new Set(c.map(P=>P.id)),A=new Set(E.map(({id:P})=>P));c.filter(P=>!A.has(P.id)).forEach(P=>{const D=o.getAnnotation(P.id);D&&!Ds(D,P)&&v("updateAnnotation",D,P)}),c=[...c.filter(P=>A.has(P.id)),...E.filter(({id:P})=>!S.has(P)).map(({id:P})=>o.getAnnotation(P))]}v("selectionChanged",c)}}),n.subscribe(E=>{!d&&E?v("mouseEnterAnnotation",o.getAnnotation(E)):d&&!E?v("mouseLeaveAnnotation",o.getAnnotation(d)):d&&E&&(v("mouseLeaveAnnotation",o.getAnnotation(d)),v("mouseEnterAnnotation",o.getAnnotation(E))),d=E}),l==null||l.subscribe(E=>v("viewportIntersect",E.map(S=>o.getAnnotation(S)))),o.observe(E=>{i&&(p&&clearTimeout(p),p=setTimeout(_,1e3));const{created:S,deleted:A}=E.changes;(S||[]).forEach(P=>v("createAnnotation",P)),(A||[]).forEach(P=>v("deleteAnnotation",P)),(E.changes.updated||[]).filter(P=>[...P.bodiesCreated||[],...P.bodiesDeleted||[],...P.bodiesUpdated||[]].length>0).forEach(({oldValue:P,newValue:D})=>{const k=c.find(U=>U.id===P.id)||P;c=c.map(U=>U.id===P.id?D:U),v("updateAnnotation",D,k)})},{origin:Zn.LOCAL}),o.observe(E=>{if(c){const S=new Set(c.map(P=>P.id)),A=(E.changes.updated||[]).filter(({newValue:P})=>S.has(P.id)).map(({newValue:P})=>P);A.length>0&&(c=c.map(P=>A.find(D=>D.id===P.id)||P))}},{origin:Zn.REMOTE});const T=E=>S=>{const{updated:A}=S;E?(A||[]).forEach(P=>v("updateAnnotation",P.oldValue,P.newValue)):(A||[]).forEach(P=>v("updateAnnotation",P.newValue,P.oldValue))};return e.on("undo",T(!0)),e.on("redo",T(!1)),{on:m,off:y,emit:v}},QS=r=>e=>e.reduce((t,i)=>{const{parsed:n,error:s}=r.parse(i);return s?{parsed:t.parsed,failed:[...t.failed,i]}:n?{parsed:[...t.parsed,n],failed:t.failed}:{...t}},{parsed:[],failed:[]}),KS=(r,e,t)=>{const{store:i,selection:n}=r,s=E=>{if(t){const{parsed:S,error:A}=t.parse(E);S?i.addAnnotation(S,Zn.REMOTE):console.error(A)}else i.addAnnotation(Wd(E),Zn.REMOTE)},o=()=>n.clear(),l=()=>i.clear(),u=E=>{const S=i.getAnnotation(E);return t&&S?t.serialize(S):S},c=()=>t?i.all().map(t.serialize):i.all(),d=()=>{var E;const S=(((E=n.selected)==null?void 0:E.map(A=>A.id))||[]).map(A=>i.getAnnotation(A)).filter(Boolean);return t?S.map(t.serialize):S},p=(E,S=!0)=>fetch(E).then(A=>A.json()).then(A=>(y(A,S),A)),m=E=>{if(typeof E=="string"){const S=i.getAnnotation(E);if(i.deleteAnnotation(E),S)return t?t.serialize(S):S}else{const S=t?t.parse(E).parsed:E;if(S)return i.deleteAnnotation(S),E}},y=(E,S=!0)=>{if(t){const A=t.parseAll||QS(t),{parsed:P,failed:D}=A(E);D.length>0&&console.warn(`Discarded ${D.length} invalid annotations`,D),i.bulkAddAnnotations(P,S,Zn.REMOTE)}else i.bulkAddAnnotations(E.map(Wd),S,Zn.REMOTE)},v=(E,S)=>{E?n.setSelected(E,S):n.clear()},_=E=>{n.clear(),n.setUserSelectAction(E)},T=E=>{if(t){const S=t.parse(E).parsed,A=t.serialize(i.getAnnotation(S.id));return i.updateAnnotation(S),A}else{const S=i.getAnnotation(E.id);return i.updateAnnotation(Wd(E)),S}};return{addAnnotation:s,cancelSelected:o,canRedo:e.canRedo,canUndo:e.canUndo,clearAnnotations:l,getAnnotationById:u,getAnnotations:c,getHistory:e.getHistory,getSelected:d,loadAnnotations:p,redo:e.redo,removeAnnotation:m,setAnnotations:y,setSelected:v,setUserSelectAction:_,undo:e.undo,updateAnnotation:T}},JS="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let $S=r=>crypto.getRandomValues(new Uint8Array(r)),eA=(r,e,t)=>{let i=(2<<Math.log2(r.length-1))-1,n=-~(1.6*i*e/r.length);return(s=e)=>{let o="";for(;;){let l=t(n),u=n|0;for(;u--;)if(o+=r[l[u]&i]||"",o.length>=s)return o}}},tA=(r,e=21)=>eA(r,e|0,$S),iA=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=JS[t[r]&63];return e};const rA=()=>({isGuest:!0,id:tA("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",20)()});iA();var nA=Object.defineProperty,sA=(r,e,t)=>e in r?nA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Pt=(r,e,t)=>sA(r,typeof e!="symbol"?e+"":e,t);function yn(){}function Xf(r,e){for(const t in e)r[t]=e[t];return r}function o0(r){return r()}function Ev(){return Object.create(null)}function Kr(r){r.forEach(o0)}function ai(r){return typeof r=="function"}function Gs(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}function oA(r){return Object.keys(r).length===0}function aA(r,e,t,i){if(r){const n=a0(r,e,t,i);return r[0](n)}}function a0(r,e,t,i){return r[1]&&i?Xf(t.ctx.slice(),r[1](i(e))):t.ctx}function lA(r,e,t,i){if(r[2]&&i){const n=r[2](i(t));if(e.dirty===void 0)return n;if(typeof n=="object"){const s=[],o=Math.max(e.dirty.length,n.length);for(let l=0;l<o;l+=1)s[l]=e.dirty[l]|n[l];return s}return e.dirty|n}return e.dirty}function uA(r,e,t,i,n,s){if(n){const o=a0(e,t,i,s);r.p(o,n)}}function hA(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}function Sv(r){const e={};for(const t in r)t[0]!=="$"&&(e[t]=r[t]);return e}function mh(r){return r??""}function gh(r,e){r.appendChild(e)}function nt(r,e,t){r.insertBefore(e,t||null)}function rt(r){r.parentNode&&r.parentNode.removeChild(r)}function Fh(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function Ot(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function l0(r){return document.createTextNode(r)}function _r(){return l0(" ")}function hl(){return l0("")}function $t(r,e,t,i){return r.addEventListener(e,t,i),()=>r.removeEventListener(e,t,i)}function te(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function cA(r){return Array.from(r.childNodes)}function Av(r,e,t){r.classList.toggle(e,!!t)}function dA(r,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:i})}let tl;function Qa(r){tl=r}function u0(){if(!tl)throw new Error("Function called outside component initialization");return tl}function h0(r){u0().$$.on_mount.push(r)}function Jp(){const r=u0();return(e,t,{cancelable:i=!1}={})=>{const n=r.$$.callbacks[e];if(n){const s=dA(e,t,{cancelable:i});return n.slice().forEach(o=>{o.call(r,s)}),!s.defaultPrevented}return!0}}function nr(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(i=>i.call(this,e))}const Eo=[],bv=[];let Fo=[];const Cv=[],fA=Promise.resolve();let Wf=!1;function pA(){Wf||(Wf=!0,fA.then(c0))}function Yf(r){Fo.push(r)}const Yd=new Set;let go=0;function c0(){if(go!==0)return;const r=tl;do{try{for(;go<Eo.length;){const e=Eo[go];go++,Qa(e),mA(e.$$)}}catch(e){throw Eo.length=0,go=0,e}for(Qa(null),Eo.length=0,go=0;bv.length;)bv.pop()();for(let e=0;e<Fo.length;e+=1){const t=Fo[e];Yd.has(t)||(Yd.add(t),t())}Fo.length=0}while(Eo.length);for(;Cv.length;)Cv.pop()();Wf=!1,Yd.clear(),Qa(r)}function mA(r){if(r.fragment!==null){r.update(),Kr(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(Yf)}}function gA(r){const e=[],t=[];Fo.forEach(i=>r.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),Fo=e}const ih=new Set;let Ms;function Bh(){Ms={r:0,c:[],p:Ms}}function kh(){Ms.r||Kr(Ms.c),Ms=Ms.p}function Mt(r,e){r&&r.i&&(ih.delete(r),r.i(e))}function ui(r,e,t,i){if(r&&r.o){if(ih.has(r))return;ih.add(r),Ms.c.push(()=>{ih.delete(r),i&&(t&&r.d(1),i())}),r.o(e)}else i&&i()}function es(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function dn(r){r&&r.c()}function Vr(r,e,t){const{fragment:i,after_update:n}=r.$$;i&&i.m(e,t),Yf(()=>{const s=r.$$.on_mount.map(o0).filter(ai);r.$$.on_destroy?r.$$.on_destroy.push(...s):Kr(s),r.$$.on_mount=[]}),n.forEach(Yf)}function jr(r,e){const t=r.$$;t.fragment!==null&&(gA(t.after_update),Kr(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function yA(r,e){r.$$.dirty[0]===-1&&(Eo.push(r),pA(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Vs(r,e,t,i,n,s,o=null,l=[-1]){const u=tl;Qa(r);const c=r.$$={fragment:null,ctx:[],props:s,update:yn,not_equal:n,bound:Ev(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:Ev(),dirty:l,skip_bound:!1,root:e.target||u.$$.root};o&&o(c.root);let d=!1;if(c.ctx=t?t(r,e.props||{},(p,m,...y)=>{const v=y.length?y[0]:m;return c.ctx&&n(c.ctx[p],c.ctx[p]=v)&&(!c.skip_bound&&c.bound[p]&&c.bound[p](v),d&&yA(r,p)),m}):[],c.update(),d=!0,Kr(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){const p=cA(e.target);c.fragment&&c.fragment.l(p),p.forEach(rt)}else c.fragment&&c.fragment.c();e.intro&&Mt(r.$$.fragment),Vr(r,e.target,e.anchor),c0()}Qa(u)}class js{constructor(){Pt(this,"$$"),Pt(this,"$$set")}$destroy(){jr(this,1),this.$destroy=yn}$on(e,t){if(!ai(t))return yn;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const n=i.indexOf(t);n!==-1&&i.splice(n,1)}}$set(e){this.$$set&&!oA(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const vA="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(vA);var Ht=(r=>(r.ELLIPSE="ELLIPSE",r.MULTIPOLYGLON="MULTIPOLYGON",r.POLYGON="POLYGON",r.RECTANGLE="RECTANGLE",r))(Ht||{});const $p={},Uh=(r,e)=>$p[r]=e,qf=r=>$p[r.type].area(r),_A=(r,e,t)=>$p[r.type].intersects(r,e,t),Xo=r=>{let e=1/0,t=1/0,i=-1/0,n=-1/0;return r.forEach(([s,o])=>{e=Math.min(e,s),t=Math.min(t,o),i=Math.max(i,s),n=Math.max(n,o)}),{minX:e,minY:t,maxX:i,maxY:n}},Zf=r=>{let e=0,t=r.length-1;for(let i=0;i<r.length;i++)e+=(r[t][0]+r[i][0])*(r[t][1]-r[i][1]),t=i;return Math.abs(.5*e)},Qf=(r,e,t)=>{let i=!1;for(let n=0,s=r.length-1;n<r.length;s=n++){const o=r[n][0],l=r[n][1],u=r[s][0],c=r[s][1];l>t!=c>t&&e<(u-o)*(t-l)/(c-l)+o&&(i=!i)}return i},xA=(r,e=!0)=>{let t="M ";return r.forEach(([i,n],s)=>{s===0?t+=`${i},${n}`:t+=` L ${i},${n}`}),e&&(t+=" Z"),t},TA={area:r=>Math.PI*r.geometry.rx*r.geometry.ry,intersects:(r,e,t)=>{const{cx:i,cy:n,rx:s,ry:o}=r.geometry,l=0,u=Math.cos(l),c=Math.sin(l),d=e-i,p=t-n,m=u*d+c*p,y=c*d-u*p;return m*m/(s*s)+y*y/(o*o)<=1}};Uh(Ht.ELLIPSE,TA);const wA={area:r=>{const{polygons:e}=r.geometry;return e.reduce((t,i)=>{const[n,...s]=i.rings,o=Zf(n.points),l=s.reduce((u,c)=>u+Zf(c.points),0);return t+o-l},0)},intersects:(r,e,t)=>{const{polygons:i}=r.geometry;for(const n of i){const[s,...o]=n.rings;if(Qf(s.points,e,t)){let l=!1;for(const u of o)if(Qf(u.points,e,t)){l=!0;break}if(!l)return!0}}return!1}},EA=r=>{const e=r.reduce((t,i)=>[...t,...i.rings[0].points],[]);return Xo(e)},bu=r=>r.rings.map(e=>xA(e.points)).join(" ");Uh(Ht.MULTIPOLYGLON,wA);const SA={area:r=>{const e=r.geometry.points;return Zf(e)},intersects:(r,e,t)=>{const i=r.geometry.points;return Qf(i,e,t)}};Uh(Ht.POLYGON,SA);const AA={area:r=>r.geometry.w*r.geometry.h,intersects:(r,e,t)=>e>=r.geometry.x&&e<=r.geometry.x+r.geometry.w&&t>=r.geometry.y&&t<=r.geometry.y+r.geometry.h};Uh(Ht.RECTANGLE,AA);const Ls=r=>rh(r.target),rh=r=>{var e,t;return(r==null?void 0:r.annotation)!==void 0&&((t=(e=r==null?void 0:r.selector)==null?void 0:e.geometry)==null?void 0:t.bounds)!==void 0},Vt=" ";function bA(r){let e="";Array.isArray(r)||(r=[r]);for(let t=0;t<r.length;t++){const i=r[t];if(i.type===oe.CLOSE_PATH)e+="z";else if(i.type===oe.HORIZ_LINE_TO)e+=(i.relative?"h":"H")+i.x;else if(i.type===oe.VERT_LINE_TO)e+=(i.relative?"v":"V")+i.y;else if(i.type===oe.MOVE_TO)e+=(i.relative?"m":"M")+i.x+Vt+i.y;else if(i.type===oe.LINE_TO)e+=(i.relative?"l":"L")+i.x+Vt+i.y;else if(i.type===oe.CURVE_TO)e+=(i.relative?"c":"C")+i.x1+Vt+i.y1+Vt+i.x2+Vt+i.y2+Vt+i.x+Vt+i.y;else if(i.type===oe.SMOOTH_CURVE_TO)e+=(i.relative?"s":"S")+i.x2+Vt+i.y2+Vt+i.x+Vt+i.y;else if(i.type===oe.QUAD_TO)e+=(i.relative?"q":"Q")+i.x1+Vt+i.y1+Vt+i.x+Vt+i.y;else if(i.type===oe.SMOOTH_QUAD_TO)e+=(i.relative?"t":"T")+i.x+Vt+i.y;else if(i.type===oe.ARC)e+=(i.relative?"a":"A")+i.rX+Vt+i.rY+Vt+i.xRot+Vt+ +i.lArcFlag+Vt+ +i.sweepFlag+Vt+i.x+Vt+i.y;else throw new Error(`Unexpected command type "${i==null?void 0:i.type}" at index ${t}.`)}return e}function Kf([r,e],t){return[r*Math.cos(t)-e*Math.sin(t),r*Math.sin(t)+e*Math.cos(t)]}function br(...r){for(let e=0;e<r.length;e++)if(typeof r[e]!="number")throw new Error(`assertNumbers arguments[${e}] is not a number. ${typeof r[e]} == typeof ${r[e]}`);return!0}const Xn=Math.PI;function em(r,e,t){r.lArcFlag=r.lArcFlag===0?0:1,r.sweepFlag=r.sweepFlag===0?0:1;let{rX:i,rY:n}=r;const{x:s,y:o}=r;if(Math.abs(i)<1e-10||Math.abs(n)<1e-10){r.rX=0,r.rY=0,r.cX=(e+s)/2,r.cY=(t+o)/2,r.phi1=0,r.phi2=0;return}i=Math.abs(r.rX),n=Math.abs(r.rY);const l=r.xRot/180*Xn,[u,c]=Kf([(e-s)/2,(t-o)/2],-l),d=Math.pow(u,2)/Math.pow(i,2)+Math.pow(c,2)/Math.pow(n,2);1<d&&(i*=Math.sqrt(d),n*=Math.sqrt(d)),r.rX=i,r.rY=n;const p=Math.pow(i,2)*Math.pow(c,2)+Math.pow(n,2)*Math.pow(u,2),m=(r.lArcFlag!==r.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(i,2)*Math.pow(n,2)-p)/p)),y=i*c/n*m,v=-n*u/i*m,_=Kf([y,v],l);r.cX=_[0]+(e+s)/2,r.cY=_[1]+(t+o)/2,r.phi1=Math.atan2((c-v)/n,(u-y)/i),r.phi2=Math.atan2((-c-v)/n,(-u-y)/i),r.sweepFlag===0&&r.phi2>r.phi1&&(r.phi2-=2*Xn),r.sweepFlag===1&&r.phi2<r.phi1&&(r.phi2+=2*Xn),r.phi1*=180/Xn,r.phi2*=180/Xn}function Rv(r,e,t){br(r,e,t);const i=r*r+e*e-t*t;if(0>i)return[];if(i===0)return[[r*t/(r*r+e*e),e*t/(r*r+e*e)]];const n=Math.sqrt(i);return[[(r*t+e*n)/(r*r+e*e),(e*t-r*n)/(r*r+e*e)],[(r*t-e*n)/(r*r+e*e),(e*t+r*n)/(r*r+e*e)]]}const Ts=Math.PI/180;function Pv(r,e,t){return(1-t)*r+t*e}function Ov(r,e,t,i){return r+Math.cos(i/180*Xn)*e+Math.sin(i/180*Xn)*t}function Iv(r,e,t,i){const n=e-r,s=t-e,o=i-t,l=3*n+3*o-6*s,u=(s-n)*6,c=3*n;return Math.abs(l)<1e-6?Math.abs(u)<1e-6?[]:[-c/u]:CA(u/l,c/l,1e-6)}function Mv(r,e,t,i,n){const s=1-n,o=s*s*s,l=3*s*s*n,u=3*s*n*n,c=n*n*n;return r*o+e*l+t*u+i*c}function CA(r,e,t=1e-6){const i=r*r/4-e;if(i<-t)return[];if(i<=t)return[-r/2];const n=Math.sqrt(i);return[-(r/2)-n,-(r/2)+n]}function RA(r,e,t){r.cX||em(r,e,t);const i=r.xRot/180*Xn;if(Math.abs(r.rX)<1e-10||Math.abs(r.rY)<1e-10)return[{relative:r.relative,type:oe.CURVE_TO,x1:e+(r.x-e)/3,y1:t+(r.y-t)/3,x2:e+2*(r.x-e)/3,y2:t+2*(r.y-t)/3,x:r.x,y:r.y}];const n=Math.min(r.phi1,r.phi2),s=Math.max(r.phi1,r.phi2),o=s-n,l=Math.ceil(o/90),u=new Array(l);let c=e,d=t;const p=(m,y)=>{const[v,_]=Kf([m*r.rX,y*r.rY],i);return[r.cX+v,r.cY+_]};for(let m=0;m<l;m++){const y=Pv(r.phi1,r.phi2,m/l),v=Pv(r.phi1,r.phi2,(m+1)/l),_=v-y,T=4/3*Math.tan(_*Ts/4),E=Math.cos(y*Ts)-T*Math.sin(y*Ts),S=Math.sin(y*Ts)+T*Math.cos(y*Ts),A=Math.cos(v*Ts),P=Math.sin(v*Ts),D=A+T*P,k=P-T*A,U=p(E,S),j=p(D,k),q=p(A,P),ee={relative:r.relative,type:oe.CURVE_TO,x:q[0],y:q[1],x1:U[0],y1:U[1],x2:j[0],y2:j[1]};r.relative&&(ee.x1-=c,ee.y1-=d,ee.x2-=c,ee.y2-=d,ee.x-=c,ee.y-=d),c=q[0],d=q[1],u[m]=ee}return u}function qd(r,e,t){const i=e[0]-r[0],n=e[1]-r[1],s=t[0]-r[0],o=t[1]-r[1],l=i*o-n*s;if(!(Math.abs(l)<1e-10))return!1;const u=i*s+n*o,c=i*i+n*n,d=s*s+o*o;return 0<=u&&u<=d&&c<=d}function PA(r,e=!0){if(r.length<2)return r;const t=Wt.INFO((s,o,l)=>({...s,x:s.x??o,y:s.y??l,relative:s.relative??!1})),i=[];let n=[];for(const s of r){const o=t(s);o.type===oe.MOVE_TO&&n.length>0&&(e?i.push(...Cu(n)):i.unshift(...Cu(n)),n=[]),n.push(o)}return n.length>0&&(e?i.push(...Cu(n)):i.unshift(...Cu(n))),i}function Cu(r){var e;const t=((e=r[r.length-1])==null?void 0:e.type)===oe.CLOSE_PATH,i=t?r.length-2:r.length-1,n=[{type:oe.MOVE_TO,relative:!1,x:r[i].x,y:r[i].y}];for(let s=i;s>0;s--){const o=r[s],l=r[s-1];if(o.relative)throw new Error("Relative command are not supported convert first with `toAbs()`");switch(o.type){case oe.HORIZ_LINE_TO:n.push({type:oe.HORIZ_LINE_TO,relative:!1,x:l.x});break;case oe.VERT_LINE_TO:n.push({type:oe.VERT_LINE_TO,relative:!1,y:l.y});break;case oe.LINE_TO:case oe.MOVE_TO:n.push({type:oe.LINE_TO,relative:!1,x:l.x,y:l.y});break;case oe.CURVE_TO:n.push({type:oe.CURVE_TO,relative:!1,x:l.x,y:l.y,x1:o.x2,y1:o.y2,x2:o.x1,y2:o.y1});break;case oe.SMOOTH_CURVE_TO:throw new Error("Unsupported command: S (smooth cubic bezier)");case oe.SMOOTH_QUAD_TO:throw new Error("Unsupported command: T (smooth quadratic bezier)");case oe.ARC:throw new Error("Unsupported command: A (arc)");case oe.QUAD_TO:throw new Error("Unsupported command: Q (quadratic bezier)")}}return t&&n.push({type:oe.CLOSE_PATH}),n}function OA(r=1e13){br(r);function e(t){return Math.round(t*r)/r}return function(t){return"x1"in t&&typeof t.x1<"u"&&(t.x1=e(t.x1)),"y1"in t&&typeof t.y1<"u"&&(t.y1=e(t.y1)),"x2"in t&&typeof t.x2<"u"&&(t.x2=e(t.x2)),"y2"in t&&typeof t.y2<"u"&&(t.y2=e(t.y2)),"x"in t&&typeof t.x<"u"&&(t.x=e(t.x)),"y"in t&&typeof t.y<"u"&&(t.y=e(t.y)),"rX"in t&&typeof t.rX<"u"&&(t.rX=e(t.rX)),"rY"in t&&typeof t.rY<"u"&&(t.rY=e(t.rY)),t}}function d0(){return Cr((r,e,t)=>(r.relative&&(typeof r.x1<"u"&&(r.x1+=e),typeof r.y1<"u"&&(r.y1+=t),typeof r.x2<"u"&&(r.x2+=e),typeof r.y2<"u"&&(r.y2+=t),typeof r.x<"u"&&(r.x+=e),typeof r.y<"u"&&(r.y+=t),r.relative=!1),r))}function IA(){return Cr((r,e,t)=>(r.relative||(typeof r.x1<"u"&&(r.x1-=e),typeof r.y1<"u"&&(r.y1-=t),typeof r.x2<"u"&&(r.x2-=e),typeof r.y2<"u"&&(r.y2-=t),typeof r.x<"u"&&(r.x-=e),typeof r.y<"u"&&(r.y-=t),r.relative=!0),r))}function MA(r=!0,e=!0,t=!0,i=!0){return Cr((n,s,o,l,u)=>{if(isNaN(l)&&!(n.type&oe.MOVE_TO))throw new Error("path must start with moveto");if(e&&n.type&oe.HORIZ_LINE_TO&&(n.type=oe.LINE_TO,n.y=n.relative?0:o),t&&n.type&oe.VERT_LINE_TO&&(n.type=oe.LINE_TO,n.x=n.relative?0:s),r&&n.type&oe.CLOSE_PATH&&(n.type=oe.LINE_TO,n.x=n.relative?l-s:l,n.y=n.relative?u-o:u),n.type&oe.ARC&&(n.rX===0||n.rY===0)&&(n.type=oe.LINE_TO,delete n.rX,delete n.rY,delete n.xRot,delete n.lArcFlag,delete n.sweepFlag),i&&n.type&oe.QUAD_TO){const c=[s,o],d=n.relative?[s+n.x1,o+n.y1]:[n.x1,n.y1],p=n.relative?[s+n.x,o+n.y]:[n.x,n.y];qd(c,d,p)&&(n.type=oe.LINE_TO,delete n.x1,delete n.y1)}if(i&&n.type&oe.CURVE_TO){const c=[s,o],d=n.relative?[s+n.x1,o+n.y1]:[n.x1,n.y1],p=n.relative?[s+n.x2,o+n.y2]:[n.x2,n.y2],m=n.relative?[s+n.x,o+n.y]:[n.x,n.y];qd(c,d,m)&&qd(c,p,m)&&(n.type=oe.LINE_TO,delete n.x1,delete n.y1,delete n.x2,delete n.y2)}return n})}function f0(){let r=NaN,e=NaN,t=NaN,i=NaN;return Cr((n,s,o)=>(n.type&oe.SMOOTH_CURVE_TO&&(n.type=oe.CURVE_TO,r=isNaN(r)?s:r,e=isNaN(e)?o:e,n.x1=n.relative?s-r:2*s-r,n.y1=n.relative?o-e:2*o-e),n.type&oe.CURVE_TO?(r=n.relative?s+n.x2:n.x2,e=n.relative?o+n.y2:n.y2):(r=NaN,e=NaN),n.type&oe.SMOOTH_QUAD_TO&&(n.type=oe.QUAD_TO,t=isNaN(t)?s:t,i=isNaN(i)?o:i,n.x1=n.relative?s-t:2*s-t,n.y1=n.relative?o-i:2*o-i),n.type&oe.QUAD_TO?(t=n.relative?s+n.x1:n.x1,i=n.relative?o+n.y1:n.y1):(t=NaN,i=NaN),n))}function p0(){let r=NaN,e=NaN;return Cr((t,i,n)=>{if(t.type&oe.SMOOTH_QUAD_TO&&(t.type=oe.QUAD_TO,r=isNaN(r)?i:r,e=isNaN(e)?n:e,t.x1=t.relative?i-r:2*i-r,t.y1=t.relative?n-e:2*n-e),t.type&oe.QUAD_TO){r=t.relative?i+t.x1:t.x1,e=t.relative?n+t.y1:t.y1;const s=t.x1,o=t.y1;t.type=oe.CURVE_TO,t.x1=((t.relative?0:i)+s*2)/3,t.y1=((t.relative?0:n)+o*2)/3,t.x2=(t.x+s*2)/3,t.y2=(t.y+o*2)/3}else r=NaN,e=NaN;return t})}function Cr(r){let e=0,t=0,i=NaN,n=NaN;return function(s){if(isNaN(i)&&!(s.type&oe.MOVE_TO))throw new Error("path must start with moveto");const o=r(s,e,t,i,n);return s.type&oe.CLOSE_PATH&&(e=i,t=n),"x"in s&&typeof s.x<"u"&&(e=s.relative?e+s.x:s.x),"y"in s&&typeof s.y<"u"&&(t=s.relative?t+s.y:s.y),s.type&oe.MOVE_TO&&(i=e,n=t),o}}function NA(r=0){br(r);let e=NaN,t=NaN,i=NaN,n=NaN;return Cr((s,o,l,u,c)=>{const d=Math.abs;let p=!1,m=0,y=0;if(s.type&oe.SMOOTH_CURVE_TO&&(m=isNaN(e)?0:o-e,y=isNaN(t)?0:l-t),s.type&(oe.CURVE_TO|oe.SMOOTH_CURVE_TO)?(e=s.relative?o+s.x2:s.x2,t=s.relative?l+s.y2:s.y2):(e=NaN,t=NaN),s.type&oe.SMOOTH_QUAD_TO?(i=isNaN(i)?o:2*o-i,n=isNaN(n)?l:2*l-n):s.type&oe.QUAD_TO?(i=s.relative?o+s.x1:s.x1,n=s.relative?l+s.y1:s.y2):(i=NaN,n=NaN),s.type&oe.LINE_COMMANDS||s.type&oe.ARC&&(s.rX===0||s.rY===0||!s.lArcFlag)||s.type&oe.CURVE_TO||s.type&oe.SMOOTH_CURVE_TO||s.type&oe.QUAD_TO||s.type&oe.SMOOTH_QUAD_TO){const v=typeof s.x>"u"?0:s.relative?s.x:s.x-o,_=typeof s.y>"u"?0:s.relative?s.y:s.y-l;m=isNaN(i)?typeof s.x1>"u"?m:s.relative?s.x:s.x1-o:i-o,y=isNaN(n)?typeof s.y1>"u"?y:s.relative?s.y:s.y1-l:n-l;const T=typeof s.x2>"u"?0:s.relative?s.x:s.x2-o,E=typeof s.y2>"u"?0:s.relative?s.y:s.y2-l;d(v)<=r&&d(_)<=r&&d(m)<=r&&d(y)<=r&&d(T)<=r&&d(E)<=r&&(p=!0)}return s.type&oe.CLOSE_PATH&&d(o-u)<=r&&d(l-c)<=r&&(p=!0),p?[]:s})}function ns(r,e,t,i,n,s){return br(r,e,t,i,n,s),Cr((o,l,u,c)=>{const d=o.x1,p=o.x2,m=o.relative&&!isNaN(c),y=typeof o.x<"u"?o.x:m?0:l,v=typeof o.y<"u"?o.y:m?0:u;o.type&oe.HORIZ_LINE_TO&&e!==0&&(o.type=oe.LINE_TO,o.y=o.relative?0:u),o.type&oe.VERT_LINE_TO&&t!==0&&(o.type=oe.LINE_TO,o.x=o.relative?0:l),typeof o.x<"u"&&(o.x=o.x*r+v*t+(m?0:n)),typeof o.y<"u"&&(o.y=y*e+o.y*i+(m?0:s)),typeof o.x1<"u"&&(o.x1=o.x1*r+o.y1*t+(m?0:n)),typeof o.y1<"u"&&(o.y1=d*e+o.y1*i+(m?0:s)),typeof o.x2<"u"&&(o.x2=o.x2*r+o.y2*t+(m?0:n)),typeof o.y2<"u"&&(o.y2=p*e+o.y2*i+(m?0:s));function _(E){return E*E}const T=r*i-e*t;if(typeof o.xRot<"u"&&(r!==1||e!==0||t!==0||i!==1))if(T===0)delete o.rX,delete o.rY,delete o.xRot,delete o.lArcFlag,delete o.sweepFlag,o.type=oe.LINE_TO;else{const E=o.xRot*Math.PI/180,S=Math.sin(E),A=Math.cos(E),P=1/_(o.rX),D=1/_(o.rY),k=_(A)*P+_(S)*D,U=2*S*A*(P-D),j=_(S)*P+_(A)*D,q=k*i*i-U*e*i+j*e*e,ee=U*(r*i+e*t)-2*(k*t*i+j*r*e),pe=k*t*t-U*r*t+j*r*r,H=(Math.atan2(ee,q-pe)+Math.PI)%Math.PI/2,F=Math.sin(H),G=Math.cos(H);o.rX=Math.abs(T)/Math.sqrt(q*_(G)+ee*F*G+pe*_(F)),o.rY=Math.abs(T)/Math.sqrt(q*_(F)-ee*F*G+pe*_(G)),o.xRot=H*180/Math.PI}return typeof o.sweepFlag<"u"&&0>T&&(o.sweepFlag=+!o.sweepFlag),o})}function DA(r,e=0,t=0){br(r,e,t);const i=Math.sin(r),n=Math.cos(r);return ns(n,i,-i,n,e-e*n+t*i,t-e*i-t*n)}function LA(r,e=0){return br(r,e),ns(1,0,0,1,r,e)}function FA(r,e=r){return br(r,e),ns(r,0,0,e,0,0)}function BA(r){return br(r),ns(1,0,Math.tan(r),1,0,0)}function kA(r){return br(r),ns(1,Math.tan(r),0,1,0,0)}function UA(r=0){return br(r),ns(-1,0,0,1,r,0)}function HA(r=0){return br(r),ns(1,0,0,-1,0,r)}function zA(){return Cr((r,e,t)=>oe.ARC===r.type?RA(r,r.relative?0:e,r.relative?0:t):r)}function GA(){return Cr((r,e,t)=>(r.relative&&(e=0,t=0),oe.ARC===r.type&&em(r,e,t),r))}function m0(){return r=>({...r})}function VA(){const r=m0(),e=d0(),t=p0(),i=f0(),n=Cr((s,o,l)=>{const u=i(t(e(r(s))));function c(p){p>n.maxX&&(n.maxX=p),p<n.minX&&(n.minX=p)}function d(p){p>n.maxY&&(n.maxY=p),p<n.minY&&(n.minY=p)}if(u.type&oe.DRAWING_COMMANDS&&(c(o),d(l)),u.type&oe.HORIZ_LINE_TO&&c(u.x),u.type&oe.VERT_LINE_TO&&d(u.y),u.type&oe.LINE_TO&&(c(u.x),d(u.y)),u.type&oe.CURVE_TO){c(u.x),d(u.y);const p=Iv(o,u.x1,u.x2,u.x);for(const y of p)0<y&&1>y&&c(Mv(o,u.x1,u.x2,u.x,y));const m=Iv(l,u.y1,u.y2,u.y);for(const y of m)0<y&&1>y&&d(Mv(l,u.y1,u.y2,u.y,y))}if(u.type&oe.ARC){c(u.x),d(u.y),em(u,o,l);const p=u.xRot/180*Math.PI,m=Math.cos(p)*u.rX,y=Math.sin(p)*u.rX,v=-Math.sin(p)*u.rY,_=Math.cos(p)*u.rY,[T,E]=u.phi1<u.phi2?[u.phi1,u.phi2]:-180>u.phi2?[u.phi2+360,u.phi1+360]:[u.phi2,u.phi1],S=([D,k])=>{const U=Math.atan2(k,D)*180/Math.PI;return U<T?U+360:U},A=Rv(v,-m,0).map(S);for(const D of A)D>T&&D<E&&c(Ov(u.cX,m,v,D));const P=Rv(_,-y,0).map(S);for(const D of P)D>T&&D<E&&d(Ov(u.cY,y,_,D))}return s});return n.minX=1/0,n.maxX=-1/0,n.minY=1/0,n.maxY=-1/0,n}const Wt={ROUND:OA,TO_ABS:d0,TO_REL:IA,NORMALIZE_HVZ:MA,NORMALIZE_ST:f0,QT_TO_C:p0,INFO:Cr,SANITIZE:NA,MATRIX:ns,ROTATE:DA,TRANSLATE:LA,SCALE:FA,SKEW_X:BA,SKEW_Y:kA,X_AXIS_SYMMETRY:UA,Y_AXIS_SYMMETRY:HA,A_TO_C:zA,ANNOTATE_ARCS:GA,CLONE:m0,CALCULATE_BOUNDS:VA,REVERSE_PATH:PA};class g0{round(e){return this.transform(Wt.ROUND(e))}toAbs(){return this.transform(Wt.TO_ABS())}toRel(){return this.transform(Wt.TO_REL())}normalizeHVZ(e,t,i){return this.transform(Wt.NORMALIZE_HVZ(e,t,i))}normalizeST(){return this.transform(Wt.NORMALIZE_ST())}qtToC(){return this.transform(Wt.QT_TO_C())}aToC(){return this.transform(Wt.A_TO_C())}sanitize(e){return this.transform(Wt.SANITIZE(e))}translate(e,t){return this.transform(Wt.TRANSLATE(e,t))}scale(e,t){return this.transform(Wt.SCALE(e,t))}rotate(e,t,i){return this.transform(Wt.ROTATE(e,t,i))}matrix(e,t,i,n,s,o){return this.transform(Wt.MATRIX(e,t,i,n,s,o))}skewX(e){return this.transform(Wt.SKEW_X(e))}skewY(e){return this.transform(Wt.SKEW_Y(e))}xSymmetry(e){return this.transform(Wt.X_AXIS_SYMMETRY(e))}ySymmetry(e){return this.transform(Wt.Y_AXIS_SYMMETRY(e))}annotateArcs(){return this.transform(Wt.ANNOTATE_ARCS())}}const jA=r=>r===" "||r==="	"||r==="\r"||r===`
`,Nv=r=>48<=r.charCodeAt(0)&&r.charCodeAt(0)<=57;class XA extends g0{constructor(){super(),Pt(this,"curNumber",""),Pt(this,"curCommandType",-1),Pt(this,"curCommandRelative",!1),Pt(this,"canParseCommandOrComma",!0),Pt(this,"curNumberHasExp",!1),Pt(this,"curNumberHasExpDigits",!1),Pt(this,"curNumberHasDecimal",!1),Pt(this,"curArgs",[])}finish(e=[]){if(this.parse(" ",e),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return e}parse(e,t=[]){const i=n=>{t.push(n),this.curArgs.length=0,this.canParseCommandOrComma=!0};for(let n=0;n<e.length;n++){const s=e[n],o=this.curCommandType===oe.ARC&&(this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber.length===1&&(this.curNumber==="0"||this.curNumber==="1"),l=Nv(s)&&(this.curNumber==="0"&&s==="0"||o);if(Nv(s)&&!l){this.curNumber+=s,this.curNumberHasExpDigits=this.curNumberHasExp;continue}if(s==="e"||s==="E"){this.curNumber+=s,this.curNumberHasExp=!0;continue}if((s==="-"||s==="+")&&this.curNumberHasExp&&!this.curNumberHasExpDigits){this.curNumber+=s;continue}if(s==="."&&!this.curNumberHasExp&&!this.curNumberHasDecimal&&!o){this.curNumber+=s,this.curNumberHasDecimal=!0;continue}if(this.curNumber&&this.curCommandType!==-1){const u=Number(this.curNumber);if(isNaN(u))throw new SyntaxError(`Invalid number ending at ${n}`);if(this.curCommandType===oe.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>u)throw new SyntaxError(`Expected positive number, got "${u}" at index "${n}"`)}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError(`Expected a flag, got "${this.curNumber}" at index "${n}"`)}this.curArgs.push(u),this.curArgs.length===WA[this.curCommandType]&&(oe.HORIZ_LINE_TO===this.curCommandType?i({type:oe.HORIZ_LINE_TO,relative:this.curCommandRelative,x:u}):oe.VERT_LINE_TO===this.curCommandType?i({type:oe.VERT_LINE_TO,relative:this.curCommandRelative,y:u}):this.curCommandType===oe.MOVE_TO||this.curCommandType===oe.LINE_TO||this.curCommandType===oe.SMOOTH_QUAD_TO?(i({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),oe.MOVE_TO===this.curCommandType&&(this.curCommandType=oe.LINE_TO)):this.curCommandType===oe.CURVE_TO?i({type:oe.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===oe.SMOOTH_CURVE_TO?i({type:oe.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===oe.QUAD_TO?i({type:oe.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===oe.ARC&&i({type:oe.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!jA(s)){if(s===","&&this.canParseCommandOrComma){this.canParseCommandOrComma=!1;continue}if(s==="+"||s==="-"||s==="."){this.curNumber=s,this.curNumberHasDecimal=s===".";continue}if(l){this.curNumber=s,this.curNumberHasDecimal=!1;continue}if(this.curArgs.length!==0)throw new SyntaxError(`Unterminated command at index ${n}.`);if(!this.canParseCommandOrComma)throw new SyntaxError(`Unexpected character "${s}" at index ${n}. Command cannot follow comma`);if(this.canParseCommandOrComma=!1,s==="z"||s==="Z"){t.push({type:oe.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1;continue}else if(s==="h"||s==="H")this.curCommandType=oe.HORIZ_LINE_TO,this.curCommandRelative=s==="h";else if(s==="v"||s==="V")this.curCommandType=oe.VERT_LINE_TO,this.curCommandRelative=s==="v";else if(s==="m"||s==="M")this.curCommandType=oe.MOVE_TO,this.curCommandRelative=s==="m";else if(s==="l"||s==="L")this.curCommandType=oe.LINE_TO,this.curCommandRelative=s==="l";else if(s==="c"||s==="C")this.curCommandType=oe.CURVE_TO,this.curCommandRelative=s==="c";else if(s==="s"||s==="S")this.curCommandType=oe.SMOOTH_CURVE_TO,this.curCommandRelative=s==="s";else if(s==="q"||s==="Q")this.curCommandType=oe.QUAD_TO,this.curCommandRelative=s==="q";else if(s==="t"||s==="T")this.curCommandType=oe.SMOOTH_QUAD_TO,this.curCommandRelative=s==="t";else if(s==="a"||s==="A")this.curCommandType=oe.ARC,this.curCommandRelative=s==="a";else throw new SyntaxError(`Unexpected character "${s}" at index ${n}.`)}}return t}transform(e){return Object.create(this,{parse:{value(t,i=[]){const n=Object.getPrototypeOf(this).parse.call(this,t);for(const s of n){const o=e(s);Array.isArray(o)?i.push(...o):i.push(o)}return i}}})}}const Et=class Jf extends g0{constructor(e){super(),Pt(this,"commands"),typeof e=="string"?this.commands=Jf.parse(e):this.commands=e}encode(){return Jf.encode(this.commands)}getBounds(){const e=Wt.CALCULATE_BOUNDS();return this.transform(e),e}transform(e){const t=[];for(const i of this.commands){const n=e(i);Array.isArray(n)?t.push(...n):t.push(n)}return this.commands=t,this}reverse(e=!0){return this.commands=Wt.REVERSE_PATH(this.commands,e),this}static encode(e){return bA(e)}static parse(e){const t=new XA,i=[];return t.parse(e,i),t.finish(i),i}};Pt(Et,"CLOSE_PATH",1),Pt(Et,"MOVE_TO",2),Pt(Et,"HORIZ_LINE_TO",4),Pt(Et,"VERT_LINE_TO",8),Pt(Et,"LINE_TO",16),Pt(Et,"CURVE_TO",32),Pt(Et,"SMOOTH_CURVE_TO",64),Pt(Et,"QUAD_TO",128),Pt(Et,"SMOOTH_QUAD_TO",256),Pt(Et,"ARC",512),Pt(Et,"LINE_COMMANDS",Et.LINE_TO|Et.HORIZ_LINE_TO|Et.VERT_LINE_TO),Pt(Et,"DRAWING_COMMANDS",Et.HORIZ_LINE_TO|Et.VERT_LINE_TO|Et.LINE_TO|Et.CURVE_TO|Et.SMOOTH_CURVE_TO|Et.QUAD_TO|Et.SMOOTH_QUAD_TO|Et.ARC);let oe=Et;const WA={[oe.MOVE_TO]:2,[oe.LINE_TO]:2,[oe.HORIZ_LINE_TO]:1,[oe.VERT_LINE_TO]:1,[oe.CLOSE_PATH]:0,[oe.QUAD_TO]:4,[oe.SMOOTH_QUAD_TO]:2,[oe.CURVE_TO]:6,[oe.SMOOTH_CURVE_TO]:4,[oe.ARC]:7},YA=[];for(let r=0;r<256;++r)YA.push((r+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var Dv=Object.prototype.hasOwnProperty;function il(r,e){var t,i;if(r===e)return!0;if(r&&e&&(t=r.constructor)===e.constructor){if(t===Date)return r.getTime()===e.getTime();if(t===RegExp)return r.toString()===e.toString();if(t===Array){if((i=r.length)===e.length)for(;i--&&il(r[i],e[i]););return i===-1}if(!t||typeof r=="object"){i=0;for(t in r)if(Dv.call(r,t)&&++i&&!Dv.call(e,t)||!(t in e)||!il(r[t],e[t]))return!1;return Object.keys(e).length===i}}return r!==r&&e!==e}function Zd(){}function qA(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}const yo=[];function tm(r,e=Zd){let t;const i=new Set;function n(l){if(qA(r,l)&&(r=l,t)){const u=!yo.length;for(const c of i)c[1](),yo.push(c,r);if(u){for(let c=0;c<yo.length;c+=2)yo[c][0](yo[c+1]);yo.length=0}}}function s(l){n(l(r))}function o(l,u=Zd){const c=[l,u];return i.add(c),i.size===1&&(t=e(n,s)||Zd),l(r),()=>{i.delete(c),i.size===0&&t&&(t(),t=null)}}return{set:n,update:s,subscribe:o}}const ZA=r=>{const{subscribe:e,set:t}=tm();let i;return e(n=>i=n),r.observe(({changes:n})=>{if(i){(n.deleted||[]).some(o=>o.id===i)&&t(void 0);const s=(n.updated||[]).find(({oldValue:o})=>o.id===i);s&&t(s.newValue.id)}}),{get current(){return i},subscribe:e,set:t}},Ru={selected:[]},QA=(r,e,t)=>{const{subscribe:i,set:n}=tm(Ru);let s=e,o=Ru;i(v=>o=v);const l=()=>{il(o,Ru)||n(Ru)},u=()=>{var v;return((v=o.selected)==null?void 0:v.length)===0},c=v=>{if(u())return!1;const _=typeof v=="string"?v:v.id;return o.selected.some(T=>T.id===_)},d=(v,_)=>{let T;if(Array.isArray(v)){if(T=v.map(S=>r.getAnnotation(S)).filter(Boolean),T.length<v.length){console.warn("Invalid selection: "+v.filter(S=>!T.some(A=>A.id===S)));return}}else{const S=r.getAnnotation(v);if(!S){console.warn("Invalid selection: "+v);return}T=[S]}const E=T.reduce((S,A)=>{const P=Lv(A,s,t);return P==="EDIT"?[...S,{id:A.id,editable:!0}]:P==="SELECT"?[...S,{id:A.id}]:S},[]);n({selected:E,event:_})},p=(v,_)=>{const T=Array.isArray(v)?v:[v],E=T.map(S=>r.getAnnotation(S)).filter(S=>!!S);n({selected:E.map(S=>{const A=_===void 0?Lv(S,s,t)==="EDIT":_;return{id:S.id,editable:A}})}),E.length!==T.length&&console.warn("Invalid selection",v)},m=v=>{if(u())return!1;const{selected:_}=o;_.some(({id:T})=>v.includes(T))&&n({selected:_.filter(({id:T})=>!v.includes(T))})},y=v=>{s=v,p(o.selected.map(({id:_})=>_))};return r.observe(({changes:v})=>m((v.deleted||[]).map(_=>_.id))),{get event(){return o?o.event:null},get selected(){return o?[...o.selected]:null},get userSelectAction(){return s},clear:l,isEmpty:u,isSelected:c,setSelected:p,setUserSelectAction:y,subscribe:i,userSelect:d}},Lv=(r,e,t)=>{const i=t?t.serialize(r):r;return typeof e=="function"?e(i):e||"EDIT"},vi=[];for(let r=0;r<256;++r)vi.push((r+256).toString(16).slice(1));function KA(r,e=0){return(vi[r[e+0]]+vi[r[e+1]]+vi[r[e+2]]+vi[r[e+3]]+"-"+vi[r[e+4]]+vi[r[e+5]]+"-"+vi[r[e+6]]+vi[r[e+7]]+"-"+vi[r[e+8]]+vi[r[e+9]]+"-"+vi[r[e+10]]+vi[r[e+11]]+vi[r[e+12]]+vi[r[e+13]]+vi[r[e+14]]+vi[r[e+15]]).toLowerCase()}let Qd;const JA=new Uint8Array(16);function $A(){if(!Qd){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Qd=crypto.getRandomValues.bind(crypto)}return Qd(JA)}const eb=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Fv={randomUUID:eb};function tb(r,e,t){var i;if(Fv.randomUUID&&!r)return Fv.randomUUID();r=r||{};const n=r.random??((i=r.rng)==null?void 0:i.call(r))??$A();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,KA(n)}const ib=(r,e)=>{const t=new Set(r.bodies.map(i=>i.id));return e.bodies.filter(i=>!t.has(i.id))},rb=(r,e)=>{const t=new Set(e.bodies.map(i=>i.id));return r.bodies.filter(i=>!t.has(i.id))},nb=(r,e)=>e.bodies.map(t=>{const i=r.bodies.find(n=>n.id===t.id);return{newBody:t,oldBody:i&&!il(i,t)?i:void 0}}).filter(({oldBody:t})=>t).map(({oldBody:t,newBody:i})=>({oldBody:t,newBody:i})),sb=(r,e)=>!il(r.target,e.target),ob=(r,e)=>{const t=ib(r,e),i=rb(r,e),n=nb(r,e);return{oldValue:r,newValue:e,bodiesCreated:t.length>0?t:void 0,bodiesDeleted:i.length>0?i:void 0,bodiesUpdated:n.length>0?n:void 0,targetUpdated:sb(r,e)?{oldTarget:r.target,newTarget:e.target}:void 0}};var si=(r=>(r.LOCAL="LOCAL",r.REMOTE="REMOTE",r.SILENT="SILENT",r))(si||{});const ab=(r,e)=>{var t,i;const{changes:n,origin:s}=e;if(!(r.options.origin?r.options.origin===s:s!=="SILENT"))return!1;if(r.options.ignore){const{ignore:o}=r.options,l=u=>u&&u.length>0;if(!(l(n.created)||l(n.deleted))){const u=(t=n.updated)==null?void 0:t.some(d=>l(d.bodiesCreated)||l(d.bodiesDeleted)||l(d.bodiesUpdated)),c=(i=n.updated)==null?void 0:i.some(d=>d.targetUpdated);if(o==="BODY_ONLY"&&u&&!c||o==="TARGET_ONLY"&&c&&!u)return!1}}if(r.options.annotations){const o=new Set([...(n.created||[]).map(l=>l.id),...(n.deleted||[]).map(l=>l.id),...(n.updated||[]).map(({oldValue:l})=>l.id)]);return!!(Array.isArray(r.options.annotations)?r.options.annotations:[r.options.annotations]).find(l=>o.has(l))}else return!0},Pu=r=>{const e=r.id===void 0?tb():r.id;return{...r,id:e,bodies:r.bodies===void 0?[]:r.bodies.map(t=>({...t,annotation:e})),target:{...r.target,annotation:e}}},lb=r=>r.id!==void 0,ub=()=>{const r=new Map,e=new Map,t=[],i=(H,F={})=>{t.push({onChange:H,options:F})},n=H=>{const F=t.findIndex(G=>G.onChange==H);F>-1&&t.splice(F,1)},s=(H,F)=>{const G={origin:H,changes:{created:F.created||[],updated:F.updated||[],deleted:F.deleted||[]},state:[...r.values()]};t.forEach($=>{ab($,G)&&$.onChange(G)})},o=(H,F=si.LOCAL)=>{if(H.id&&r.get(H.id))throw Error(`Cannot add annotation ${H.id} - exists already`);{const G=Pu(H);r.set(G.id,G),G.bodies.forEach($=>e.set($.id,G.id)),s(F,{created:[G]})}},l=(H,F)=>{const G=Pu(typeof H=="string"?F:H),$=typeof H=="string"?H:H.id,le=$&&r.get($);if(le){const ie=ob(le,G);return $===G.id?r.set($,G):(r.delete($),r.set(G.id,G)),le.bodies.forEach(Y=>e.delete(Y.id)),G.bodies.forEach(Y=>e.set(Y.id,G.id)),ie}else console.warn(`Cannot update annotation ${$} - does not exist`)},u=(H,F=si.LOCAL,G=si.LOCAL)=>{const $=lb(F)?G:F,le=l(H,F);le&&s($,{updated:[le]})},c=(H,F=si.LOCAL)=>{r.get(H.id)?u(H,F):o(H,F)},d=(H,F=si.LOCAL)=>{const G=H.reduce(($,le)=>{const ie=l(le);return ie?[...$,ie]:$},[]);G.length>0&&s(F,{updated:G})},p=(H,F=si.LOCAL)=>{const G=H.map(Pu),{toAdd:$,toUpdate:le}=G.reduce((Y,de)=>r.get(de.id)?{...Y,toUpdate:[...Y.toUpdate,de]}:{...Y,toAdd:[...Y.toAdd,de]},{toAdd:[],toUpdate:[]}),ie=le.map(Y=>l(Y,F)).filter(Boolean);$.forEach(Y=>{r.set(Y.id,Y),Y.bodies.forEach(de=>e.set(de.id,Y.id))}),s(F,{created:$,updated:ie})},m=(H,F=si.LOCAL)=>{const G=r.get(H.annotation);if(G){const $={...G,bodies:[...G.bodies,H]};r.set(G.id,$),e.set(H.id,$.id),s(F,{updated:[{oldValue:G,newValue:$,bodiesCreated:[H]}]})}else console.warn(`Attempt to add body to missing annotation: ${H.annotation}`)},y=()=>[...r.values()],v=(H=si.LOCAL)=>{const F=[...r.values()];r.clear(),e.clear(),s(H,{deleted:F})},_=(H,F=!0,G=si.LOCAL)=>{const $=H.map(Pu);if(F){const le=[...r.values()];r.clear(),e.clear(),$.forEach(ie=>{r.set(ie.id,ie),ie.bodies.forEach(Y=>e.set(Y.id,ie.id))}),s(G,{created:$,deleted:le})}else{const le=H.reduce((ie,Y)=>{const de=Y.id&&r.get(Y.id);return de?[...ie,de]:ie},[]);if(le.length>0)throw Error(`Bulk insert would overwrite the following annotations: ${le.map(ie=>ie.id).join(", ")}`);$.forEach(ie=>{r.set(ie.id,ie),ie.bodies.forEach(Y=>e.set(Y.id,ie.id))}),s(G,{created:$})}},T=H=>{const F=typeof H=="string"?H:H.id,G=r.get(F);if(G)return r.delete(F),G.bodies.forEach($=>e.delete($.id)),G;console.warn(`Attempt to delete missing annotation: ${F}`)},E=(H,F=si.LOCAL)=>{const G=T(H);G&&s(F,{deleted:[G]})},S=(H,F=si.LOCAL)=>{const G=H.reduce(($,le)=>{const ie=T(le);return ie?[...$,ie]:$},[]);G.length>0&&s(F,{deleted:G})},A=H=>{const F=r.get(H.annotation);if(F){const G=F.bodies.find($=>$.id===H.id);if(G){e.delete(G.id);const $={...F,bodies:F.bodies.filter(le=>le.id!==H.id)};return r.set(F.id,$),{oldValue:F,newValue:$,bodiesDeleted:[G]}}else console.warn(`Attempt to delete missing body ${H.id} from annotation ${H.annotation}`)}else console.warn(`Attempt to delete body from missing annotation ${H.annotation}`)},P=(H,F=si.LOCAL)=>{const G=A(H);G&&s(F,{updated:[G]})},D=(H,F=si.LOCAL)=>{const G=H.map($=>A($)).filter(Boolean);G.length>0&&s(F,{updated:G})},k=H=>{const F=r.get(H);return F?{...F}:void 0},U=H=>{const F=e.get(H);if(F){const G=k(F).bodies.find($=>$.id===H);if(G)return G;console.error(`Store integrity error: body ${H} in index, but not in annotation`)}else console.warn(`Attempt to retrieve missing body: ${H}`)},j=(H,F)=>{if(H.annotation!==F.annotation)throw"Annotation integrity violation: annotation ID must be the same when updating bodies";const G=r.get(H.annotation);if(G){const $=G.bodies.find(ie=>ie.id===H.id),le={...G,bodies:G.bodies.map(ie=>ie.id===$.id?F:ie)};return r.set(G.id,le),$.id!==F.id&&(e.delete($.id),e.set(F.id,le.id)),{oldValue:G,newValue:le,bodiesUpdated:[{oldBody:$,newBody:F}]}}else console.warn(`Attempt to add body to missing annotation ${H.annotation}`)},q=(H,F,G=si.LOCAL)=>{const $=j(H,F);$&&s(G,{updated:[$]})},ee=(H,F=si.LOCAL)=>{const G=H.map($=>j({id:$.id,annotation:$.annotation},$)).filter(Boolean);s(F,{updated:G})},pe=H=>{const F=r.get(H.annotation);if(F){const G={...F,target:{...F.target,...H}};return r.set(F.id,G),{oldValue:F,newValue:G,targetUpdated:{oldTarget:F.target,newTarget:H}}}else console.warn(`Attempt to update target on missing annotation: ${H.annotation}`)};return{addAnnotation:o,addBody:m,all:y,bulkAddAnnotations:_,bulkDeleteAnnotations:S,bulkDeleteBodies:D,bulkUpdateAnnotations:d,bulkUpdateBodies:ee,bulkUpdateTargets:(H,F=si.LOCAL)=>{const G=H.map($=>pe($)).filter(Boolean);G.length>0&&s(F,{updated:G})},bulkUpsertAnnotations:p,clear:v,deleteAnnotation:E,deleteBody:P,getAnnotation:k,getBody:U,observe:i,unobserve:n,updateAnnotation:u,updateBody:q,updateTarget:(H,F=si.LOCAL)=>{const G=pe(H);G&&s(F,{updated:[G]})},upsertAnnotation:c}},hb=()=>{const{subscribe:r,set:e}=tm([]);return{subscribe:r,set:e}},cb="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let db=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=cb[t[r]&63];return e};db();function Bv(r,e,t){const i=r.slice();return i[10]=e[t],i[12]=t,i}function kv(r){let e,t;return e=new No({props:{x:r[10][0],y:r[10][1],scale:r[3]}}),e.$on("pointerdown",function(){ai(r[9](`HANDLE-${r[12]}`))&&r[9](`HANDLE-${r[12]}`).apply(this,arguments)}),{c(){dn(e.$$.fragment)},m(i,n){Vr(e,i,n),t=!0},p(i,n){r=i;const s={};n&16&&(s.x=r[10][0]),n&16&&(s.y=r[10][1]),n&8&&(s.scale=r[3]),e.$set(s)},i(i){t||(Mt(e.$$.fragment,i),t=!0)},o(i){ui(e.$$.fragment,i),t=!1},d(i){jr(e,i)}}}function fb(r){let e,t,i,n,s,o,l,u,c,d,p,m=es(r[4].points),y=[];for(let _=0;_<m.length;_+=1)y[_]=kv(Bv(r,m,_));const v=_=>ui(y[_],1,1,()=>{y[_]=null});return{c(){e=Ot("polygon"),n=_r(),s=Ot("polygon"),l=_r();for(let _=0;_<y.length;_+=1)y[_].c();u=hl(),te(e,"class","a9s-outer"),te(e,"style",t=r[1]?"display:none;":void 0),te(e,"points",i=r[4].points.map(Uv).join(" ")),te(s,"class","a9s-inner a9s-shape-handle"),te(s,"style",r[1]),te(s,"points",o=r[4].points.map(Hv).join(" "))},m(_,T){nt(_,e,T),nt(_,n,T),nt(_,s,T),nt(_,l,T);for(let E=0;E<y.length;E+=1)y[E]&&y[E].m(_,T);nt(_,u,T),c=!0,d||(p=[$t(e,"pointerdown",function(){ai(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments)}),$t(s,"pointerdown",function(){ai(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments)})],d=!0)},p(_,T){if(r=_,(!c||T&2&&t!==(t=r[1]?"display:none;":void 0))&&te(e,"style",t),(!c||T&16&&i!==(i=r[4].points.map(Uv).join(" ")))&&te(e,"points",i),(!c||T&2)&&te(s,"style",r[1]),(!c||T&16&&o!==(o=r[4].points.map(Hv).join(" ")))&&te(s,"points",o),T&536){m=es(r[4].points);let E;for(E=0;E<m.length;E+=1){const S=Bv(r,m,E);y[E]?(y[E].p(S,T),Mt(y[E],1)):(y[E]=kv(S),y[E].c(),Mt(y[E],1),y[E].m(u.parentNode,u))}for(Bh(),E=m.length;E<y.length;E+=1)v(E);kh()}},i(_){if(!c){for(let T=0;T<m.length;T+=1)Mt(y[T]);c=!0}},o(_){y=y.filter(Boolean);for(let T=0;T<y.length;T+=1)ui(y[T]);c=!1},d(_){_&&(rt(e),rt(n),rt(s),rt(l),rt(u)),Fh(y,_),d=!1,Kr(p)}}}function pb(r){let e,t;return e=new im({props:{shape:r[0],transform:r[2],editor:r[5],$$slots:{default:[fb,({grab:i})=>({9:i}),({grab:i})=>i?512:0]},$$scope:{ctx:r}}}),e.$on("change",r[6]),e.$on("grab",r[7]),e.$on("release",r[8]),{c(){dn(e.$$.fragment)},m(i,n){Vr(e,i,n),t=!0},p(i,[n]){const s={};n&1&&(s.shape=i[0]),n&4&&(s.transform=i[2]),n&8730&&(s.$$scope={dirty:n,ctx:i}),e.$set(s)},i(i){t||(Mt(e.$$.fragment,i),t=!0)},o(i){ui(e.$$.fragment,i),t=!1},d(i){jr(e,i)}}}const Uv=r=>r.join(","),Hv=r=>r.join(",");function mb(r,e,t){let i,{shape:n}=e,{computedStyle:s}=e,{transform:o}=e,{viewportScale:l=1}=e;const u=(m,y,v)=>{let _;const T=m.geometry;y==="SHAPE"?_=T.points.map(([S,A])=>[S+v[0],A+v[1]]):_=T.points.map(([S,A],P)=>y===`HANDLE-${P}`?[S+v[0],A+v[1]]:[S,A]);const E=Xo(_);return{...m,geometry:{points:_,bounds:E}}};function c(m){nr.call(this,r,m)}function d(m){nr.call(this,r,m)}function p(m){nr.call(this,r,m)}return r.$$set=m=>{"shape"in m&&t(0,n=m.shape),"computedStyle"in m&&t(1,s=m.computedStyle),"transform"in m&&t(2,o=m.transform),"viewportScale"in m&&t(3,l=m.viewportScale)},r.$$.update=()=>{r.$$.dirty&1&&t(4,i=n.geometry)},[n,s,o,l,i,u,c,d,p]}class gb extends js{constructor(e){super(),Vs(this,e,mb,pb,Gs,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}const Kd=(r,e)=>{const t=Math.abs(e[0]-r[0]),i=Math.abs(e[1]-r[1]);return Math.sqrt(Math.pow(t,2)+Math.pow(i,2))},y0=typeof window>"u"||typeof navigator>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;function yb(r){let e,t,i,n,s,o;return{c(){e=Ot("rect"),te(e,"class",t=mh(`a9s-handle ${r[8].class||""}`.trim())+" svelte-1sgkh33"),te(e,"x",i=r[0]-r[5]/2),te(e,"y",n=r[1]-r[5]/2),te(e,"width",r[5]),te(e,"height",r[5])},m(l,u){nt(l,e,u),s||(o=$t(e,"pointerdown",r[11]),s=!0)},p(l,u){u&256&&t!==(t=mh(`a9s-handle ${l[8].class||""}`.trim())+" svelte-1sgkh33")&&te(e,"class",t),u&33&&i!==(i=l[0]-l[5]/2)&&te(e,"x",i),u&34&&n!==(n=l[1]-l[5]/2)&&te(e,"y",n),u&32&&te(e,"width",l[5]),u&32&&te(e,"height",l[5])},d(l){l&&rt(e),s=!1,o()}}}function vb(r){let e,t,i,n,s,o,l,u,c;return{c(){e=Ot("g"),t=Ot("circle"),n=Ot("rect"),te(t,"cx",r[0]),te(t,"cy",r[1]),te(t,"r",i=r[3]/r[2]),te(t,"class","a9s-touch-halo svelte-1sgkh33"),Av(t,"touched",r[4]),te(n,"class",s=mh(`a9s-handle ${r[8].class||""}`.trim())+" svelte-1sgkh33"),te(n,"x",o=r[0]-r[5]/2),te(n,"y",l=r[1]-r[5]/2),te(n,"width",r[5]),te(n,"height",r[5]),te(e,"class","a9s-touch-handle")},m(d,p){nt(d,e,p),gh(e,t),gh(e,n),u||(c=[$t(t,"pointerdown",r[10]),$t(t,"pointerdown",r[6]),$t(t,"pointerup",r[7]),$t(n,"pointerdown",r[9]),$t(n,"pointerdown",r[6]),$t(n,"pointerup",r[7])],u=!0)},p(d,p){p&1&&te(t,"cx",d[0]),p&2&&te(t,"cy",d[1]),p&12&&i!==(i=d[3]/d[2])&&te(t,"r",i),p&16&&Av(t,"touched",d[4]),p&256&&s!==(s=mh(`a9s-handle ${d[8].class||""}`.trim())+" svelte-1sgkh33")&&te(n,"class",s),p&33&&o!==(o=d[0]-d[5]/2)&&te(n,"x",o),p&34&&l!==(l=d[1]-d[5]/2)&&te(n,"y",l),p&32&&te(n,"width",d[5]),p&32&&te(n,"height",d[5])},d(d){d&&rt(e),u=!1,Kr(c)}}}function _b(r){let e;function t(n,s){return y0?vb:yb}let i=t()(r);return{c(){i.c(),e=hl()},m(n,s){i.m(n,s),nt(n,e,s)},p(n,[s]){i.p(n,s)},i:yn,o:yn,d(n){n&&rt(e),i.d(n)}}}function xb(r,e,t){let i,{x:n}=e,{y:s}=e,{scale:o}=e,{radius:l=30}=e,u=!1;const c=v=>{v.pointerType==="touch"&&t(4,u=!0)},d=()=>t(4,u=!1);function p(v){nr.call(this,r,v)}function m(v){nr.call(this,r,v)}function y(v){nr.call(this,r,v)}return r.$$set=v=>{t(8,e=Xf(Xf({},e),Sv(v))),"x"in v&&t(0,n=v.x),"y"in v&&t(1,s=v.y),"scale"in v&&t(2,o=v.scale),"radius"in v&&t(3,l=v.radius)},r.$$.update=()=>{r.$$.dirty&4&&t(5,i=10/o)},e=Sv(e),[n,s,o,l,u,i,c,d,e,p,m,y]}class No extends js{constructor(e){super(),Vs(this,e,xb,_b,Gs,{x:0,y:1,scale:2,radius:3})}}function Tb(r){let e,t,i,n,s,o,l,u,c,d,p,m,y,v,_,T,E,S,A,P,D,k,U,j,q,ee,pe,H,F,G,$,le,ie,Y,de,z,N,W,re,_e,me,Pe,Ue;return Y=new No({props:{class:"a9s-corner-handle-topleft",x:r[4].x,y:r[4].y,scale:r[3]}}),Y.$on("pointerdown",function(){ai(r[9]("TOP_LEFT"))&&r[9]("TOP_LEFT").apply(this,arguments)}),z=new No({props:{class:"a9s-corner-handle-topright",x:r[4].x+r[4].w,y:r[4].y,scale:r[3]}}),z.$on("pointerdown",function(){ai(r[9]("TOP_RIGHT"))&&r[9]("TOP_RIGHT").apply(this,arguments)}),W=new No({props:{class:"a9s-corner-handle-bottomright",x:r[4].x+r[4].w,y:r[4].y+r[4].h,scale:r[3]}}),W.$on("pointerdown",function(){ai(r[9]("BOTTOM_RIGHT"))&&r[9]("BOTTOM_RIGHT").apply(this,arguments)}),_e=new No({props:{class:"a9s-corner-handle-bottomleft",x:r[4].x,y:r[4].y+r[4].h,scale:r[3]}}),_e.$on("pointerdown",function(){ai(r[9]("BOTTOM_LEFT"))&&r[9]("BOTTOM_LEFT").apply(this,arguments)}),{c(){e=Ot("rect"),l=_r(),u=Ot("rect"),y=_r(),v=Ot("rect"),S=_r(),A=Ot("rect"),U=_r(),j=Ot("rect"),H=_r(),F=Ot("rect"),ie=_r(),dn(Y.$$.fragment),de=_r(),dn(z.$$.fragment),N=_r(),dn(W.$$.fragment),re=_r(),dn(_e.$$.fragment),te(e,"class","a9s-outer"),te(e,"style",t=r[1]?"display:none;":void 0),te(e,"x",i=r[4].x),te(e,"y",n=r[4].y),te(e,"width",s=r[4].w),te(e,"height",o=r[4].h),te(u,"class","a9s-inner a9s-shape-handle"),te(u,"style",r[1]),te(u,"x",c=r[4].x),te(u,"y",d=r[4].y),te(u,"width",p=r[4].w),te(u,"height",m=r[4].h),te(v,"class","a9s-edge-handle a9s-edge-handle-top"),te(v,"x",_=r[4].x),te(v,"y",T=r[4].y),te(v,"height",1),te(v,"width",E=r[4].w),te(A,"class","a9s-edge-handle a9s-edge-handle-right"),te(A,"x",P=r[4].x+r[4].w),te(A,"y",D=r[4].y),te(A,"height",k=r[4].h),te(A,"width",1),te(j,"class","a9s-edge-handle a9s-edge-handle-bottom"),te(j,"x",q=r[4].x),te(j,"y",ee=r[4].y+r[4].h),te(j,"height",1),te(j,"width",pe=r[4].w),te(F,"class","a9s-edge-handle a9s-edge-handle-left"),te(F,"x",G=r[4].x),te(F,"y",$=r[4].y),te(F,"height",le=r[4].h),te(F,"width",1)},m(Te,ge){nt(Te,e,ge),nt(Te,l,ge),nt(Te,u,ge),nt(Te,y,ge),nt(Te,v,ge),nt(Te,S,ge),nt(Te,A,ge),nt(Te,U,ge),nt(Te,j,ge),nt(Te,H,ge),nt(Te,F,ge),nt(Te,ie,ge),Vr(Y,Te,ge),nt(Te,de,ge),Vr(z,Te,ge),nt(Te,N,ge),Vr(W,Te,ge),nt(Te,re,ge),Vr(_e,Te,ge),me=!0,Pe||(Ue=[$t(e,"pointerdown",function(){ai(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments)}),$t(u,"pointerdown",function(){ai(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments)}),$t(v,"pointerdown",function(){ai(r[9]("TOP"))&&r[9]("TOP").apply(this,arguments)}),$t(A,"pointerdown",function(){ai(r[9]("RIGHT"))&&r[9]("RIGHT").apply(this,arguments)}),$t(j,"pointerdown",function(){ai(r[9]("BOTTOM"))&&r[9]("BOTTOM").apply(this,arguments)}),$t(F,"pointerdown",function(){ai(r[9]("LEFT"))&&r[9]("LEFT").apply(this,arguments)})],Pe=!0)},p(Te,ge){r=Te,(!me||ge&2&&t!==(t=r[1]?"display:none;":void 0))&&te(e,"style",t),(!me||ge&16&&i!==(i=r[4].x))&&te(e,"x",i),(!me||ge&16&&n!==(n=r[4].y))&&te(e,"y",n),(!me||ge&16&&s!==(s=r[4].w))&&te(e,"width",s),(!me||ge&16&&o!==(o=r[4].h))&&te(e,"height",o),(!me||ge&2)&&te(u,"style",r[1]),(!me||ge&16&&c!==(c=r[4].x))&&te(u,"x",c),(!me||ge&16&&d!==(d=r[4].y))&&te(u,"y",d),(!me||ge&16&&p!==(p=r[4].w))&&te(u,"width",p),(!me||ge&16&&m!==(m=r[4].h))&&te(u,"height",m),(!me||ge&16&&_!==(_=r[4].x))&&te(v,"x",_),(!me||ge&16&&T!==(T=r[4].y))&&te(v,"y",T),(!me||ge&16&&E!==(E=r[4].w))&&te(v,"width",E),(!me||ge&16&&P!==(P=r[4].x+r[4].w))&&te(A,"x",P),(!me||ge&16&&D!==(D=r[4].y))&&te(A,"y",D),(!me||ge&16&&k!==(k=r[4].h))&&te(A,"height",k),(!me||ge&16&&q!==(q=r[4].x))&&te(j,"x",q),(!me||ge&16&&ee!==(ee=r[4].y+r[4].h))&&te(j,"y",ee),(!me||ge&16&&pe!==(pe=r[4].w))&&te(j,"width",pe),(!me||ge&16&&G!==(G=r[4].x))&&te(F,"x",G),(!me||ge&16&&$!==($=r[4].y))&&te(F,"y",$),(!me||ge&16&&le!==(le=r[4].h))&&te(F,"height",le);const Ke={};ge&16&&(Ke.x=r[4].x),ge&16&&(Ke.y=r[4].y),ge&8&&(Ke.scale=r[3]),Y.$set(Ke);const Je={};ge&16&&(Je.x=r[4].x+r[4].w),ge&16&&(Je.y=r[4].y),ge&8&&(Je.scale=r[3]),z.$set(Je);const ht={};ge&16&&(ht.x=r[4].x+r[4].w),ge&16&&(ht.y=r[4].y+r[4].h),ge&8&&(ht.scale=r[3]),W.$set(ht);const st={};ge&16&&(st.x=r[4].x),ge&16&&(st.y=r[4].y+r[4].h),ge&8&&(st.scale=r[3]),_e.$set(st)},i(Te){me||(Mt(Y.$$.fragment,Te),Mt(z.$$.fragment,Te),Mt(W.$$.fragment,Te),Mt(_e.$$.fragment,Te),me=!0)},o(Te){ui(Y.$$.fragment,Te),ui(z.$$.fragment,Te),ui(W.$$.fragment,Te),ui(_e.$$.fragment,Te),me=!1},d(Te){Te&&(rt(e),rt(l),rt(u),rt(y),rt(v),rt(S),rt(A),rt(U),rt(j),rt(H),rt(F),rt(ie),rt(de),rt(N),rt(re)),jr(Y,Te),jr(z,Te),jr(W,Te),jr(_e,Te),Pe=!1,Kr(Ue)}}}function wb(r){let e,t;return e=new im({props:{shape:r[0],transform:r[2],editor:r[5],$$slots:{default:[Tb,({grab:i})=>({9:i}),({grab:i})=>i?512:0]},$$scope:{ctx:r}}}),e.$on("grab",r[6]),e.$on("change",r[7]),e.$on("release",r[8]),{c(){dn(e.$$.fragment)},m(i,n){Vr(e,i,n),t=!0},p(i,[n]){const s={};n&1&&(s.shape=i[0]),n&4&&(s.transform=i[2]),n&1562&&(s.$$scope={dirty:n,ctx:i}),e.$set(s)},i(i){t||(Mt(e.$$.fragment,i),t=!0)},o(i){ui(e.$$.fragment,i),t=!1},d(i){jr(e,i)}}}function Eb(r,e,t){let i,{shape:n}=e,{computedStyle:s}=e,{transform:o}=e,{viewportScale:l=1}=e;const u=(m,y,v)=>{const _=m.geometry.bounds;let[T,E]=[_.minX,_.minY],[S,A]=[_.maxX,_.maxY];const[P,D]=v;if(y==="SHAPE")T+=P,S+=P,E+=D,A+=D;else{switch(y){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{E+=D;break}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{A+=D;break}}switch(y){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{T+=P;break}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{S+=P;break}}}const k=Math.min(T,S),U=Math.min(E,A),j=Math.abs(S-T),q=Math.abs(A-E);return{...m,geometry:{x:k,y:U,w:j,h:q,bounds:{minX:k,minY:U,maxX:k+j,maxY:U+q}}}};function c(m){nr.call(this,r,m)}function d(m){nr.call(this,r,m)}function p(m){nr.call(this,r,m)}return r.$$set=m=>{"shape"in m&&t(0,n=m.shape),"computedStyle"in m&&t(1,s=m.computedStyle),"transform"in m&&t(2,o=m.transform),"viewportScale"in m&&t(3,l=m.viewportScale)},r.$$.update=()=>{r.$$.dirty&1&&t(4,i=n.geometry)},[n,s,o,l,i,u,c,d,p]}class Sb extends js{constructor(e){super(),Vs(this,e,Eb,wb,Gs,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}function zv(r,e,t){const i=r.slice();return i[10]=e[t],i[12]=t,i}function Gv(r,e,t){const i=r.slice();return i[13]=e[t],i[15]=t,i}function Vv(r,e,t){const i=r.slice();return i[16]=e[t],i[18]=t,i}function jv(r){let e,t;return e=new No({props:{x:r[16][0],y:r[16][1],scale:r[3]}}),e.$on("pointerdown",function(){ai(r[9](`HANDLE-${r[12]}-${r[15]}-${r[18]}`))&&r[9](`HANDLE-${r[12]}-${r[15]}-${r[18]}`).apply(this,arguments)}),{c(){dn(e.$$.fragment)},m(i,n){Vr(e,i,n),t=!0},p(i,n){r=i;const s={};n&16&&(s.x=r[16][0]),n&16&&(s.y=r[16][1]),n&8&&(s.scale=r[3]),e.$set(s)},i(i){t||(Mt(e.$$.fragment,i),t=!0)},o(i){ui(e.$$.fragment,i),t=!1},d(i){jr(e,i)}}}function Xv(r){let e,t,i=es(r[13].points),n=[];for(let o=0;o<i.length;o+=1)n[o]=jv(Vv(r,i,o));const s=o=>ui(n[o],1,1,()=>{n[o]=null});return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=hl()},m(o,l){for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(o,l);nt(o,e,l),t=!0},p(o,l){if(l&536){i=es(o[13].points);let u;for(u=0;u<i.length;u+=1){const c=Vv(o,i,u);n[u]?(n[u].p(c,l),Mt(n[u],1)):(n[u]=jv(c),n[u].c(),Mt(n[u],1),n[u].m(e.parentNode,e))}for(Bh(),u=i.length;u<n.length;u+=1)s(u);kh()}},i(o){if(!t){for(let l=0;l<i.length;l+=1)Mt(n[l]);t=!0}},o(o){n=n.filter(Boolean);for(let l=0;l<n.length;l+=1)ui(n[l]);t=!1},d(o){o&&rt(e),Fh(n,o)}}}function Wv(r){let e,t,i,n,s,o,l,u,c,d=es(r[10].rings),p=[];for(let y=0;y<d.length;y+=1)p[y]=Xv(Gv(r,d,y));const m=y=>ui(p[y],1,1,()=>{p[y]=null});return{c(){e=Ot("g"),t=Ot("path"),s=Ot("path");for(let y=0;y<p.length;y+=1)p[y].c();te(t,"class","a9s-outer"),te(t,"style",i=r[1]?"display:none;":void 0),te(t,"fill-rule","evenodd"),te(t,"d",n=bu(r[10])),te(s,"class","a9s-inner"),te(s,"style",r[1]),te(s,"fill-rule","evenodd"),te(s,"d",o=bu(r[10]))},m(y,v){nt(y,e,v),gh(e,t),gh(e,s);for(let _=0;_<p.length;_+=1)p[_]&&p[_].m(e,null);l=!0,u||(c=[$t(t,"pointerdown",function(){ai(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments)}),$t(s,"pointerdown",function(){ai(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments)})],u=!0)},p(y,v){if(r=y,(!l||v&2&&i!==(i=r[1]?"display:none;":void 0))&&te(t,"style",i),(!l||v&16&&n!==(n=bu(r[10])))&&te(t,"d",n),(!l||v&2)&&te(s,"style",r[1]),(!l||v&16&&o!==(o=bu(r[10])))&&te(s,"d",o),v&536){d=es(r[10].rings);let _;for(_=0;_<d.length;_+=1){const T=Gv(r,d,_);p[_]?(p[_].p(T,v),Mt(p[_],1)):(p[_]=Xv(T),p[_].c(),Mt(p[_],1),p[_].m(e,null))}for(Bh(),_=d.length;_<p.length;_+=1)m(_);kh()}},i(y){if(!l){for(let v=0;v<d.length;v+=1)Mt(p[v]);l=!0}},o(y){p=p.filter(Boolean);for(let v=0;v<p.length;v+=1)ui(p[v]);l=!1},d(y){y&&rt(e),Fh(p,y),u=!1,Kr(c)}}}function Ab(r){let e,t,i=es(r[4].polygons),n=[];for(let o=0;o<i.length;o+=1)n[o]=Wv(zv(r,i,o));const s=o=>ui(n[o],1,1,()=>{n[o]=null});return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=hl()},m(o,l){for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(o,l);nt(o,e,l),t=!0},p(o,l){if(l&538){i=es(o[4].polygons);let u;for(u=0;u<i.length;u+=1){const c=zv(o,i,u);n[u]?(n[u].p(c,l),Mt(n[u],1)):(n[u]=Wv(c),n[u].c(),Mt(n[u],1),n[u].m(e.parentNode,e))}for(Bh(),u=i.length;u<n.length;u+=1)s(u);kh()}},i(o){if(!t){for(let l=0;l<i.length;l+=1)Mt(n[l]);t=!0}},o(o){n=n.filter(Boolean);for(let l=0;l<n.length;l+=1)ui(n[l]);t=!1},d(o){o&&rt(e),Fh(n,o)}}}function bb(r){let e,t;return e=new im({props:{shape:r[0],transform:r[2],editor:r[5],$$slots:{default:[Ab,({grab:i})=>({9:i}),({grab:i})=>i?512:0]},$$scope:{ctx:r}}}),e.$on("change",r[6]),e.$on("grab",r[7]),e.$on("release",r[8]),{c(){dn(e.$$.fragment)},m(i,n){Vr(e,i,n),t=!0},p(i,[n]){const s={};n&1&&(s.shape=i[0]),n&4&&(s.transform=i[2]),n&524826&&(s.$$scope={dirty:n,ctx:i}),e.$set(s)},i(i){t||(Mt(e.$$.fragment,i),t=!0)},o(i){ui(e.$$.fragment,i),t=!1},d(i){jr(e,i)}}}function Cb(r,e,t){let i,{shape:n}=e,{computedStyle:s}=e,{transform:o}=e,{viewportScale:l=1}=e;const u=(m,y,v)=>{const _=m.geometry.polygons;let T;if(y==="SHAPE")T=_.map(E=>{const S=E.rings.map((P,D)=>({points:P.points.map((k,U)=>[k[0]+v[0],k[1]+v[1]])})),A=Xo(S[0].points);return{rings:S,bounds:A}});else{const[E,S,A,P]=y.split("-").map(D=>parseInt(D));T=_.map((D,k)=>{if(k===S){const U=D.rings.map((q,ee)=>ee===A?{points:q.points.map((pe,H)=>H===P?[pe[0]+v[0],pe[1]+v[1]]:pe)}:q),j=Xo(U[0].points);return{rings:U,bounds:j}}else return D})}return{...m,geometry:{polygons:T,bounds:EA(T)}}};function c(m){nr.call(this,r,m)}function d(m){nr.call(this,r,m)}function p(m){nr.call(this,r,m)}return r.$$set=m=>{"shape"in m&&t(0,n=m.shape),"computedStyle"in m&&t(1,s=m.computedStyle),"transform"in m&&t(2,o=m.transform),"viewportScale"in m&&t(3,l=m.viewportScale)},r.$$.update=()=>{r.$$.dirty&1&&t(4,i=n.geometry)},[n,s,o,l,i,u,c,d,p]}class Rb extends js{constructor(e){super(),Vs(this,e,Cb,bb,Gs,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}const v0=new Map([[Ht.RECTANGLE,Sb],[Ht.POLYGON,gb],[Ht.MULTIPOLYGLON,Rb]]),Pb=r=>v0.get(r.type),Ob=(r,e)=>v0.set(r,e),Ib=r=>({}),Yv=r=>({grab:r[0]});function Mb(r){let e,t,i,n;const s=r[7].default,o=aA(s,r,r[6],Yv);return{c(){e=Ot("g"),o&&o.c(),te(e,"class","a9s-annotation selected")},m(l,u){nt(l,e,u),o&&o.m(e,null),t=!0,i||(n=[$t(e,"pointerup",r[2]),$t(e,"pointermove",r[1])],i=!0)},p(l,[u]){o&&o.p&&(!t||u&64)&&uA(o,s,l,l[6],t?lA(s,l[6],u,Ib):hA(l[6]),Yv)},i(l){t||(Mt(o,l),t=!0)},o(l){ui(o,l),t=!1},d(l){l&&rt(e),o&&o.d(l),i=!1,Kr(n)}}}function Nb(r,e,t){let{$$slots:i={},$$scope:n}=e;const s=Jp();let{shape:o}=e,{editor:l}=e,{transform:u}=e,c,d,p;const m=_=>T=>{c=_,d=u.elementToImage(T.offsetX,T.offsetY),p=o,T.target.setPointerCapture(T.pointerId),s("grab",T)},y=_=>{if(c){const[T,E]=u.elementToImage(_.offsetX,_.offsetY),S=[T-d[0],E-d[1]];t(3,o=l(p,c,S)),s("change",o)}},v=_=>{_.target.releasePointerCapture(_.pointerId),c=void 0,p=o,s("release",_)};return r.$$set=_=>{"shape"in _&&t(3,o=_.shape),"editor"in _&&t(4,l=_.editor),"transform"in _&&t(5,u=_.transform),"$$scope"in _&&t(6,n=_.$$scope)},[m,y,v,o,l,u,n,i]}class im extends js{constructor(e){super(),Vs(this,e,Nb,Mb,Gs,{shape:3,editor:4,transform:5})}}function qv(r){let e,t;return{c(){e=Ot("rect"),t=Ot("rect"),te(e,"class","a9s-outer"),te(e,"x",r[1]),te(e,"y",r[2]),te(e,"width",r[3]),te(e,"height",r[4]),te(t,"class","a9s-inner"),te(t,"x",r[1]),te(t,"y",r[2]),te(t,"width",r[3]),te(t,"height",r[4])},m(i,n){nt(i,e,n),nt(i,t,n)},p(i,n){n&2&&te(e,"x",i[1]),n&4&&te(e,"y",i[2]),n&8&&te(e,"width",i[3]),n&16&&te(e,"height",i[4]),n&2&&te(t,"x",i[1]),n&4&&te(t,"y",i[2]),n&8&&te(t,"width",i[3]),n&16&&te(t,"height",i[4])},d(i){i&&(rt(e),rt(t))}}}function Db(r){let e,t=r[0]&&qv(r);return{c(){e=Ot("g"),t&&t.c(),te(e,"class","a9s-annotation a9s-rubberband")},m(i,n){nt(i,e,n),t&&t.m(e,null)},p(i,[n]){i[0]?t?t.p(i,n):(t=qv(i),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},i:yn,o:yn,d(i){i&&rt(e),t&&t.d()}}}function Lb(r,e,t){const i=Jp();let{addEventListener:n}=e,{drawingMode:s}=e,{transform:o}=e,l,u,c,d,p,m,y;const v=S=>{const A=S;l=performance.now(),s==="drag"&&(t(0,u=o.elementToImage(A.offsetX,A.offsetY)),c=u,t(1,d=u[0]),t(2,p=u[1]),t(3,m=1),t(4,y=1))},_=S=>{const A=S;u&&(c=o.elementToImage(A.offsetX,A.offsetY),t(1,d=Math.min(c[0],u[0])),t(2,p=Math.min(c[1],u[1])),t(3,m=Math.abs(c[0]-u[0])),t(4,y=Math.abs(c[1]-u[1])))},T=S=>{const A=S,P=performance.now()-l;if(s==="click"){if(P>300)return;u?E():(t(0,u=o.elementToImage(A.offsetX,A.offsetY)),c=u,t(1,d=u[0]),t(2,p=u[1]),t(3,m=1),t(4,y=1))}else u&&(P>300||m*y>100?(A.stopPropagation(),E()):(t(0,u=void 0),c=void 0))},E=()=>{if(m*y>15){const S={type:Ht.RECTANGLE,geometry:{bounds:{minX:d,minY:p,maxX:d+m,maxY:p+y},x:d,y:p,w:m,h:y}};i("create",S)}t(0,u=void 0),c=void 0};return h0(()=>{n("pointerdown",v),n("pointermove",_),n("pointerup",T,!0)}),r.$$set=S=>{"addEventListener"in S&&t(5,n=S.addEventListener),"drawingMode"in S&&t(6,s=S.drawingMode),"transform"in S&&t(7,o=S.transform)},[u,d,p,m,y,n,s,o]}class Fb extends js{constructor(e){super(),Vs(this,e,Lb,Db,Gs,{addEventListener:5,drawingMode:6,transform:7})}}function Jd(r){const e=r.slice(),t=(e[2]?e[0]:[...e[0],e[1]]).map(i=>i.join(",")).join(" ");return e[16]=t,e}function Zv(r){let e,t,i,n,s,o=r[2]&&Qv(r);return{c(){e=Ot("polygon"),i=Ot("polygon"),o&&o.c(),s=hl(),te(e,"class","a9s-outer"),te(e,"points",t=r[16]),te(i,"class","a9s-inner"),te(i,"points",n=r[16])},m(l,u){nt(l,e,u),nt(l,i,u),o&&o.m(l,u),nt(l,s,u)},p(l,u){u&7&&t!==(t=l[16])&&te(e,"points",t),u&7&&n!==(n=l[16])&&te(i,"points",n),l[2]?o?o.p(l,u):(o=Qv(l),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null)},d(l){l&&(rt(e),rt(i),rt(s)),o&&o.d(l)}}}function Qv(r){let e,t,i;return{c(){e=Ot("rect"),te(e,"class","a9s-handle"),te(e,"x",t=r[0][0][0]-r[3]/2),te(e,"y",i=r[0][0][1]-r[3]/2),te(e,"height",r[3]),te(e,"width",r[3])},m(n,s){nt(n,e,s)},p(n,s){s&9&&t!==(t=n[0][0][0]-n[3]/2)&&te(e,"x",t),s&9&&i!==(i=n[0][0][1]-n[3]/2)&&te(e,"y",i),s&8&&te(e,"height",n[3]),s&8&&te(e,"width",n[3])},d(n){n&&rt(e)}}}function Bb(r){let e,t=r[1]&&Zv(Jd(r));return{c(){e=Ot("g"),t&&t.c(),te(e,"class","a9s-annotation a9s-rubberband")},m(i,n){nt(i,e,n),t&&t.m(e,null)},p(i,[n]){i[1]?t?t.p(Jd(i),n):(t=Zv(Jd(i)),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},i:yn,o:yn,d(i){i&&rt(e),t&&t.d()}}}const kb=20,Ub=1500;function Hb(r,e,t){let i;const n=Jp();let{addEventListener:s}=e,{drawingMode:o}=e,{transform:l}=e,{viewportScale:u=1}=e,c,d=[],p,m,y=!1;const v=A=>{const P=A,{timeStamp:D,offsetX:k,offsetY:U}=P;if(c={timeStamp:D,offsetX:k,offsetY:U},o==="drag"&&d.length===0){const j=l.elementToImage(P.offsetX,P.offsetY);d.push(j),t(1,p=j)}},_=A=>{const P=A;if(m&&clearTimeout(m),d.length>0){if(t(1,p=l.elementToImage(P.offsetX,P.offsetY)),d.length>2){const D=Kd(p,d[0])*u;t(2,y=D<kb)}P.pointerType==="touch"&&(m=setTimeout(()=>{E()},Ub))}},T=A=>{const P=A;if(m&&clearTimeout(m),o==="click"){const D=P.timeStamp-c.timeStamp,k=Kd([c.offsetX,c.offsetY],[P.offsetX,P.offsetY]);if(D>300||k>15)return;if(y)S();else if(d.length===0){const U=l.elementToImage(P.offsetX,P.offsetY);d.push(U),t(1,p=U)}else d.push(p)}else{if(d.length===1&&Kd(d[0],p)<=4){t(0,d=[]),t(1,p=void 0);return}P.stopImmediatePropagation(),y?S():d.push(p)}},E=()=>{if(!p)return;const A=d.slice(0,-1);if(A.length<3)return;const P={type:Ht.POLYGON,geometry:{bounds:Xo(d),points:A}};qf(P)>4&&(t(0,d=[]),t(1,p=void 0),n("create",P))},S=()=>{const A={type:Ht.POLYGON,geometry:{bounds:Xo(d),points:[...d]}};t(0,d=[]),t(1,p=void 0),n("create",A)};return h0(()=>{s("pointerdown",v,!0),s("pointermove",_),s("pointerup",T,!0),s("dblclick",E,!0)}),r.$$set=A=>{"addEventListener"in A&&t(4,s=A.addEventListener),"drawingMode"in A&&t(5,o=A.drawingMode),"transform"in A&&t(6,l=A.transform),"viewportScale"in A&&t(7,u=A.viewportScale)},r.$$.update=()=>{r.$$.dirty&128&&t(3,i=10/u)},[d,p,y,i,s,o,l,u]}class zb extends js{constructor(e){super(),Vs(this,e,Hb,Bb,Gs,{addEventListener:4,drawingMode:5,transform:6,viewportScale:7})}}const rm=new Map([["rectangle",{tool:Fb}],["polygon",{tool:zb}]]),_0=()=>[...rm.keys()],x0=r=>rm.get(r),Gb=(r,e,t={})=>rm.set(r,{tool:e,opts:t});function T0(r,e,t=0,i=r.length-1,n=Vb){for(;i>t;){if(i-t>600){const u=i-t+1,c=e-t+1,d=Math.log(u),p=.5*Math.exp(2*d/3),m=.5*Math.sqrt(d*p*(u-p)/u)*(c-u/2<0?-1:1),y=Math.max(t,Math.floor(e-c*p/u+m)),v=Math.min(i,Math.floor(e+(u-c)*p/u+m));T0(r,e,y,v,n)}const s=r[e];let o=t,l=i;for(La(r,t,e),n(r[i],s)>0&&La(r,t,i);o<l;){for(La(r,o,l),o++,l--;n(r[o],s)<0;)o++;for(;n(r[l],s)>0;)l--}n(r[t],s)===0?La(r,t,l):(l++,La(r,l,i)),l<=e&&(t=l+1),e<=l&&(i=l-1)}}function La(r,e,t){const i=r[e];r[e]=r[t],r[t]=i}function Vb(r,e){return r<e?-1:r>e?1:0}class jb{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!Iu(e,t))return i;const n=this.toBBox,s=[];for(;t;){for(let o=0;o<t.children.length;o++){const l=t.children[o],u=t.leaf?n(l):l;Iu(e,u)&&(t.leaf?i.push(l):ef(e,u)?this._all(l,i):s.push(l))}t=s.pop()}return i}collides(e){let t=this.data;if(!Iu(e,t))return!1;const i=[];for(;t;){for(let n=0;n<t.children.length;n++){const s=t.children[n],o=t.leaf?this.toBBox(s):s;if(Iu(e,o)){if(t.leaf||ef(e,o))return!0;i.push(s)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=So([]),this}remove(e,t){if(!e)return this;let i=this.data;const n=this.toBBox(e),s=[],o=[];let l,u,c;for(;i||s.length;){if(i||(i=s.pop(),u=s[s.length-1],l=o.pop(),c=!0),i.leaf){const d=Xb(e,i.children,t);if(d!==-1)return i.children.splice(d,1),s.push(i),this._condense(s),this}!c&&!i.leaf&&ef(i,n)?(s.push(i),o.push(l),l=0,u=i,i=i.children[0]):u?(l++,i=u.children[l],c=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,n){const s=i-t+1;let o=this._maxEntries,l;if(s<=o)return l=So(e.slice(t,i+1)),vo(l,this.toBBox),l;n||(n=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,n-1))),l=So([]),l.leaf=!1,l.height=n;const u=Math.ceil(s/o),c=u*Math.ceil(Math.sqrt(o));Kv(e,t,i,c,this.compareMinX);for(let d=t;d<=i;d+=c){const p=Math.min(d+c-1,i);Kv(e,d,p,u,this.compareMinY);for(let m=d;m<=p;m+=u){const y=Math.min(m+u-1,p);l.children.push(this._build(e,m,y,n-1))}}return vo(l,this.toBBox),l}_chooseSubtree(e,t,i,n){for(;n.push(t),!(t.leaf||n.length-1===i);){let s=1/0,o=1/0,l;for(let u=0;u<t.children.length;u++){const c=t.children[u],d=$d(c),p=qb(e,c)-d;p<o?(o=p,s=d<s?d:s,l=c):p===o&&d<s&&(s=d,l=c)}t=l||t.children[0]}return t}_insert(e,t,i){const n=i?e:this.toBBox(e),s=[],o=this._chooseSubtree(n,this.data,t,s);for(o.children.push(e),Ga(o,n);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(n,s,t)}_split(e,t){const i=e[t],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);const o=this._chooseSplitIndex(i,s,n),l=So(i.children.splice(o,i.children.length-o));l.height=i.height,l.leaf=i.leaf,vo(i,this.toBBox),vo(l,this.toBBox),t?e[t-1].children.push(l):this._splitRoot(i,l)}_splitRoot(e,t){this.data=So([e,t]),this.data.height=e.height+1,this.data.leaf=!1,vo(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let n,s=1/0,o=1/0;for(let l=t;l<=i-t;l++){const u=za(e,0,l,this.toBBox),c=za(e,l,i,this.toBBox),d=Zb(u,c),p=$d(u)+$d(c);d<s?(s=d,n=l,o=p<o?p:o):d===s&&p<o&&(o=p,n=l)}return n||i-t}_chooseSplitAxis(e,t,i){const n=e.leaf?this.compareMinX:Wb,s=e.leaf?this.compareMinY:Yb,o=this._allDistMargin(e,t,i,n),l=this._allDistMargin(e,t,i,s);o<l&&e.children.sort(n)}_allDistMargin(e,t,i,n){e.children.sort(n);const s=this.toBBox,o=za(e,0,t,s),l=za(e,i-t,i,s);let u=Ou(o)+Ou(l);for(let c=t;c<i-t;c++){const d=e.children[c];Ga(o,e.leaf?s(d):d),u+=Ou(o)}for(let c=i-t-1;c>=t;c--){const d=e.children[c];Ga(l,e.leaf?s(d):d),u+=Ou(l)}return u}_adjustParentBBoxes(e,t,i){for(let n=i;n>=0;n--)Ga(t[n],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():vo(e[t],this.toBBox)}}function Xb(r,e,t){if(!t)return e.indexOf(r);for(let i=0;i<e.length;i++)if(t(r,e[i]))return i;return-1}function vo(r,e){za(r,0,r.children.length,e,r)}function za(r,e,t,i,n){n||(n=So(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let s=e;s<t;s++){const o=r.children[s];Ga(n,r.leaf?i(o):o)}return n}function Ga(r,e){return r.minX=Math.min(r.minX,e.minX),r.minY=Math.min(r.minY,e.minY),r.maxX=Math.max(r.maxX,e.maxX),r.maxY=Math.max(r.maxY,e.maxY),r}function Wb(r,e){return r.minX-e.minX}function Yb(r,e){return r.minY-e.minY}function $d(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function Ou(r){return r.maxX-r.minX+(r.maxY-r.minY)}function qb(r,e){return(Math.max(e.maxX,r.maxX)-Math.min(e.minX,r.minX))*(Math.max(e.maxY,r.maxY)-Math.min(e.minY,r.minY))}function Zb(r,e){const t=Math.max(r.minX,e.minX),i=Math.max(r.minY,e.minY),n=Math.min(r.maxX,e.maxX),s=Math.min(r.maxY,e.maxY);return Math.max(0,n-t)*Math.max(0,s-i)}function ef(r,e){return r.minX<=e.minX&&r.minY<=e.minY&&e.maxX<=r.maxX&&e.maxY<=r.maxY}function Iu(r,e){return e.minX<=r.maxX&&e.minY<=r.maxY&&e.maxX>=r.minX&&e.maxY>=r.minY}function So(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Kv(r,e,t,i,n){const s=[e,t];for(;s.length;){if(t=s.pop(),e=s.pop(),t-e<=i)continue;const o=e+Math.ceil((t-e)/i/2)*i;T0(r,o,e,t,n),s.push(e,o,o,t)}}const Qb=()=>{const r=new jb,e=new Map,t=()=>[...e.values()],i=()=>{r.clear(),e.clear()},n=o=>{if(!rh(o))return;const{minX:l,minY:u,maxX:c,maxY:d}=o.selector.geometry.bounds,p={minX:l,minY:u,maxX:c,maxY:d,target:o};r.insert(p),e.set(o.annotation,p)},s=o=>{if(!rh(o))return;const l=e.get(o.annotation);l&&r.remove(l),e.delete(o.annotation)};return{all:t,clear:i,getAt:(o,l)=>{const u=r.search({minX:o,minY:l,maxX:o,maxY:l}).map(c=>c.target).filter(c=>c.selector.type===Ht.RECTANGLE||_A(c.selector,o,l));if(u.length>0)return u.sort((c,d)=>qf(c.selector)-qf(d.selector)),u[0]},getIntersecting:(o,l,u,c)=>r.search({minX:o,minY:l,maxX:o+u,maxY:l+c}).map(d=>d.target),insert:n,remove:s,set:(o,l=!0)=>{l&&i();const u=o.reduce((c,d)=>{if(rh(d)){const{minX:p,minY:m,maxX:y,maxY:v}=d.selector.geometry.bounds;return[...c,{minX:p,minY:m,maxX:y,maxY:v,target:d}]}else return c},[]);u.forEach(c=>e.set(c.target.annotation,c)),r.load(u)},size:()=>r.all().length,update:(o,l)=>{s(o),n(l)}}},Kb=r=>{const e=ub(),t=Qb(),i=QA(e,r.userSelectAction,r.adapter),n=ZA(e),s=hb();return e.observe(({changes:o})=>{t.set((o.created||[]).map(l=>l.target),!1),(o.deleted||[]).forEach(l=>t.remove(l.target)),(o.updated||[]).forEach(({oldValue:l,newValue:u})=>t.update(l.target,u.target))}),{store:{...e,getAt:(o,l)=>{const u=t.getAt(o,l);return u?e.getAnnotation(u.annotation):void 0},getIntersecting:(o,l,u,c)=>t.getIntersecting(o,l,u,c).map(d=>e.getAnnotation(d.annotation))},selection:i,hover:n,viewport:s}},Jb=r=>{let e,t;if(r.nodeName==="CANVAS")e=r,t=e.getContext("2d",{willReadFrequently:!0});else{const n=r;e=document.createElement("canvas"),e.width=n.width,e.height=n.height,t=e.getContext("2d",{willReadFrequently:!0}),t.drawImage(n,0,0,n.width,n.height)}let i=0;for(let n=1;n<10;n++)for(let s=1;s<10;s++){const o=Math.round(s*e.width/10),l=Math.round(n*e.height/10),u=t.getImageData(o,l,1,1).data,c=(.299*u[0]+.587*u[1]+.114*u[2])/255;i+=c}return i/81},$b=r=>{const e=Jb(r),t=e>.6?"dark":"light";return console.log(`[Annotorious] Image brightness: ${e.toFixed(1)}. Setting ${t} theme.`),t},eC=(r,e)=>({...r,drawingEnabled:r.drawingEnabled===void 0?e.drawingEnabled:r.drawingEnabled,drawingMode:r.drawingMode||e.drawingMode,userSelectAction:r.userSelectAction||e.userSelectAction,theme:r.theme||e.theme}),Jv=typeof navigator>"u"?!1:navigator.userAgent.indexOf("Mac OS X")!==-1,tC=(r,e)=>{const t=e||document,i=o=>{const l=o;l.key==="z"&&l.ctrlKey?r.undo():l.key==="y"&&l.ctrlKey&&r.redo()},n=o=>{const l=o;l.key==="z"&&l.metaKey&&(l.shiftKey?r.redo():r.undo())},s=()=>{Jv?t.removeEventListener("keydown",n):t.removeEventListener("keydown",i)};return Jv?t.addEventListener("keydown",n):t.addEventListener("keydown",i),{destroy:s}};function ki(){}function iC(r,e){for(const t in e)r[t]=e[t];return r}function w0(r){return r()}function $v(){return Object.create(null)}function cl(r){r.forEach(w0)}function nm(r){return typeof r=="function"}function Oi(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}function rC(r){return Object.keys(r).length===0}function nC(r,...e){if(r==null){for(const i of e)i(void 0);return ki}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function yh(r,e,t){r.$$.on_destroy.push(nC(e,t))}function sC(r,e,t,i){if(r){const n=E0(r,e,t,i);return r[0](n)}}function E0(r,e,t,i){return r[1]&&i?iC(t.ctx.slice(),r[1](i(e))):t.ctx}function oC(r,e,t,i){if(r[2]&&i){const n=r[2](i(t));if(e.dirty===void 0)return n;if(typeof n=="object"){const s=[],o=Math.max(e.dirty.length,n.length);for(let l=0;l<o;l+=1)s[l]=e.dirty[l]|n[l];return s}return e.dirty|n}return e.dirty}function aC(r,e,t,i,n,s){if(n){const o=E0(e,t,i,s);r.p(o,n)}}function lC(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}const S0=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Yr(r,e){r.appendChild(e)}function di(r,e,t){r.insertBefore(e,t||null)}function ei(r){r.parentNode&&r.parentNode.removeChild(r)}function sm(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function hi(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function A0(r){return document.createTextNode(r)}function xn(){return A0("")}function Se(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function uC(r){return Array.from(r.childNodes)}function hC(r,e){e=""+e,r.data!==e&&(r.data=e)}function e_(r,e,t){r.classList.toggle(e,!!t)}function cC(r,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:i})}let rl;function Ka(r){rl=r}function om(){if(!rl)throw new Error("Function called outside component initialization");return rl}function Hh(r){om().$$.on_mount.push(r)}function dC(r){om().$$.on_destroy.push(r)}function am(){const r=om();return(e,t,{cancelable:i=!1}={})=>{const n=r.$$.callbacks[e];if(n){const s=cC(e,t,{cancelable:i});return n.slice().forEach(o=>{o.call(r,s)}),!s.defaultPrevented}return!0}}const Ao=[],vh=[];let Bo=[];const t_=[],fC=Promise.resolve();let $f=!1;function pC(){$f||($f=!0,fC.then(b0))}function ep(r){Bo.push(r)}const tf=new Set;let _o=0;function b0(){if(_o!==0)return;const r=rl;do{try{for(;_o<Ao.length;){const e=Ao[_o];_o++,Ka(e),mC(e.$$)}}catch(e){throw Ao.length=0,_o=0,e}for(Ka(null),Ao.length=0,_o=0;vh.length;)vh.pop()();for(let e=0;e<Bo.length;e+=1){const t=Bo[e];tf.has(t)||(tf.add(t),t())}Bo.length=0}while(Ao.length);for(;t_.length;)t_.pop()();$f=!1,tf.clear(),Ka(r)}function mC(r){if(r.fragment!==null){r.update(),cl(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(ep)}}function gC(r){const e=[],t=[];Bo.forEach(i=>r.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),Bo=e}const nh=new Set;let Ns;function sr(){Ns={r:0,c:[],p:Ns}}function or(){Ns.r||cl(Ns.c),Ns=Ns.p}function qe(r,e){r&&r.i&&(nh.delete(r),r.i(e))}function tt(r,e,t,i){if(r&&r.o){if(nh.has(r))return;nh.add(r),Ns.c.push(()=>{nh.delete(r),i&&(t&&r.d(1),i())}),r.o(e)}else i&&i()}function Wo(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function ar(r){r&&r.c()}function Xi(r,e,t){const{fragment:i,after_update:n}=r.$$;i&&i.m(e,t),ep(()=>{const s=r.$$.on_mount.map(w0).filter(nm);r.$$.on_destroy?r.$$.on_destroy.push(...s):cl(s),r.$$.on_mount=[]}),n.forEach(ep)}function Wi(r,e){const t=r.$$;t.fragment!==null&&(gC(t.after_update),cl(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function yC(r,e){r.$$.dirty[0]===-1&&(Ao.push(r),pC(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Yi(r,e,t,i,n,s,o=null,l=[-1]){const u=rl;Ka(r);const c=r.$$={fragment:null,ctx:[],props:s,update:ki,not_equal:n,bound:$v(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:$v(),dirty:l,skip_bound:!1,root:e.target||u.$$.root};o&&o(c.root);let d=!1;if(c.ctx=t?t(r,e.props||{},(p,m,...y)=>{const v=y.length?y[0]:m;return c.ctx&&n(c.ctx[p],c.ctx[p]=v)&&(!c.skip_bound&&c.bound[p]&&c.bound[p](v),d&&yC(r,p)),m}):[],c.update(),d=!0,cl(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){const p=uC(e.target);c.fragment&&c.fragment.l(p),p.forEach(ei)}else c.fragment&&c.fragment.c();e.intro&&qe(r.$$.fragment),Xi(r,e.target,e.anchor),b0()}Ka(u)}class qi{constructor(){Rt(this,"$$"),Rt(this,"$$set")}$destroy(){Wi(this,1),this.$destroy=ki}$on(e,t){if(!nm(t))return ki;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const n=i.indexOf(t);n!==-1&&i.splice(n,1)}}$set(e){this.$$set&&!rC(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const vC="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(vC);var Xs=(r=>(r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2",r))(Xs||{}),C0=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS",r))(C0||{}),tp=(r=>(r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL",r))(tp||{}),je=(r=>(r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR",r))(je||{}),Xr=(r=>(r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r))(Xr||{}),xe=(r=>(r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r))(xe||{}),ko=(r=>(r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r))(ko||{}),ke=(r=>(r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT",r))(ke||{}),Ce=(r=>(r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT",r))(Ce||{}),fn=(r=>(r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR",r))(fn||{}),Jn=(r=>(r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r))(Jn||{}),Qr=(r=>(r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL",r))(Qr||{}),Bi=(r=>(r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",r))(Bi||{}),Gr=(r=>(r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT",r))(Gr||{}),lm=(r=>(r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL",r))(lm||{}),ir=(r=>(r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp",r))(ir||{}),Jt=(r=>(r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR",r))(Jt||{}),qt=(r=>(r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH",r))(qt||{}),qr=(r=>(r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r))(qr||{});const _C={createCanvas:(r,e)=>{const t=document.createElement("canvas");return t.width=r,t.height=e,t},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(r,e)=>fetch(r,e),parseXML:r=>new DOMParser().parseFromString(r,"text/xml")},Re={ADAPTER:_C,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var rf=/iPhone/i,i_=/iPod/i,r_=/iPad/i,n_=/\biOS-universal(?:.+)Mac\b/i,nf=/\bAndroid(?:.+)Mobile\b/i,s_=/Android/i,xo=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Mu=/Silk/i,hn=/Windows Phone/i,o_=/\bWindows(?:.+)ARM\b/i,a_=/BlackBerry/i,l_=/BB10/i,u_=/Opera Mini/i,h_=/\b(CriOS|Chrome)(?:.+)Mobile/i,c_=/Mobile(?:.+)Firefox\b/i,d_=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function xC(r){return function(e){return e.test(r)}}function f_(r){var e={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?e.userAgent=r:r&&r.userAgent&&(e={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var t=e.userAgent,i=t.split("[FBAN");typeof i[1]<"u"&&(t=i[0]),i=t.split("Twitter"),typeof i[1]<"u"&&(t=i[0]);var n=xC(t),s={apple:{phone:n(rf)&&!n(hn),ipod:n(i_),tablet:!n(rf)&&(n(r_)||d_(e))&&!n(hn),universal:n(n_),device:(n(rf)||n(i_)||n(r_)||n(n_)||d_(e))&&!n(hn)},amazon:{phone:n(xo),tablet:!n(xo)&&n(Mu),device:n(xo)||n(Mu)},android:{phone:!n(hn)&&n(xo)||!n(hn)&&n(nf),tablet:!n(hn)&&!n(xo)&&!n(nf)&&(n(Mu)||n(s_)),device:!n(hn)&&(n(xo)||n(Mu)||n(nf)||n(s_))||n(/\bokhttp\b/i)},windows:{phone:n(hn),tablet:n(o_),device:n(hn)||n(o_)},other:{blackberry:n(a_),blackberry10:n(l_),opera:n(u_),firefox:n(c_),chrome:n(h_),device:n(a_)||n(l_)||n(u_)||n(c_)||n(h_)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const TC=f_.default??f_,pn=TC(globalThis.navigator);Re.RETINA_PREFIX=/@([0-9\.]+)x/;Re.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var sf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function R0(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function wC(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var n=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return r[i]}})}),t}var P0={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function n(u,c,d){this.fn=u,this.context=c,this.once=d||!1}function s(u,c,d,p,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var y=new n(d,p||u,m),v=t?t+c:c;return u._events[v]?u._events[v].fn?u._events[v]=[u._events[v],y]:u._events[v].push(y):(u._events[v]=y,u._eventsCount++),u}function o(u,c){--u._eventsCount===0?u._events=new i:delete u._events[c]}function l(){this._events=new i,this._eventsCount=0}l.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},l.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var p=0,m=d.length,y=new Array(m);p<m;p++)y[p]=d[p].fn;return y},l.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},l.prototype.emit=function(u,c,d,p,m,y){var v=t?t+u:u;if(!this._events[v])return!1;var _=this._events[v],T=arguments.length,E,S;if(_.fn){switch(_.once&&this.removeListener(u,_.fn,void 0,!0),T){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,c),!0;case 3:return _.fn.call(_.context,c,d),!0;case 4:return _.fn.call(_.context,c,d,p),!0;case 5:return _.fn.call(_.context,c,d,p,m),!0;case 6:return _.fn.call(_.context,c,d,p,m,y),!0}for(S=1,E=new Array(T-1);S<T;S++)E[S-1]=arguments[S];_.fn.apply(_.context,E)}else{var A=_.length,P;for(S=0;S<A;S++)switch(_[S].once&&this.removeListener(u,_[S].fn,void 0,!0),T){case 1:_[S].fn.call(_[S].context);break;case 2:_[S].fn.call(_[S].context,c);break;case 3:_[S].fn.call(_[S].context,c,d);break;case 4:_[S].fn.call(_[S].context,c,d,p);break;default:if(!E)for(P=1,E=new Array(T-1);P<T;P++)E[P-1]=arguments[P];_[S].fn.apply(_[S].context,E)}}return!0},l.prototype.on=function(u,c,d){return s(this,u,c,d,!1)},l.prototype.once=function(u,c,d){return s(this,u,c,d,!0)},l.prototype.removeListener=function(u,c,d,p){var m=t?t+u:u;if(!this._events[m])return this;if(!c)return o(this,m),this;var y=this._events[m];if(y.fn)y.fn===c&&(!p||y.once)&&(!d||y.context===d)&&o(this,m);else{for(var v=0,_=[],T=y.length;v<T;v++)(y[v].fn!==c||p&&!y[v].once||d&&y[v].context!==d)&&_.push(y[v]);_.length?this._events[m]=_.length===1?_[0]:_:o(this,m)}return this},l.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&o(this,c)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,r.exports=l})(P0);var EC=P0.exports;const dl=R0(EC);var um={exports:{}};um.exports=zh;um.exports.default=zh;function zh(r,e,t){t=t||2;var i=e&&e.length,n=i?e[0]*t:r.length,s=O0(r,0,n,t,!0),o=[];if(!s||s.next===s.prev)return o;var l,u,c,d,p,m,y;if(i&&(s=RC(r,e,s,t)),r.length>80*t){l=c=r[0],u=d=r[1];for(var v=t;v<n;v+=t)p=r[v],m=r[v+1],p<l&&(l=p),m<u&&(u=m),p>c&&(c=p),m>d&&(d=m);y=Math.max(c-l,d-u),y=y!==0?32767/y:0}return nl(s,o,t,l,u,y,0),o}function O0(r,e,t,i,n){var s,o;if(n===np(r,e,t,i)>0)for(s=e;s<t;s+=i)o=p_(s,r[s],r[s+1],o);else for(s=t-i;s>=e;s-=i)o=p_(s,r[s],r[s+1],o);return o&&Gh(o,o.next)&&(ol(o),o=o.next),o}function Us(r,e){if(!r)return r;e||(e=r);var t=r,i;do if(i=!1,!t.steiner&&(Gh(t,t.next)||It(t.prev,t,t.next)===0)){if(ol(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function nl(r,e,t,i,n,s,o){if(r){!o&&s&&NC(r,i,n,s);for(var l=r,u,c;r.prev!==r.next;){if(u=r.prev,c=r.next,s?AC(r,i,n,s):SC(r)){e.push(u.i/t|0),e.push(r.i/t|0),e.push(c.i/t|0),ol(r),r=c.next,l=c.next;continue}if(r=c,r===l){o?o===1?(r=bC(Us(r),e,t),nl(r,e,t,i,n,s,2)):o===2&&CC(r,e,t,i,n,s):nl(Us(r),e,t,i,n,s,1);break}}}}function SC(r){var e=r.prev,t=r,i=r.next;if(It(e,t,i)>=0)return!1;for(var n=e.x,s=t.x,o=i.x,l=e.y,u=t.y,c=i.y,d=n<s?n<o?n:o:s<o?s:o,p=l<u?l<c?l:c:u<c?u:c,m=n>s?n>o?n:o:s>o?s:o,y=l>u?l>c?l:c:u>c?u:c,v=i.next;v!==e;){if(v.x>=d&&v.x<=m&&v.y>=p&&v.y<=y&&Do(n,l,s,u,o,c,v.x,v.y)&&It(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function AC(r,e,t,i){var n=r.prev,s=r,o=r.next;if(It(n,s,o)>=0)return!1;for(var l=n.x,u=s.x,c=o.x,d=n.y,p=s.y,m=o.y,y=l<u?l<c?l:c:u<c?u:c,v=d<p?d<m?d:m:p<m?p:m,_=l>u?l>c?l:c:u>c?u:c,T=d>p?d>m?d:m:p>m?p:m,E=ip(y,v,e,t,i),S=ip(_,T,e,t,i),A=r.prevZ,P=r.nextZ;A&&A.z>=E&&P&&P.z<=S;){if(A.x>=y&&A.x<=_&&A.y>=v&&A.y<=T&&A!==n&&A!==o&&Do(l,d,u,p,c,m,A.x,A.y)&&It(A.prev,A,A.next)>=0||(A=A.prevZ,P.x>=y&&P.x<=_&&P.y>=v&&P.y<=T&&P!==n&&P!==o&&Do(l,d,u,p,c,m,P.x,P.y)&&It(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;A&&A.z>=E;){if(A.x>=y&&A.x<=_&&A.y>=v&&A.y<=T&&A!==n&&A!==o&&Do(l,d,u,p,c,m,A.x,A.y)&&It(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;P&&P.z<=S;){if(P.x>=y&&P.x<=_&&P.y>=v&&P.y<=T&&P!==n&&P!==o&&Do(l,d,u,p,c,m,P.x,P.y)&&It(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function bC(r,e,t){var i=r;do{var n=i.prev,s=i.next.next;!Gh(n,s)&&I0(n,i,i.next,s)&&sl(n,s)&&sl(s,n)&&(e.push(n.i/t|0),e.push(i.i/t|0),e.push(s.i/t|0),ol(i),ol(i.next),i=r=s),i=i.next}while(i!==r);return Us(i)}function CC(r,e,t,i,n,s){var o=r;do{for(var l=o.next.next;l!==o.prev;){if(o.i!==l.i&&FC(o,l)){var u=M0(o,l);o=Us(o,o.next),u=Us(u,u.next),nl(o,e,t,i,n,s,0),nl(u,e,t,i,n,s,0);return}l=l.next}o=o.next}while(o!==r)}function RC(r,e,t,i){var n=[],s,o,l,u,c;for(s=0,o=e.length;s<o;s++)l=e[s]*i,u=s<o-1?e[s+1]*i:r.length,c=O0(r,l,u,i,!1),c===c.next&&(c.steiner=!0),n.push(LC(c));for(n.sort(PC),s=0;s<n.length;s++)t=OC(n[s],t);return t}function PC(r,e){return r.x-e.x}function OC(r,e){var t=IC(r,e);if(!t)return e;var i=M0(t,r);return Us(i,i.next),Us(t,t.next)}function IC(r,e){var t=e,i=r.x,n=r.y,s=-1/0,o;do{if(n<=t.y&&n>=t.next.y&&t.next.y!==t.y){var l=t.x+(n-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(l<=i&&l>s&&(s=l,o=t.x<t.next.x?t:t.next,l===i))return o}t=t.next}while(t!==e);if(!o)return null;var u=o,c=o.x,d=o.y,p=1/0,m;t=o;do i>=t.x&&t.x>=c&&i!==t.x&&Do(n<d?i:s,n,c,d,n<d?s:i,n,t.x,t.y)&&(m=Math.abs(n-t.y)/(i-t.x),sl(t,r)&&(m<p||m===p&&(t.x>o.x||t.x===o.x&&MC(o,t)))&&(o=t,p=m)),t=t.next;while(t!==u);return o}function MC(r,e){return It(r.prev,r,e.prev)<0&&It(e.next,r,r.next)<0}function NC(r,e,t,i){var n=r;do n.z===0&&(n.z=ip(n.x,n.y,e,t,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==r);n.prevZ.nextZ=null,n.prevZ=null,DC(n)}function DC(r){var e,t,i,n,s,o,l,u,c=1;do{for(t=r,r=null,s=null,o=0;t;){for(o++,i=t,l=0,e=0;e<c&&(l++,i=i.nextZ,!!i);e++);for(u=c;l>0||u>0&&i;)l!==0&&(u===0||!i||t.z<=i.z)?(n=t,t=t.nextZ,l--):(n=i,i=i.nextZ,u--),s?s.nextZ=n:r=n,n.prevZ=s,s=n;t=i}s.nextZ=null,c*=2}while(o>1);return r}function ip(r,e,t,i,n){return r=(r-t)*n|0,e=(e-i)*n|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function LC(r){var e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function Do(r,e,t,i,n,s,o,l){return(n-o)*(e-l)>=(r-o)*(s-l)&&(r-o)*(i-l)>=(t-o)*(e-l)&&(t-o)*(s-l)>=(n-o)*(i-l)}function FC(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!BC(r,e)&&(sl(r,e)&&sl(e,r)&&kC(r,e)&&(It(r.prev,r,e.prev)||It(r,e.prev,e))||Gh(r,e)&&It(r.prev,r,r.next)>0&&It(e.prev,e,e.next)>0)}function It(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function Gh(r,e){return r.x===e.x&&r.y===e.y}function I0(r,e,t,i){var n=Du(It(r,e,t)),s=Du(It(r,e,i)),o=Du(It(t,i,r)),l=Du(It(t,i,e));return!!(n!==s&&o!==l||n===0&&Nu(r,t,e)||s===0&&Nu(r,i,e)||o===0&&Nu(t,r,i)||l===0&&Nu(t,e,i))}function Nu(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function Du(r){return r>0?1:r<0?-1:0}function BC(r,e){var t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&I0(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function sl(r,e){return It(r.prev,r,r.next)<0?It(r,e,r.next)>=0&&It(r,r.prev,e)>=0:It(r,e,r.prev)<0||It(r,r.next,e)<0}function kC(r,e){var t=r,i=!1,n=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&n<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==r);return i}function M0(r,e){var t=new rp(r.i,r.x,r.y),i=new rp(e.i,e.x,e.y),n=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=n,n.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function p_(r,e,t,i){var n=new rp(r,e,t);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function ol(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function rp(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}zh.deviation=function(r,e,t,i){var n=e&&e.length,s=n?e[0]*t:r.length,o=Math.abs(np(r,0,s,t));if(n)for(var l=0,u=e.length;l<u;l++){var c=e[l]*t,d=l<u-1?e[l+1]*t:r.length;o-=Math.abs(np(r,c,d,t))}var p=0;for(l=0;l<i.length;l+=3){var m=i[l]*t,y=i[l+1]*t,v=i[l+2]*t;p+=Math.abs((r[m]-r[v])*(r[y+1]-r[m+1])-(r[m]-r[y])*(r[v+1]-r[m+1]))}return o===0&&p===0?0:Math.abs((p-o)/o)};function np(r,e,t,i){for(var n=0,s=e,o=t-i;s<t;s+=i)n+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return n}zh.flatten=function(r){for(var e=r[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,n=0;n<r.length;n++){for(var s=0;s<r[n].length;s++)for(var o=0;o<e;o++)t.vertices.push(r[n][s][o]);n>0&&(i+=r[n-1].length,t.holes.push(i))}return t};var UC=um.exports;const HC=R0(UC);var _h={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */_h.exports;(function(r,e){(function(t){var i=e&&!e.nodeType&&e,n=r&&!r.nodeType&&r,s=typeof sf=="object"&&sf;(s.global===s||s.window===s||s.self===s)&&(t=s);var o,l=2147483647,u=36,c=1,d=26,p=38,m=700,y=72,v=128,_="-",T=/^xn--/,E=/[^\x20-\x7E]/,S=/[\x2E\u3002\uFF0E\uFF61]/g,A={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},P=u-c,D=Math.floor,k=String.fromCharCode,U;function j(z){throw new RangeError(A[z])}function q(z,N){for(var W=z.length,re=[];W--;)re[W]=N(z[W]);return re}function ee(z,N){var W=z.split("@"),re="";W.length>1&&(re=W[0]+"@",z=W[1]),z=z.replace(S,".");var _e=z.split("."),me=q(_e,N).join(".");return re+me}function pe(z){for(var N=[],W=0,re=z.length,_e,me;W<re;)_e=z.charCodeAt(W++),_e>=55296&&_e<=56319&&W<re?(me=z.charCodeAt(W++),(me&64512)==56320?N.push(((_e&1023)<<10)+(me&1023)+65536):(N.push(_e),W--)):N.push(_e);return N}function H(z){return q(z,function(N){var W="";return N>65535&&(N-=65536,W+=k(N>>>10&1023|55296),N=56320|N&1023),W+=k(N),W}).join("")}function F(z){return z-48<10?z-22:z-65<26?z-65:z-97<26?z-97:u}function G(z,N){return z+22+75*(z<26)-((N!=0)<<5)}function $(z,N,W){var re=0;for(z=W?D(z/m):z>>1,z+=D(z/N);z>P*d>>1;re+=u)z=D(z/P);return D(re+(P+1)*z/(z+p))}function le(z){var N=[],W=z.length,re,_e=0,me=v,Pe=y,Ue,Te,ge,Ke,Je,ht,st,ti,Zt;for(Ue=z.lastIndexOf(_),Ue<0&&(Ue=0),Te=0;Te<Ue;++Te)z.charCodeAt(Te)>=128&&j("not-basic"),N.push(z.charCodeAt(Te));for(ge=Ue>0?Ue+1:0;ge<W;){for(Ke=_e,Je=1,ht=u;ge>=W&&j("invalid-input"),st=F(z.charCodeAt(ge++)),(st>=u||st>D((l-_e)/Je))&&j("overflow"),_e+=st*Je,ti=ht<=Pe?c:ht>=Pe+d?d:ht-Pe,!(st<ti);ht+=u)Zt=u-ti,Je>D(l/Zt)&&j("overflow"),Je*=Zt;re=N.length+1,Pe=$(_e-Ke,re,Ke==0),D(_e/re)>l-me&&j("overflow"),me+=D(_e/re),_e%=re,N.splice(_e++,0,me)}return H(N)}function ie(z){var N,W,re,_e,me,Pe,Ue,Te,ge,Ke,Je,ht=[],st,ti,Zt,bi;for(z=pe(z),st=z.length,N=v,W=0,me=y,Pe=0;Pe<st;++Pe)Je=z[Pe],Je<128&&ht.push(k(Je));for(re=_e=ht.length,_e&&ht.push(_);re<st;){for(Ue=l,Pe=0;Pe<st;++Pe)Je=z[Pe],Je>=N&&Je<Ue&&(Ue=Je);for(ti=re+1,Ue-N>D((l-W)/ti)&&j("overflow"),W+=(Ue-N)*ti,N=Ue,Pe=0;Pe<st;++Pe)if(Je=z[Pe],Je<N&&++W>l&&j("overflow"),Je==N){for(Te=W,ge=u;Ke=ge<=me?c:ge>=me+d?d:ge-me,!(Te<Ke);ge+=u)bi=Te-Ke,Zt=u-Ke,ht.push(k(G(Ke+bi%Zt,0))),Te=D(bi/Zt);ht.push(k(G(Te,0))),me=$(W,ti,re==_e),W=0,++re}++W,++N}return ht.join("")}function Y(z){return ee(z,function(N){return T.test(N)?le(N.slice(4).toLowerCase()):N})}function de(z){return ee(z,function(N){return E.test(N)?"xn--"+ie(N):N})}if(o={version:"1.4.1",ucs2:{decode:pe,encode:H},decode:le,encode:ie,toASCII:de,toUnicode:Y},i&&n)if(r.exports==i)n.exports=o;else for(U in o)o.hasOwnProperty(U)&&(i[U]=o[U]);else t.punycode=o})(sf)})(_h,_h.exports);_h.exports;var N0=TypeError;const zC={},GC=Object.freeze(Object.defineProperty({__proto__:null,default:zC},Symbol.toStringTag,{value:"Module"})),VC=wC(GC);var D0=typeof Map=="function"&&Map.prototype,of=Object.getOwnPropertyDescriptor&&D0?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null;D0&&of&&typeof of.get=="function"&&of.get;var L0=typeof Set=="function"&&Set.prototype,af=Object.getOwnPropertyDescriptor&&L0?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null;L0&&af&&typeof af.get=="function"&&af.get;var m_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,jC=typeof Symbol=="function"&&typeof Symbol.iterator=="object",XC=VC,g_=XC.custom;WC(g_);function WC(r){if(jC)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!m_)return!1;try{return m_.call(r),!0}catch{}return!1}var F0=Object,YC=Error,qC=EvalError,ZC=RangeError,QC=ReferenceError,KC=SyntaxError,JC=URIError,$C=Math.abs,eR=Math.floor,tR=Math.max,iR=Math.min,rR=Math.pow,nR=Math.round,sR=Number.isNaN||function(r){return r!==r},oR=sR,aR=function(r){return oR(r)||r===0?r:r<0?-1:1},lR=Object.getOwnPropertyDescriptor,sh=lR;if(sh)try{sh([],"length")}catch{sh=null}var B0=sh,oh=Object.defineProperty||!1;if(oh)try{oh({},"a",{value:1})}catch{oh=!1}var uR=oh,y_,v_;function hR(){return v_||(v_=1,y_=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var r={},e=Symbol("test"),t=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(t)!=="[object Symbol]")return!1;var i=42;r[e]=i;for(var n in r)return!1;if(typeof Object.keys=="function"&&Object.keys(r).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(r).length!==0)return!1;var s=Object.getOwnPropertySymbols(r);if(s.length!==1||s[0]!==e||!Object.prototype.propertyIsEnumerable.call(r,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(r,e);if(o.value!==i||o.enumerable!==!0)return!1}return!0}),y_}var lf,__;function cR(){if(__)return lf;__=1;var r=typeof Symbol<"u"&&Symbol,e=hR();return lf=function(){return typeof r!="function"||typeof Symbol!="function"||typeof r("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},lf}var x_,T_;function k0(){return T_||(T_=1,x_=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),x_}var uf,w_;function U0(){if(w_)return uf;w_=1;var r=F0;return uf=r.getPrototypeOf||null,uf}var dR="Function.prototype.bind called on incompatible ",fR=Object.prototype.toString,pR=Math.max,mR="[object Function]",E_=function(r,e){for(var t=[],i=0;i<r.length;i+=1)t[i]=r[i];for(var n=0;n<e.length;n+=1)t[n+r.length]=e[n];return t},gR=function(r,e){for(var t=[],i=e,n=0;i<r.length;i+=1,n+=1)t[n]=r[i];return t},yR=function(r,e){for(var t="",i=0;i<r.length;i+=1)t+=r[i],i+1<r.length&&(t+=e);return t},vR=function(r){var e=this;if(typeof e!="function"||fR.apply(e)!==mR)throw new TypeError(dR+e);for(var t=gR(arguments,1),i,n=function(){if(this instanceof i){var c=e.apply(this,E_(t,arguments));return Object(c)===c?c:this}return e.apply(r,E_(t,arguments))},s=pR(0,e.length-t.length),o=[],l=0;l<s;l++)o[l]="$"+l;if(i=Function("binder","return function ("+yR(o,",")+"){ return binder.apply(this,arguments); }")(n),e.prototype){var u=function(){};u.prototype=e.prototype,i.prototype=new u,u.prototype=null}return i},_R=vR,Vh=Function.prototype.bind||_R,hm=Function.prototype.call,H0=Function.prototype.apply,xR=typeof Reflect<"u"&&Reflect&&Reflect.apply,TR=Vh,wR=H0,ER=hm,SR=xR,AR=SR||TR.call(ER,wR),bR=Vh,CR=N0,RR=hm,PR=AR,z0=function(r){if(r.length<1||typeof r[0]!="function")throw new CR("a function is required");return PR(bR,RR,r)},hf,S_;function OR(){if(S_)return hf;S_=1;var r=z0,e=B0,t;try{t=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var i=!!t&&e&&e(Object.prototype,"__proto__"),n=Object,s=n.getPrototypeOf;return hf=i&&typeof i.get=="function"?r([i.get]):typeof s=="function"?function(o){return s(o==null?o:n(o))}:!1,hf}var cf,A_;function IR(){if(A_)return cf;A_=1;var r=k0(),e=U0(),t=OR();return cf=r?function(i){return r(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:t?function(i){return t(i)}:null,cf}var df,b_;function MR(){if(b_)return df;b_=1;var r=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Vh;return df=t.call(r,e),df}var it,NR=F0,DR=YC,LR=qC,FR=ZC,BR=QC,Yo=KC,Uo=N0,kR=JC,UR=$C,HR=eR,zR=tR,GR=iR,VR=rR,jR=nR,XR=aR,G0=Function,ff=function(r){try{return G0('"use strict"; return ('+r+").constructor;")()}catch{}},al=B0,WR=uR,pf=function(){throw new Uo},YR=al?function(){try{return arguments.callee,pf}catch{try{return al(arguments,"callee").get}catch{return pf}}}():pf,To=cR()(),oi=IR(),qR=U0(),ZR=k0(),V0=H0,fl=hm,bo={},QR=typeof Uint8Array>"u"||!oi?it:oi(Uint8Array),Fs={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?it:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?it:ArrayBuffer,"%ArrayIteratorPrototype%":To&&oi?oi([][Symbol.iterator]()):it,"%AsyncFromSyncIteratorPrototype%":it,"%AsyncFunction%":bo,"%AsyncGenerator%":bo,"%AsyncGeneratorFunction%":bo,"%AsyncIteratorPrototype%":bo,"%Atomics%":typeof Atomics>"u"?it:Atomics,"%BigInt%":typeof BigInt>"u"?it:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?it:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?it:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?it:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":DR,"%eval%":eval,"%EvalError%":LR,"%Float16Array%":typeof Float16Array>"u"?it:Float16Array,"%Float32Array%":typeof Float32Array>"u"?it:Float32Array,"%Float64Array%":typeof Float64Array>"u"?it:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?it:FinalizationRegistry,"%Function%":G0,"%GeneratorFunction%":bo,"%Int8Array%":typeof Int8Array>"u"?it:Int8Array,"%Int16Array%":typeof Int16Array>"u"?it:Int16Array,"%Int32Array%":typeof Int32Array>"u"?it:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":To&&oi?oi(oi([][Symbol.iterator]())):it,"%JSON%":typeof JSON=="object"?JSON:it,"%Map%":typeof Map>"u"?it:Map,"%MapIteratorPrototype%":typeof Map>"u"||!To||!oi?it:oi(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":NR,"%Object.getOwnPropertyDescriptor%":al,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?it:Promise,"%Proxy%":typeof Proxy>"u"?it:Proxy,"%RangeError%":FR,"%ReferenceError%":BR,"%Reflect%":typeof Reflect>"u"?it:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?it:Set,"%SetIteratorPrototype%":typeof Set>"u"||!To||!oi?it:oi(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?it:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":To&&oi?oi(""[Symbol.iterator]()):it,"%Symbol%":To?Symbol:it,"%SyntaxError%":Yo,"%ThrowTypeError%":YR,"%TypedArray%":QR,"%TypeError%":Uo,"%Uint8Array%":typeof Uint8Array>"u"?it:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?it:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?it:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?it:Uint32Array,"%URIError%":kR,"%WeakMap%":typeof WeakMap>"u"?it:WeakMap,"%WeakRef%":typeof WeakRef>"u"?it:WeakRef,"%WeakSet%":typeof WeakSet>"u"?it:WeakSet,"%Function.prototype.call%":fl,"%Function.prototype.apply%":V0,"%Object.defineProperty%":WR,"%Object.getPrototypeOf%":qR,"%Math.abs%":UR,"%Math.floor%":HR,"%Math.max%":zR,"%Math.min%":GR,"%Math.pow%":VR,"%Math.round%":jR,"%Math.sign%":XR,"%Reflect.getPrototypeOf%":ZR};if(oi)try{null.error}catch(r){var KR=oi(oi(r));Fs["%Error.prototype%"]=KR}var JR=function r(e){var t;if(e==="%AsyncFunction%")t=ff("async function () {}");else if(e==="%GeneratorFunction%")t=ff("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=ff("async function* () {}");else if(e==="%AsyncGenerator%"){var i=r("%AsyncGeneratorFunction%");i&&(t=i.prototype)}else if(e==="%AsyncIteratorPrototype%"){var n=r("%AsyncGenerator%");n&&oi&&(t=oi(n.prototype))}return Fs[e]=t,t},C_={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},pl=Vh,xh=MR(),$R=pl.call(fl,Array.prototype.concat),eP=pl.call(V0,Array.prototype.splice),R_=pl.call(fl,String.prototype.replace),Th=pl.call(fl,String.prototype.slice),tP=pl.call(fl,RegExp.prototype.exec),iP=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,rP=/\\(\\)?/g,nP=function(r){var e=Th(r,0,1),t=Th(r,-1);if(e==="%"&&t!=="%")throw new Yo("invalid intrinsic syntax, expected closing `%`");if(t==="%"&&e!=="%")throw new Yo("invalid intrinsic syntax, expected opening `%`");var i=[];return R_(r,iP,function(n,s,o,l){i[i.length]=o?R_(l,rP,"$1"):s||n}),i},sP=function(r,e){var t=r,i;if(xh(C_,t)&&(i=C_[t],t="%"+i[0]+"%"),xh(Fs,t)){var n=Fs[t];if(n===bo&&(n=JR(t)),typeof n>"u"&&!e)throw new Uo("intrinsic "+r+" exists, but is not available. Please file an issue!");return{alias:i,name:t,value:n}}throw new Yo("intrinsic "+r+" does not exist!")},cm=function(r,e){if(typeof r!="string"||r.length===0)throw new Uo("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new Uo('"allowMissing" argument must be a boolean');if(tP(/^%?[^%]*%?$/,r)===null)throw new Yo("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var t=nP(r),i=t.length>0?t[0]:"",n=sP("%"+i+"%",e),s=n.name,o=n.value,l=!1,u=n.alias;u&&(i=u[0],eP(t,$R([0,1],u)));for(var c=1,d=!0;c<t.length;c+=1){var p=t[c],m=Th(p,0,1),y=Th(p,-1);if((m==='"'||m==="'"||m==="`"||y==='"'||y==="'"||y==="`")&&m!==y)throw new Yo("property names with quotes must have matching quotes");if((p==="constructor"||!d)&&(l=!0),i+="."+p,s="%"+i+"%",xh(Fs,s))o=Fs[s];else if(o!=null){if(!(p in o)){if(!e)throw new Uo("base intrinsic for "+r+" exists, but the property is not available.");return}if(al&&c+1>=t.length){var v=al(o,p);d=!!v,d&&"get"in v&&!("originalValue"in v.get)?o=v.get:o=o[p]}else d=xh(o,p),o=o[p];d&&!l&&(Fs[s]=o)}}return o},j0=cm,X0=z0,oP=X0([j0("%String.prototype.indexOf%")]),W0=function(r,e){var t=j0(r,!!e);return typeof t=="function"&&oP(r,".prototype.")>-1?X0([t]):t},aP=cm,ml=W0;aP("%Map%",!0);ml("Map.prototype.get",!0);ml("Map.prototype.set",!0);ml("Map.prototype.has",!0);ml("Map.prototype.delete",!0);ml("Map.prototype.size",!0);var lP=cm,jh=W0;lP("%WeakMap%",!0);jh("WeakMap.prototype.get",!0);jh("WeakMap.prototype.set",!0);jh("WeakMap.prototype.has",!0);jh("WeakMap.prototype.delete",!0);(function(){for(var r=[],e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})();const P_={};function et(r,e,t=3){if(P_[e])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${r}`):(i=i.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${r}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${r}`),console.warn(i))),P_[e]=!0}function mr(r){if(typeof r!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(r)}`)}function Fa(r){return r.split("?")[0].split("#")[0]}function uP(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function hP(r,e,t){return r.replace(new RegExp(uP(e),"g"),t)}function cP(r,e){let t="",i=0,n=-1,s=0,o=-1;for(let l=0;l<=r.length;++l){if(l<r.length)o=r.charCodeAt(l);else{if(o===47)break;o=47}if(o===47){if(!(n===l-1||s===1))if(n!==l-1&&s===2){if(t.length<2||i!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){const u=t.lastIndexOf("/");if(u!==t.length-1){u===-1?(t="",i=0):(t=t.slice(0,u),i=t.length-1-t.lastIndexOf("/")),n=l,s=0;continue}}else if(t.length===2||t.length===1){t="",i=0,n=l,s=0;continue}}}else t.length>0?t+=`/${r.slice(n+1,l)}`:t=r.slice(n+1,l),i=l-n-1;n=l,s=0}else o===46&&s!==-1?++s:s=-1}return t}const ci={toPosix(r){return hP(r,"\\","/")},isUrl(r){return/^https?:/.test(this.toPosix(r))},isDataUrl(r){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(r)},isBlobUrl(r){return r.startsWith("blob:")},hasProtocol(r){return/^[^/:]+:/.test(this.toPosix(r))},getProtocol(r){mr(r),r=this.toPosix(r);const e=/^file:\/\/\//.exec(r);if(e)return e[0];const t=/^[^/:]+:\/{0,2}/.exec(r);return t?t[0]:""},toAbsolute(r,e,t){if(mr(r),this.isDataUrl(r)||this.isBlobUrl(r))return r;const i=Fa(this.toPosix(e??Re.ADAPTER.getBaseUrl())),n=Fa(this.toPosix(t??this.rootname(i)));return r=this.toPosix(r),r.startsWith("/")?ci.join(n,r.slice(1)):this.isAbsolute(r)?r:this.join(i,r)},normalize(r){if(mr(r),r.length===0)return".";if(this.isDataUrl(r)||this.isBlobUrl(r))return r;r=this.toPosix(r);let e="";const t=r.startsWith("/");this.hasProtocol(r)&&(e=this.rootname(r),r=r.slice(e.length));const i=r.endsWith("/");return r=cP(r),r.length>0&&i&&(r+="/"),t?`/${r}`:e+r},isAbsolute(r){return mr(r),r=this.toPosix(r),this.hasProtocol(r)?!0:r.startsWith("/")},join(...r){if(r.length===0)return".";let e;for(let t=0;t<r.length;++t){const i=r[t];if(mr(i),i.length>0)if(e===void 0)e=i;else{const n=r[t-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?e+=`/../${i}`:e+=`/${i}`}}return e===void 0?".":this.normalize(e)},dirname(r){if(mr(r),r.length===0)return".";r=this.toPosix(r);let e=r.charCodeAt(0);const t=e===47;let i=-1,n=!0;const s=this.getProtocol(r),o=r;r=r.slice(s.length);for(let l=r.length-1;l>=1;--l)if(e=r.charCodeAt(l),e===47){if(!n){i=l;break}}else n=!1;return i===-1?t?"/":this.isUrl(o)?s+r:s:t&&i===1?"//":s+r.slice(0,i)},rootname(r){mr(r),r=this.toPosix(r);let e="";if(r.startsWith("/")?e="/":e=this.getProtocol(r),this.isUrl(r)){const t=r.indexOf("/",e.length);t!==-1?e=r.slice(0,t):e=r,e.endsWith("/")||(e+="/")}return e},basename(r,e){mr(r),e&&mr(e),r=Fa(this.toPosix(r));let t=0,i=-1,n=!0,s;if(e!==void 0&&e.length>0&&e.length<=r.length){if(e.length===r.length&&e===r)return"";let o=e.length-1,l=-1;for(s=r.length-1;s>=0;--s){const u=r.charCodeAt(s);if(u===47){if(!n){t=s+1;break}}else l===-1&&(n=!1,l=s+1),o>=0&&(u===e.charCodeAt(o)?--o===-1&&(i=s):(o=-1,i=l))}return t===i?i=l:i===-1&&(i=r.length),r.slice(t,i)}for(s=r.length-1;s>=0;--s)if(r.charCodeAt(s)===47){if(!n){t=s+1;break}}else i===-1&&(n=!1,i=s+1);return i===-1?"":r.slice(t,i)},extname(r){mr(r),r=Fa(this.toPosix(r));let e=-1,t=0,i=-1,n=!0,s=0;for(let o=r.length-1;o>=0;--o){const l=r.charCodeAt(o);if(l===47){if(!n){t=o+1;break}continue}i===-1&&(n=!1,i=o+1),l===46?e===-1?e=o:s!==1&&(s=1):e!==-1&&(s=-1)}return e===-1||i===-1||s===0||s===1&&e===i-1&&e===t+1?"":r.slice(e,i)},parse(r){mr(r);const e={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return e;r=Fa(this.toPosix(r));let t=r.charCodeAt(0);const i=this.isAbsolute(r);let n;e.root=this.rootname(r),i||this.hasProtocol(r)?n=1:n=0;let s=-1,o=0,l=-1,u=!0,c=r.length-1,d=0;for(;c>=n;--c){if(t=r.charCodeAt(c),t===47){if(!u){o=c+1;break}continue}l===-1&&(u=!1,l=c+1),t===46?s===-1?s=c:d!==1&&(d=1):s!==-1&&(d=-1)}return s===-1||l===-1||d===0||d===1&&s===l-1&&s===o+1?l!==-1&&(o===0&&i?e.base=e.name=r.slice(1,l):e.base=e.name=r.slice(o,l)):(o===0&&i?(e.name=r.slice(1,s),e.base=r.slice(1,l)):(e.name=r.slice(o,s),e.base=r.slice(o,l)),e.ext=r.slice(s,l)),e.dir=this.dirname(r),e},sep:"/",delimiter:":",joinExtensions:[".html"]};let mf;async function dP(){return mf??(mf=(async()=>{var r;const e=document.createElement("canvas").getContext("webgl");if(!e)return Bi.UNPACK;const t=await new Promise(o=>{const l=document.createElement("video");l.onloadeddata=()=>o(l),l.onerror=()=>o(null),l.autoplay=!1,l.crossOrigin="anonymous",l.preload="auto",l.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",l.load()});if(!t)return Bi.UNPACK;const i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);const n=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);const s=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,s),e.deleteFramebuffer(n),e.deleteTexture(i),(r=e.getExtension("WEBGL_lose_context"))==null||r.loseContext(),s[0]<=s[3]?Bi.PMA:Bi.UNPACK})()),mf}let gf;function fP(){return typeof gf>"u"&&(gf=function(){var r;const e={stencil:!0,failIfMajorPerformanceCaveat:Re.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Re.ADAPTER.getWebGLRenderingContext())return!1;const t=Re.ADAPTER.createCanvas();let i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);const n=!!((r=i==null?void 0:i.getContextAttributes())!=null&&r.stencil);if(i){const s=i.getExtension("WEBGL_lose_context");s&&s.loseContext()}return i=null,n}catch{return!1}}()),gf}var pP={grad:.9,turn:360,rad:360/(2*Math.PI)},cn=function(r){return typeof r=="string"?r.length>0:typeof r=="number"},li=function(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*r)/t+0},rr=function(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),r>t?t:r>e?r:e},Y0=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},O_=function(r){return{r:rr(r.r,0,255),g:rr(r.g,0,255),b:rr(r.b,0,255),a:rr(r.a)}},yf=function(r){return{r:li(r.r),g:li(r.g),b:li(r.b),a:li(r.a,3)}},mP=/^#([0-9a-f]{3,8})$/i,Lu=function(r){var e=r.toString(16);return e.length<2?"0"+e:e},q0=function(r){var e=r.r,t=r.g,i=r.b,n=r.a,s=Math.max(e,t,i),o=s-Math.min(e,t,i),l=o?s===e?(t-i)/o:s===t?2+(i-e)/o:4+(e-t)/o:0;return{h:60*(l<0?l+6:l),s:s?o/s*100:0,v:s/255*100,a:n}},Z0=function(r){var e=r.h,t=r.s,i=r.v,n=r.a;e=e/360*6,t/=100,i/=100;var s=Math.floor(e),o=i*(1-t),l=i*(1-(e-s)*t),u=i*(1-(1-e+s)*t),c=s%6;return{r:255*[i,l,o,o,u,i][c],g:255*[u,i,i,l,o,o][c],b:255*[o,o,u,i,i,l][c],a:n}},I_=function(r){return{h:Y0(r.h),s:rr(r.s,0,100),l:rr(r.l,0,100),a:rr(r.a)}},M_=function(r){return{h:li(r.h),s:li(r.s),l:li(r.l),a:li(r.a,3)}},N_=function(r){return Z0((t=(e=r).s,{h:e.h,s:(t*=((i=e.l)<50?i:100-i)/100)>0?2*t/(i+t)*100:0,v:i+t,a:e.a}));var e,t,i},Ja=function(r){return{h:(e=q0(r)).h,s:(n=(200-(t=e.s))*(i=e.v)/100)>0&&n<200?t*i/100/(n<=100?n:200-n)*100:0,l:n/2,a:e.a};var e,t,i,n},gP=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,yP=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,vP=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,_P=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,sp={string:[[function(r){var e=mP.exec(r);return e?(r=e[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?li(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?li(parseInt(r.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r){var e=vP.exec(r)||_P.exec(r);return e?e[2]!==e[4]||e[4]!==e[6]?null:O_({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(r){var e=gP.exec(r)||yP.exec(r);if(!e)return null;var t,i,n=I_({h:(t=e[1],i=e[2],i===void 0&&(i="deg"),Number(t)*(pP[i]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return N_(n)},"hsl"]],object:[[function(r){var e=r.r,t=r.g,i=r.b,n=r.a,s=n===void 0?1:n;return cn(e)&&cn(t)&&cn(i)?O_({r:Number(e),g:Number(t),b:Number(i),a:Number(s)}):null},"rgb"],[function(r){var e=r.h,t=r.s,i=r.l,n=r.a,s=n===void 0?1:n;if(!cn(e)||!cn(t)||!cn(i))return null;var o=I_({h:Number(e),s:Number(t),l:Number(i),a:Number(s)});return N_(o)},"hsl"],[function(r){var e=r.h,t=r.s,i=r.v,n=r.a,s=n===void 0?1:n;if(!cn(e)||!cn(t)||!cn(i))return null;var o=function(l){return{h:Y0(l.h),s:rr(l.s,0,100),v:rr(l.v,0,100),a:rr(l.a)}}({h:Number(e),s:Number(t),v:Number(i),a:Number(s)});return Z0(o)},"hsv"]]},D_=function(r,e){for(var t=0;t<e.length;t++){var i=e[t][0](r);if(i)return[i,e[t][1]]}return[null,void 0]},xP=function(r){return typeof r=="string"?D_(r.trim(),sp.string):typeof r=="object"&&r!==null?D_(r,sp.object):[null,void 0]},vf=function(r,e){var t=Ja(r);return{h:t.h,s:rr(t.s+100*e,0,100),l:t.l,a:t.a}},_f=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},L_=function(r,e){var t=Ja(r);return{h:t.h,s:t.s,l:rr(t.l+100*e,0,100),a:t.a}},op=function(){function r(e){this.parsed=xP(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return li(_f(this.rgba),2)},r.prototype.isDark=function(){return _f(this.rgba)<.5},r.prototype.isLight=function(){return _f(this.rgba)>=.5},r.prototype.toHex=function(){return e=yf(this.rgba),t=e.r,i=e.g,n=e.b,o=(s=e.a)<1?Lu(li(255*s)):"","#"+Lu(t)+Lu(i)+Lu(n)+o;var e,t,i,n,s,o},r.prototype.toRgb=function(){return yf(this.rgba)},r.prototype.toRgbString=function(){return e=yf(this.rgba),t=e.r,i=e.g,n=e.b,(s=e.a)<1?"rgba("+t+", "+i+", "+n+", "+s+")":"rgb("+t+", "+i+", "+n+")";var e,t,i,n,s},r.prototype.toHsl=function(){return M_(Ja(this.rgba))},r.prototype.toHslString=function(){return e=M_(Ja(this.rgba)),t=e.h,i=e.s,n=e.l,(s=e.a)<1?"hsla("+t+", "+i+"%, "+n+"%, "+s+")":"hsl("+t+", "+i+"%, "+n+"%)";var e,t,i,n,s},r.prototype.toHsv=function(){return e=q0(this.rgba),{h:li(e.h),s:li(e.s),v:li(e.v),a:li(e.a,3)};var e},r.prototype.invert=function(){return Br({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},r.prototype.saturate=function(e){return e===void 0&&(e=.1),Br(vf(this.rgba,e))},r.prototype.desaturate=function(e){return e===void 0&&(e=.1),Br(vf(this.rgba,-e))},r.prototype.grayscale=function(){return Br(vf(this.rgba,-1))},r.prototype.lighten=function(e){return e===void 0&&(e=.1),Br(L_(this.rgba,e))},r.prototype.darken=function(e){return e===void 0&&(e=.1),Br(L_(this.rgba,-e))},r.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},r.prototype.alpha=function(e){return typeof e=="number"?Br({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):li(this.rgba.a,3);var t},r.prototype.hue=function(e){var t=Ja(this.rgba);return typeof e=="number"?Br({h:e,s:t.s,l:t.l,a:t.a}):li(t.h)},r.prototype.isEqual=function(e){return this.toHex()===Br(e).toHex()},r}(),Br=function(r){return r instanceof op?r:new op(r)},F_=[],TP=function(r){r.forEach(function(e){F_.indexOf(e)<0&&(e(op,sp),F_.push(e))})};function wP(r,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var n in t)i[t[n]]=n;var s={};r.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var l,u,c=i[this.toHex()];if(c)return c;if(o!=null&&o.closest){var d=this.toRgb(),p=1/0,m="black";if(!s.length)for(var y in t)s[y]=new r(t[y]).toRgb();for(var v in t){var _=(l=d,u=s[v],Math.pow(l.r-u.r,2)+Math.pow(l.g-u.g,2)+Math.pow(l.b-u.b,2));_<p&&(p=_,m=v)}return m}},e.string.push([function(o){var l=o.toLowerCase(),u=l==="transparent"?"#0000":t[l];return u?new r(u).toRgb():null},"name"])}TP([wP]);const Co=class ah{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof ah)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}isSourceEqual(e,t){const i=typeof e;if(i!==typeof t)return!1;if(i==="number"||i==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length!==t.length?!1:e.every((n,s)=>n===t[s]);if(e!==null&&t!==null){const n=Object.keys(e),s=Object.keys(t);return n.length!==s.length?!1:n.every(o=>e[o]===t[o])}return e===t}toRgba(){const[e,t,i,n]=this._components;return{r:e,g:t,b:i,a:n}}toRgb(){const[e,t,i]=this._components;return{r:e,g:t,b:i}}toRgbaString(){const[e,t,i]=this.toUint8RgbArray();return`rgba(${e},${t},${i},${this.alpha})`}toUint8RgbArray(e){const[t,i,n]=this._components;return e=e??[],e[0]=Math.round(t*255),e[1]=Math.round(i*255),e[2]=Math.round(n*255),e}toRgbArray(e){e=e??[];const[t,i,n]=this._components;return e[0]=t,e[1]=i,e[2]=n,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[t,i,n,s]=ah.temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=i,this._components[2]*=n,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let i=this._int>>16&255,n=this._int>>8&255,s=this._int&255;return t&&(i=i*e+.5|0,n=n*e+.5|0,s=s*e+.5|0),(e*255<<24)+(i<<16)+(n<<8)+s}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,i,n]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(i*e)/e,this._components[2]=Math.round(n*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,i,n,s]=this._components;return e[0]=t,e[1]=i,e[2]=n,e[3]=s,e}normalize(e){let t,i,n,s;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const o=e;t=(o>>16&255)/255,i=(o>>8&255)/255,n=(o&255)/255,s=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,i,n,s=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,i,n,s=255]=e,t/=255,i/=255,n/=255,s/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const l=ah.HEX_PATTERN.exec(e);l&&(e=`#${l[2]}`)}const o=Br(e);o.isValid()&&({r:t,g:i,b:n,a:s}=o.rgba,t/=255,i/=255,n/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=i,this._components[2]=n,this._components[3]=s,this.refreshInt();else throw new Error(`Unable to convert color ${e}`)}refreshInt(){this._clamp(this._components);const[e,t,i]=this._components;this._int=(e*255<<16)+(t*255<<8)+(i*255|0)}_clamp(e,t=0,i=1){return typeof e=="number"?Math.min(Math.max(e,t),i):(e.forEach((n,s)=>{e[s]=Math.min(Math.max(n,t),i)}),e)}};Co.shared=new Co,Co.temp=new Co,Co.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let pt=Co;function EP(r){return et("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),pt.shared.setValue(r).toHex()}function SP(r){return et("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),pt.shared.setValue(r).toNumber()}function AP(){const r=[],e=[];for(let i=0;i<32;i++)r[i]=i,e[i]=i;r[je.NORMAL_NPM]=je.NORMAL,r[je.ADD_NPM]=je.ADD,r[je.SCREEN_NPM]=je.SCREEN,e[je.NORMAL]=je.NORMAL_NPM,e[je.ADD]=je.ADD_NPM,e[je.SCREEN]=je.SCREEN_NPM;const t=[];return t.push(e),t.push(r),t}const Q0=AP();function K0(r,e){return Q0[e?1:0][r]}function bP(r,e=null){const t=r*6;if(e=e||new Uint16Array(t),e.length!==t)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${t}`);for(let i=0,n=0;i<t;i+=6,n+=4)e[i+0]=n+0,e[i+1]=n+1,e[i+2]=n+2,e[i+3]=n+0,e[i+4]=n+2,e[i+5]=n+3;return e}function J0(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null}function wh(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function B_(r){return!(r&r-1)&&!!r}function k_(r){let e=(r>65535?1:0)<<4;r>>>=e;let t=(r>255?1:0)<<3;return r>>>=t,e|=t,t=(r>15?1:0)<<2,r>>>=t,e|=t,t=(r>3?1:0)<<1,r>>>=t,e|=t,e|r>>1}function Ho(r,e,t){const i=r.length;let n;if(e>=i||t===0)return;t=e+t>i?i-e:t;const s=i-t;for(n=e;n<s;++n)r[n]=r[n+t];r.length=s}function Qn(r){return r===0?0:r<0?-1:1}let CP=0;function Hs(){return++CP}const ap=class{constructor(r,e,t,i){this.left=r,this.top=e,this.right=t,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};ap.EMPTY=new ap(0,0,0,0);let U_=ap;const H_={},kr=Object.create(null),Hn=Object.create(null);class RP{constructor(e,t,i){this._canvas=Re.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||Re.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function z_(r,e,t){for(let i=0,n=4*t*e;i<e;++i,n+=4)if(r[n+3]!==0)return!1;return!0}function G_(r,e,t,i,n){const s=4*e;for(let o=i,l=i*s+4*t;o<=n;++o,l+=s)if(r[l+3]!==0)return!1;return!0}function PP(r){const{width:e,height:t}=r,i=r.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");const n=i.getImageData(0,0,e,t).data;let s=0,o=0,l=e-1,u=t-1;for(;o<t&&z_(n,e,o);)++o;if(o===t)return U_.EMPTY;for(;z_(n,e,u);)--u;for(;G_(n,e,s,o,u);)++s;for(;G_(n,e,l,o,u);)--l;return++l,++u,new U_(s,o,l,u)}function OP(r){const e=PP(r),{width:t,height:i}=e;let n=null;if(!e.isEmpty()){const s=r.getContext("2d");if(s===null)throw new TypeError("Failed to get canvas 2D context");n=s.getImageData(e.left,e.top,t,i)}return{width:t,height:i,data:n}}function IP(r,e=globalThis.location){if(r.startsWith("data:"))return"";e=e||globalThis.location;const t=new URL(r,document.baseURI);return t.hostname!==e.hostname||t.port!==e.port||t.protocol!==e.protocol?"anonymous":""}function vn(r,e=1){var t;const i=(t=Re.RETINA_PREFIX)==null?void 0:t.exec(r);return i?parseFloat(i[1]):e}var Ae=(r=>(r.Renderer="renderer",r.Application="application",r.RendererSystem="renderer-webgl-system",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererSystem="renderer-canvas-system",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Asset="asset",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser",r))(Ae||{});const lp=r=>{if(typeof r=="function"||typeof r=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");r={...typeof r.extension!="object"?{type:r.extension}:r.extension,ref:r}}if(typeof r=="object")r={...r};else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},V_=(r,e)=>lp(r).priority??e,Le={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...r){return r.map(lp).forEach(e=>{e.type.forEach(t=>{var i,n;return(n=(i=this._removeHandlers)[t])==null?void 0:n.call(i,e)})}),this},add(...r){return r.map(lp).forEach(e=>{e.type.forEach(t=>{var i,n;const s=this._addHandlers,o=this._queue;s[t]?(i=s[t])==null||i.call(s,e):(o[t]=o[t]||[],(n=o[t])==null||n.push(e))})}),this},handle(r,e,t){var i;const n=this._addHandlers,s=this._removeHandlers;if(n[r]||s[r])throw new Error(`Extension type ${r} already has a handler`);n[r]=e,s[r]=t;const o=this._queue;return o[r]&&((i=o[r])==null||i.forEach(l=>e(l)),delete o[r]),this},handleByMap(r,e){return this.handle(r,t=>{t.name&&(e[t.name]=t.ref)},t=>{t.name&&delete e[t.name]})},handleByList(r,e,t=-1){return this.handle(r,i=>{e.includes(i.ref)||(e.push(i.ref),e.sort((n,s)=>V_(s,t)-V_(n,t)))},i=>{const n=e.indexOf(i.ref);n!==-1&&e.splice(n,1)})}};class up{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const MP=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function NP(r){let e="";for(let t=0;t<r;++t)t>0&&(e+=`
else `),t<r-1&&(e+=`if(test == ${t}.0){}`);return e}function DP(r,e){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const t=e.createShader(e.FRAGMENT_SHADER);for(;;){const i=MP.replace(/%forloop%/gi,NP(r));if(e.shaderSource(t,i),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))r=r/2|0;else break}return r}const xf=0,Tf=1,wf=2,Ef=3,Sf=4,Af=5;class Jr{constructor(){this.data=0,this.blendMode=je.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<xf)}set blend(e){!!(this.data&1<<xf)!==e&&(this.data^=1<<xf)}get offsets(){return!!(this.data&1<<Tf)}set offsets(e){!!(this.data&1<<Tf)!==e&&(this.data^=1<<Tf)}get culling(){return!!(this.data&1<<wf)}set culling(e){!!(this.data&1<<wf)!==e&&(this.data^=1<<wf)}get depthTest(){return!!(this.data&1<<Ef)}set depthTest(e){!!(this.data&1<<Ef)!==e&&(this.data^=1<<Ef)}get depthMask(){return!!(this.data&1<<Af)}set depthMask(e){!!(this.data&1<<Af)!==e&&(this.data^=1<<Af)}get clockwiseFrontFace(){return!!(this.data&1<<Sf)}set clockwiseFrontFace(e){!!(this.data&1<<Sf)!==e&&(this.data^=1<<Sf)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==je.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new Jr;return e.depthTest=!1,e.blend=!0,e}}Jr.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const hp=[];function $0(r,e){if(!r)return null;let t="";if(typeof r=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(t=i[1].toLowerCase())}for(let i=hp.length-1;i>=0;--i){const n=hp[i];if(n.test&&n.test(r,t))return new n(r,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class Tr{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,i,n,s,o,l,u){if(arguments.length>8)throw new Error("max arguments reached");const{name:c,items:d}=this;this._aliasCount++;for(let p=0,m=d.length;p<m;p++)d[p][c](e,t,i,n,s,o,l,u);return d===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Tr.prototype,{dispatch:{value:Tr.prototype.emit},run:{value:Tr.prototype.emit}});class ll{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new Tr("setRealSize"),this.onUpdate=new Tr("update"),this.onError=new Tr("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}class Xh extends ll{constructor(e,t){const{width:i,height:n}=t||{};if(!i||!n)throw new Error("BufferResource width or height invalid");super(i,n),this.data=e,this.unpackAlignment=t.unpackAlignment??4}upload(e,t,i){const n=e.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,this.unpackAlignment),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===Bi.UNPACK);const s=t.realWidth,o=t.realHeight;return i.width===s&&i.height===o?n.texSubImage2D(t.target,0,0,0,s,o,t.format,i.type,this.data):(i.width=s,i.height=o,n.texImage2D(t.target,0,i.internalFormat,s,o,0,t.format,i.type,this.data)),!0}dispose(){this.data=null}static test(e){return e===null||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}const LP={scaleMode:fn.NEAREST,alphaMode:Bi.NPM},cp=class Ro extends dl{constructor(e=null,t=null){super(),t=Object.assign({},Ro.defaultOptions,t);const{alphaMode:i,mipmap:n,anisotropicLevel:s,scaleMode:o,width:l,height:u,wrapMode:c,format:d,type:p,target:m,resolution:y,resourceOptions:v}=t;e&&!(e instanceof ll)&&(e=$0(e,v),e.internal=!0),this.resolution=y||Re.RESOLUTION,this.width=Math.round((l||0)*this.resolution)/this.resolution,this.height=Math.round((u||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=s,this._wrapMode=c,this._scaleMode=o,this.format=d,this.type=p,this.target=m,this.alphaMode=i,this.uid=Hs(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=l>0&&u>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let i;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,i=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,i=!0),i&&this.dirtyStyleId++,this}setSize(e,t,i){return i=i||this.resolution,this.setRealSize(e*i,t*i,i)}setRealSize(e,t,i){return this.resolution=i||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=B_(this.realWidth)&&B_(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Hn[this.cacheId],delete kr[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Ro.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,i=Re.STRICT_TEXTURE_CACHE){const n=typeof e=="string";let s=null;if(n)s=e;else{if(!e._pixiId){const l=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${l}_${Hs()}`}s=e._pixiId}let o=Hn[s];if(n&&i&&!o)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return o||(o=new Ro(e,t),o.cacheId=s,Ro.addToCache(o,s)),o}static fromBuffer(e,t,i,n){e=e||new Float32Array(t*i*4);const s=new Xh(e,{width:t,height:i,...n==null?void 0:n.resourceOptions});let o,l;return e instanceof Float32Array?(o=xe.RGBA,l=ke.FLOAT):e instanceof Int32Array?(o=xe.RGBA_INTEGER,l=ke.INT):e instanceof Uint32Array?(o=xe.RGBA_INTEGER,l=ke.UNSIGNED_INT):e instanceof Int16Array?(o=xe.RGBA_INTEGER,l=ke.SHORT):e instanceof Uint16Array?(o=xe.RGBA_INTEGER,l=ke.UNSIGNED_SHORT):e instanceof Int8Array?(o=xe.RGBA,l=ke.BYTE):(o=xe.RGBA,l=ke.UNSIGNED_BYTE),s.internal=!0,new Ro(s,Object.assign({},LP,{type:l,format:o},n))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Hn[t]&&Hn[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),Hn[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=Hn[e];if(t){const i=t.textureCacheIds.indexOf(e);return i>-1&&t.textureCacheIds.splice(i,1),delete Hn[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete Hn[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};cp.defaultOptions={mipmap:Qr.POW2,anisotropicLevel:0,scaleMode:fn.LINEAR,wrapMode:Jn.CLAMP,alphaMode:Bi.UNPACK,target:ko.TEXTURE_2D,format:xe.RGBA,type:ke.UNSIGNED_BYTE},cp._globalBatch=0;let Ze=cp;class dp{constructor(){this.texArray=null,this.blend=0,this.type=Xr.TRIANGLES,this.start=0,this.size=0,this.data=null}}let FP=0;class Ut{constructor(e,t=!0,i=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=t,this.id=FP++,this.disposeRunner=new Tr("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?qr.ELEMENT_ARRAY_BUFFER:qr.ARRAY_BUFFER}get index(){return this.type===qr.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new Ut(e)}}class Eh{constructor(e,t=0,i=!1,n=ke.FLOAT,s,o,l,u=1){this.buffer=e,this.size=t,this.normalized=i,this.type=n,this.stride=s,this.start=o,this.instance=l,this.divisor=u}destroy(){this.buffer=null}static from(e,t,i,n,s){return new Eh(e,t,i,n,s)}}const BP={Float32Array,Uint32Array,Int32Array,Uint8Array};function kP(r,e){let t=0,i=0;const n={};for(let u=0;u<r.length;u++)i+=e[u],t+=r[u].length;const s=new ArrayBuffer(t*4);let o=null,l=0;for(let u=0;u<r.length;u++){const c=e[u],d=r[u],p=J0(d);n[p]||(n[p]=new BP[p](s)),o=n[p];for(let m=0;m<d.length;m++){const y=(m/c|0)*i+l,v=m%c;o[y+v]=d[m]}l+=c}return new Float32Array(s)}const j_={5126:4,5123:2,5121:1};let UP=0;const HP={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class ts{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=UP++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Tr("disposeGeometry"),this.refCount=0}addAttribute(e,t,i=0,n=!1,s,o,l,u=!1){if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof Ut||(t instanceof Array&&(t=new Float32Array(t)),t=new Ut(t));const c=e.split("|");if(c.length>1){for(let p=0;p<c.length;p++)this.addAttribute(c[p],t,i,n,s);return this}let d=this.buffers.indexOf(t);return d===-1&&(this.buffers.push(t),d=this.buffers.length-1),this.attributes[e]=new Eh(d,i,n,s,o,l,u),this.instanced=this.instanced||u,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof Ut||(e instanceof Array&&(e=new Uint16Array(e)),e=new Ut(e)),e.type=qr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const e=[],t=[],i=new Ut;let n;for(n in this.attributes){const s=this.attributes[n],o=this.buffers[s.buffer];e.push(o.data),t.push(s.size*j_[s.type]/4),s.buffer=0}for(i.data=kP(e,t),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new ts;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new Ut(this.buffers[t].data.slice(0));for(const t in this.attributes){const i=this.attributes[t];e.attributes[t]=new Eh(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=qr.ELEMENT_ARRAY_BUFFER),e}static merge(e){const t=new ts,i=[],n=[],s=[];let o;for(let l=0;l<e.length;l++){o=e[l];for(let u=0;u<o.buffers.length;u++)n[u]=n[u]||0,n[u]+=o.buffers[u].data.length,s[u]=0}for(let l=0;l<o.buffers.length;l++)i[l]=new HP[J0(o.buffers[l].data)](n[l]),t.buffers[l]=new Ut(i[l]);for(let l=0;l<e.length;l++){o=e[l];for(let u=0;u<o.buffers.length;u++)i[u].set(o.buffers[u].data,s[u]),s[u]+=o.buffers[u].data.length}if(t.attributes=o.attributes,o.indexBuffer){t.indexBuffer=t.buffers[o.buffers.indexOf(o.indexBuffer)],t.indexBuffer.type=qr.ELEMENT_ARRAY_BUFFER;let l=0,u=0,c=0,d=0;for(let p=0;p<o.buffers.length;p++)if(o.buffers[p]!==o.indexBuffer){d=p;break}for(const p in o.attributes){const m=o.attributes[p];(m.buffer|0)===d&&(u+=m.size*j_[m.type]/4)}for(let p=0;p<e.length;p++){const m=e[p].indexBuffer.data;for(let y=0;y<m.length;y++)t.indexBuffer.data[y+c]+=l;l+=e[p].buffers[d].data.length/u,c+=m.length}}return t}}class eT extends ts{constructor(e=!1){super(),this._buffer=new Ut(null,e,!1),this._indexBuffer=new Ut(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,ke.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,ke.FLOAT).addAttribute("aColor",this._buffer,4,!0,ke.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,ke.FLOAT).addIndex(this._indexBuffer)}}const Sh=Math.PI*2,zP=180/Math.PI,GP=Math.PI/180;var Ti=(r=>(r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC",r))(Ti||{});class ot{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new ot(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}}ot.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Fu=[new ot,new ot,new ot,new ot];class Qe{constructor(e=0,t=0,i=0,n=0){this.x=Number(e),this.y=Number(t),this.width=Number(i),this.height=Number(n),this.type=Ti.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Qe(0,0,0,0)}clone(){return new Qe(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){const j=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=j)return!1;const q=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>q}const i=this.left,n=this.right,s=this.top,o=this.bottom;if(n<=i||o<=s)return!1;const l=Fu[0].set(e.left,e.top),u=Fu[1].set(e.left,e.bottom),c=Fu[2].set(e.right,e.top),d=Fu[3].set(e.right,e.bottom);if(c.x<=l.x||u.y<=l.y)return!1;const p=Math.sign(t.a*t.d-t.b*t.c);if(p===0||(t.apply(l,l),t.apply(u,u),t.apply(c,c),t.apply(d,d),Math.max(l.x,u.x,c.x,d.x)<=i||Math.min(l.x,u.x,c.x,d.x)>=n||Math.max(l.y,u.y,c.y,d.y)<=s||Math.min(l.y,u.y,c.y,d.y)>=o))return!1;const m=p*(u.y-l.y),y=p*(l.x-u.x),v=m*i+y*s,_=m*n+y*s,T=m*i+y*o,E=m*n+y*o;if(Math.max(v,_,T,E)<=m*l.x+y*l.y||Math.min(v,_,T,E)>=m*d.x+y*d.y)return!1;const S=p*(l.y-c.y),A=p*(c.x-l.x),P=S*i+A*s,D=S*n+A*s,k=S*i+A*o,U=S*n+A*o;return!(Math.max(P,D,k,U)<=S*l.x+A*l.y||Math.min(P,D,k,U)>=S*d.x+A*d.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this}fit(e){const t=Math.max(this.x,e.x),i=Math.min(this.x+this.width,e.x+e.width),n=Math.max(this.y,e.y),s=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(i-t,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(e=1,t=.001){const i=Math.ceil((this.x+this.width-t)*e)/e,n=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=i-this.x,this.height=n-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),i=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),s=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=i-t,this.y=n,this.height=s-n,this}}Qe.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Wh{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.radius=i,this.type=Ti.CIRC}clone(){return new Wh(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-e,s=this.y-t;return n*=n,s*=s,n+s<=i}getBounds(){return new Qe(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}Wh.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Yh{constructor(e=0,t=0,i=0,n=0){this.x=e,this.y=t,this.width=i,this.height=n,this.type=Ti.ELIP}clone(){return new Yh(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let i=(e-this.x)/this.width,n=(t-this.y)/this.height;return i*=i,n*=n,i+n<=1}getBounds(){return new Qe(this.x-this.width,this.y-this.height,this.width,this.height)}}Yh.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Bs{constructor(...e){let t=Array.isArray(e[0])?e[0]:e;if(typeof t[0]!="number"){const i=[];for(let n=0,s=t.length;n<s;n++)i.push(t[n].x,t[n].y);t=i}this.points=t,this.type=Ti.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),t=new Bs(e);return t.closeStroke=this.closeStroke,t}contains(e,t){let i=!1;const n=this.points.length/2;for(let s=0,o=n-1;s<n;o=s++){const l=this.points[s*2],u=this.points[s*2+1],c=this.points[o*2],d=this.points[o*2+1];u>t!=d>t&&e<(c-l)*((t-u)/(d-u))+l&&(i=!i)}return i}}Bs.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((r,e)=>`${r}, ${e}`,"")}]`};class qh{constructor(e=0,t=0,i=0,n=0,s=20){this.x=e,this.y=t,this.width=i,this.height=n,this.radius=s,this.type=Ti.RREC}clone(){return new qh(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+i&&t<=this.y+this.height-i||e>=this.x+i&&e<=this.x+this.width-i)return!0;let n=e-(this.x+i),s=t-(this.y+i);const o=i*i;if(n*n+s*s<=o||(n=e-(this.x+this.width-i),n*n+s*s<=o)||(s=t-(this.y+this.height-i),n*n+s*s<=o)||(n=e-(this.x+i),n*n+s*s<=o))return!0}return!1}}qh.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class xt{constructor(e=1,t=0,i=0,n=1,s=0,o=0){this.array=null,this.a=e,this.b=t,this.c=i,this.d=n,this.tx=s,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,i,n,s,o){return this.a=e,this.b=t,this.c=i,this.d=n,this.tx=s,this.ty=o,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const i=t||this.array;return e?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(e,t){t=t||new ot;const i=e.x,n=e.y;return t.x=this.a*i+this.c*n+this.tx,t.y=this.b*i+this.d*n+this.ty,t}applyInverse(e,t){t=t||new ot;const i=1/(this.a*this.d+this.c*-this.b),n=e.x,s=e.y;return t.x=this.d*i*n+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,t.y=this.a*i*s+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),n=this.a,s=this.c,o=this.tx;return this.a=n*t-this.b*i,this.b=n*i+this.b*t,this.c=s*t-this.d*i,this.d=s*i+this.d*t,this.tx=o*t-this.ty*i,this.ty=o*i+this.ty*t,this}append(e){const t=this.a,i=this.b,n=this.c,s=this.d;return this.a=e.a*t+e.b*n,this.b=e.a*i+e.b*s,this.c=e.c*t+e.d*n,this.d=e.c*i+e.d*s,this.tx=e.tx*t+e.ty*n+this.tx,this.ty=e.tx*i+e.ty*s+this.ty,this}setTransform(e,t,i,n,s,o,l,u,c){return this.a=Math.cos(l+c)*s,this.b=Math.sin(l+c)*s,this.c=-Math.sin(l-u)*o,this.d=Math.cos(l-u)*o,this.tx=e-(i*this.a+n*this.c),this.ty=t-(i*this.b+n*this.d),this}prepend(e){const t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const i=this.a,n=this.c;this.a=i*e.a+this.b*e.c,this.b=i*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,i=this.b,n=this.c,s=this.d,o=e.pivot,l=-Math.atan2(-n,s),u=Math.atan2(i,t),c=Math.abs(l+u);return c<1e-5||Math.abs(Sh-c)<1e-5?(e.rotation=u,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=l,e.skew.y=u),e.scale.x=Math.sqrt(t*t+i*i),e.scale.y=Math.sqrt(n*n+s*s),e.position.x=this.tx+(o.x*t+o.y*n),e.position.y=this.ty+(o.x*i+o.y*s),e}invert(){const e=this.a,t=this.b,i=this.c,n=this.d,s=this.tx,o=e*n-t*i;return this.a=n/o,this.b=-t/o,this.c=-i/o,this.d=e/o,this.tx=(i*this.ty-n*s)/o,this.ty=-(e*this.ty-t*s)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new xt;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new xt}static get TEMP_MATRIX(){return new xt}}xt.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const As=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],bs=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Cs=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Rs=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],fp=[],tT=[],Bu=Math.sign;function VP(){for(let r=0;r<16;r++){const e=[];fp.push(e);for(let t=0;t<16;t++){const i=Bu(As[r]*As[t]+Cs[r]*bs[t]),n=Bu(bs[r]*As[t]+Rs[r]*bs[t]),s=Bu(As[r]*Cs[t]+Cs[r]*Rs[t]),o=Bu(bs[r]*Cs[t]+Rs[r]*Rs[t]);for(let l=0;l<16;l++)if(As[l]===i&&bs[l]===n&&Cs[l]===s&&Rs[l]===o){e.push(l);break}}}for(let r=0;r<16;r++){const e=new xt;e.set(As[r],bs[r],Cs[r],Rs[r],0,0),tT.push(e)}}VP();const Ct={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:r=>As[r],uY:r=>bs[r],vX:r=>Cs[r],vY:r=>Rs[r],inv:r=>r&8?r&15:-r&7,add:(r,e)=>fp[r][e],sub:(r,e)=>fp[r][Ct.inv(e)],rotate180:r=>r^4,isVertical:r=>(r&3)===2,byDirection:(r,e)=>Math.abs(r)*2<=Math.abs(e)?e>=0?Ct.S:Ct.N:Math.abs(e)*2<=Math.abs(r)?r>0?Ct.E:Ct.W:e>0?r>0?Ct.SE:Ct.SW:r>0?Ct.NE:Ct.NW,matrixAppendRotationInv:(r,e,t=0,i=0)=>{const n=tT[Ct.inv(e)];n.tx=t,n.ty=i,r.append(n)}};class mn{constructor(e,t,i=0,n=0){this._x=i,this._y=n,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new mn(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}mn.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const pp=class{constructor(){this.worldTransform=new xt,this.localTransform=new xt,this.position=new mn(this.onChange,this,0,0),this.scale=new mn(this.onChange,this,1,1),this.pivot=new mn(this.onChange,this,0,0),this.skew=new mn(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const r=this.localTransform;this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(r){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==r._worldID){const t=r.worldTransform,i=this.worldTransform;i.a=e.a*t.a+e.b*t.c,i.b=e.a*t.b+e.b*t.d,i.c=e.c*t.a+e.d*t.c,i.d=e.c*t.b+e.d*t.d,i.tx=e.tx*t.a+e.ty*t.c+t.tx,i.ty=e.tx*t.b+e.ty*t.d+t.ty,this._parentID=r._worldID,this._worldID++}}setFromMatrix(r){r.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(r){this._rotation!==r&&(this._rotation=r,this.updateSkew())}};pp.IDENTITY=new pp;let dm=pp;dm.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var jP=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,XP=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function X_(r,e,t){const i=r.createShader(e);return r.shaderSource(i,t),r.compileShader(i),i}function bf(r){const e=new Array(r);for(let t=0;t<e.length;t++)e[t]=!1;return e}function iT(r,e){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return bf(2*e);case"bvec3":return bf(3*e);case"bvec4":return bf(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const zo=[{test:r=>r.type==="float"&&r.size===1&&!r.isArray,code:r=>`
            if(uv["${r}"] !== ud["${r}"].value)
            {
                ud["${r}"].value = uv["${r}"]
                gl.uniform1f(ud["${r}"].location, uv["${r}"])
            }
            `},{test:(r,e)=>(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(e==null||e.castToBaseTexture!==void 0),code:r=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${r}"], t);

            if(ud["${r}"].value !== t)
            {
                ud["${r}"].value = t;
                gl.uniform1i(ud["${r}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(r,e)=>r.type==="mat3"&&r.size===1&&!r.isArray&&e.a!==void 0,code:r=>`
            gl.uniformMatrix3fv(ud["${r}"].location, false, uv["${r}"].toArray(true));
            `,codeUbo:r=>`
                var ${r}_matrix = uv.${r}.toArray(true);

                data[offset] = ${r}_matrix[0];
                data[offset+1] = ${r}_matrix[1];
                data[offset+2] = ${r}_matrix[2];
        
                data[offset + 4] = ${r}_matrix[3];
                data[offset + 5] = ${r}_matrix[4];
                data[offset + 6] = ${r}_matrix[5];
        
                data[offset + 8] = ${r}_matrix[6];
                data[offset + 9] = ${r}_matrix[7];
                data[offset + 10] = ${r}_matrix[8];
            `},{test:(r,e)=>r.type==="vec2"&&r.size===1&&!r.isArray&&e.x!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${r}"].location, v.x, v.y);
                }`,codeUbo:r=>`
                v = uv.${r};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:r=>r.type==="vec2"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${r}"].location, v[0], v[1]);
                }
            `},{test:(r,e)=>r.type==="vec4"&&r.size===1&&!r.isArray&&e.width!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${r}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(r,e)=>r.type==="vec4"&&r.size===1&&!r.isArray&&e.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${r}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(r,e)=>r.type==="vec3"&&r.size===1&&!r.isArray&&e.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${r}"].location, v.red, v.green, v.blue)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:r=>r.type==="vec4"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${r}"].location, v[0], v[1], v[2], v[3])
                }`}],WP={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},YP={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function qP(r,e){var t;const i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in r.uniforms){const s=e[n];if(!s){((t=r.uniforms[n])==null?void 0:t.group)===!0&&(r.uniforms[n].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const o=r.uniforms[n];let l=!1;for(let u=0;u<zo.length;u++)if(zo[u].test(s,o)){i.push(zo[u].code(n,o)),l=!0;break}if(!l){const u=(s.size===1&&!s.isArray?WP:YP)[s.type].replace("location",`ud["${n}"].location`);i.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${u};`)}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}const rT={};let Ba=rT;function ZP(){if(Ba===rT||Ba!=null&&Ba.isContextLost()){const r=Re.ADAPTER.createCanvas();let e;Re.PREFER_ENV>=Xs.WEBGL2&&(e=r.getContext("webgl2",{})),e||(e=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),Ba=e}return Ba}let ku;function QP(){if(!ku){ku=ir.MEDIUM;const r=ZP();if(r&&r.getShaderPrecisionFormat){const e=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);e&&(ku=e.precision?ir.HIGH:ir.MEDIUM)}}return ku}function W_(r,e){const t=r.getShaderSource(e).split(`
`).map((c,d)=>`${d}: ${c}`),i=r.getShaderInfoLog(e),n=i.split(`
`),s={},o=n.map(c=>parseFloat(c.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(c=>c&&!s[c]?(s[c]=!0,!0):!1),l=[""];o.forEach(c=>{t[c-1]=`%c${t[c-1]}%c`,l.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const u=t.join(`
`);l[0]=u,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...l),console.groupEnd()}function KP(r,e,t,i){r.getProgramParameter(e,r.LINK_STATUS)||(r.getShaderParameter(t,r.COMPILE_STATUS)||W_(r,t),r.getShaderParameter(i,r.COMPILE_STATUS)||W_(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(e)))}const JP={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function nT(r){return JP[r]}let Uu=null;const Y_={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function sT(r,e){if(!Uu){const t=Object.keys(Y_);Uu={};for(let i=0;i<t.length;++i){const n=t[i];Uu[r[n]]=Y_[n]}}return Uu[e]}function q_(r,e,t){if(r.substring(0,9)!=="precision"){let i=e;return e===ir.HIGH&&t!==ir.HIGH&&(i=ir.MEDIUM),`precision ${i} float;
${r}`}else if(t!==ir.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}let ka;function $P(){if(typeof ka=="boolean")return ka;try{ka=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{ka=!1}return ka}let eO=0;const Hu={},mp=class Po{constructor(e,t,i="pixi-shader",n={}){this.extra={},this.id=eO++,this.vertexSrc=e||Po.defaultVertexSrc,this.fragmentSrc=t||Po.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),Hu[i]?(Hu[i]++,i+=`-${Hu[i]}`):Hu[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=q_(this.vertexSrc,Po.defaultVertexPrecision,ir.HIGH),this.fragmentSrc=q_(this.fragmentSrc,Po.defaultFragmentPrecision,QP())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return XP}static get defaultFragmentSrc(){return jP}static from(e,t,i){const n=e+t;let s=H_[n];return s||(H_[n]=s=new Po(e,t,i)),s}};mp.defaultVertexPrecision=ir.HIGH,mp.defaultFragmentPrecision=pn.apple.device?ir.HIGH:ir.MEDIUM;let gn=mp,tO=0;class wr{constructor(e,t,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=tO++,this.static=!!t,this.ubo=!!i,e instanceof Ut?(this.buffer=e,this.buffer.type=qr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new Ut(new Float32Array(1)),this.buffer.type=qr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,i){if(!this.ubo)this.uniforms[e]=new wr(t,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,t,i){return new wr(e,t,i)}static uboFrom(e,t){return new wr(e,t??!0,!0)}}class Zr{constructor(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof wr?this.uniformGroup=t:this.uniformGroup=new wr(t):this.uniformGroup=new wr({}),this.disposeRunner=new Tr("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const i in t.uniforms){const n=t.uniforms[i];if(n.group===!0&&this.checkUniformExists(e,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,i){const n=gn.from(e,t);return new Zr(n,i)}}class iO{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const i=new Int32Array(e);for(let s=0;s<e;s++)i[s]=s;this.defaultGroupCache[e]=wr.from({uSamplers:i},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${e}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new gn(this.vertexSrc,n)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new xt,default:this.defaultGroupCache[e]};return new Zr(this.programCache[e],t)}generateSampleSrc(e){let t="";t+=`
`,t+=`
`;for(let i=0;i<e;i++)i>0&&(t+=`
else `),i<e-1&&(t+=`if(vTextureId < ${i}.5)`),t+=`
{`,t+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,t+=`
}`;return t+=`
`,t+=`
`,t}}class gp{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}function rO(){return!pn.apple.device}function nO(r){let e=!0;const t=Re.ADAPTER.getNavigator();if(pn.tablet||pn.phone){if(pn.apple.device){const i=t.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(e=!1)}if(pn.android.device){const i=t.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(e=!1)}}return e?r:4}class Zh{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}var sO=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,oO=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const Va=class yr extends Zh{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=eT,this.vertexSize=6,this.state=Jr.for2d(),this.size=yr.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??nO(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??rO(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return et("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return oO}static get defaultFragmentTemplate(){return sO}setShaderGenerator({vertex:e=yr.defaultVertexSrc,fragment:t=yr.defaultFragmentTemplate}={}){this.shaderGenerator=new iO(e,t)}contextChange(){const e=this.renderer.gl;Re.PREFER_ENV===Xs.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),yr.defaultMaxTextures),this.maxTextures=DP(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=yr,i=this.size/4,n=Math.floor(i/this.maxTextures)+1;for(;e.length<i;)e.push(new dp);for(;t.length<n;)t.push(new gp);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,i=yr._textureArrayPool,n=this.renderer.batch,s=this._tempBoundTextures,o=this.renderer.textureGC.count;let l=++Ze._globalBatch,u=0,c=i[0],d=0;n.copyBoundTextures(s,t);for(let p=0;p<this._bufferSize;++p){const m=e[p];e[p]=null,m._batchEnabled!==l&&(c.count>=t&&(n.boundArray(c,s,l,t),this.buildDrawCalls(c,d,p),d=p,c=i[++u],++l),m._batchEnabled=l,m.touched=o,c.elements[c.count++]=m)}c.count>0&&(n.boundArray(c,s,l,t),this.buildDrawCalls(c,d,this._bufferSize),++u,++l);for(let p=0;p<s.length;p++)s[p]=null;Ze._globalBatch=l}buildDrawCalls(e,t,i){const{_bufferedElements:n,_attributeBuffer:s,_indexBuffer:o,vertexSize:l}=this,u=yr._drawCallPool;let c=this._dcIndex,d=this._aIndex,p=this._iIndex,m=u[c];m.start=this._iIndex,m.texArray=e;for(let y=t;y<i;++y){const v=n[y],_=v._texture.baseTexture,T=Q0[_.alphaMode?1:0][v.blendMode];n[y]=null,t<y&&m.blend!==T&&(m.size=p-m.start,t=y,m=u[++c],m.texArray=e,m.start=p),this.packInterleavedGeometry(v,s,o,d,p),d+=v.vertexData.length/2*l,p+=v.indices.length,m.blend=T}t<i&&(m.size=p-m.start,++c),this._dcIndex=c,this._aIndex=d,this._iIndex=p}bindAndClearTexArray(e){const t=this.renderer.texture;for(let i=0;i<e.count;i++)t.bind(e.elements[i],e.ids[i]),e.elements[i]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:i}=this;yr.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:i}=this.renderer,n=yr._drawCallPool;let s=null;for(let o=0;o<e;o++){const{texArray:l,type:u,size:c,start:d,blend:p}=n[o];s!==l&&(s=l,this.bindAndClearTexArray(l)),this.state.blendMode=p,i.set(this.state),t.drawElements(u,c,t.UNSIGNED_SHORT,d*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),yr.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=wh(Math.ceil(e/8)),i=k_(t),n=t*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._aBuffers[n];return s||(this._aBuffers[n]=s=new up(n*this.vertexSize*4)),s}getIndexBuffer(e){const t=wh(Math.ceil(e/12)),i=k_(t),n=t*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._iBuffers[i];return s||(this._iBuffers[i]=s=new Uint16Array(n)),s}packInterleavedGeometry(e,t,i,n,s){const{uint32View:o,float32View:l}=t,u=n/this.vertexSize,c=e.uvs,d=e.indices,p=e.vertexData,m=e._texture.baseTexture._batchLocation,y=Math.min(e.worldAlpha,1),v=pt.shared.setValue(e._tintRGB).toPremultiplied(y,e._texture.baseTexture.alphaMode>0);for(let _=0;_<p.length;_+=2)l[n++]=p[_],l[n++]=p[_+1],l[n++]=c[_],l[n++]=c[_+1],o[n++]=v,l[n++]=m;for(let _=0;_<d.length;_++)i[s++]=u+d[_]}};Va.defaultBatchSize=4096,Va.extension={name:"batch",type:Ae.RendererPlugin},Va._drawCallPool=[],Va._textureArrayPool=[];let Ps=Va;Le.add(Ps);var aO=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,lO=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const yp=class ja extends Zr{constructor(e,t,i){const n=gn.from(e||ja.defaultVertexSrc,t||ja.defaultFragmentSrc);super(n,i),this.padding=0,this.resolution=ja.defaultResolution,this.multisample=ja.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Jr}apply(e,t,i,n,s){e.applyFilter(this,t,i,n)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return lO}static get defaultFragmentSrc(){return aO}};yp.defaultResolution=1,yp.defaultMultisample=qt.NONE;let Pi=yp;class Ah{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new pt(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:t,background:i,backgroundAlpha:n}=e,s=i??t;s!==void 0&&(this.color=s),this.alpha=n}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}Ah.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Ah.extension={type:[Ae.RendererSystem,Ae.CanvasRendererSystem],name:"background"};Le.add(Ah);class oT{constructor(e){this.renderer=e,this.emptyRenderer=new Zh(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:i}=this.renderer.texture;for(let n=t-1;n>=0;--n)e[n]=i[n]||null,e[n]&&(e[n]._batchLocation=n)}boundArray(e,t,i,n){const{elements:s,ids:o,count:l}=e;let u=0;for(let c=0;c<l;c++){const d=s[c],p=d._batchLocation;if(p>=0&&p<n&&t[p]===d){o[c]=p;continue}for(;u<n;){const m=t[u];if(m&&m._batchEnabled===i&&m._batchLocation===u){u++;continue}o[c]=u,d._batchLocation=u,t[u]=d;break}}}destroy(){this.renderer=null}}oT.extension={type:Ae.RendererSystem,name:"batch"};Le.add(oT);let Z_=0;class bh{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=Z_++}init(e){if(e.context)this.initFromContext(e.context);else{const t=this.renderer.background.alpha<1,i=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:i,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=Z_++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;t.addEventListener!==void 0&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let i;if(Re.PREFER_ENV>=Xs.WEBGL2&&(i=e.getContext("webgl2",t)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=i||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}bh.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},bh.extension={type:Ae.RendererSystem,name:"context"};Le.add(bh);class vp{constructor(e,t){if(this.width=Math.round(e),this.height=Math.round(t),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Tr("disposeFramebuffer"),this.multisample=qt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new Ze(null,{scaleMode:fn.NEAREST,resolution:1,mipmap:Qr.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new Ze(null,{scaleMode:fn.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Qr.OFF,format:xe.DEPTH_COMPONENT,type:ke.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!e||!t)throw new Error("Framebuffer width and height must not be zero");if(!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const n=this.colorTextures[i],s=n.resolution;n.setSize(e/s,t/s)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(e/i,t/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class aT extends Ze{constructor(e={}){if(typeof e=="number"){const t=arguments[0],i=arguments[1],n=arguments[2],s=arguments[3];e={width:t,height:i,scaleMode:n,resolution:s}}e.width=e.width??100,e.height=e.height??100,e.multisample??(e.multisample=qt.NONE),super(null,e),this.mipmap=Qr.OFF,this.valid=!0,this._clear=new pt([0,0,0,0]),this.framebuffer=new vp(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class _n extends ll{constructor(e){const t=e,i=t.naturalWidth||t.videoWidth||t.displayWidth||t.width,n=t.naturalHeight||t.videoHeight||t.displayHeight||t.height;super(i,n),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,i){i===void 0&&!t.startsWith("data:")?e.crossOrigin=IP(t):i!==!1&&(e.crossOrigin=typeof i=="string"?i:"anonymous")}upload(e,t,i,n){const s=e.gl,o=t.realWidth,l=t.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===Bi.UNPACK),!this.noSubImage&&t.target===s.TEXTURE_2D&&i.width===o&&i.height===l?s.texSubImage2D(s.TEXTURE_2D,0,0,0,t.format,i.type,n):(i.width=o,i.height=l,s.texImage2D(t.target,0,i.internalFormat,t.format,i.type,n)),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,i=e.naturalHeight||e.videoHeight||e.height;this.resize(t,i),super.update()}dispose(){this.source=null}}class lT extends _n{constructor(e,t){if(t=t||{},typeof e=="string"){const i=new Image;_n.crossOrigin(i,e,t.crossorigin),i.src=e,e=i}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??Re.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.bitmap=null,this._load=null,t.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((t,i)=>{const n=this.source;this.url=n.src;const s=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.update(),this._load=null,this.createBitmap?t(this.process()):t(this))};n.complete&&n.src?s():(n.onload=s,n.onerror=o=>{i(o),this.onError.emit(o)})}),this._load)}process(){const e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,i=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:i?"cors":"no-cors"}).then(n=>n.blob()).then(n=>t(n,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Bi.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,t,i){if(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,i,this.bitmap),!this.preserveBitmap){let n=!0;const s=t._glTextures;for(const o in s){const l=s[o];if(l!==i&&l.dirtyId!==t.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&(typeof e=="string"||e instanceof HTMLImageElement)}}class fm{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,i){const n=t.width,s=t.height;if(i){const o=e.width/2/n,l=e.height/2/s,u=e.x/n+o,c=e.y/s+l;i=Ct.add(i,Ct.NW),this.x0=u+o*Ct.uX(i),this.y0=c+l*Ct.uY(i),i=Ct.add(i,2),this.x1=u+o*Ct.uX(i),this.y1=c+l*Ct.uY(i),i=Ct.add(i,2),this.x2=u+o*Ct.uX(i),this.y2=c+l*Ct.uY(i),i=Ct.add(i,2),this.x3=u+o*Ct.uX(i),this.y3=c+l*Ct.uY(i)}else this.x0=e.x/n,this.y0=e.y/s,this.x1=(e.x+e.width)/n,this.y1=e.y/s,this.x2=(e.x+e.width)/n,this.y2=(e.y+e.height)/s,this.x3=e.x/n,this.y3=(e.y+e.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}fm.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Q_=new fm;function zu(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}class De extends dl{constructor(e,t,i,n,s,o,l){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new Qe(0,0,1,1)),e instanceof De&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=n,this.valid=!1,this.destroyed=!1,this._uvs=Q_,this.uvMatrix=null,this.orig=i||t,this._rotate=Number(s||0),s===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new ot(o.x,o.y):new ot(0,0),this.defaultBorders=l,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:t}=this.baseTexture;t!=null&&t.url&&kr[t.url]&&De.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,De.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var e;const t=this._frame.clone(),i=this._frame===this.orig?t:this.orig.clone(),n=new De(this.baseTexture,!this.noFrame&&t,i,(e=this.trim)==null?void 0:e.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(n._frame=t),n}updateUvs(){this._uvs===Q_&&(this._uvs=new fm),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},i=Re.STRICT_TEXTURE_CACHE){const n=typeof e=="string";let s=null;if(n)s=e;else if(e instanceof Ze){if(!e.cacheId){const l=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e.cacheId=`${l}-${Hs()}`,Ze.addToCache(e,e.cacheId)}s=e.cacheId}else{if(!e._pixiId){const l=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${l}_${Hs()}`}s=e._pixiId}let o=kr[s];if(n&&i&&!o)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return!o&&!(e instanceof Ze)?(t.resolution||(t.resolution=vn(e)),o=new De(new Ze(e,t)),o.baseTexture.cacheId=s,Ze.addToCache(o.baseTexture,s),De.addToCache(o,s)):!o&&e instanceof Ze&&(o=new De(e),De.addToCache(o,s)),o}static fromURL(e,t){const i=Object.assign({autoLoad:!1},t==null?void 0:t.resourceOptions),n=De.from(e,Object.assign({resourceOptions:i},t),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then(()=>Promise.resolve(n))}static fromBuffer(e,t,i,n){return new De(Ze.fromBuffer(e,t,i,n))}static fromLoader(e,t,i,n){const s=new Ze(e,Object.assign({scaleMode:Ze.defaultOptions.scaleMode,resolution:vn(t)},n)),{resource:o}=s;o instanceof lT&&(o.url=t);const l=new De(s);return i||(i=t),Ze.addToCache(l.baseTexture,i),De.addToCache(l,i),i!==t&&(Ze.addToCache(l.baseTexture,t),De.addToCache(l,t)),l.baseTexture.valid?Promise.resolve(l):new Promise(u=>{l.baseTexture.once("loaded",()=>u(l))})}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),kr[t]&&kr[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),kr[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=kr[e];if(t){const i=t.textureCacheIds.indexOf(e);return i>-1&&t.textureCacheIds.splice(i,1),delete kr[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)kr[e.textureCacheIds[t]]===e&&delete kr[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:t,y:i,width:n,height:s}=e,o=t+n>this.baseTexture.width,l=i+s>this.baseTexture.height;if(o||l){const u=o&&l?"and":"or",c=`X: ${t} + ${n} = ${t+n} > ${this.baseTexture.width}`,d=`Y: ${i} + ${s} = ${i+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${c} ${u} ${d}`)}this.valid=n&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return De._EMPTY||(De._EMPTY=new De(new Ze),zu(De._EMPTY),zu(De._EMPTY.baseTexture)),De._EMPTY}static get WHITE(){if(!De._WHITE){const e=Re.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),De._WHITE=new De(Ze.from(e)),zu(De._WHITE),zu(De._WHITE.baseTexture)}return De._WHITE}}class Ws extends De{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,i=!0){const n=this.baseTexture.resolution,s=Math.round(e*n)/n,o=Math.round(t*n)/n;this.valid=s>0&&o>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=o,i&&this.baseTexture.resize(s,o),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new Ws(new aT(e))}}class uT{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,i=qt.NONE){const n=new aT(Object.assign({width:e,height:t,resolution:1,multisample:i},this.textureOptions));return new Ws(n)}getOptimalTexture(e,t,i=1,n=qt.NONE){let s;e=Math.max(Math.ceil(e*i-1e-6),1),t=Math.max(Math.ceil(t*i-1e-6),1),!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight?(e=wh(e),t=wh(t),s=((e&65535)<<16|t&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);let o=this.texturePool[s].pop();return o||(o=this.createTexture(e,t,n)),o.filterPoolKey=s,o.setResolution(i),o}getFilterTexture(e,t,i){const n=this.getOptimalTexture(e.width,e.height,t||e.resolution,i||qt.NONE);return n.filterFrame=e.filterFrame,n}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(const t in this.texturePool){const i=this.texturePool[t];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const i=this.texturePool[t];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}uT.SCREEN_KEY=-1;class uO extends ts{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class hT extends ts{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Ut(this.vertices),this.uvBuffer=new Ut(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let i=0,n=0;return this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i+t.width/e.width,this.uvs[3]=n,this.uvs[4]=i+t.width/e.width,this.uvs[5]=n+t.height/e.height,this.uvs[6]=i,this.uvs[7]=n+t.height/e.height,i=t.x,n=t.y,this.vertices[0]=i,this.vertices[1]=n,this.vertices[2]=i+t.width,this.vertices[3]=n,this.vertices[4]=i+t.width,this.vertices[5]=n+t.height,this.vertices[6]=i,this.vertices[7]=n+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class hO{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=qt.NONE,this.sourceFrame=new Qe,this.destinationFrame=new Qe,this.bindingSourceFrame=new Qe,this.bindingDestinationFrame=new Qe,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Gu=[new ot,new ot,new ot,new ot],Cf=new xt;class cT{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new uT,this.statePool=[],this.quad=new uO,this.quadUv=new hT,this.tempRect=new Qe,this.activeState={},this.globalUniforms=new wr({outputFrame:new Qe,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){const i=this.renderer,n=this.defaultFilterStack,s=this.statePool.pop()||new hO,o=i.renderTexture;let l,u;if(o.current){const T=o.current;l=T.resolution,u=T.multisample}else l=i.resolution,u=i.multisample;let c=t[0].resolution||l,d=t[0].multisample??u,p=t[0].padding,m=t[0].autoFit,y=t[0].legacy??!0;for(let T=1;T<t.length;T++){const E=t[T];c=Math.min(c,E.resolution||l),d=Math.min(d,E.multisample??u),p=this.useMaxPadding?Math.max(p,E.padding):p+E.padding,m=m&&E.autoFit,y=y||(E.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),n.push(s),s.resolution=c,s.multisample=d,s.legacy=y,s.target=e,s.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),s.sourceFrame.pad(p);const v=this.tempRect.copyFrom(o.sourceFrame);i.projection.transform&&this.transformAABB(Cf.copyFrom(i.projection.transform).invert(),v),m?(s.sourceFrame.fit(v),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(v)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,o.current?o.current.resolution:i.resolution,o.sourceFrame,o.destinationFrame,i.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,c,d),s.filters=t,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const _=this.tempRect;_.x=0,_.y=0,_.width=s.sourceFrame.width,_.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(o.sourceFrame),s.bindingDestinationFrame.copyFrom(o.destinationFrame),s.transform=i.projection.transform,i.projection.transform=null,o.bind(s.renderTexture,s.sourceFrame,_),i.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,t=e.pop(),i=t.filters;this.activeState=t;const n=this.globalUniforms.uniforms;n.outputFrame=t.sourceFrame,n.resolution=t.resolution;const s=n.inputSize,o=n.inputPixel,l=n.inputClamp;if(s[0]=t.destinationFrame.width,s[1]=t.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],o[0]=Math.round(s[0]*t.resolution),o[1]=Math.round(s[1]*t.resolution),o[2]=1/o[0],o[3]=1/o[1],l[0]=.5*o[2],l[1]=.5*o[3],l[2]=t.sourceFrame.width*s[2]-.5*o[2],l[3]=t.sourceFrame.height*s[3]-.5*o[3],t.legacy){const c=n.filterArea;c[0]=t.destinationFrame.width,c[1]=t.destinationFrame.height,c[2]=t.sourceFrame.x,c[3]=t.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const u=e[e.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,t.renderTexture,u.renderTexture,Gr.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let c=t.renderTexture,d=this.getOptimalFilterTexture(c.width,c.height,t.resolution);d.filterFrame=c.filterFrame;let p=0;for(p=0;p<i.length-1;++p){p===1&&t.multisample>1&&(d=this.getOptimalFilterTexture(c.width,c.height,t.resolution),d.filterFrame=c.filterFrame),i[p].apply(this,c,d,Gr.CLEAR,t);const m=c;c=d,d=m}i[p].apply(this,c,u.renderTexture,Gr.BLEND,t),p>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(d)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=Gr.CLEAR){const{renderTexture:i,state:n}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e==null?void 0:e.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=e.filterFrame.width,o.height=e.filterFrame.height,i.bind(e,e.filterFrame,o)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=n.stateId&1||this.forceClear;(t===Gr.CLEAR||t===Gr.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,i,n){const s=this.renderer;s.state.set(e.state),this.bindAndClear(i,n),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(Xr.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(Xr.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:i,destinationFrame:n}=this.activeState,{orig:s}=t._texture,o=e.set(n.width,0,0,n.height,i.x,i.y),l=t.worldTransform.copyTo(xt.TEMP_MATRIX);return l.invert(),o.prepend(l),o.scale(1/s.width,1/s.height),o.translate(t.anchor.x,t.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,i=1,n=qt.NONE){return this.texturePool.getOptimalTexture(e,t,i,n)}getFilterTexture(e,t,i){if(typeof e=="number"){const s=e;e=t,t=s}e=e||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,i||qt.NONE);return n.filterFrame=e.filterFrame,n}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const i=Gu[0],n=Gu[1],s=Gu[2],o=Gu[3];i.set(t.left,t.top),n.set(t.left,t.bottom),s.set(t.right,t.top),o.set(t.right,t.bottom),e.apply(i,i),e.apply(n,n),e.apply(s,s),e.apply(o,o);const l=Math.min(i.x,n.x,s.x,o.x),u=Math.min(i.y,n.y,s.y,o.y),c=Math.max(i.x,n.x,s.x,o.x),d=Math.max(i.y,n.y,s.y,o.y);t.x=l,t.y=u,t.width=c-l,t.height=d-u}roundFrame(e,t,i,n,s){if(!(e.width<=0||e.height<=0||i.width<=0||i.height<=0)){if(s){const{a:o,b:l,c:u,d:c}=s;if((Math.abs(l)>1e-4||Math.abs(u)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(c)>1e-4))return}s=s?Cf.copyFrom(s):Cf.identity(),s.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(s,e),e.ceil(t),this.transformAABB(s.invert(),e)}}}cT.extension={type:Ae.RendererSystem,name:"filter"};Le.add(cT);class cO{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=qt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const dO=new Qe;class dT{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new vp(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Qe,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let t=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;Re.PREFER_ENV===Xs.WEBGL_LEGACY&&(t=null,i=null),t?e.drawBuffers=n=>t.drawBuffersWEBGL(n):(this.hasMRT=!1,e.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,i=0){const{gl:n}=this;if(e){const s=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==i&&(e.dirtyId++,e.dirtyFormat++,s.mipLevel=i),s.dirtyId!==e.dirtyId&&(s.dirtyId=e.dirtyId,s.dirtyFormat!==e.dirtyFormat?(s.dirtyFormat=e.dirtyFormat,s.dirtySize=e.dirtySize,this.updateFramebuffer(e,i)):s.dirtySize!==e.dirtySize&&(s.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let o=0;o<e.colorTextures.length;o++){const l=e.colorTextures[o];this.renderer.texture.unbind(l.parentTextureArray||l)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const o=t.width>>i,l=t.height>>i,u=o/t.width;this.setViewport(t.x*u,t.y*u,o,l)}else{const o=e.width>>i,l=e.height>>i;this.setViewport(0,0,o,l)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,i,n){const s=this.viewport;e=Math.round(e),t=Math.round(t),i=Math.round(i),n=Math.round(n),(s.width!==i||s.height!==n||s.x!==e||s.y!==t)&&(s.x=e,s.y=t,s.width=i,s.height=n,this.gl.viewport(e,t,i,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,i,n,s=tp.COLOR|tp.DEPTH){const{gl:o}=this;o.clearColor(e,t,i,n),o.clear(s)}initFramebuffer(e){const{gl:t}=this,i=new cO(t.createFramebuffer());return i.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(e),e.disposeRunner.add(this),i}resizeFramebuffer(e){const{gl:t}=this,i=e.glFramebuffers[this.CONTEXT_UID];if(i.stencil){t.bindRenderbuffer(t.RENDERBUFFER,i.stencil);let o;this.renderer.context.webGLVersion===1?o=t.DEPTH_STENCIL:e.depth&&e.stencil?o=t.DEPTH24_STENCIL8:e.depth?o=t.DEPTH_COMPONENT24:o=t.STENCIL_INDEX8,i.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,o,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,o,e.width,e.height)}const n=e.colorTextures;let s=n.length;t.drawBuffers||(s=Math.min(s,1));for(let o=0;o<s;o++){const l=n[o],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),o===0&&i.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,i.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:i}=this,n=e.glFramebuffers[this.CONTEXT_UID],s=e.colorTextures;let o=s.length;i.drawBuffers||(o=Math.min(o,1)),n.multisample>1&&this.canMultisampleFramebuffer(e)?n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer():n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const l=[];for(let u=0;u<o;u++){const c=s[u],d=c.parentTextureArray||c;this.renderer.texture.bind(d,0),u===0&&n.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,d._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+u,c.target,d._glTextures[this.CONTEXT_UID].texture,t),l.push(i.COLOR_ATTACHMENT0+u))}if(l.length>1&&i.drawBuffers(l),e.depthTexture&&this.writeDepthTexture){const u=e.depthTexture;this.renderer.texture.bind(u,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,u._glTextures[this.CONTEXT_UID].texture,t)}if((e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)){n.stencil=n.stencil||i.createRenderbuffer();let u,c;this.renderer.context.webGLVersion===1?(u=i.DEPTH_STENCIL_ATTACHMENT,c=i.DEPTH_STENCIL):e.depth&&e.stencil?(u=i.DEPTH_STENCIL_ATTACHMENT,c=i.DEPTH24_STENCIL8):e.depth?(u=i.DEPTH_ATTACHMENT,c=i.DEPTH_COMPONENT24):(u=i.STENCIL_ATTACHMENT,c=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,c,e.width,e.height):i.renderbufferStorage(i.RENDERBUFFER,c,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,u,i.RENDERBUFFER,n.stencil)}else n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:t}=this;let i=qt.NONE;if(e<=1||t===null)return i;for(let n=0;n<t.length;n++)if(t[n]<=e){i=t[n];break}return i===1&&(i=qt.NONE),i}blit(e,t,i){const{current:n,renderer:s,gl:o,CONTEXT_UID:l}=this;if(s.context.webGLVersion!==2||!n)return;const u=n.glFramebuffers[l];if(!u)return;if(!e){if(!u.msaaBuffer)return;const d=n.colorTextures[0];if(!d)return;u.blitFramebuffer||(u.blitFramebuffer=new vp(n.width,n.height),u.blitFramebuffer.addColorTexture(0,d)),e=u.blitFramebuffer,e.colorTextures[0]!==d&&(e.colorTextures[0]=d,e.dirtyId++,e.dirtyFormat++),(e.width!==n.width||e.height!==n.height)&&(e.width=n.width,e.height=n.height,e.dirtyId++,e.dirtySize++)}t||(t=dO,t.width=n.width,t.height=n.height),i||(i=t);const c=t.width===i.width&&t.height===i.height;this.bind(e),o.bindFramebuffer(o.READ_FRAMEBUFFER,u.framebuffer),o.blitFramebuffer(t.left,t.top,t.right,t.bottom,i.left,i.top,i.right,i.bottom,o.COLOR_BUFFER_BIT,c?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,t){const i=e.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!i)return;delete e.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(e);s>=0&&this.managedFramebuffers.splice(s,1),e.disposeRunner.remove(this),t||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,t)}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<t.length;i++)this.disposeFramebuffer(t[i],e)}forceStencil(){const e=this.current;if(!e)return;const t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil&&e.stencil)return;e.stencil=!0;const i=e.width,n=e.height,s=this.gl,o=t.stencil=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,o);let l,u;this.renderer.context.webGLVersion===1?(l=s.DEPTH_STENCIL_ATTACHMENT,u=s.DEPTH_STENCIL):e.depth?(l=s.DEPTH_STENCIL_ATTACHMENT,u=s.DEPTH24_STENCIL8):(l=s.STENCIL_ATTACHMENT,u=s.STENCIL_INDEX8),t.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,t.multisample,u,i,n):s.renderbufferStorage(s.RENDERBUFFER,u,i,n),s.framebufferRenderbuffer(s.FRAMEBUFFER,l,s.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Qe}destroy(){this.renderer=null}}dT.extension={type:Ae.RendererSystem,name:"framebuffer"};Le.add(dT);const Rf={5126:4,5123:2,5121:1};class fT{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,t.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;Re.PREFER_ENV===Xs.WEBGL_LEGACY&&(i=null),i?(e.createVertexArray=()=>i.createVertexArrayOES(),e.bindVertexArray=n=>i.bindVertexArrayOES(n),e.deleteVertexArray=n=>i.deleteVertexArrayOES(n)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(t.webGLVersion!==2){const i=e.getExtension("ANGLE_instanced_arrays");i?(e.vertexAttribDivisor=(n,s)=>i.vertexAttribDivisorANGLE(n,s),e.drawElementsInstanced=(n,s,o,l,u)=>i.drawElementsInstancedANGLE(n,s,o,l,u),e.drawArraysInstanced=(n,s,o,l)=>i.drawArraysInstancedANGLE(n,s,o,l)):this.hasInstance=!1}this.canUseUInt32ElementIndex=t.webGLVersion===2||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:i}=this;let n=e.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);const o=n[t.program.id]||this.initGeometryVao(e,t,s);this._activeGeometry=e,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let i=0;i<e.buffers.length;i++){const n=e.buffers[i];t.update(n)}}checkCompatibility(e,t){const i=e.attributes,n=t.attributeData;for(const s in n)if(!i[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(e,t){const i=e.attributes,n=t.attributeData,s=["g",e.id];for(const o in i)n[o]&&s.push(o,n[o].location);return s.join("-")}initGeometryVao(e,t,i=!0){const n=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,l=t.program;l.glPrograms[s]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,l);const u=this.getSignature(e,l),c=e.glVertexArrayObjects[this.CONTEXT_UID];let d=c[u];if(d)return c[l.id]=d,d;const p=e.buffers,m=e.attributes,y={},v={};for(const _ in p)y[_]=0,v[_]=0;for(const _ in m)!m[_].size&&l.attributeData[_]?m[_].size=l.attributeData[_].size:m[_].size||console.warn(`PIXI Geometry attribute '${_}' size cannot be determined (likely the bound shader does not have the attribute)`),y[m[_].buffer]+=m[_].size*Rf[m[_].type];for(const _ in m){const T=m[_],E=T.size;T.stride===void 0&&(y[T.buffer]===E*Rf[T.type]?T.stride=0:T.stride=y[T.buffer]),T.start===void 0&&(T.start=v[T.buffer],v[T.buffer]+=E*Rf[T.type])}d=n.createVertexArray(),n.bindVertexArray(d);for(let _=0;_<p.length;_++){const T=p[_];o.bind(T),i&&T._glBuffers[s].refCount++}return this.activateVao(e,l),c[l.id]=d,c[u]=d,n.bindVertexArray(null),o.unbind(qr.ARRAY_BUFFER),d}disposeGeometry(e,t){var i;if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const n=e.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,o=e.buffers,l=(i=this.renderer)==null?void 0:i.buffer;if(e.disposeRunner.remove(this),!!n){if(l)for(let u=0;u<o.length;u++){const c=o[u]._glBuffers[this.CONTEXT_UID];c&&(c.refCount--,c.refCount===0&&!t&&l.dispose(o[u],t))}if(!t){for(const u in n)if(u[0]==="g"){const c=n[u];this._activeVao===c&&this.unbind(),s.deleteVertexArray(c)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let i=0;i<t.length;i++)this.disposeGeometry(this.managedGeometries[t[i]],e)}activateVao(e,t){const i=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,o=e.buffers,l=e.attributes;e.indexBuffer&&s.bind(e.indexBuffer);let u=null;for(const c in l){const d=l[c],p=o[d.buffer],m=p._glBuffers[n];if(t.attributeData[c]){u!==m&&(s.bind(p),u=m);const y=t.attributeData[c].location;if(i.enableVertexAttribArray(y),i.vertexAttribPointer(y,d.size,d.type||i.FLOAT,d.normalized,d.stride,d.start),d.instance)if(this.hasInstance)i.vertexAttribDivisor(y,d.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,t,i,n){const{gl:s}=this,o=this._activeGeometry;if(o.indexBuffer){const l=o.indexBuffer.data.BYTES_PER_ELEMENT,u=l===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;l===2||l===4&&this.canUseUInt32ElementIndex?o.instanced?s.drawElementsInstanced(e,t||o.indexBuffer.data.length,u,(i||0)*l,n||1):s.drawElements(e,t||o.indexBuffer.data.length,u,(i||0)*l):console.warn("unsupported index buffer type: uint32")}else o.instanced?s.drawArraysInstanced(e,i,t||o.getSize(),n||1):s.drawArrays(e,i,t||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}fT.extension={type:Ae.RendererSystem,name:"geometry"};Le.add(fT);const K_=new xt;class pT{constructor(e,t){this._texture=e,this.mapCoord=new xt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){t===void 0&&(t=e);const i=this.mapCoord;for(let n=0;n<e.length;n+=2){const s=e[n],o=e[n+1];t[n]=s*i.a+o*i.c+i.tx,t[n+1]=s*i.b+o*i.d+i.ty}return t}update(e){const t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const i=t._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const n=t.orig,s=t.trim;s&&(K_.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(K_));const o=t.baseTexture,l=this.uClampFrame,u=this.clampMargin/o.resolution,c=this.clampOffset;return l[0]=(t._frame.x+u+c)/o.width,l[1]=(t._frame.y+u+c)/o.height,l[2]=(t._frame.x+t._frame.width-u+c)/o.width,l[3]=(t._frame.y+t._frame.height-u+c)/o.height,this.uClampOffset[0]=c/o.realWidth,this.uClampOffset[1]=c/o.realHeight,this.isSimple=t._frame.width===o.width&&t._frame.height===o.height&&t.rotate===0,!0}}var fO=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,pO=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class mO extends Pi{constructor(e,t,i){let n=null;typeof e!="string"&&t===void 0&&i===void 0&&(n=e,e=void 0,t=void 0,i=void 0),super(e||pO,t||fO,i),this.maskSprite=n,this.maskMatrix=new xt}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,i,n){const s=this._maskSprite,o=s._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new pT(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,s).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,t,i,n))}}class gO{constructor(e=null){this.type=Jt.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Pi.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Jt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class mT{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let i=t;if(!i.isMaskData){const s=this.maskDataPool.pop()||new gO;s.pooled=!0,s.maskObject=t,i=s}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(n),i._colorMask=n?n._colorMask:15,i.autoDetect&&this.detect(i),i._target=e,i.type!==Jt.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case Jt.SCISSOR:this.renderer.scissor.push(i);break;case Jt.STENCIL:this.renderer.stencil.push(i);break;case Jt.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case Jt.COLOR:this.pushColorMask(i);break}i.type===Jt.SPRITE&&this.maskStack.push(i)}pop(e){const t=this.maskStack.pop();if(!(!t||t._target!==e)){if(t.enabled)switch(t.type){case Jt.SCISSOR:this.renderer.scissor.pop(t);break;case Jt.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case Jt.SPRITE:this.popSpriteMask(t);break;case Jt.COLOR:this.popColorMask(t);break}if(t.reset(),t.pooled&&this.maskDataPool.push(t),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===Jt.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=Jt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=Jt.SCISSOR:e.type=Jt.STENCIL:e.type=Jt.COLOR}pushSpriteMask(e){const{maskObject:t}=e,i=e._target;let n=e._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new mO])),n[0].resolution=e.resolution,n[0].multisample=e.multisample,n[0].maskSprite=t;const s=i.filterArea;i.filterArea=t.getBounds(!0),this.renderer.filter.push(i,n),i.filterArea=s,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const t=e._colorMask,i=e._colorMask=t&e.colorMask;i!==t&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(e){const t=e._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==t&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}mT.extension={type:Ae.RendererSystem,name:"mask"};Le.add(mT);class gT{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,i=this.getStackLength();this.maskStack=e;const n=this.getStackLength();n!==i&&(n===0?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const J_=new xt,$_=[],yT=class lh extends gT{constructor(e){super(e),this.glConst=Re.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:i}=e,{renderer:n}=this,s=n.renderTexture,o=i.getBounds(!0,$_.pop()??new Qe);this.roundFrameToPixels(o,s.current?s.current.resolution:n.resolution,s.sourceFrame,s.destinationFrame,n.projection.transform),t&&o.fit(t),e._scissorRectLocal=o}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:i,c:n,d:s}=e;return(Math.abs(i)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(s)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||lh.isMatrixRotated(t.worldTransform)||lh.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const i=e._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(e,t,i,n,s){lh.isMatrixRotated(s)||(s=s?J_.copyFrom(s):J_.identity(),s.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.renderer.filter.transformAABB(s,e),e.fit(n),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&$_.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};yT.extension={type:Ae.RendererSystem,name:"scissor"};let yO=yT;Le.add(yO);class vT extends gT{constructor(e){super(e),this.glConst=Re.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const t=e.maskObject,{gl:i}=this.renderer,n=e._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),e._stencilCounter++;const s=e._colorMask;s!==0&&(e._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,n,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(e._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}pop(e){const t=this.renderer.gl;if(this.getStackLength()===0)t.disable(t.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=i?i._colorMask:15;n!==0&&(i._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(i._colorMask=n,t.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}vT.extension={type:Ae.RendererSystem,name:"stencil"};Le.add(vT);class _T{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return et("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return et("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return et("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){const e=this.rendererPlugins;for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}_T.extension={type:[Ae.RendererSystem,Ae.CanvasRendererSystem],name:"_plugin"};Le.add(_T);class xT{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new xt,this.transform=null}update(e,t,i,n){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(e,t,i,n){const s=this.projectionMatrix,o=n?-1:1;s.identity(),s.a=1/t.width*2,s.d=o*(1/t.height*2),s.tx=-1-t.x*s.a,s.ty=-o-t.y*s.d}setTransform(e){}destroy(){this.renderer=null}}xT.extension={type:Ae.RendererSystem,name:"projection"};Le.add(xT);const vO=new dm,ex=new Qe;class TT{constructor(e){this.renderer=e,this._tempMatrix=new xt}generateTexture(e,t){const{region:i,...n}=t||{},s=(i==null?void 0:i.copyTo(ex))||e.getLocalBounds(ex,!0),o=n.resolution||this.renderer.resolution;s.width=Math.max(s.width,1/o),s.height=Math.max(s.height,1/o),n.width=s.width,n.height=s.height,n.resolution=o,n.multisample??(n.multisample=this.renderer.multisample);const l=Ws.create(n);this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const u=e.transform;return e.transform=vO,this.renderer.render(e,{renderTexture:l,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=u,l}destroy(){}}TT.extension={type:[Ae.RendererSystem,Ae.CanvasRendererSystem],name:"textureGenerator"};Le.add(TT);const ws=new Qe,Ua=new Qe;class wT{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Qe,this.destinationFrame=new Qe,this.viewportFrame=new Qe}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(e=null,t,i){const n=this.renderer;this.current=e;let s,o,l;e?(s=e.baseTexture,l=s.resolution,t||(ws.width=e.frame.width,ws.height=e.frame.height,t=ws),i||(Ua.x=e.frame.x,Ua.y=e.frame.y,Ua.width=t.width,Ua.height=t.height,i=Ua),o=s.framebuffer):(l=n.resolution,t||(ws.width=n._view.screen.width,ws.height=n._view.screen.height,t=ws),i||(i=ws,i.width=t.width,i.height=t.height));const u=this.viewportFrame;u.x=i.x*l,u.y=i.y*l,u.width=i.width*l,u.height=i.height*l,e||(u.y=n.view.height-(u.y+u.height)),u.ceil(),this.renderer.framebuffer.bind(o,u),this.renderer.projection.update(i,t,l,!o),e?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(i)}clear(e,t){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=pt.shared.setValue(e||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const s=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,l=s.width!==o.width||s.height!==o.height;if(l){let{x:u,y:c,width:d,height:p}=this.viewportFrame;u=Math.round(u),c=Math.round(c),d=Math.round(d),p=Math.round(p),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(u,c,d,p)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,t),l&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}wT.extension={type:Ae.RendererSystem,name:"renderTexture"};Le.add(wT);class _O{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function xO(r,e){const t={},i=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const s=e.getActiveAttrib(r,n);if(s.name.startsWith("gl_"))continue;const o=sT(e,s.type),l={type:o,name:s.name,size:nT(o),location:e.getAttribLocation(r,s.name)};t[s.name]=l}return t}function TO(r,e){const t={},i=e.getProgramParameter(r,e.ACTIVE_UNIFORMS);for(let n=0;n<i;n++){const s=e.getActiveUniform(r,n),o=s.name.replace(/\[.*?\]$/,""),l=!!s.name.match(/\[.*?\]$/),u=sT(e,s.type);t[o]={name:o,index:n,type:u,size:s.size,isArray:l,value:iT(u,s.size)}}return t}function wO(r,e){var t;const i=X_(r,r.VERTEX_SHADER,e.vertexSrc),n=X_(r,r.FRAGMENT_SHADER,e.fragmentSrc),s=r.createProgram();r.attachShader(s,i),r.attachShader(s,n);const o=(t=e.extra)==null?void 0:t.transformFeedbackVaryings;if(o&&(typeof r.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):r.transformFeedbackVaryings(s,o.names,o.bufferMode==="separate"?r.SEPARATE_ATTRIBS:r.INTERLEAVED_ATTRIBS)),r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS)||KP(r,s,i,n),e.attributeData=xO(s,r),e.uniformData=TO(s,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const u=Object.keys(e.attributeData);u.sort((c,d)=>c>d?1:-1);for(let c=0;c<u.length;c++)e.attributeData[u[c]].location=c,r.bindAttribLocation(s,c,u[c]);r.linkProgram(s)}r.deleteShader(i),r.deleteShader(n);const l={};for(const u in e.uniformData){const c=e.uniformData[u];l[u]={location:r.getUniformLocation(s,u),value:iT(c.type,c.size)}}return new _O(s,l)}function EO(r,e,t,i,n){t.buffer.update(n)}const SO={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},ET={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function AO(r){const e=r.map(s=>({data:s,offset:0,dataLen:0,dirty:0}));let t=0,i=0,n=0;for(let s=0;s<e.length;s++){const o=e[s];if(t=ET[o.data.type],o.data.size>1&&(t=Math.max(t,16)*o.data.size),o.dataLen=t,i%t!==0&&i<16){const l=i%t%16;i+=l,n+=l}i+t>16?(n=Math.ceil(n/16)*16,o.offset=n,n+=t,i=t):(o.offset=n,i+=t,n+=t)}return n=Math.ceil(n/16)*16,{uboElements:e,size:n}}function bO(r,e){const t=[];for(const i in r)e[i]&&t.push(e[i]);return t.sort((i,n)=>i.index-n.index),t}function CO(r,e){if(!r.autoManage)return{size:0,syncFunc:EO};const t=bO(r.uniforms,e),{uboElements:i,size:n}=AO(t),s=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<i.length;o++){const l=i[o],u=r.uniforms[l.data.name],c=l.data.name;let d=!1;for(let p=0;p<zo.length;p++){const m=zo[p];if(m.codeUbo&&m.test(l.data,u)){s.push(`offset = ${l.offset/4};`,zo[p].codeUbo(l.data.name,u)),d=!0;break}}if(!d)if(l.data.size>1){const p=nT(l.data.type),m=Math.max(ET[l.data.type]/16,1),y=p/m,v=(4-y%4)%4;s.push(`
                cv = ud.${c}.value;
                v = uv.${c};
                offset = ${l.offset/4};

                t = 0;

                for(var i=0; i < ${l.data.size*m}; i++)
                {
                    for(var j = 0; j < ${y}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${v};
                }

                `)}else{const p=SO[l.data.type];s.push(`
                cv = ud.${c}.value;
                v = uv.${c};
                offset = ${l.offset/4};
                ${p};
                `)}}return s.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join(`
`))}}let RO=0;const Vu={textureCount:0,uboCount:0};class ST{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=RO++}systemCheck(){if(!$P())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const i=e.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),t||(Vu.textureCount=0,Vu.uboCount=0,this.syncUniformGroup(e.uniformGroup,Vu)),n}setUniforms(e){const t=this.shader.program,i=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(i.uniformData,e,this.renderer)}syncUniformGroup(e,t){const i=this.getGlProgram();(!e.static||e.dirtyId!==i.uniformDirtyGroups[e.id])&&(i.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,i,t))}syncUniforms(e,t,i){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,i)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=qP(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const i=this.getGlProgram();if(!e.static||e.dirtyId!==0||!i.uniformGroups[e.id]){e.dirtyId=0;const n=i.uniformGroups[e.id]||this.createSyncBufferGroup(e,i,t);e.buffer.update(),n(i.uniformData,e.uniforms,this.renderer,Vu,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,i.uniformBufferBindings[t])}createSyncBufferGroup(e,t,i){const{gl:n}=this.renderer;this.renderer.buffer.bind(e.buffer);const s=this.gl.getUniformBlockIndex(t.program,i);t.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(t.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(e,this.shader.program.uniformData,"ubo");let l=this._uboCache[o];if(l||(l=this._uboCache[o]=CO(e,this.shader.program.uniformData)),e.autoManage){const u=new Float32Array(l.size/4);e.buffer.update(u)}return t.uniformGroups[e.id]=l.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,i){const n=e.uniforms,s=[`${i}-`];for(const o in n)s.push(o),t[o]&&s.push(t[o].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const t=this.gl,i=e.program,n=wO(t,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}ST.extension={type:Ae.RendererSystem,name:"shader"};Le.add(ST);class Ch{constructor(e){this.renderer=e}run(e){const{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.4.3 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}}Ch.defaultOptions={hello:!1},Ch.extension={type:[Ae.RendererSystem,Ae.CanvasRendererSystem],name:"startup"};Le.add(Ch);function PO(r,e=[]){return e[je.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.ADD]=[r.ONE,r.ONE],e[je.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.NONE]=[0,0],e[je.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],e[je.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[je.SRC_IN]=[r.DST_ALPHA,r.ZERO],e[je.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],e[je.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],e[je.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],e[je.DST_IN]=[r.ZERO,r.SRC_ALPHA],e[je.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],e[je.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],e[je.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],e[je.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],e}const OO=0,IO=1,MO=2,NO=3,DO=4,LO=5,AT=class _p{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=je.NONE,this._blendEq=!1,this.map=[],this.map[OO]=this.setBlend,this.map[IO]=this.setOffset,this.map[MO]=this.setCullFace,this.map[NO]=this.setDepthTest,this.map[DO]=this.setFrontFace,this.map[LO]=this.setDepthMask,this.checks=[],this.defaultState=new Jr,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=PO(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,i=0;for(;t;)t&1&&this.map[i].call(this,!!(e.data&1<<i)),t=t>>1,i++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(_p.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(_p.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],i=this.gl;t.length===2?i.blendFunc(t[0],t[1]):i.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,i.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const i=this.checks.indexOf(e);t&&i===-1?this.checks.push(e):!t&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};AT.extension={type:Ae.RendererSystem,name:"state"};let FO=AT;Le.add(FO);class BO extends dl{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const t=(e.priority??[]).filter(n=>e.systems[n]),i=[...t,...Object.keys(e.systems).filter(n=>!t.includes(n))];for(const n of i)this.addSystem(e.systems[n],n)}addRunners(...e){e.forEach(t=>{this.runners[t]=new Tr(t)})}addSystem(e,t){const i=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=i,this._systemsHash[t]=i;for(const n in this.runners)this.runners[n].add(i);return this}emitWithCustomOptions(e,t){const i=Object.keys(this._systemsHash);e.items.forEach(n=>{const s=i.find(o=>this._systemsHash[o]===n);n[e.name](t[s])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}const Xa=class uh{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=uh.defaultMaxIdle,this.checkCountMax=uh.defaultCheckCountMax,this.mode=uh.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==lm.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let i=!1;for(let n=0;n<t.length;n++){const s=t[n];s.resource&&this.count-s.touched>this.maxIdle&&(e.destroyTexture(s,!0),t[n]=null,i=!0)}if(i){let n=0;for(let s=0;s<t.length;s++)t[s]!==null&&(t[n++]=t[s]);t.length=n}}unload(e){const t=this.renderer.texture,i=e._texture;i&&!i.framebuffer&&t.destroyTexture(i);for(let n=e.children.length-1;n>=0;n--)this.unload(e.children[n])}destroy(){this.renderer=null}};Xa.defaultMode=lm.AUTO,Xa.defaultMaxIdle=60*60,Xa.defaultCheckCountMax=60*10,Xa.extension={type:Ae.RendererSystem,name:"textureGC"};let Os=Xa;Le.add(Os);class Pf{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ke.UNSIGNED_BYTE,this.internalFormat=xe.RGBA,this.samplerType=0}}function kO(r){let e;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?e={[r.RGB]:Ce.FLOAT,[r.RGBA]:Ce.FLOAT,[r.ALPHA]:Ce.FLOAT,[r.LUMINANCE]:Ce.FLOAT,[r.LUMINANCE_ALPHA]:Ce.FLOAT,[r.R8]:Ce.FLOAT,[r.R8_SNORM]:Ce.FLOAT,[r.RG8]:Ce.FLOAT,[r.RG8_SNORM]:Ce.FLOAT,[r.RGB8]:Ce.FLOAT,[r.RGB8_SNORM]:Ce.FLOAT,[r.RGB565]:Ce.FLOAT,[r.RGBA4]:Ce.FLOAT,[r.RGB5_A1]:Ce.FLOAT,[r.RGBA8]:Ce.FLOAT,[r.RGBA8_SNORM]:Ce.FLOAT,[r.RGB10_A2]:Ce.FLOAT,[r.RGB10_A2UI]:Ce.FLOAT,[r.SRGB8]:Ce.FLOAT,[r.SRGB8_ALPHA8]:Ce.FLOAT,[r.R16F]:Ce.FLOAT,[r.RG16F]:Ce.FLOAT,[r.RGB16F]:Ce.FLOAT,[r.RGBA16F]:Ce.FLOAT,[r.R32F]:Ce.FLOAT,[r.RG32F]:Ce.FLOAT,[r.RGB32F]:Ce.FLOAT,[r.RGBA32F]:Ce.FLOAT,[r.R11F_G11F_B10F]:Ce.FLOAT,[r.RGB9_E5]:Ce.FLOAT,[r.R8I]:Ce.INT,[r.R8UI]:Ce.UINT,[r.R16I]:Ce.INT,[r.R16UI]:Ce.UINT,[r.R32I]:Ce.INT,[r.R32UI]:Ce.UINT,[r.RG8I]:Ce.INT,[r.RG8UI]:Ce.UINT,[r.RG16I]:Ce.INT,[r.RG16UI]:Ce.UINT,[r.RG32I]:Ce.INT,[r.RG32UI]:Ce.UINT,[r.RGB8I]:Ce.INT,[r.RGB8UI]:Ce.UINT,[r.RGB16I]:Ce.INT,[r.RGB16UI]:Ce.UINT,[r.RGB32I]:Ce.INT,[r.RGB32UI]:Ce.UINT,[r.RGBA8I]:Ce.INT,[r.RGBA8UI]:Ce.UINT,[r.RGBA16I]:Ce.INT,[r.RGBA16UI]:Ce.UINT,[r.RGBA32I]:Ce.INT,[r.RGBA32UI]:Ce.UINT,[r.DEPTH_COMPONENT16]:Ce.FLOAT,[r.DEPTH_COMPONENT24]:Ce.FLOAT,[r.DEPTH_COMPONENT32F]:Ce.FLOAT,[r.DEPTH_STENCIL]:Ce.FLOAT,[r.DEPTH24_STENCIL8]:Ce.FLOAT,[r.DEPTH32F_STENCIL8]:Ce.FLOAT}:e={[r.RGB]:Ce.FLOAT,[r.RGBA]:Ce.FLOAT,[r.ALPHA]:Ce.FLOAT,[r.LUMINANCE]:Ce.FLOAT,[r.LUMINANCE_ALPHA]:Ce.FLOAT,[r.DEPTH_STENCIL]:Ce.FLOAT},e}function UO(r){let e;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?e={[ke.UNSIGNED_BYTE]:{[xe.RGBA]:r.RGBA8,[xe.RGB]:r.RGB8,[xe.RG]:r.RG8,[xe.RED]:r.R8,[xe.RGBA_INTEGER]:r.RGBA8UI,[xe.RGB_INTEGER]:r.RGB8UI,[xe.RG_INTEGER]:r.RG8UI,[xe.RED_INTEGER]:r.R8UI,[xe.ALPHA]:r.ALPHA,[xe.LUMINANCE]:r.LUMINANCE,[xe.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[ke.BYTE]:{[xe.RGBA]:r.RGBA8_SNORM,[xe.RGB]:r.RGB8_SNORM,[xe.RG]:r.RG8_SNORM,[xe.RED]:r.R8_SNORM,[xe.RGBA_INTEGER]:r.RGBA8I,[xe.RGB_INTEGER]:r.RGB8I,[xe.RG_INTEGER]:r.RG8I,[xe.RED_INTEGER]:r.R8I},[ke.UNSIGNED_SHORT]:{[xe.RGBA_INTEGER]:r.RGBA16UI,[xe.RGB_INTEGER]:r.RGB16UI,[xe.RG_INTEGER]:r.RG16UI,[xe.RED_INTEGER]:r.R16UI,[xe.DEPTH_COMPONENT]:r.DEPTH_COMPONENT16},[ke.SHORT]:{[xe.RGBA_INTEGER]:r.RGBA16I,[xe.RGB_INTEGER]:r.RGB16I,[xe.RG_INTEGER]:r.RG16I,[xe.RED_INTEGER]:r.R16I},[ke.UNSIGNED_INT]:{[xe.RGBA_INTEGER]:r.RGBA32UI,[xe.RGB_INTEGER]:r.RGB32UI,[xe.RG_INTEGER]:r.RG32UI,[xe.RED_INTEGER]:r.R32UI,[xe.DEPTH_COMPONENT]:r.DEPTH_COMPONENT24},[ke.INT]:{[xe.RGBA_INTEGER]:r.RGBA32I,[xe.RGB_INTEGER]:r.RGB32I,[xe.RG_INTEGER]:r.RG32I,[xe.RED_INTEGER]:r.R32I},[ke.FLOAT]:{[xe.RGBA]:r.RGBA32F,[xe.RGB]:r.RGB32F,[xe.RG]:r.RG32F,[xe.RED]:r.R32F,[xe.DEPTH_COMPONENT]:r.DEPTH_COMPONENT32F},[ke.HALF_FLOAT]:{[xe.RGBA]:r.RGBA16F,[xe.RGB]:r.RGB16F,[xe.RG]:r.RG16F,[xe.RED]:r.R16F},[ke.UNSIGNED_SHORT_5_6_5]:{[xe.RGB]:r.RGB565},[ke.UNSIGNED_SHORT_4_4_4_4]:{[xe.RGBA]:r.RGBA4},[ke.UNSIGNED_SHORT_5_5_5_1]:{[xe.RGBA]:r.RGB5_A1},[ke.UNSIGNED_INT_2_10_10_10_REV]:{[xe.RGBA]:r.RGB10_A2,[xe.RGBA_INTEGER]:r.RGB10_A2UI},[ke.UNSIGNED_INT_10F_11F_11F_REV]:{[xe.RGB]:r.R11F_G11F_B10F},[ke.UNSIGNED_INT_5_9_9_9_REV]:{[xe.RGB]:r.RGB9_E5},[ke.UNSIGNED_INT_24_8]:{[xe.DEPTH_STENCIL]:r.DEPTH24_STENCIL8},[ke.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[xe.DEPTH_STENCIL]:r.DEPTH32F_STENCIL8}}:e={[ke.UNSIGNED_BYTE]:{[xe.RGBA]:r.RGBA,[xe.RGB]:r.RGB,[xe.ALPHA]:r.ALPHA,[xe.LUMINANCE]:r.LUMINANCE,[xe.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[ke.UNSIGNED_SHORT_5_6_5]:{[xe.RGB]:r.RGB},[ke.UNSIGNED_SHORT_4_4_4_4]:{[xe.RGBA]:r.RGBA},[ke.UNSIGNED_SHORT_5_5_5_1]:{[xe.RGBA]:r.RGBA}},e}class bT{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Ze,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=UO(e),this.samplerTypes=kO(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let n=0;n<t;n++)this.boundTextures[n]=null;this.emptyTextures={};const i=new Pf(e.createTexture());e.bindTexture(e.TEXTURE_2D,i.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=i,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new Pf(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(e,t=0){const{gl:i}=this;if(e=e==null?void 0:e.castToBaseTexture(),(e==null?void 0:e.valid)&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const n=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(e.target,n.texture)),n.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),this.updateTexture(e)):n.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:t,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<i.length;n++)i[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<i.length;n++)i[n]===e&&(this.currentLocation!==n&&(t.activeTexture(t.TEXTURE0+n),this.currentLocation=n),t.bindTexture(e.target,this.emptyTextures[e.target].texture),i[n]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:i,CONTEXT_UID:n}=this;if(i)for(let s=e-1;s>=0;--s){const o=t[s];o&&o._glTextures[n].samplerType!==Ce.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(e){const t=new Pf(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){var i;t.internalFormat=((i=this.internalFormats[e.type])==null?void 0:i[e.format])??e.format,t.samplerType=this.samplerTypes[t.internalFormat]??Ce.FLOAT,this.webGLVersion===2&&e.type===ke.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){var t;const i=e._glTextures[this.CONTEXT_UID];if(!i)return;const n=this.renderer;if(this.initTextureType(e,i),(t=e.resource)==null?void 0:t.upload(n,e,i))i.samplerType!==Ce.FLOAT&&(this.hasIntegerTextures=!0);else{const s=e.realWidth,o=e.realHeight,l=n.gl;(i.width!==s||i.height!==o||i.dirtyId<0)&&(i.width=s,i.height=o,l.texImage2D(e.target,0,i.internalFormat,s,o,0,e.format,i.type,null))}e.dirtyStyleId!==i.dirtyStyleId&&this.updateTextureStyle(e),i.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:i}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),i.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const n=this.managedTextures.indexOf(e);n!==-1&&Ho(this.managedTextures,n,1)}}updateTextureStyle(e){var t;const i=e._glTextures[this.CONTEXT_UID];i&&((e.mipmap===Qr.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?i.mipmap=!1:i.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?i.wrapMode=Jn.CLAMP:i.wrapMode=e.wrapMode,(t=e.resource)!=null&&t.style(this.renderer,e,i)||this.setStyle(e,i),i.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const i=this.gl;if(t.mipmap&&e.mipmap!==Qr.ON_MANUAL&&i.generateMipmap(e.target),i.texParameteri(e.target,i.TEXTURE_WRAP_S,t.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===fn.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&e.anisotropicLevel>0&&e.scaleMode===fn.LINEAR){const s=Math.min(e.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(e.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===fn.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,e.scaleMode===fn.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}bT.extension={type:Ae.RendererSystem,name:"texture"};Le.add(bT);class CT{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:i}=this,n=e._glTransformFeedbacks[i]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:i,renderer:n}=this;t&&n.shader.bind(t),i.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:i,CONTEXT_UID:n}=this,s=t.createTransformFeedback();e._glTransformFeedbacks[n]=s,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,s);for(let o=0;o<e.buffers.length;o++){const l=e.buffers[o];l&&(i.buffer.update(l),l._glBuffers[n].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,o,l._glBuffers[n].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),s}disposeTransformFeedback(e,t){const i=e._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;e.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let o=0;o<e.buffers.length;o++){const l=e.buffers[o];if(!l)continue;const u=l._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,u.refCount===0&&!t&&s.dispose(l,t))}i&&(t||n.deleteTransformFeedback(i),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}CT.extension={type:Ae.RendererSystem,name:"transformFeedback"};Le.add(CT);class Rh{constructor(e){this.renderer=e}init(e){this.screen=new Qe(0,0,e.width,e.height),this.element=e.view||Re.ADAPTER.createCanvas(),this.resolution=e.resolution||Re.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const i=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=i,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",i,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){var t;e&&((t=this.element.parentNode)==null||t.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Rh.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Rh.extension={type:[Ae.RendererSystem,Ae.CanvasRendererSystem],name:"_view"};Le.add(Rh);Re.PREFER_ENV=Xs.WEBGL2;Re.STRICT_TEXTURE_CACHE=!1;Re.RENDER_OPTIONS={...bh.defaultOptions,...Ah.defaultOptions,...Rh.defaultOptions,...Ch.defaultOptions};Object.defineProperties(Re,{WRAP_MODE:{get(){return Ze.defaultOptions.wrapMode},set(r){et("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),Ze.defaultOptions.wrapMode=r}},SCALE_MODE:{get(){return Ze.defaultOptions.scaleMode},set(r){et("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),Ze.defaultOptions.scaleMode=r}},MIPMAP_TEXTURES:{get(){return Ze.defaultOptions.mipmap},set(r){et("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),Ze.defaultOptions.mipmap=r}},ANISOTROPIC_LEVEL:{get(){return Ze.defaultOptions.anisotropicLevel},set(r){et("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),Ze.defaultOptions.anisotropicLevel=r}},FILTER_RESOLUTION:{get(){return et("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Pi.defaultResolution},set(r){Pi.defaultResolution=r}},FILTER_MULTISAMPLE:{get(){return et("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Pi.defaultMultisample},set(r){Pi.defaultMultisample=r}},SPRITE_MAX_TEXTURES:{get(){return Ps.defaultMaxTextures},set(r){et("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Ps.defaultMaxTextures=r}},SPRITE_BATCH_SIZE:{get(){return Ps.defaultBatchSize},set(r){et("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Ps.defaultBatchSize=r}},CAN_UPLOAD_SAME_BUFFER:{get(){return Ps.canUploadSameBuffer},set(r){et("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Ps.canUploadSameBuffer=r}},GC_MODE:{get(){return Os.defaultMode},set(r){et("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Os.defaultMode=r}},GC_MAX_IDLE:{get(){return Os.defaultMaxIdle},set(r){et("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Os.defaultMaxIdle=r}},GC_MAX_CHECK_COUNT:{get(){return Os.defaultCheckCountMax},set(r){et("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Os.defaultCheckCountMax=r}},PRECISION_VERTEX:{get(){return gn.defaultVertexPrecision},set(r){et("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),gn.defaultVertexPrecision=r}},PRECISION_FRAGMENT:{get(){return gn.defaultFragmentPrecision},set(r){et("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),gn.defaultFragmentPrecision=r}}});var zs=(r=>(r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY",r))(zs||{});class Of{constructor(e,t=null,i=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=i,this.once=n}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const RT=class Vi{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Of(null,null,1/0),this.deltaMS=1/Vi.targetFPMS,this.elapsedMS=1/Vi.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,i=zs.NORMAL){return this._addListener(new Of(e,t,i))}addOnce(e,t,i=zs.NORMAL){return this._addListener(new Of(e,t,i,!0))}_addListener(e){let t=this._head.next,i=this._head;if(!t)e.connect(i);else{for(;t;){if(e.priority>t.priority){e.connect(i);break}i=t,t=t.next}e.previous||e.connect(i)}return this._startIfPossible(),this}remove(e,t){let i=this._head.next;for(;i;)i.match(e,t)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const s=e-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=e-s%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*Vi.targetFPMS;const i=this._head;let n=i.next;for(;n;)n=n.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),i=Math.min(Math.max(0,t)/1e3,Vi.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!Vi._shared){const e=Vi._shared=new Vi;e.autoStart=!0,e._protected=!0}return Vi._shared}static get system(){if(!Vi._system){const e=Vi._system=new Vi;e.autoStart=!0,e._protected=!0}return Vi._system}};RT.targetFPMS=.06;let ji=RT;Object.defineProperties(Re,{TARGET_FPMS:{get(){return ji.targetFPMS},set(r){et("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),ji.targetFPMS=r}}});class PT{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,zs.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?ji.shared:new ji,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}PT.extension=Ae.Application;Le.add(PT);const OT=[];Le.handleByList(Ae.Renderer,OT);function IT(r){for(const e of OT)if(e.test(r))return new e(r);throw new Error("Unable to auto-detect a suitable renderer.")}var HO=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,zO=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const GO=HO,MT=zO;class NT{constructor(e){this.renderer=e}contextChange(e){let t;if(this.renderer.context.webGLVersion===1){const i=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,i)}else{const i=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,i)}t>=qt.HIGH?this.multisample=qt.HIGH:t>=qt.MEDIUM?this.multisample=qt.MEDIUM:t>=qt.LOW?this.multisample=qt.LOW:this.multisample=qt.NONE}destroy(){}}NT.extension={type:Ae.RendererSystem,name:"_multisample"};Le.add(NT);class VO{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class DT{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:i}=this,n=e._glBuffers[i]||this.createGLBuffer(e);t.bindBuffer(e.type,n.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:i,CONTEXT_UID:n}=this;if(this.boundBufferBases[t]!==e){const s=e._glBuffers[n]||this.createGLBuffer(e);this.boundBufferBases[t]=e,i.bindBufferBase(i.UNIFORM_BUFFER,t,s.buffer)}}bindBufferRange(e,t,i){const{gl:n,CONTEXT_UID:s}=this;i=i||0;const o=e._glBuffers[s]||this.createGLBuffer(e);n.bindBufferRange(n.UNIFORM_BUFFER,t||0,o.buffer,i*256,256)}update(e){const{gl:t,CONTEXT_UID:i}=this,n=e._glBuffers[i]||this.createGLBuffer(e);if(e._updateID!==n.updateID)if(n.updateID=e._updateID,t.bindBuffer(e.type,n.buffer),n.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const s=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;n.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,s)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const i=e._glBuffers[this.CONTEXT_UID],n=this.gl;e.disposeRunner.remove(this),i&&(t||n.deleteBuffer(i.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let i=0;i<t.length;i++)this.dispose(this.managedBuffers[t[i]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:i}=this;return e._glBuffers[t]=new VO(i.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}DT.extension={type:Ae.RendererSystem,name:"buffer"};Le.add(DT);class LT{constructor(e){this.renderer=e}render(e,t){const i=this.renderer;let n,s,o,l;if(t&&(n=t.renderTexture,s=t.clear,o=t.transform,l=t.skipUpdateTransform),this.renderingToScreen=!n,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=o,!i.context.isLost){if(n||(this.lastObjectRendered=e),!l){const u=e.enableTempParent();e.updateTransform(),e.disableTempParent(u)}i.renderTexture.bind(n),i.batch.currentRenderer.start(),(s??i.background.clearBeforeRender)&&i.renderTexture.clear(),e.render(i),i.batch.currentRenderer.flush(),n&&(t.blit&&i.framebuffer.blit(),n.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}LT.extension={type:Ae.RendererSystem,name:"objectRenderer"};Le.add(LT);const hh=class xp extends BO{constructor(e){super(),this.type=C0.WEBGL,e=Object.assign({},Re.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new wr({projectionMatrix:new xt},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:xp.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(et("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha),this._plugin.rendererPlugins=xp.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return e!=null&&e.forceCanvas?!1:fP()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return et("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return et("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return et("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return et("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){et("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return et("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){et("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return et("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};hh.extension={type:Ae.Renderer,priority:1},hh.__plugins={},hh.__systems={};let pm=hh;Le.handleByMap(Ae.RendererPlugin,pm.__plugins);Le.handleByMap(Ae.RendererSystem,pm.__systems);Le.add(pm);class FT extends ll{constructor(e,t){const{width:i,height:n}=t||{};super(i,n),this.items=[],this.itemDirtyIds=[];for(let s=0;s<e;s++){const o=new Ze;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let i=0;i<this.length;i++)e[i]&&(e[i].castToBaseTexture?this.addBaseTextureAt(e[i].castToBaseTexture(),i):e[i]instanceof ll?this.addResourceAt(e[i],i):this.addResourceAt($0(e[i],t),i))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;const e=this.items.map(t=>t.resource).filter(t=>t).map(t=>t.load());return this._load=Promise.all(e).then(()=>{const{realWidth:t,realHeight:i}=this.items[0];return this.resize(t,i),this.update(),Promise.resolve(this)}),this._load}}class jO extends FT{constructor(e,t){const{width:i,height:n}=t||{};let s,o;Array.isArray(e)?(s=e,o=e.length):o=e,super(o,{width:i,height:n}),s&&this.initFromArray(s,t)}addBaseTextureAt(e,t){if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=ko.TEXTURE_2D_ARRAY}upload(e,t,i){const{length:n,itemDirtyIds:s,items:o}=this,{gl:l}=e;i.dirtyId<0&&l.texImage3D(l.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,n,0,t.format,i.type,null);for(let u=0;u<n;u++){const c=o[u];s[u]<c.dirtyId&&(s[u]=c.dirtyId,c.valid&&l.texSubImage3D(l.TEXTURE_2D_ARRAY,0,0,0,u,c.resource.width,c.resource.height,1,t.format,i.type,c.resource.source))}return!0}}class XO extends _n{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return t&&e instanceof t?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}}const BT=class Wa extends FT{constructor(e,t){const{width:i,height:n,autoLoad:s,linkBaseTexture:o}=t||{};if(e&&e.length!==Wa.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:i,height:n});for(let l=0;l<Wa.SIDES;l++)this.items[l].target=ko.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.linkBaseTexture=o!==!1,e&&this.initFromArray(e,t),s!==!1&&this.load()}bind(e){super.bind(e),e.target=ko.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=ko.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,i){const n=this.itemDirtyIds;for(let s=0;s<Wa.SIDES;s++){const o=this.items[s];(n[s]<o.dirtyId||i.dirtyId<t.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(e,o,i),n[s]=o.dirtyId):n[s]<-1&&(e.gl.texImage2D(o.target,0,i.internalFormat,t.realWidth,t.realHeight,0,t.format,i.type,null),n[s]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===Wa.SIDES}};BT.SIDES=6;let WO=BT;class Lo extends _n{constructor(e,t){t=t||{};let i,n,s;typeof e=="string"?(i=Lo.EMPTY,n=e,s=!0):(i=e,n=null,s=!1),super(i),this.url=n,this.crossOrigin=t.crossOrigin??!0,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.ownsImageBitmap=t.ownsImageBitmap??s,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(e,t)=>{if(this.url===null){e(this);return}try{const i=await Re.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await i.blob();if(this.destroyed)return;const s=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Bi.UNPACK?"premultiply":"none"});if(this.destroyed){s.close();return}this.source=s,this.update(),e(this)}catch(i){if(this.destroyed)return;t(i),this.onError.emit(i)}}),this._load)}upload(e,t,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),super.upload(e,t,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){return Lo._EMPTY=Lo._EMPTY??Re.ADAPTER.createCanvas(0,0),Lo._EMPTY}}const Tp=class ch extends _n{constructor(e,t){t=t||{},super(Re.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.update(),e(this)},ch.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;_n.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,i=e.height;if(!t||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=t*this.scale,s=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/i*t,s=this._overrideHeight||this._overrideWidth/t*i),n=Math.round(n),s=Math.round(s);const o=this.source;o.width=n,o.height=s,o._pixiId=`canvas_${Hs()}`,o.getContext("2d").drawImage(e,0,0,t,i,0,0,n,s),this._resolve(),this._resolve=null}}static getSize(e){const t=ch.SVG_SIZE.exec(e),i={};return t&&(i[t[1]]=Math.round(parseFloat(t[3])),i[t[5]]=Math.round(parseFloat(t[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&ch.SVG_XML.test(e)}};Tp.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Tp.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let wp=Tp;class YO extends _n{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}}const Ep=class Sp extends _n{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const i=document.createElement("video");t.autoLoad!==!1&&i.setAttribute("preload","auto"),t.playsinline!==!1&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),t.muted===!0&&(i.setAttribute("muted",""),i.muted=!0),t.loop===!0&&i.setAttribute("loop",""),t.autoPlay!==!1&&i.setAttribute("autoplay",""),typeof e=="string"&&(e=[e]);const n=e[0].src||e[0];_n.crossOrigin(i,n,t.crossorigin);for(let s=0;s<e.length;++s){const o=document.createElement("source");let{src:l,mime:u}=e[s];if(l=l||e[s],l.startsWith("data:"))u=l.slice(5,l.indexOf(";"));else if(!l.startsWith("blob:")){const c=l.split("?").shift().toLowerCase(),d=c.slice(c.lastIndexOf(".")+1);u=u||Sp.MIME_TYPES[d]||`video/${d}`}o.src=l,u&&(o.type=u),i.appendChild(o)}e=i}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){if(this._updateFPS){const t=ji.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((t,i)=>{this.valid?t(this):(this._resolve=t,this._reject=i,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!t&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();const e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(ji.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(ji.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(ji.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||Sp.TYPES.includes(t)}};Ep.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Ep.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let kT=Ep;hp.push(Lo,lT,XO,kT,YO,wp,Xh,WO,jO);class Ph{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?Qe.EMPTY:(e=e||new Qe(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:i,b:n,c:s,d:o,tx:l,ty:u}=e,c=i*t.x+s*t.y+l,d=n*t.x+o*t.y+u;this.minX=Math.min(this.minX,c),this.maxX=Math.max(this.maxX,c),this.minY=Math.min(this.minY,d),this.maxY=Math.max(this.maxY,d)}addQuad(e){let t=this.minX,i=this.minY,n=this.maxX,s=this.maxY,o=e[0],l=e[1];t=o<t?o:t,i=l<i?l:i,n=o>n?o:n,s=l>s?l:s,o=e[2],l=e[3],t=o<t?o:t,i=l<i?l:i,n=o>n?o:n,s=l>s?l:s,o=e[4],l=e[5],t=o<t?o:t,i=l<i?l:i,n=o>n?o:n,s=l>s?l:s,o=e[6],l=e[7],t=o<t?o:t,i=l<i?l:i,n=o>n?o:n,s=l>s?l:s,this.minX=t,this.minY=i,this.maxX=n,this.maxY=s}addFrame(e,t,i,n,s){this.addFrameMatrix(e.worldTransform,t,i,n,s)}addFrameMatrix(e,t,i,n,s){const o=e.a,l=e.b,u=e.c,c=e.d,d=e.tx,p=e.ty;let m=this.minX,y=this.minY,v=this.maxX,_=this.maxY,T=o*t+u*i+d,E=l*t+c*i+p;m=T<m?T:m,y=E<y?E:y,v=T>v?T:v,_=E>_?E:_,T=o*n+u*i+d,E=l*n+c*i+p,m=T<m?T:m,y=E<y?E:y,v=T>v?T:v,_=E>_?E:_,T=o*t+u*s+d,E=l*t+c*s+p,m=T<m?T:m,y=E<y?E:y,v=T>v?T:v,_=E>_?E:_,T=o*n+u*s+d,E=l*n+c*s+p,m=T<m?T:m,y=E<y?E:y,v=T>v?T:v,_=E>_?E:_,this.minX=m,this.minY=y,this.maxX=v,this.maxY=_}addVertexData(e,t,i){let n=this.minX,s=this.minY,o=this.maxX,l=this.maxY;for(let u=t;u<i;u+=2){const c=e[u],d=e[u+1];n=c<n?c:n,s=d<s?d:s,o=c>o?c:o,l=d>l?d:l}this.minX=n,this.minY=s,this.maxX=o,this.maxY=l}addVertices(e,t,i,n){this.addVerticesMatrix(e.worldTransform,t,i,n)}addVerticesMatrix(e,t,i,n,s=0,o=s){const l=e.a,u=e.b,c=e.c,d=e.d,p=e.tx,m=e.ty;let y=this.minX,v=this.minY,_=this.maxX,T=this.maxY;for(let E=i;E<n;E+=2){const S=t[E],A=t[E+1],P=l*S+c*A+p,D=d*A+u*S+m;y=Math.min(y,P-s),_=Math.max(_,P+s),v=Math.min(v,D-o),T=Math.max(T,D+o)}this.minX=y,this.minY=v,this.maxX=_,this.maxY=T}addBounds(e){const t=this.minX,i=this.minY,n=this.maxX,s=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<i?e.minY:i,this.maxX=e.maxX>n?e.maxX:n,this.maxY=e.maxY>s?e.maxY:s}addBoundsMask(e,t){const i=e.minX>t.minX?e.minX:t.minX,n=e.minY>t.minY?e.minY:t.minY,s=e.maxX<t.maxX?e.maxX:t.maxX,o=e.maxY<t.maxY?e.maxY:t.maxY;if(i<=s&&n<=o){const l=this.minX,u=this.minY,c=this.maxX,d=this.maxY;this.minX=i<l?i:l,this.minY=n<u?n:u,this.maxX=s>c?s:c,this.maxY=o>d?o:d}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const i=e.minX>t.x?e.minX:t.x,n=e.minY>t.y?e.minY:t.y,s=e.maxX<t.x+t.width?e.maxX:t.x+t.width,o=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(i<=s&&n<=o){const l=this.minX,u=this.minY,c=this.maxX,d=this.maxY;this.minX=i<l?i:l,this.minY=n<u?n:u,this.maxX=s>c?s:c,this.maxY=o>d?o:d}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,i,n,s,o){e-=s,t-=o,i+=s,n+=o,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>n?this.maxY:n}}class Nt extends dl{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new dm,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ph,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let i=0;i<t.length;++i){const n=t[i];Object.defineProperty(Nt.prototype,n,Object.getOwnPropertyDescriptor(e,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new Qe),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new Qe),e=this._localBoundsRect),this._localBounds||(this._localBounds=new Ph);const t=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(i==null?void 0:i.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,e);return this.parent=i,this.transform=t,this._bounds=n,this._bounds.updateID+=this._boundsID-s,o}toGlobal(e,t,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,i,n){return t&&(e=t.toGlobal(e,i,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,i)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e=0,t=0,i=1,n=1,s=0,o=0,l=0,u=0,c=0){return this.position.x=e,this.position.y=t,this.scale.x=i||1,this.scale.y=n||1,this.rotation=s,this.skew.x=o,this.skew.y=l,this.pivot.x=u,this.pivot.y=c,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new qO),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*zP}set angle(e){this.transform.rotation=e*GP}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,t._maskRefCount===0&&(t.renderable=!0,t.isMask=!1))}if(this._mask=e,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount===0&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class qO extends Nt{constructor(){super(...arguments),this.sortDirty=null}}Nt.prototype.displayObjectUpdateTransform=Nt.prototype.updateTransform;const ZO=new xt;function QO(r,e){return r.zIndex===e.zIndex?r._lastSortedIndex-e._lastSortedIndex:r.zIndex-e.zIndex}const UT=class Ap extends Nt{constructor(){super(),this.children=[],this.sortableChildren=Ap.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const i=this.getChildIndex(e),n=this.getChildIndex(t);this.children[i]=t,this.children[n]=e,this.onChildrenChange(i<n?i:n)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(e);Ho(this.children,i,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],i=this.children.indexOf(t);if(i===-1)return null;t.parent=null,t.transform._parentID=-1,Ho(this.children,i,1),this._boundsID++,this.onChildrenChange(i),t.emit("removed",this),this.emit("childRemoved",t,this,i)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,Ho(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const i=e,n=t,s=n-i;let o;if(s>0&&s<=n){o=this.children.splice(i,s);for(let l=0;l<o.length;++l)o[l].parent=null,o[l].transform&&(o[l].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let l=0;l<o.length;++l)o[l].emit("removed",this),this.emit("childRemoved",o[l],this,l);return o}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,i=this.children.length;t<i;++t){const n=this.children[t];n._lastSortedIndex=t,!e&&n.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(QO),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const i=this.children[e];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(t._bounds,i._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const i=super.getLocalBounds(e);if(!t)for(let n=0,s=this.children.length;n<s;++n){const o=this.children[n];o.visible&&o.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let i,n;this.cullArea?(i=this.cullArea,n=this.worldTransform):this._render!==Ap.prototype._render&&(i=this.getBounds(!0));const s=e.projection.transform;if(s&&(n?(n=ZO.copyFrom(n),n.prepend(s)):n=s),i&&t.intersects(i,n))this._render(e);else if(this.cullArea)return;for(let o=0,l=this.children.length;o<l;++o){const u=this.children[o],c=u.cullable;u.cullable=c||!this.cullArea,u.render(e),u.cullable=c}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let i=0,n=this.children.length;i<n;++i)this.children[i].render(e)}}renderAdvanced(e){var t,i,n;const s=this.filters,o=this._mask;if(s){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let u=0;u<s.length;u++)s[u].enabled&&this._enabledFilters.push(s[u])}const l=s&&((t=this._enabledFilters)==null?void 0:t.length)||o&&(!o.isMaskData||o.enabled&&(o.autoDetect||o.type!==Jt.NONE));if(l&&e.batch.flush(),s&&(i=this._enabledFilters)!=null&&i.length&&e.filter.push(this,this._enabledFilters),o&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let u=0,c=this.children.length;u<c;++u)this.children[u].render(e)}l&&e.batch.flush(),o&&e.mask.pop(this),s&&(n=this._enabledFilters)!=null&&n.length&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,i=this.removeChildren(0,this.children.length);if(t)for(let n=0;n<i.length;++n)i[n].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};UT.defaultSortableChildren=!1;let Er=UT;Er.prototype.containerUpdateTransform=Er.prototype.updateTransform;Object.defineProperties(Re,{SORTABLE_CHILDREN:{get(){return Er.defaultSortableChildren},set(r){et("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Er.defaultSortableChildren=r}}});const Ha=new ot,KO=new Uint16Array([0,1,2,0,2,3]);class Zo extends Er{constructor(e){super(),this._anchor=new mn(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new pt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=je.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||De.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=KO,this.pluginName="batch",this.isSprite=!0,this._roundPixels=Re.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Qn(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Qn(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const t=this.transform.worldTransform,i=t.a,n=t.b,s=t.c,o=t.d,l=t.tx,u=t.ty,c=this.vertexData,d=e.trim,p=e.orig,m=this._anchor;let y=0,v=0,_=0,T=0;if(d?(v=d.x-m._x*p.width,y=v+d.width,T=d.y-m._y*p.height,_=T+d.height):(v=-m._x*p.width,y=v+p.width,T=-m._y*p.height,_=T+p.height),c[0]=i*v+s*T+l,c[1]=o*T+n*v+u,c[2]=i*y+s*T+l,c[3]=o*T+n*y+u,c[4]=i*y+s*_+l,c[5]=o*_+n*y+u,c[6]=i*v+s*_+l,c[7]=o*_+n*v+u,this._roundPixels){const E=Re.RESOLUTION;for(let S=0;S<c.length;++S)c[S]=Math.round(c[S]*E)/E}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this._texture,t=this.vertexTrimmedData,i=e.orig,n=this._anchor,s=this.transform.worldTransform,o=s.a,l=s.b,u=s.c,c=s.d,d=s.tx,p=s.ty,m=-n._x*i.width,y=m+i.width,v=-n._y*i.height,_=v+i.height;if(t[0]=o*m+u*v+d,t[1]=c*v+l*m+p,t[2]=o*y+u*v+d,t[3]=c*v+l*y+p,t[4]=o*y+u*_+d,t[5]=c*_+l*y+p,t[6]=o*m+u*_+d,t[7]=c*_+l*m+p,this._roundPixels){const T=Re.RESOLUTION;for(let E=0;E<t.length;++E)t[E]=Math.round(t[E]*T)/T}}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return this.children.length===0?(this._localBounds||(this._localBounds=new Ph),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Qe),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,Ha);const t=this._texture.orig.width,i=this._texture.orig.height,n=-t*this.anchor.x;let s=0;return Ha.x>=n&&Ha.x<n+t&&(s=-i*this.anchor.y,Ha.y>=s&&Ha.y<s+i)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof e=="boolean"?e:e==null?void 0:e.texture){const t=typeof e=="boolean"?e:e==null?void 0:e.baseTexture;this._texture.destroy(!!t)}this._texture=null}static from(e,t){const i=e instanceof De?e:De.from(e,t);return new Zo(i)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const t=Qn(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const t=Qn(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||De.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const HT=new xt;Nt.prototype._cacheAsBitmap=!1;Nt.prototype._cacheData=null;Nt.prototype._cacheAsBitmapResolution=null;Nt.prototype._cacheAsBitmapMultisample=null;class JO{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Nt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(r){r!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(r){r!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(r){if(this._cacheAsBitmap===r)return;this._cacheAsBitmap=r;let e;r?(this._cacheData||(this._cacheData=new JO),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}});Nt.prototype._renderCached=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(r),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(r))};Nt.prototype._initCachedDisplayObject=function(r){var e,t;if((e=this._cacheData)!=null&&e.sprite)return;const i=this.alpha;this.alpha=1,r.batch.flush();const n=this.getLocalBounds(new Qe,!0);if((t=this.filters)!=null&&t.length){const v=this.filters[0].padding;n.pad(v)}const s=this.cacheAsBitmapResolution||r.resolution;n.ceil(s),n.width=Math.max(n.width,1/s),n.height=Math.max(n.height,1/s);const o=r.renderTexture.current,l=r.renderTexture.sourceFrame.clone(),u=r.renderTexture.destinationFrame.clone(),c=r.projection.transform,d=Ws.create({width:n.width,height:n.height,resolution:s,multisample:this.cacheAsBitmapMultisample??r.multisample}),p=`cacheAsBitmap_${Hs()}`;this._cacheData.textureCacheId=p,Ze.addToCache(d.baseTexture,p),De.addToCache(d,p);const m=this.transform.localTransform.copyTo(HT).invert().translate(-n.x,-n.y);this.render=this._cacheData.originalRender,r.render(this,{renderTexture:d,clear:!0,transform:m,skipUpdateTransform:!1}),r.framebuffer.blit(),r.projection.transform=c,r.renderTexture.bind(o,l,u),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const y=new Zo(d);y.transform.worldTransform=this.transform.worldTransform,y.anchor.x=-(n.x/n.width),y.anchor.y=-(n.y/n.height),y.alpha=i,y._bounds=this._bounds,this._cacheData.sprite=y,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=y.containsPoint.bind(y)};Nt.prototype._renderCachedCanvas=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(r),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(r))};Nt.prototype._initCachedDisplayObjectCanvas=function(r){var e;if((e=this._cacheData)!=null&&e.sprite)return;const t=this.getLocalBounds(new Qe,!0),i=this.alpha;this.alpha=1;const n=r.canvasContext.activeContext,s=r._projTransform,o=this.cacheAsBitmapResolution||r.resolution;t.ceil(o),t.width=Math.max(t.width,1/o),t.height=Math.max(t.height,1/o);const l=Ws.create({width:t.width,height:t.height,resolution:o}),u=`cacheAsBitmap_${Hs()}`;this._cacheData.textureCacheId=u,Ze.addToCache(l.baseTexture,u),De.addToCache(l,u);const c=HT;this.transform.localTransform.copyTo(c),c.invert(),c.tx-=t.x,c.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,r.render(this,{renderTexture:l,clear:!0,transform:c,skipUpdateTransform:!1}),r.canvasContext.activeContext=n,r._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const d=new Zo(l);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-(t.x/t.width),d.anchor.y=-(t.y/t.height),d.alpha=i,d._bounds=this._bounds,this._cacheData.sprite=d,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=r._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=d.containsPoint.bind(d)};Nt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Nt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Nt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Ze.removeFromCache(this._cacheData.textureCacheId),De.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Nt.prototype._cacheAsBitmapDestroy=function(r){this.cacheAsBitmap=!1,this.destroy(r)};Nt.prototype.name=null;Er.prototype.getChildByName=function(r,e){for(let t=0,i=this.children.length;t<i;t++)if(this.children[t].name===r)return this.children[t];if(e)for(let t=0,i=this.children.length;t<i;t++){const n=this.children[t];if(!n.getChildByName)continue;const s=n.getChildByName(r,!0);if(s)return s}return null};Nt.prototype.getGlobalPosition=function(r=new ot,e=!1){return this.parent?this.parent.toGlobal(this.position,r,e):(r.x=this.position.x,r.y=this.position.y),r};var $O=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class eI extends Pi{constructor(e=1){super(GO,$O,{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}const tI={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},iI=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function rI(r){const e=tI[r],t=e.length;let i=iI,n="";const s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let o;for(let l=0;l<r;l++){let u=s.replace("%index%",l.toString());o=l,l>=t&&(o=r-l-1),u=u.replace("%value%",e[o].toString()),n+=u,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",r.toString()),i}const nI=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function sI(r,e){const t=Math.ceil(r/2);let i=nI,n="",s;e?s="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":s="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<r;o++){let l=s.replace("%index%",o.toString());l=l.replace("%sampleIndex%",`${o-(t-1)}.0`),n+=l,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",r.toString()),i}class bp extends Pi{constructor(e,t=8,i=4,n=Pi.defaultResolution,s=5){const o=sI(s,e),l=rI(s);super(o,l),this.horizontal=e,this.resolution=n,this._quality=0,this.quality=i,this.blur=t}apply(e,t,i,n){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/t.width):this.uniforms.strength=1/i.height*(i.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)e.applyFilter(this,t,i,n);else{const s=e.getFilterTexture(),o=e.renderer;let l=t,u=s;this.state.blend=!1,e.applyFilter(this,l,u,Gr.CLEAR);for(let c=1;c<this.passes-1;c++){e.bindAndClear(l,Gr.BLIT),this.uniforms.uSampler=u;const d=u;u=l,l=d,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,u,i,n),e.returnFilterTexture(s)}}get blur(){return this.strength}set blur(e){this.padding=1+Math.abs(e)*2,this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}class oI extends Pi{constructor(e=8,t=4,i=Pi.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new bp(!0,e,t,i,n),this.blurYFilter=new bp(!1,e,t,i,n),this.resolution=i,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,i,n){const s=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(s&&o){const l=e.getFilterTexture();this.blurXFilter.apply(e,t,l,Gr.CLEAR),this.blurYFilter.apply(e,l,i,n),e.returnFilterTexture(l)}else o?this.blurYFilter.apply(e,t,i,n):this.blurXFilter.apply(e,t,i,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}}var aI=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class Cp extends Pi{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(MT,aI,e),this.alpha=1}_loadMatrix(e,t=!1){let i=e;t&&(this._multiply(i,this.uniforms.m,e),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(e,t,i){return e[0]=t[0]*i[0]+t[1]*i[5]+t[2]*i[10]+t[3]*i[15],e[1]=t[0]*i[1]+t[1]*i[6]+t[2]*i[11]+t[3]*i[16],e[2]=t[0]*i[2]+t[1]*i[7]+t[2]*i[12]+t[3]*i[17],e[3]=t[0]*i[3]+t[1]*i[8]+t[2]*i[13]+t[3]*i[18],e[4]=t[0]*i[4]+t[1]*i[9]+t[2]*i[14]+t[3]*i[19]+t[4],e[5]=t[5]*i[0]+t[6]*i[5]+t[7]*i[10]+t[8]*i[15],e[6]=t[5]*i[1]+t[6]*i[6]+t[7]*i[11]+t[8]*i[16],e[7]=t[5]*i[2]+t[6]*i[7]+t[7]*i[12]+t[8]*i[17],e[8]=t[5]*i[3]+t[6]*i[8]+t[7]*i[13]+t[8]*i[18],e[9]=t[5]*i[4]+t[6]*i[9]+t[7]*i[14]+t[8]*i[19]+t[9],e[10]=t[10]*i[0]+t[11]*i[5]+t[12]*i[10]+t[13]*i[15],e[11]=t[10]*i[1]+t[11]*i[6]+t[12]*i[11]+t[13]*i[16],e[12]=t[10]*i[2]+t[11]*i[7]+t[12]*i[12]+t[13]*i[17],e[13]=t[10]*i[3]+t[11]*i[8]+t[12]*i[13]+t[13]*i[18],e[14]=t[10]*i[4]+t[11]*i[9]+t[12]*i[14]+t[13]*i[19]+t[14],e[15]=t[15]*i[0]+t[16]*i[5]+t[17]*i[10]+t[18]*i[15],e[16]=t[15]*i[1]+t[16]*i[6]+t[17]*i[11]+t[18]*i[16],e[17]=t[15]*i[2]+t[16]*i[7]+t[17]*i[12]+t[18]*i[17],e[18]=t[15]*i[3]+t[16]*i[8]+t[17]*i[13]+t[18]*i[18],e[19]=t[15]*i[4]+t[16]*i[9]+t[17]*i[14]+t[18]*i[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const i=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(i,t)}tint(e,t){const[i,n,s]=pt.shared.setValue(e).toArray(),o=[i,0,0,0,0,0,n,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(o,t)}greyscale(e,t){const i=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(i,t)}blackAndWhite(e){const t=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(t,e)}hue(e,t){e=(e||0)/180*Math.PI;const i=Math.cos(e),n=Math.sin(e),s=Math.sqrt,o=1/3,l=s(o),u=i+(1-i)*o,c=o*(1-i)-l*n,d=o*(1-i)+l*n,p=o*(1-i)+l*n,m=i+o*(1-i),y=o*(1-i)-l*n,v=o*(1-i)-l*n,_=o*(1-i)+l*n,T=i+o*(1-i),E=[u,c,d,0,0,p,m,y,0,0,v,_,T,0,0,0,0,0,1,0];this._loadMatrix(E,t)}contrast(e,t){const i=(e||0)+1,n=-.5*(i-1),s=[i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0];this._loadMatrix(s,t)}saturate(e=0,t){const i=e*2/3+1,n=(i-1)*-.5,s=[i,n,n,0,0,n,i,n,0,0,n,n,i,0,0,0,0,0,1,0];this._loadMatrix(s,t)}desaturate(){this.saturate(-1)}negative(e){const t=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(t,e)}sepia(e){const t=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(t,e)}technicolor(e){const t=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(t,e)}polaroid(e){const t=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(t,e)}toBGR(e){const t=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(t,e)}kodachrome(e){const t=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(t,e)}browni(e){const t=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(t,e)}vintage(e){const t=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(t,e)}colorTone(e,t,i,n,s){e=e||.2,t=t||.15,i=i||16770432,n=n||3375104;const o=pt.shared,[l,u,c]=o.setValue(i).toArray(),[d,p,m]=o.setValue(n).toArray(),y=[.3,.59,.11,0,0,l,u,c,e,0,d,p,m,t,0,l-d,u-p,c-m,0,0];this._loadMatrix(y,s)}night(e,t){e=e||.1;const i=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(i,t)}predator(e,t){const i=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(i,t)}lsd(e){const t=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(t,e)}reset(){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}Cp.prototype.grayscale=Cp.prototype.greyscale;var lI=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,uI=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class hI extends Pi{constructor(e,t){const i=new xt;e.renderable=!1,super(uI,lI,{mapSampler:e._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=i,t==null&&(t=20),this.scale=new ot(t,t)}apply(e,t,i,n){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const s=this.maskSprite.worldTransform,o=Math.sqrt(s.a*s.a+s.b*s.b),l=Math.sqrt(s.c*s.c+s.d*s.d);o!==0&&l!==0&&(this.uniforms.rotation[0]=s.a/o,this.uniforms.rotation[1]=s.b/o,this.uniforms.rotation[2]=s.c/l,this.uniforms.rotation[3]=s.d/l),e.applyFilter(this,t,i,n)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}}var cI=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,dI=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class fI extends Pi{constructor(){super(dI,cI)}}var pI=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class mI extends Pi{constructor(e=.5,t=Math.random()){super(MT,pI,{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}const tx={AlphaFilter:eI,BlurFilter:oI,BlurFilterPass:bp,ColorMatrixFilter:Cp,DisplacementFilter:hI,FXAAFilter:fI,NoiseFilter:mI};Object.entries(tx).forEach(([r,e])=>{Object.defineProperty(tx,r,{get(){return et("7.1.0",`filters.${r} has moved to ${r}`),e}})});class gI{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(ji.system.add(this.tickerUpdate,this,zs.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(ji.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Wn=new gI;class gl{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=gl.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new ot,this.page=new ot,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,i,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Oh extends gl{constructor(){super(...arguments),this.client=new ot,this.movement=new ot,this.offset=new ot,this.global=new ot,this.screen=new ot}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,i){return e.worldTransform.applyInverse(i||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,i,n,s,o,l,u,c,d,p,m,y,v,_){throw new Error("Method not implemented.")}}class vr extends Oh{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Go extends Oh{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Go.DOM_DELTA_PIXEL=0,Go.DOM_DELTA_LINE=1,Go.DOM_DELTA_PAGE=2;const yI=2048,vI=new ot,If=new ot;class _I{constructor(e){this.dispatch=new dl,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((i,n)=>i.priority-n.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let i=0,n=t.length;i<n;i++)t[i].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){Wn.pauseUpdate=!0;const i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[i](this.rootTarget,this.rootTarget.eventMode,vI.set(e,t),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(e,t){if(!e.target)return;const i=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let n=0,s=i.length-1;n<s;n++)if(e.currentTarget=i[n],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(e.currentTarget=i[n],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,i=this._allInteractiveElements){if(i.length===0)return;e.eventPhase=e.BUBBLING_PHASE;const n=Array.isArray(t)?t:[t];for(let s=i.length-1;s>=0;s--)n.forEach(o=>{e.currentTarget=i[s],this.notifyTarget(e,o)})}propagationPath(e){const t=[e];for(let i=0;i<yI&&e!==this.rootTarget;i++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,i,n,s,o=!1){let l=!1;if(this._interactivePrune(e))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Wn.pauseUpdate=!1),e.interactiveChildren&&e.children){const d=e.children;for(let p=d.length-1;p>=0;p--){const m=d[p],y=this.hitTestMoveRecursive(m,this._isInteractive(t)?t:m.eventMode,i,n,s,o||s(e,i));if(y){if(y.length>0&&!y[y.length-1].parent)continue;const v=e.isInteractive();(y.length>0||v)&&(v&&this._allInteractiveElements.push(e),y.push(e)),this._hitElements.length===0&&(this._hitElements=y),l=!0}}}const u=this._isInteractive(t),c=e.isInteractive();return u&&c&&this._allInteractiveElements.push(e),o||this._hitElements.length>0?null:l?this._hitElements:u&&!s(e,i)&&n(e,i)?c?[e]:[]:null}hitTestRecursive(e,t,i,n,s){if(this._interactivePrune(e)||s(e,i))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Wn.pauseUpdate=!1),e.interactiveChildren&&e.children){const u=e.children;for(let c=u.length-1;c>=0;c--){const d=u[c],p=this.hitTestRecursive(d,this._isInteractive(t)?t:d.eventMode,i,n,s);if(p){if(p.length>0&&!p[p.length-1].parent)continue;const m=e.isInteractive();return(p.length>0||m)&&p.push(e),p}}}const o=this._isInteractive(t),l=e.isInteractive();return o&&n(e,i)?l?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}_interactivePrune(e){return!!(!e||e.isMask||!e.visible||!e.renderable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren||e.isMask)}hitPruneFn(e,t){var i;if(e.hitArea&&(e.worldTransform.applyInverse(t,If),!e.hitArea.contains(If.x,If.y)))return!0;if(e._mask){const n=e._mask.isMaskData?e._mask.maskObject:e._mask;if(n&&!((i=n.containsPoint)!=null&&i.call(n,t)))return!0}return!1}hitTestFn(e,t){return e.eventMode==="passive"?!1:e.hitArea?!0:e.containsPoint?e.containsPoint(t):!1}notifyTarget(e,t){var i,n;t=t??e.type;const s=`on${t}`;(n=(i=e.currentTarget)[s])==null||n.call(i,e);const o=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,o),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof vr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),t.pointerType==="touch")this.dispatchEvent(t,"touchstart");else if(t.pointerType==="mouse"||t.pointerType==="pen"){const n=t.button===2;this.dispatchEvent(t,n?"rightdown":"mousedown")}const i=this.trackingData(e.pointerId);i.pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){var t,i;if(!(e instanceof vr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const n=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const s=n.pointerType==="mouse"||n.pointerType==="pen",o=this.trackingData(e.pointerId),l=this.findMountedTarget(o.overTargets);if(((t=o.overTargets)==null?void 0:t.length)>0&&l!==n.target){const d=e.type==="mousemove"?"mouseout":"pointerout",p=this.createPointerEvent(e,d,l);if(this.dispatchEvent(p,"pointerout"),s&&this.dispatchEvent(p,"mouseout"),!n.composedPath().includes(l)){const m=this.createPointerEvent(e,"pointerleave",l);for(m.eventPhase=m.AT_TARGET;m.target&&!n.composedPath().includes(m.target);)m.currentTarget=m.target,this.notifyTarget(m),s&&this.notifyTarget(m,"mouseleave"),m.target=m.target.parent;this.freeEvent(m)}this.freeEvent(p)}if(l!==n.target){const d=e.type==="mousemove"?"mouseover":"pointerover",p=this.clonePointerEvent(n,d);this.dispatchEvent(p,"pointerover"),s&&this.dispatchEvent(p,"mouseover");let m=l==null?void 0:l.parent;for(;m&&m!==this.rootTarget.parent&&m!==n.target;)m=m.parent;if(!m||m===this.rootTarget.parent){const y=this.clonePointerEvent(n,"pointerenter");for(y.eventPhase=y.AT_TARGET;y.target&&y.target!==l&&y.target!==this.rootTarget.parent;)y.currentTarget=y.target,this.notifyTarget(y),s&&this.notifyTarget(y,"mouseenter"),y.target=y.target.parent;this.freeEvent(y)}this.freeEvent(p)}const u=[],c=this.enableGlobalMoveEvents??!0;this.moveOnAll?u.push("pointermove"):this.dispatchEvent(n,"pointermove"),c&&u.push("globalpointermove"),n.pointerType==="touch"&&(this.moveOnAll?u.splice(1,0,"touchmove"):this.dispatchEvent(n,"touchmove"),c&&u.push("globaltouchmove")),s&&(this.moveOnAll?u.splice(1,0,"mousemove"):this.dispatchEvent(n,"mousemove"),c&&u.push("globalmousemove"),this.cursor=(i=n.target)==null?void 0:i.cursor),u.length>0&&this.all(n,u),this._allInteractiveElements.length=0,this._hitElements.length=0,o.overTargets=n.composedPath(),this.freeEvent(n)}mapPointerOver(e){var t;if(!(e instanceof vr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=this.trackingData(e.pointerId),n=this.createPointerEvent(e),s=n.pointerType==="mouse"||n.pointerType==="pen";this.dispatchEvent(n,"pointerover"),s&&this.dispatchEvent(n,"mouseover"),n.pointerType==="mouse"&&(this.cursor=(t=n.target)==null?void 0:t.cursor);const o=this.clonePointerEvent(n,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),s&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;i.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(o)}mapPointerOut(e){if(!(e instanceof vr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId);if(t.overTargets){const i=e.pointerType==="mouse"||e.pointerType==="pen",n=this.findMountedTarget(t.overTargets),s=this.createPointerEvent(e,"pointerout",n);this.dispatchEvent(s),i&&this.dispatchEvent(s,"mouseout");const o=this.createPointerEvent(e,"pointerleave",n);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;t.overTargets=null,this.freeEvent(s),this.freeEvent(o)}this.cursor=null}mapPointerUp(e){if(!(e instanceof vr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=performance.now(),i=this.createPointerEvent(e);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const l=i.button===2;this.dispatchEvent(i,l?"rightup":"mouseup")}const n=this.trackingData(e.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[e.button]);let o=s;if(s&&!i.composedPath().includes(s)){let l=s;for(;l&&!i.composedPath().includes(l);){if(i.currentTarget=l,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const u=i.button===2;this.notifyTarget(i,u?"rightupoutside":"mouseupoutside")}l=l.parent}delete n.pressTargetsByButton[e.button],o=l}if(o){const l=this.clonePointerEvent(i,"click");l.target=o,l.path=null,n.clicksByButton[e.button]||(n.clicksByButton[e.button]={clickCount:0,target:l.target,timeStamp:t});const u=n.clicksByButton[e.button];if(u.target===l.target&&t-u.timeStamp<200?++u.clickCount:u.clickCount=1,u.target=l.target,u.timeStamp=t,l.detail=u.clickCount,l.pointerType==="mouse"){const c=l.button===2;this.dispatchEvent(l,c?"rightclick":"click")}else l.pointerType==="touch"&&this.dispatchEvent(l,"tap");this.dispatchEvent(l,"pointertap"),this.freeEvent(l)}this.freeEvent(i)}mapPointerUpOutside(e){if(!(e instanceof vr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),i=this.findMountedTarget(t.pressTargetsByButton[e.button]),n=this.createPointerEvent(e);if(i){let s=i;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),s=s.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(n)}mapWheel(e){if(!(e instanceof Go)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let i=1;i<e.length&&e[i].parent===t;i++)t=e[i];return t}createPointerEvent(e,t,i){const n=this.allocateEvent(vr);return this.copyPointerData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.nativeEvent=e.nativeEvent,n.originalEvent=e,n.target=i??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],typeof t=="string"&&(n.type=t),n}createWheelEvent(e){const t=this.allocateEvent(Go);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const i=this.allocateEvent(vr);return i.nativeEvent=e.nativeEvent,i.originalEvent=e.originalEvent,this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.target=e.target,i.path=e.composedPath().slice(),i.type=t??i.type,i}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof vr&&t instanceof vr&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof Oh&&t instanceof Oh&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){const i=e.currentTarget._events[t];if(i&&e.currentTarget.isInteractive())if("fn"in i)i.once&&e.currentTarget.removeListener(t,i.fn,void 0,!0),i.fn.call(i.context,e);else for(let n=0,s=i.length;n<s&&!e.propagationImmediatelyStopped;n++)i[n].once&&e.currentTarget.removeListener(t,i[n].fn,void 0,!0),i[n].fn.call(i[n].context,e)}}const xI=1,TI={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Rp=class Pp{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new _I(null),Wn.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new vr(null),this.rootWheelEvent=new Go(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Pp.defaultEventFeatures},{set:(t,i,n)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=n),t[i]=n,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:t,resolution:i}=this.renderer;this.setTargetElement(t),this.resolution=i,Pp._defaultEventMode=e.eventMode??"auto",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const i=this.cursorStyles[e];if(i)switch(typeof i){case"string":t&&(this.domElement.style.cursor=i);break;case"function":i(e);break;case"object":t&&Object.assign(this.domElement.style,i);break}else t&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let i=0,n=t.length;i<n;i++){const s=t[i],o=this.bootstrapEvent(this.rootPointerEvent,s);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Wn.pointerMoved();const t=this.normalizeToPointerData(e);for(let i=0,n=t.length;i<n;i++){const s=this.bootstrapEvent(this.rootPointerEvent,t[i]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const i=t!==this.domElement?"outside":"",n=this.normalizeToPointerData(e);for(let s=0,o=n.length;s<o;s++){const l=this.bootstrapEvent(this.rootPointerEvent,n[s]);l.type+=i,this.rootBoundary.mapEvent(l)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);for(let i=0,n=t.length;i<n;i++){const s=this.bootstrapEvent(this.rootPointerEvent,t[i]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,Wn.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Wn.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Wn.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,i){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;e.x=(t-n.left)*(this.domElement.width/n.width)*s,e.y=(i-n.top)*(this.domElement.height/n.height)*s}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let i=0,n=e.changedTouches.length;i<n;i++){const s=e.changedTouches[i];typeof s.button>"u"&&(s.button=0),typeof s.buttons>"u"&&(s.buttons=1),typeof s.isPrimary>"u"&&(s.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof s.width>"u"&&(s.width=s.radiusX||1),typeof s.height>"u"&&(s.height=s.radiusY||1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="touch"),typeof s.pointerId>"u"&&(s.pointerId=s.identifier||0),typeof s.pressure>"u"&&(s.pressure=s.force||.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),typeof s.layerX>"u"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY>"u"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=e.type,t.push(s)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){const i=e;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=xI),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,t.push(i)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=TI[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};Rp.extension={name:"events",type:[Ae.RendererSystem,Ae.CanvasRendererSystem]},Rp.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let Op=Rp;Le.add(Op);function ix(r){return r==="dynamic"||r==="static"}const wI={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??ix(Op.defaultEventMode)},set interactive(r){et("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=r,this.eventMode=r?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Op.defaultEventMode},set eventMode(r){this._internalInteractive=ix(r),this._internalEventMode=r},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(r,e,t){const i=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,n=typeof t=="object"?t.signal:void 0,s=typeof t=="object"?t.once===!0:!1,o=typeof e=="function"?void 0:e;r=i?`${r}capture`:r;const l=typeof e=="function"?e:e.handleEvent,u=this;n&&n.addEventListener("abort",()=>{u.off(r,l,o)}),s?u.once(r,l,o):u.on(r,l,o)},removeEventListener(r,e,t){const i=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,n=typeof e=="function"?void 0:e;r=i?`${r}capture`:r,e=typeof e=="function"?e:e.handleEvent,this.off(r,e,n)},dispatchEvent(r){if(!(r instanceof gl))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=null,r.target=this,r.manager.dispatchEvent(r),!r.defaultPrevented}};Nt.mixin(wI);const EI={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Nt.mixin(EI);const SI=9,ju=100,AI=0,bI=0,rx=2,nx=1,CI=-1e3,RI=-1e3,PI=2;class zT{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(pn.tablet||pn.phone)&&this.createTouchHook();const t=document.createElement("div");t.style.width=`${ju}px`,t.style.height=`${ju}px`,t.style.position="absolute",t.style.top=`${AI}px`,t.style.left=`${bI}px`,t.style.zIndex=rx.toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width=`${nx}px`,e.style.height=`${nx}px`,e.style.position="absolute",e.style.top=`${CI}px`,e.style.left=`${RI}px`,e.style.zIndex=PI.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(e=this.renderer.view.parentNode)==null||e.appendChild(this.div))}deactivate(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(e=this.div.parentNode)==null||e.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const t=e.children;if(t)for(let i=0;i<t.length;i++)this.updateAccessibleObjects(t[i])}update(){const e=performance.now();if(pn.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:t,y:i,width:n,height:s}=this.renderer.view.getBoundingClientRect(),{width:o,height:l,resolution:u}=this.renderer,c=n/o*u,d=s/l*u;let p=this.div;p.style.left=`${t}px`,p.style.top=`${i}px`,p.style.width=`${o}px`,p.style.height=`${l}px`;for(let m=0;m<this.children.length;m++){const y=this.children[m];if(y.renderId!==this.renderId)y._accessibleActive=!1,Ho(this.children,m,1),this.div.removeChild(y._accessibleDiv),this.pool.push(y._accessibleDiv),y._accessibleDiv=null,m--;else{p=y._accessibleDiv;let v=y.hitArea;const _=y.worldTransform;y.hitArea?(p.style.left=`${(_.tx+v.x*_.a)*c}px`,p.style.top=`${(_.ty+v.y*_.d)*d}px`,p.style.width=`${v.width*_.a*c}px`,p.style.height=`${v.height*_.d*d}px`):(v=y.getBounds(),this.capHitArea(v),p.style.left=`${v.x*c}px`,p.style.top=`${v.y*d}px`,p.style.width=`${v.width*c}px`,p.style.height=`${v.height*d}px`,p.title!==y.accessibleTitle&&y.accessibleTitle!==null&&(p.title=y.accessibleTitle),p.getAttribute("aria-label")!==y.accessibleHint&&y.accessibleHint!==null&&p.setAttribute("aria-label",y.accessibleHint)),(y.accessibleTitle!==p.title||y.tabIndex!==p.tabIndex)&&(p.title=y.accessibleTitle,p.tabIndex=y.tabIndex,this.debug&&this.updateDebugHTML(p))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:i}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>i&&(e.height=i-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement("button"),t.style.width=`${ju}px`,t.style.height=`${ju}px`,t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=rx.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){const{displayObject:i}=e.target,n=this.renderer.events.rootBoundary,s=Object.assign(new gl(n),{target:i});n.rootTarget=this.renderer.lastObjectRendered,t.forEach(o=>n.dispatchEvent(s,o))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode===SI&&this.activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}zT.extension={name:"accessibility",type:[Ae.RendererPlugin,Ae.CanvasRendererPlugin]};Le.add(zT);const GT=class Ip{constructor(e){this.stage=new Er,e=Object.assign({forceCanvas:!1},e),this.renderer=IT(e),Ip._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){var e;return(e=this.renderer)==null?void 0:e.view}get screen(){var e;return(e=this.renderer)==null?void 0:e.screen}destroy(e,t){const i=Ip._plugins.slice(0);i.reverse(),i.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};GT._plugins=[];let OI=GT;Le.handleByList(Ae.Application,OI._plugins);class VT{static init(e){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let t,i;if(this._resizeTo===globalThis.window)t=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:s}=this._resizeTo;t=n,i=s}this.renderer.resize(t,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}VT.extension=Ae.Application;Le.add(VT);const sx={loader:Ae.LoadParser,resolver:Ae.ResolveParser,cache:Ae.CacheParser,detection:Ae.DetectionParser};Le.handle(Ae.Asset,r=>{const e=r.ref;Object.entries(sx).filter(([t])=>!!e[t]).forEach(([t,i])=>Le.add(Object.assign(e[t],{extension:e[t].extension??i})))},r=>{const e=r.ref;Object.keys(sx).filter(t=>!!e[t]).forEach(t=>Le.remove(e[t]))});class II{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(t=>{this._assetList.push(t)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<t;i++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function Qo(r,e){if(Array.isArray(e)){for(const t of e)if(r.startsWith(`data:${t}`))return!0;return!1}return r.startsWith(`data:${e}`)}function ss(r,e){const t=r.split("?")[0],i=ci.extname(t).toLowerCase();return Array.isArray(e)?e.includes(i):i===e}const xr=(r,e,t=!1)=>(Array.isArray(r)||(r=[r]),e?r.map(i=>typeof i=="string"||t?e(i):i):r),Mp=(r,e)=>{const t=e.split("?")[1];return t&&(r+=`?${t}`),r};function jT(r,e,t,i,n){const s=e[t];for(let o=0;o<s.length;o++){const l=s[o];t<e.length-1?jT(r.replace(i[t],l),e,t+1,i,n):n.push(r.replace(i[t],l))}}function MI(r){const e=/\{(.*?)\}/g,t=r.match(e),i=[];if(t){const n=[];t.forEach(s=>{const o=s.substring(1,s.length-1).split(",");n.push(o)}),jT(r,n,0,t,i)}else i.push(r);return i}const Ih=r=>!Array.isArray(r);class NI{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const i=xr(e);let n;for(let l=0;l<this.parsers.length;l++){const u=this.parsers[l];if(u.test(t)){n=u.getCacheableAssets(i,t);break}}n||(n={},i.forEach(l=>{n[l]=t}));const s=Object.keys(n),o={cacheKeys:s,keys:i};if(i.forEach(l=>{this._cacheMap.set(l,o)}),s.forEach(l=>{const u=n?n[l]:t;this._cache.has(l)&&this._cache.get(l)!==u&&console.warn("[Cache] already has key:",l),this._cache.set(l,n[l])}),t instanceof De){const l=t;i.forEach(u=>{l.baseTexture!==De.EMPTY.baseTexture&&Ze.addToCache(l.baseTexture,u),De.addToCache(l,u)})}}remove(e){if(!this._cacheMap.has(e)){console.warn(`[Assets] Asset id ${e} was not found in the Cache`);return}const t=this._cacheMap.get(e);t.cacheKeys.forEach(i=>{this._cache.delete(i)}),t.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const Is=new NI;class DI{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,i)=>(this._parsersValidated=!1,e[t]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const i={promise:null,parser:null};return i.promise=(async()=>{var n,s;let o=null,l=null;if(t.loadParser&&(l=this._parserHash[t.loadParser],l||console.warn(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!l){for(let u=0;u<this.parsers.length;u++){const c=this.parsers[u];if(c.load&&(n=c.test)!=null&&n.call(c,e,t,this)){l=c;break}}if(!l)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}o=await l.load(e,t,this),i.parser=l;for(let u=0;u<this.parsers.length;u++){const c=this.parsers[u];c.parse&&c.parse&&await((s=c.testParse)==null?void 0:s.call(c,o,t,this))&&(o=await c.parse(o,t,this)||o,i.parser=c)}return o})(),i}async load(e,t){this._parsersValidated||this._validateParsers();let i=0;const n={},s=Ih(e),o=xr(e,c=>({alias:[c],src:c})),l=o.length,u=o.map(async c=>{const d=ci.toAbsolute(c.src);if(!n[c.src])try{this.promiseCache[d]||(this.promiseCache[d]=this._getLoadPromiseAndParser(d,c)),n[c.src]=await this.promiseCache[d].promise,t&&t(++i/l)}catch(p){throw delete this.promiseCache[d],delete n[c.src],new Error(`[Loader.load] Failed to load ${d}.
${p}`)}});return await Promise.all(u),s?n[o[0].src]:n}async unload(e){const t=xr(e,i=>({alias:[i],src:i})).map(async i=>{var n,s;const o=ci.toAbsolute(i.src),l=this.promiseCache[o];if(l){const u=await l.promise;delete this.promiseCache[o],(s=(n=l.parser)==null?void 0:n.unload)==null||s.call(n,u,i,this)}});await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(e[t.name]&&console.warn(`[Assets] loadParser name conflict "${t.name}"`),{...e,[t.name]:t}),{})}}var Rr=(r=>(r[r.Low=0]="Low",r[r.Normal=1]="Normal",r[r.High=2]="High",r))(Rr||{});const LI=".json",FI="application/json",BI={extension:{type:Ae.LoadParser,priority:Rr.Low},name:"loadJson",test(r){return Qo(r,FI)||ss(r,LI)},async load(r){return await(await Re.ADAPTER.fetch(r)).json()}};Le.add(BI);const kI=".txt",UI="text/plain",HI={name:"loadTxt",extension:{type:Ae.LoadParser,priority:Rr.Low},test(r){return Qo(r,UI)||ss(r,kI)},async load(r){return await(await Re.ADAPTER.fetch(r)).text()}};Le.add(HI);const zI=["normal","bold","100","200","300","400","500","600","700","800","900"],GI=[".ttf",".otf",".woff",".woff2"],VI=["font/ttf","font/otf","font/woff","font/woff2"],jI=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function XI(r){const e=ci.extname(r),t=ci.basename(r,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1));let i=t.length>0;for(const s of t)if(!s.match(jI)){i=!1;break}let n=t.join(" ");return i||(n=`"${n.replace(/[\\"]/g,"\\$&")}"`),n}const WI=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function YI(r){return WI.test(r)?r:encodeURI(r)}const qI={extension:{type:Ae.LoadParser,priority:Rr.Low},name:"loadWebFont",test(r){return Qo(r,VI)||ss(r,GI)},async load(r,e){var t,i,n;const s=Re.ADAPTER.getFontFaceSet();if(s){const o=[],l=((t=e.data)==null?void 0:t.family)??XI(r),u=((n=(i=e.data)==null?void 0:i.weights)==null?void 0:n.filter(d=>zI.includes(d)))??["normal"],c=e.data??{};for(let d=0;d<u.length;d++){const p=u[d],m=new FontFace(l,`url(${YI(r)})`,{...c,weight:p});await m.load(),s.add(m),o.push(m)}return o.length===1?o[0]:o}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(r){(Array.isArray(r)?r:[r]).forEach(e=>Re.ADAPTER.getFontFaceSet().delete(e))}};Le.add(qI);const ZI=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let Vo=null,Np=class{constructor(){Vo||(Vo=URL.createObjectURL(new Blob([ZI],{type:"application/javascript"}))),this.worker=new Worker(Vo)}};Np.revokeObjectURL=function(){Vo&&(URL.revokeObjectURL(Vo),Vo=null)};const QI=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let jo=null;class XT{constructor(){jo||(jo=URL.createObjectURL(new Blob([QI],{type:"application/javascript"}))),this.worker=new Worker(jo)}}XT.revokeObjectURL=function(){jo&&(URL.revokeObjectURL(jo),jo=null)};let ox=0,Mf;class KI{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const{worker:t}=new Np;t.addEventListener("message",i=>{t.terminate(),Np.revokeObjectURL(),e(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Mf===void 0&&(Mf=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<Mf&&(this._createdWorkers++,e=new XT().worker,e.addEventListener("message",t=>{this.complete(t.data),this.returnWorker(t.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){e.error!==void 0?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const i=new Promise((n,s)=>{this.queue.push({id:e,arguments:t,resolve:n,reject:s})});return this.next(),i}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const t=this.queue.pop(),i=t.id;this.resolveHash[ox]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:ox++,id:i})}}const ax=new KI;function yl(r,e,t){r.resource.internal=!0;const i=new De(r),n=()=>{delete e.promiseCache[t],Is.has(t)&&Is.remove(t)};return i.baseTexture.once("destroyed",()=>{t in e.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),n())}),i.once("destroyed",()=>{r.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),i}const JI=[".jpeg",".jpg",".png",".webp",".avif"],$I=["image/jpeg","image/png","image/webp","image/avif"];async function eM(r){const e=await Re.ADAPTER.fetch(r);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${r}: ${e.status} ${e.statusText}`);const t=await e.blob();return await createImageBitmap(t)}const Qh={name:"loadTextures",extension:{type:Ae.LoadParser,priority:Rr.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(r){return Qo(r,$I)||ss(r,JI)},async load(r,e,t){var i;const n=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let s;n?this.config.preferWorkers&&await ax.isImageBitmapSupported()?s=await ax.loadImageBitmap(r):s=await eM(r):s=await new Promise((u,c)=>{const d=new Image;d.crossOrigin=this.config.crossOrigin,d.src=r,d.complete?u(d):(d.onload=()=>u(d),d.onerror=p=>c(p))});const o={...e.data};o.resolution??(o.resolution=vn(r)),n&&((i=o.resourceOptions)==null?void 0:i.ownsImageBitmap)===void 0&&(o.resourceOptions={...o.resourceOptions},o.resourceOptions.ownsImageBitmap=!0);const l=new Ze(s,o);return l.resource.src=r,yl(l,t,r)},unload(r){r.destroy(!0)}};Le.add(Qh);const tM=".svg",iM="image/svg+xml",rM={extension:{type:Ae.LoadParser,priority:Rr.High},name:"loadSVG",test(r){return Qo(r,iM)||ss(r,tM)},async testParse(r){return wp.test(r)},async parse(r,e,t){var i;const n=new wp(r,(i=e==null?void 0:e.data)==null?void 0:i.resourceOptions);await n.load();const s=new Ze(n,{resolution:vn(r),...e==null?void 0:e.data});return s.resource.src=e.src,yl(s,t,e.src)},async load(r,e){return(await Re.ADAPTER.fetch(r)).text()},unload:Qh.unload};Le.add(rM);const nM=[".mp4",".m4v",".webm",".ogv"],sM=["video/mp4","video/webm","video/ogg"],oM={name:"loadVideo",extension:{type:Ae.LoadParser,priority:Rr.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(r){return Qo(r,sM)||ss(r,nM)},async load(r,e,t){var i;let n;const s=await(await Re.ADAPTER.fetch(r)).blob(),o=URL.createObjectURL(s);try{const l={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...(i=e==null?void 0:e.data)==null?void 0:i.resourceOptions,autoLoad:!0},u=new kT(o,l);await u.load();const c=new Ze(u,{alphaMode:await dP(),resolution:vn(r),...e==null?void 0:e.data});c.resource.src=r,n=yl(c,t,r),n.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(o)})}catch(l){throw URL.revokeObjectURL(o),l}return n},unload(r){r.destroy(!0)}};Le.add(oM);class aM{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(t[i])}`).join("&")}}getAlias(e){const{alias:t,name:i,src:n,srcs:s}=e;return xr(t||i||n||s,o=>typeof o=="string"?o:Array.isArray(o)?o.map(l=>(l==null?void 0:l.src)??(l==null?void 0:l.srcs)??l):o!=null&&o.src||o!=null&&o.srcs?o.src??o.srcs:o,!0)}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(t=>{this.addBundle(t.name,t.assets)})}addBundle(e,t){const i=[];Array.isArray(t)?t.forEach(n=>{const s=n.src??n.srcs,o=n.alias??n.name;let l;if(typeof o=="string"){const u=this._createBundleAssetId(e,o);i.push(u),l=[o,u]}else{const u=o.map(c=>this._createBundleAssetId(e,c));i.push(...u),l=[...o,...u]}this.add({...n,alias:l,src:s})}):Object.keys(t).forEach(n=>{const s=[n,this._createBundleAssetId(e,n)];if(typeof t[n]=="string")this.add({alias:s,src:t[n]});else if(Array.isArray(t[n]))this.add({alias:s,src:t[n]});else{const o=t[n],l=o.src??o.srcs;this.add({...o,alias:s,src:Array.isArray(l)?l:[l]})}i.push(...s)}),this._bundles[e]=i}add(e,t,i,n,s){const o=[];typeof e=="string"||Array.isArray(e)&&typeof e[0]=="string"?(et("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),o.push({alias:e,src:t,data:i,format:n,loadParser:s})):Array.isArray(e)?o.push(...e):o.push(e);let l;l=u=>{this.hasKey(u)&&console.warn(`[Resolver] already has key: ${u} overwriting`)},xr(o).forEach(u=>{const{src:c,srcs:d}=u;let{data:p,format:m,loadParser:y}=u;const v=xr(c||d).map(E=>typeof E=="string"?MI(E):Array.isArray(E)?E:[E]),_=this.getAlias(u);Array.isArray(_)?_.forEach(l):l(_);const T=[];v.forEach(E=>{E.forEach(S=>{let A={};if(typeof S!="object"){A.src=S;for(let P=0;P<this._parsers.length;P++){const D=this._parsers[P];if(D.test(S)){A=D.parse(S);break}}}else p=S.data??p,m=S.format??m,y=S.loadParser??y,A={...A,...S};if(!_)throw new Error(`[Resolver] alias is undefined for this asset: ${A.src}`);A=this.buildResolvedAsset(A,{aliases:_,data:p,format:m,loadParser:y}),T.push(A)})}),_.forEach(E=>{this._assetMap[E]=T})})}resolveBundle(e){const t=Ih(e);e=xr(e);const i={};return e.forEach(n=>{const s=this._bundles[n];if(s){const o=this.resolve(s),l={};for(const u in o){const c=o[u];l[this._extractAssetIdFromBundle(n,u)]=c}i[n]=l}}),t?i[e[0]]:i}resolveUrl(e){const t=this.resolve(e);if(typeof e!="string"){const i={};for(const n in t)i[n]=t[n].src;return i}return t.src}resolve(e){const t=Ih(e);e=xr(e);const i={};return e.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let s=this._assetMap[n];const o=s[0],l=this._getPreferredOrder(s);l==null||l.priority.forEach(u=>{l.params[u].forEach(c=>{const d=s.filter(p=>p[u]?p[u]===c:!1);d.length&&(s=d)})}),this._resolverHash[n]=s[0]??o}else this._resolverHash[n]=this.buildResolvedAsset({alias:[n],src:n},{});i[n]=this._resolverHash[n]}),t?i[e[0]]:i}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const i=e[0],n=this._preferredOrder.find(s=>s.params.format.includes(i.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;const t=/\?/.test(e)?"&":"?";return`${e}${t}${this._defaultSearchParams}`}buildResolvedAsset(e,t){const{aliases:i,data:n,loadParser:s,format:o}=t;return(this._basePath||this._rootPath)&&(e.src=ci.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=i??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...n||{},...e.data},e.loadParser=s??e.loadParser,e.format=o??e.format??ci.extname(e.src).slice(1),e.srcs=e.src,e.name=e.alias,e}}class lM{constructor(){this._detections=[],this._initialized=!1,this.resolver=new aM,this.loader=new DI,this.cache=Is,this._backgroundLoader=new II(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){var t,i;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let l=e.manifest;typeof l=="string"&&(l=await this.load(l)),this.resolver.addManifest(l)}const n=((t=e.texturePreference)==null?void 0:t.resolution)??1,s=typeof n=="number"?[n]:n,o=await this._detectFormats({preferredFormats:(i=e.texturePreference)==null?void 0:i.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:o,resolution:s}}),e.preferences&&this.setPreferences(e.preferences)}add(e,t,i,n,s){this.resolver.add(e,t,i,n,s)}async load(e,t){this._initialized||await this.init();const i=Ih(e),n=xr(e).map(l=>{if(typeof l!="string"){const u=this.resolver.getAlias(l);return u.some(c=>!this.resolver.hasKey(c))&&this.add(l),Array.isArray(u)?u[0]:u}return this.resolver.hasKey(l)||this.add({alias:l,src:l}),l}),s=this.resolver.resolve(n),o=await this._mapLoadToResolve(s,t);return i?o[n[0]]:o}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let i=!1;typeof e=="string"&&(i=!0,e=[e]);const n=this.resolver.resolveBundle(e),s={},o=Object.keys(n);let l=0,u=0;const c=()=>{t==null||t(++l/u)},d=o.map(p=>{const m=n[p];return u+=Object.keys(m).length,this._mapLoadToResolve(m,c).then(y=>{s[p]=y})});return await Promise.all(d),i?s[e[0]]:s}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return Is.get(e);const t={};for(let i=0;i<e.length;i++)t[i]=Is.get(e[i]);return t}async _mapLoadToResolve(e,t){const i=Object.values(e),n=Object.keys(e);this._backgroundLoader.active=!1;const s=await this.loader.load(i,t);this._backgroundLoader.active=!0;const o={};return i.forEach((l,u)=>{const c=s[l.src],d=[l.src];l.alias&&d.push(...l.alias),o[n[u]]=c,Is.set(d,c)}),o}async unload(e){this._initialized||await this.init();const t=xr(e).map(n=>typeof n!="string"?n.src:n),i=this.resolver.resolve(t);await this._unloadFromResolved(i)}async unloadBundle(e){this._initialized||await this.init(),e=xr(e);const t=this.resolver.resolveBundle(e),i=Object.keys(t).map(n=>this._unloadFromResolved(t[n]));await Promise.all(i)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach(i=>{Is.remove(i.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const i of e.detections)e.skipDetections||await i.test()?t=await i.add(t):e.skipDetections||(t=await i.remove(t));return t=t.filter((i,n)=>t.indexOf(i)===n),t}get detections(){return this._detections}get preferWorkers(){return Qh.config.preferWorkers}set preferWorkers(e){et("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(i=>i in e).forEach(i=>{t.config[i]=e[i]})})}}const Xu=new lM;Le.handleByList(Ae.LoadParser,Xu.loader.parsers).handleByList(Ae.ResolveParser,Xu.resolver.parsers).handleByList(Ae.CacheParser,Xu.cache.parsers).handleByList(Ae.DetectionParser,Xu.detections);const uM={extension:Ae.CacheParser,test:r=>Array.isArray(r)&&r.every(e=>e instanceof De),getCacheableAssets:(r,e)=>{const t={};return r.forEach(i=>{e.forEach((n,s)=>{t[i+(s===0?"":s+1)]=n})}),t}};Le.add(uM);async function WT(r){if("Image"in globalThis)return new Promise(e=>{const t=new Image;t.onload=()=>{e(!0)},t.onerror=()=>{e(!1)},t.src=r});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(r)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}const hM={extension:{type:Ae.DetectionParser,priority:1},test:async()=>WT("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async r=>[...r,"avif"],remove:async r=>r.filter(e=>e!=="avif")};Le.add(hM);const cM={extension:{type:Ae.DetectionParser,priority:0},test:async()=>WT("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async r=>[...r,"webp"],remove:async r=>r.filter(e=>e!=="webp")};Le.add(cM);const lx=["png","jpg","jpeg"],dM={extension:{type:Ae.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async r=>[...r,...lx],remove:async r=>r.filter(e=>!lx.includes(e))};Le.add(dM);const fM="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function mm(r){return fM?!1:document.createElement("video").canPlayType(r)!==""}const pM={extension:{type:Ae.DetectionParser,priority:0},test:async()=>mm("video/webm"),add:async r=>[...r,"webm"],remove:async r=>r.filter(e=>e!=="webm")};Le.add(pM);const mM={extension:{type:Ae.DetectionParser,priority:0},test:async()=>mm("video/mp4"),add:async r=>[...r,"mp4","m4v"],remove:async r=>r.filter(e=>e!=="mp4"&&e!=="m4v")};Le.add(mM);const gM={extension:{type:Ae.DetectionParser,priority:0},test:async()=>mm("video/ogg"),add:async r=>[...r,"ogv"],remove:async r=>r.filter(e=>e!=="ogv")};Le.add(gM);const yM={extension:Ae.ResolveParser,test:Qh.test,parse:r=>{var e;return{resolution:parseFloat(((e=Re.RETINA_PREFIX.exec(r))==null?void 0:e[1])??"1"),format:ci.extname(r).slice(1),src:r}}};Le.add(yM);var xi=(r=>(r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r))(xi||{});const Mh={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let Ur,Oo;function ux(){Oo={bptc:Ur.getExtension("EXT_texture_compression_bptc"),astc:Ur.getExtension("WEBGL_compressed_texture_astc"),etc:Ur.getExtension("WEBGL_compressed_texture_etc"),s3tc:Ur.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Ur.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:Ur.getExtension("WEBGL_compressed_texture_pvrtc")||Ur.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:Ur.getExtension("WEBGL_compressed_texture_etc1"),atc:Ur.getExtension("WEBGL_compressed_texture_atc")}}const vM={extension:{type:Ae.DetectionParser,priority:2},test:async()=>{const r=Re.ADAPTER.createCanvas().getContext("webgl");return r?(Ur=r,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async r=>{Oo||ux();const e=[];for(const t in Oo)Oo[t]&&e.push(t);return[...e,...r]},remove:async r=>(Oo||ux(),r.filter(e=>!(e in Oo)))};Le.add(vM);class _M extends Xh{constructor(e,t={width:1,height:1,autoLoad:!0}){let i,n;typeof e=="string"?(i=e,n=new Uint8Array):(i=null,n=e),super(n,t),this.origin=i,this.buffer=n?new up(n):null,this._load=null,this.loaded=!1,this.origin!==null&&t.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new up(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this)),this._load)}}class ks extends _M{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=ks._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||ks._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,i){const n=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;n.pixelStorei(n.UNPACK_ALIGNMENT,4);for(let s=0,o=this.levels;s<o;s++){const{levelID:l,levelWidth:u,levelHeight:c,levelBuffer:d}=this._levelBuffers[s];n.compressedTexImage2D(n.TEXTURE_2D,l,this.format,u,c,0,d)}return!0}onBlobLoaded(){this._levelBuffers=ks._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=35916&&e<=35919)return"s3tc_sRGB";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e===36196)return"etc1";if(e===35986||e===35987||e===34798)return"atc";if(e>=36492&&e<=36495)return"bptc";if(e===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${e}`)}static _createLevelBuffers(e,t,i,n,s,o,l){const u=new Array(i);let c=e.byteOffset,d=o,p=l,m=d+n-1&~(n-1),y=p+s-1&~(s-1),v=m*y*Mh[t];for(let _=0;_<i;_++)u[_]={levelID:_,levelWidth:i>1?d:m,levelHeight:i>1?p:y,levelBuffer:new Uint8Array(e.buffer,c,v)},c+=v,d=d>>1||1,p=p>>1||1,m=d+n-1&~(n-1),y=p+s-1&~(s-1),v=m*y*Mh[t];return u}}const Nf=4,Wu=124,xM=32,hx=20,TM=542327876,Yu={HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},wM={FOURCC:2},qu={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3},EM=1,SM=2,AM=4,bM=64,CM=512,RM=131072,PM=827611204,OM=861165636,IM=894720068,MM=808540228,NM=4,DM={[PM]:xi.COMPRESSED_RGBA_S3TC_DXT1_EXT,[OM]:xi.COMPRESSED_RGBA_S3TC_DXT3_EXT,[IM]:xi.COMPRESSED_RGBA_S3TC_DXT5_EXT},LM={70:xi.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:xi.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:xi.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:xi.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:xi.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:xi.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:xi.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:xi.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:xi.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:xi.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:xi.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:xi.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:xi.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function FM(r){const e=new Uint32Array(r);if(e[0]!==TM)throw new Error("Invalid DDS file magic word");const t=new Uint32Array(r,0,Wu/Uint32Array.BYTES_PER_ELEMENT),i=t[Yu.HEIGHT],n=t[Yu.WIDTH],s=t[Yu.MIPMAP_COUNT],o=new Uint32Array(r,Yu.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,xM/Uint32Array.BYTES_PER_ELEMENT),l=o[EM];if(l&AM){const u=o[wM.FOURCC];if(u!==MM){const S=DM[u],A=Nf+Wu,P=new Uint8Array(r,A);return[new ks(P,{format:S,width:n,height:i,levels:s})]}const c=Nf+Wu,d=new Uint32Array(e.buffer,c,hx/Uint32Array.BYTES_PER_ELEMENT),p=d[qu.DXGI_FORMAT],m=d[qu.RESOURCE_DIMENSION],y=d[qu.MISC_FLAG],v=d[qu.ARRAY_SIZE],_=LM[p];if(_===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${p}`);if(y===NM)throw new Error("DDSParser does not support cubemap textures");if(m===6)throw new Error("DDSParser does not supported 3D texture data");const T=new Array,E=Nf+Wu+hx;if(v===1)T.push(new Uint8Array(r,E));else{const S=Mh[_];let A=0,P=n,D=i;for(let U=0;U<s;U++){const j=Math.max(1,P+3&-4),q=Math.max(1,D+3&-4),ee=j*q*S;A+=ee,P=P>>>1,D=D>>>1}let k=E;for(let U=0;U<v;U++)T.push(new Uint8Array(r,k,A)),k+=A}return T.map(S=>new ks(S,{format:_,width:n,height:i,levels:s}))}throw l&bM?new Error("DDSParser does not support uncompressed texture data."):l&CM?new Error("DDSParser does not supported YUV uncompressed texture data."):l&RM?new Error("DDSParser does not support single-channel (lumninance) texture data!"):l&SM?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const cx=[171,75,84,88,32,49,49,187,13,10,26,10],BM=67305985,gr={ENDIANNESS:12,GL_TYPE:16,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Dp=64,dx={[ke.UNSIGNED_BYTE]:1,[ke.UNSIGNED_SHORT]:2,[ke.INT]:4,[ke.UNSIGNED_INT]:4,[ke.FLOAT]:4,[ke.HALF_FLOAT]:8},kM={[xe.RGBA]:4,[xe.RGB]:3,[xe.RG]:2,[xe.RED]:1,[xe.LUMINANCE]:1,[xe.LUMINANCE_ALPHA]:2,[xe.ALPHA]:1},UM={[ke.UNSIGNED_SHORT_4_4_4_4]:2,[ke.UNSIGNED_SHORT_5_5_5_1]:2,[ke.UNSIGNED_SHORT_5_6_5]:2};function HM(r,e,t=!1){const i=new DataView(e);if(!zM(r,i))return null;const n=i.getUint32(gr.ENDIANNESS,!0)===BM,s=i.getUint32(gr.GL_TYPE,n),o=i.getUint32(gr.GL_FORMAT,n),l=i.getUint32(gr.GL_INTERNAL_FORMAT,n),u=i.getUint32(gr.PIXEL_WIDTH,n),c=i.getUint32(gr.PIXEL_HEIGHT,n)||1,d=i.getUint32(gr.PIXEL_DEPTH,n)||1,p=i.getUint32(gr.NUMBER_OF_ARRAY_ELEMENTS,n)||1,m=i.getUint32(gr.NUMBER_OF_FACES,n),y=i.getUint32(gr.NUMBER_OF_MIPMAP_LEVELS,n),v=i.getUint32(gr.BYTES_OF_KEY_VALUE_DATA,n);if(c===0||d!==1)throw new Error("Only 2D textures are supported");if(m!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(p!==1)throw new Error("WebGL does not support array textures");const _=4,T=4,E=u+3&-4,S=c+3&-4,A=new Array(p);let P=u*c;s===0&&(P=E*S);let D;if(s!==0?dx[s]?D=dx[s]*kM[o]:D=UM[s]:D=Mh[l],D===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const k=t?VM(i,v,n):null;let U=P*D,j=u,q=c,ee=E,pe=S,H=Dp+v;for(let F=0;F<y;F++){const G=i.getUint32(H,n);let $=H+4;for(let le=0;le<p;le++){let ie=A[le];ie||(ie=A[le]=new Array(y)),ie[F]={levelID:F,levelWidth:y>1||s!==0?j:ee,levelHeight:y>1||s!==0?q:pe,levelBuffer:new Uint8Array(e,$,U)},$+=U}H+=G+4,H=H%4!==0?H+4-H%4:H,j=j>>1||1,q=q>>1||1,ee=j+_-1&-4,pe=q+T-1&-4,U=ee*pe*D}return s!==0?{uncompressed:A.map(F=>{let G=F[0].levelBuffer,$=!1;return s===ke.FLOAT?G=new Float32Array(F[0].levelBuffer.buffer,F[0].levelBuffer.byteOffset,F[0].levelBuffer.byteLength/4):s===ke.UNSIGNED_INT?($=!0,G=new Uint32Array(F[0].levelBuffer.buffer,F[0].levelBuffer.byteOffset,F[0].levelBuffer.byteLength/4)):s===ke.INT&&($=!0,G=new Int32Array(F[0].levelBuffer.buffer,F[0].levelBuffer.byteOffset,F[0].levelBuffer.byteLength/4)),{resource:new Xh(G,{width:F[0].levelWidth,height:F[0].levelHeight}),type:s,format:$?GM(o):o}}),kvData:k}:{compressed:A.map(F=>new ks(null,{format:l,width:u,height:c,levels:y,levelBuffers:F})),kvData:k}}function zM(r,e){for(let t=0;t<cx.length;t++)if(e.getUint8(t)!==cx[t])return console.error(`${r} is not a valid *.ktx file!`),!1;return!0}function GM(r){switch(r){case xe.RGBA:return xe.RGBA_INTEGER;case xe.RGB:return xe.RGB_INTEGER;case xe.RG:return xe.RG_INTEGER;case xe.RED:return xe.RED_INTEGER;default:return r}}function VM(r,e,t){const i=new Map;let n=0;for(;n<e;){const s=r.getUint32(Dp+n,t),o=Dp+n+4,l=3-(s+3)%4;if(s===0||s>e-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let u=0;for(;u<s&&r.getUint8(o+u)!==0;u++);if(u===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const c=new TextDecoder().decode(new Uint8Array(r.buffer,o,u)),d=new DataView(r.buffer,o+u+1,s-u-1);i.set(c,d),n+=4+s+l}return i}const jM={extension:{type:Ae.LoadParser,priority:Rr.High},name:"loadDDS",test(r){return ss(r,".dds")},async load(r,e,t){const i=await(await Re.ADAPTER.fetch(r)).arrayBuffer(),n=FM(i).map(s=>{const o=new Ze(s,{mipmap:Qr.OFF,alphaMode:Bi.NO_PREMULTIPLIED_ALPHA,resolution:vn(r),...e.data});return yl(o,t,r)});return n.length===1?n[0]:n},unload(r){Array.isArray(r)?r.forEach(e=>e.destroy(!0)):r.destroy(!0)}};Le.add(jM);const XM={extension:{type:Ae.LoadParser,priority:Rr.High},name:"loadKTX",test(r){return ss(r,".ktx")},async load(r,e,t){const i=await(await Re.ADAPTER.fetch(r)).arrayBuffer(),{compressed:n,uncompressed:s,kvData:o}=HM(r,i),l=n??s,u={mipmap:Qr.OFF,alphaMode:Bi.NO_PREMULTIPLIED_ALPHA,resolution:vn(r),...e.data},c=l.map(d=>{l===s&&Object.assign(u,{type:d.type,format:d.format});const p=d.resource??d,m=new Ze(p,u);return m.ktxKeyValueData=o,yl(m,t,r)});return c.length===1?c[0]:c},unload(r){Array.isArray(r)?r.forEach(e=>e.destroy(!0)):r.destroy(!0)}};Le.add(XM);const WM=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],YM={extension:Ae.ResolveParser,test:r=>{const e=ci.extname(r).slice(1);return["basis","ktx","dds"].includes(e)},parse:r=>{var e,t;const i=r.split("."),n=i.pop();if(["ktx","dds"].includes(n)){const s=i.pop();if(WM.includes(s))return{resolution:parseFloat(((e=Re.RETINA_PREFIX.exec(r))==null?void 0:e[1])??"1"),format:s,src:r}}return{resolution:parseFloat(((t=Re.RETINA_PREFIX.exec(r))==null?void 0:t[1])??"1"),format:n,src:r}}};Le.add(YM);const Zu=new Qe,qM=4,YT=class Ya{constructor(e){this.renderer=e,this._rendererPremultipliedAlpha=!1}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(e,t,i,n){const s=new Image;return s.src=await this.base64(e,t,i,n),s}async base64(e,t,i,n){const s=this.canvas(e,n);if(s.toBlob!==void 0)return new Promise((o,l)=>{s.toBlob(u=>{if(!u){l(new Error("ICanvas.toBlob failed!"));return}const c=new FileReader;c.onload=()=>o(c.result),c.onerror=l,c.readAsDataURL(u)},t,i)});if(s.toDataURL!==void 0)return s.toDataURL(t,i);if(s.convertToBlob!==void 0){const o=await s.convertToBlob({type:t,quality:i});return new Promise((l,u)=>{const c=new FileReader;c.onload=()=>l(c.result),c.onerror=u,c.readAsDataURL(o)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,t){const{pixels:i,width:n,height:s,flipY:o,premultipliedAlpha:l}=this._rawPixels(e,t);o&&Ya._flipY(i,n,s),l&&Ya._unpremultiplyAlpha(i);const u=new RP(n,s,1),c=new ImageData(new Uint8ClampedArray(i.buffer),n,s);return u.context.putImageData(c,0,0),u.canvas}pixels(e,t){const{pixels:i,width:n,height:s,flipY:o,premultipliedAlpha:l}=this._rawPixels(e,t);return o&&Ya._flipY(i,n,s),l&&Ya._unpremultiplyAlpha(i),i}_rawPixels(e,t){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let n,s=!1,o=!1,l,u=!1;e&&(e instanceof Ws?l=e:(l=i.generateTexture(e,{region:t,resolution:i.resolution,multisample:i.multisample}),u=!0,t&&(Zu.width=t.width,Zu.height=t.height,t=Zu)));const c=i.gl;if(l){if(n=l.baseTexture.resolution,t=t??l.frame,s=!1,o=l.baseTexture.alphaMode>0&&l.baseTexture.format===xe.RGBA,!u){i.renderTexture.bind(l);const y=l.framebuffer.glFramebuffers[i.CONTEXT_UID];y.blitFramebuffer&&i.framebuffer.bind(y.blitFramebuffer)}}else n=i.resolution,t||(t=Zu,t.width=i.width/n,t.height=i.height/n),s=!0,o=this._rendererPremultipliedAlpha,i.renderTexture.bind();const d=Math.max(Math.round(t.width*n),1),p=Math.max(Math.round(t.height*n),1),m=new Uint8Array(qM*d*p);return c.readPixels(Math.round(t.x*n),Math.round(t.y*n),d,p,c.RGBA,c.UNSIGNED_BYTE,m),u&&(l==null||l.destroy(!0)),{pixels:m,width:d,height:p,flipY:s,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(e,t,i){const n=t<<2,s=i>>1,o=new Uint8Array(n);for(let l=0;l<s;l++){const u=l*n,c=(i-l-1)*n;o.set(e.subarray(u,u+n)),e.copyWithin(u,c,c+n),e.set(o,c)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let i=0;i<t;i+=4){const n=e[i+3];if(n!==0){const s=255.001/n;e[i]=e[i]*s+.5,e[i+1]=e[i+1]*s+.5,e[i+2]=e[i+2]*s+.5}}}};YT.extension={name:"extract",type:Ae.RendererSystem};let ZM=YT;Le.add(ZM);const Nh={build(r){const e=r.points;let t,i,n,s,o,l;if(r.type===Ti.CIRC){const v=r.shape;t=v.x,i=v.y,o=l=v.radius,n=s=0}else if(r.type===Ti.ELIP){const v=r.shape;t=v.x,i=v.y,o=v.width,l=v.height,n=s=0}else{const v=r.shape,_=v.width/2,T=v.height/2;t=v.x+_,i=v.y+T,o=l=Math.max(0,Math.min(v.radius,Math.min(_,T))),n=_-o,s=T-l}if(!(o>=0&&l>=0&&n>=0&&s>=0)){e.length=0;return}const u=Math.ceil(2.3*Math.sqrt(o+l)),c=u*8+(n?4:0)+(s?4:0);if(e.length=c,c===0)return;if(u===0){e.length=8,e[0]=e[6]=t+n,e[1]=e[3]=i+s,e[2]=e[4]=t-n,e[5]=e[7]=i-s;return}let d=0,p=u*4+(n?2:0)+2,m=p,y=c;{const v=n+o,_=s,T=t+v,E=t-v,S=i+_;if(e[d++]=T,e[d++]=S,e[--p]=S,e[--p]=E,s){const A=i-_;e[m++]=E,e[m++]=A,e[--y]=A,e[--y]=T}}for(let v=1;v<u;v++){const _=Math.PI/2*(v/u),T=n+Math.cos(_)*o,E=s+Math.sin(_)*l,S=t+T,A=t-T,P=i+E,D=i-E;e[d++]=S,e[d++]=P,e[--p]=P,e[--p]=A,e[m++]=A,e[m++]=D,e[--y]=D,e[--y]=S}{const v=n,_=s+l,T=t+v,E=t-v,S=i+_,A=i-_;e[d++]=T,e[d++]=S,e[--y]=A,e[--y]=T,n&&(e[d++]=E,e[d++]=S,e[--y]=A,e[--y]=E)}},triangulate(r,e){const t=r.points,i=e.points,n=e.indices;if(t.length===0)return;let s=i.length/2;const o=s;let l,u;if(r.type!==Ti.RREC){const d=r.shape;l=d.x,u=d.y}else{const d=r.shape;l=d.x+d.width/2,u=d.y+d.height/2}const c=r.matrix;i.push(r.matrix?c.a*l+c.c*u+c.tx:l,r.matrix?c.b*l+c.d*u+c.ty:u),s++,i.push(t[0],t[1]);for(let d=2;d<t.length;d+=2)i.push(t[d],t[d+1]),n.push(s++,o,s);n.push(o+1,o,s)}};function fx(r,e=!1){const t=r.length;if(t<6)return;let i=0;for(let n=0,s=r[t-2],o=r[t-1];n<t;n+=2){const l=r[n],u=r[n+1];i+=(l-s)*(u+o),s=l,o=u}if(!e&&i>0||e&&i<=0){const n=t/2;for(let s=n+n%2;s<t;s+=2){const o=t-s-2,l=t-s-1,u=s,c=s+1;[r[o],r[u]]=[r[u],r[o]],[r[l],r[c]]=[r[c],r[l]]}}}const qT={build(r){r.points=r.shape.points.slice()},triangulate(r,e){let t=r.points;const i=r.holes,n=e.points,s=e.indices;if(t.length>=6){fx(t,!1);const o=[];for(let c=0;c<i.length;c++){const d=i[c];fx(d.points,!0),o.push(t.length/2),t=t.concat(d.points)}const l=HC(t,o,2);if(!l)return;const u=n.length/2;for(let c=0;c<l.length;c+=3)s.push(l[c]+u),s.push(l[c+1]+u),s.push(l[c+2]+u);for(let c=0;c<t.length;c++)n.push(t[c])}}},QM={build(r){const e=r.shape,t=e.x,i=e.y,n=e.width,s=e.height,o=r.points;o.length=0,n>=0&&s>=0&&o.push(t,i,t+n,i,t+n,i+s,t,i+s)},triangulate(r,e){const t=r.points,i=e.points;if(t.length===0)return;const n=i.length/2;i.push(t[0],t[1],t[2],t[3],t[6],t[7],t[4],t[5]),e.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},KM={build(r){Nh.build(r)},triangulate(r,e){Nh.triangulate(r,e)}};var tr=(r=>(r.MITER="miter",r.BEVEL="bevel",r.ROUND="round",r))(tr||{}),Kn=(r=>(r.BUTT="butt",r.ROUND="round",r.SQUARE="square",r))(Kn||{});const qo={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(r,e=20){if(!this.adaptive||!r||isNaN(r))return e;let t=Math.ceil(r/this.maxLength);return t<this.minSegments?t=this.minSegments:t>this.maxSegments&&(t=this.maxSegments),t}};class px{static curveTo(e,t,i,n,s,o){const l=o[o.length-2],u=o[o.length-1]-t,c=l-e,d=n-t,p=i-e,m=Math.abs(u*p-c*d);if(m<1e-8||s===0)return(o[o.length-2]!==e||o[o.length-1]!==t)&&o.push(e,t),null;const y=u*u+c*c,v=d*d+p*p,_=u*d+c*p,T=s*Math.sqrt(y)/m,E=s*Math.sqrt(v)/m,S=T*_/y,A=E*_/v,P=T*p+E*c,D=T*d+E*u,k=c*(E+S),U=u*(E+S),j=p*(T+A),q=d*(T+A),ee=Math.atan2(U-D,k-P),pe=Math.atan2(q-D,j-P);return{cx:P+e,cy:D+t,radius:s,startAngle:ee,endAngle:pe,anticlockwise:c*d>p*u}}static arc(e,t,i,n,s,o,l,u,c){const d=l-o,p=qo._segmentsCount(Math.abs(d)*s,Math.ceil(Math.abs(d)/Sh)*40),m=d/(p*2),y=m*2,v=Math.cos(m),_=Math.sin(m),T=p-1,E=T%1/T;for(let S=0;S<=T;++S){const A=S+E*S,P=m+o+y*A,D=Math.cos(P),k=-Math.sin(P);c.push((v*D+_*k)*s+i,(v*-k+_*D)*s+n)}}}class JM{constructor(){this.reset()}begin(e,t,i){this.reset(),this.style=e,this.start=t,this.attribStart=i}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class gm{static curveLength(e,t,i,n,s,o,l,u){let c=0,d=0,p=0,m=0,y=0,v=0,_=0,T=0,E=0,S=0,A=0,P=e,D=t;for(let k=1;k<=10;++k)d=k/10,p=d*d,m=p*d,y=1-d,v=y*y,_=v*y,T=_*e+3*v*d*i+3*y*p*s+m*l,E=_*t+3*v*d*n+3*y*p*o+m*u,S=P-T,A=D-E,P=T,D=E,c+=Math.sqrt(S*S+A*A);return c}static curveTo(e,t,i,n,s,o,l){const u=l[l.length-2],c=l[l.length-1];l.length-=2;const d=qo._segmentsCount(gm.curveLength(u,c,e,t,i,n,s,o));let p=0,m=0,y=0,v=0,_=0;l.push(u,c);for(let T=1,E=0;T<=d;++T)E=T/d,p=1-E,m=p*p,y=m*p,v=E*E,_=v*E,l.push(y*u+3*m*E*e+3*p*v*i+_*s,y*c+3*m*E*t+3*p*v*n+_*o)}}function mx(r,e,t,i,n,s,o,l){const u=r-t*n,c=e-i*n,d=r+t*s,p=e+i*s;let m,y;o?(m=i,y=-t):(m=-i,y=t);const v=u+m,_=c+y,T=d+m,E=p+y;return l.push(v,_,T,E),2}function Es(r,e,t,i,n,s,o,l){const u=t-r,c=i-e;let d=Math.atan2(u,c),p=Math.atan2(n-r,s-e);l&&d<p?d+=Math.PI*2:!l&&d>p&&(p+=Math.PI*2);let m=d;const y=p-d,v=Math.abs(y),_=Math.sqrt(u*u+c*c),T=(15*v*Math.sqrt(_)/Math.PI>>0)+1,E=y/T;if(m+=E,l){o.push(r,e,t,i);for(let S=1,A=m;S<T;S++,A+=E)o.push(r,e,r+Math.sin(A)*_,e+Math.cos(A)*_);o.push(r,e,n,s)}else{o.push(t,i,r,e);for(let S=1,A=m;S<T;S++,A+=E)o.push(r+Math.sin(A)*_,e+Math.cos(A)*_,r,e);o.push(n,s,r,e)}return T*2}function $M(r,e){const t=r.shape;let i=r.points||t.points.slice();const n=e.closePointEps;if(i.length===0)return;const s=r.lineStyle,o=new ot(i[0],i[1]),l=new ot(i[i.length-2],i[i.length-1]),u=t.type!==Ti.POLY||t.closeStroke,c=Math.abs(o.x-l.x)<n&&Math.abs(o.y-l.y)<n;if(u){i=i.slice(),c&&(i.pop(),i.pop(),l.set(i[i.length-2],i[i.length-1]));const ie=(o.x+l.x)*.5,Y=(l.y+o.y)*.5;i.unshift(ie,Y),i.push(ie,Y)}const d=e.points,p=i.length/2;let m=i.length;const y=d.length/2,v=s.width/2,_=v*v,T=s.miterLimit*s.miterLimit;let E=i[0],S=i[1],A=i[2],P=i[3],D=0,k=0,U=-(S-P),j=E-A,q=0,ee=0,pe=Math.sqrt(U*U+j*j);U/=pe,j/=pe,U*=v,j*=v;const H=s.alignment,F=(1-H)*2,G=H*2;u||(s.cap===Kn.ROUND?m+=Es(E-U*(F-G)*.5,S-j*(F-G)*.5,E-U*F,S-j*F,E+U*G,S+j*G,d,!0)+2:s.cap===Kn.SQUARE&&(m+=mx(E,S,U,j,F,G,!0,d))),d.push(E-U*F,S-j*F,E+U*G,S+j*G);for(let ie=1;ie<p-1;++ie){E=i[(ie-1)*2],S=i[(ie-1)*2+1],A=i[ie*2],P=i[ie*2+1],D=i[(ie+1)*2],k=i[(ie+1)*2+1],U=-(S-P),j=E-A,pe=Math.sqrt(U*U+j*j),U/=pe,j/=pe,U*=v,j*=v,q=-(P-k),ee=A-D,pe=Math.sqrt(q*q+ee*ee),q/=pe,ee/=pe,q*=v,ee*=v;const Y=A-E,de=S-P,z=A-D,N=k-P,W=Y*z+de*N,re=de*z-N*Y,_e=re<0;if(Math.abs(re)<.001*Math.abs(W)){d.push(A-U*F,P-j*F,A+U*G,P+j*G),W>=0&&(s.join===tr.ROUND?m+=Es(A,P,A-U*F,P-j*F,A-q*F,P-ee*F,d,!1)+4:m+=2,d.push(A-q*G,P-ee*G,A+q*F,P+ee*F));continue}const me=(-U+E)*(-j+P)-(-U+A)*(-j+S),Pe=(-q+D)*(-ee+P)-(-q+A)*(-ee+k),Ue=(Y*Pe-z*me)/re,Te=(N*me-de*Pe)/re,ge=(Ue-A)*(Ue-A)+(Te-P)*(Te-P),Ke=A+(Ue-A)*F,Je=P+(Te-P)*F,ht=A-(Ue-A)*G,st=P-(Te-P)*G,ti=Math.min(Y*Y+de*de,z*z+N*N),Zt=_e?F:G,bi=ti+Zt*Zt*_,b=ge<=bi;let M=s.join;if(M===tr.MITER&&ge/_>T&&(M=tr.BEVEL),b)switch(M){case tr.MITER:{d.push(Ke,Je,ht,st);break}case tr.BEVEL:{_e?d.push(Ke,Je,A+U*G,P+j*G,Ke,Je,A+q*G,P+ee*G):d.push(A-U*F,P-j*F,ht,st,A-q*F,P-ee*F,ht,st),m+=2;break}case tr.ROUND:{_e?(d.push(Ke,Je,A+U*G,P+j*G),m+=Es(A,P,A+U*G,P+j*G,A+q*G,P+ee*G,d,!0)+4,d.push(Ke,Je,A+q*G,P+ee*G)):(d.push(A-U*F,P-j*F,ht,st),m+=Es(A,P,A-U*F,P-j*F,A-q*F,P-ee*F,d,!1)+4,d.push(A-q*F,P-ee*F,ht,st));break}}else{switch(d.push(A-U*F,P-j*F,A+U*G,P+j*G),M){case tr.MITER:{_e?d.push(ht,st,ht,st):d.push(Ke,Je,Ke,Je),m+=2;break}case tr.ROUND:{_e?m+=Es(A,P,A+U*G,P+j*G,A+q*G,P+ee*G,d,!0)+2:m+=Es(A,P,A-U*F,P-j*F,A-q*F,P-ee*F,d,!1)+2;break}}d.push(A-q*F,P-ee*F,A+q*G,P+ee*G),m+=2}}E=i[(p-2)*2],S=i[(p-2)*2+1],A=i[(p-1)*2],P=i[(p-1)*2+1],U=-(S-P),j=E-A,pe=Math.sqrt(U*U+j*j),U/=pe,j/=pe,U*=v,j*=v,d.push(A-U*F,P-j*F,A+U*G,P+j*G),u||(s.cap===Kn.ROUND?m+=Es(A-U*(F-G)*.5,P-j*(F-G)*.5,A-U*F,P-j*F,A+U*G,P+j*G,d,!1)+2:s.cap===Kn.SQUARE&&(m+=mx(A,P,U,j,F,G,!1,d)));const $=e.indices,le=qo.epsilon*qo.epsilon;for(let ie=y;ie<m+y-2;++ie)E=d[ie*2],S=d[ie*2+1],A=d[(ie+1)*2],P=d[(ie+1)*2+1],D=d[(ie+2)*2],k=d[(ie+2)*2+1],!(Math.abs(E*(P-k)+A*(k-S)+D*(S-P))<le)&&$.push(ie,ie+1,ie+2)}function e2(r,e){let t=0;const i=r.shape,n=r.points||i.points,s=i.type!==Ti.POLY||i.closeStroke;if(n.length===0)return;const o=e.points,l=e.indices,u=n.length/2,c=o.length/2;let d=c;for(o.push(n[0],n[1]),t=1;t<u;t++)o.push(n[t*2],n[t*2+1]),l.push(d,d+1),d++;s&&l.push(d,c)}function gx(r,e){r.lineStyle.native?e2(r,e):$M(r,e)}class ym{static curveLength(e,t,i,n,s,o){const l=e-2*i+s,u=t-2*n+o,c=2*i-2*e,d=2*n-2*t,p=4*(l*l+u*u),m=4*(l*c+u*d),y=c*c+d*d,v=2*Math.sqrt(p+m+y),_=Math.sqrt(p),T=2*p*_,E=2*Math.sqrt(y),S=m/_;return(T*v+_*m*(v-E)+(4*y*p-m*m)*Math.log((2*_+S+v)/(S+E)))/(4*T)}static curveTo(e,t,i,n,s){const o=s[s.length-2],l=s[s.length-1],u=qo._segmentsCount(ym.curveLength(o,l,e,t,i,n));let c=0,d=0;for(let p=1;p<=u;++p){const m=p/u;c=o+(e-o)*m,d=l+(t-l)*m,s.push(c+(e+(i-e)*m-c)*m,d+(t+(n-t)*m-d)*m)}}}const Df={[Ti.POLY]:qT,[Ti.CIRC]:Nh,[Ti.ELIP]:Nh,[Ti.RECT]:QM,[Ti.RREC]:KM},yx=[],Qu=[];class Dh{constructor(e,t=null,i=null,n=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=i,this.fillStyle=t,this.matrix=n,this.type=e.type}clone(){return new Dh(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const wo=new ot,ZT=class QT extends eT{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Ph,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Qu.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),yx.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,i=null,n=null){const s=new Dh(e,t,i,n);return this.graphicsData.push(s),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const i=new Dh(e,null,null,t),n=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=n.lineStyle,n.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let i=0;i<t.length;++i){const n=t[i];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(e,wo):wo.copyFrom(e),n.shape.contains(wo.x,wo.y))){let s=!1;if(n.holes){for(let o=0;o<n.holes.length;o++)if(n.holes[o].shape.contains(wo.x,wo.y)){s=!0;break}}if(!s)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let i=null,n=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],n=i.style);for(let u=this.shapeIndex;u<t.length;u++){this.shapeIndex++;const c=t[u],d=c.fillStyle,p=c.lineStyle;Df[c.type].build(c),c.matrix&&this.transformPoints(c.points,c.matrix),(d.visible||p.visible)&&this.processHoles(c.holes);for(let m=0;m<2;m++){const y=m===0?d:p;if(!y.visible)continue;const v=y.texture.baseTexture,_=this.indices.length,T=this.points.length/2;v.wrapMode=Jn.REPEAT,m===0?this.processFill(c):this.processLine(c);const E=this.points.length/2-T;E!==0&&(i&&!this._compareStyles(n,y)&&(i.end(_,T),i=null),i||(i=yx.pop()||new JM,i.begin(y,_,T),this.batches.push(i),n=y),this.addUvs(this.points,e,y.texture,T,E,y.matrix))}}const s=this.indices.length,o=this.points.length/2;if(i&&i.end(s,o),this.batches.length===0){this.batchable=!0;return}const l=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&l===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=l?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const i=this.graphicsData[e],n=i.fillStyle,s=i.lineStyle;if(n&&!n.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,i=e.length;t<i;t++){const n=e[t];for(let s=0;s<n.size;s++){const o=n.start+s;this.indicesUint16[o]=this.indicesUint16[o]-n.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<QT.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++Ze._globalBatch;for(let p=0;p<this.drawCalls.length;p++)this.drawCalls[p].texArray.clear(),Qu.push(this.drawCalls[p]);this.drawCalls.length=0;const t=this.colors,i=this.textureIds;let n=Qu.pop();n||(n=new dp,n.texArray=new gp),n.texArray.count=0,n.start=0,n.size=0,n.type=Xr.TRIANGLES;let s=0,o=null,l=0,u=!1,c=Xr.TRIANGLES,d=0;this.drawCalls.push(n);for(let p=0;p<this.batches.length;p++){const m=this.batches[p],y=8,v=m.style,_=v.texture.baseTexture;u!==!!v.native&&(u=!!v.native,c=u?Xr.LINES:Xr.TRIANGLES,o=null,s=y,e++),o!==_&&(o=_,_._batchEnabled!==e&&(s===y&&(e++,s=0,n.size>0&&(n=Qu.pop(),n||(n=new dp,n.texArray=new gp),this.drawCalls.push(n)),n.start=d,n.size=0,n.texArray.count=0,n.type=c),_.touched=1,_._batchEnabled=e,_._batchLocation=s,_.wrapMode=Jn.REPEAT,n.texArray.elements[n.texArray.count++]=_,s++)),n.size+=m.size,d+=m.size,l=_._batchLocation,this.addColors(t,v.color,v.alpha,m.attribSize,m.attribStart),this.addTextureIds(i,l,m.attribSize,m.attribStart)}Ze._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,i=this.colors,n=this.textureIds,s=new ArrayBuffer(e.length*3*4),o=new Float32Array(s),l=new Uint32Array(s);let u=0;for(let c=0;c<e.length/2;c++)o[u++]=e[c*2],o[u++]=e[c*2+1],o[u++]=t[c*2],o[u++]=t[c*2+1],l[u++]=i[c],o[u++]=n[c];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?qT.triangulate(e,this):Df[e.type].triangulate(e,this)}processLine(e){gx(e,this);for(let t=0;t<e.holes.length;t++)gx(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const i=e[t];Df[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let i=0;i<e.length/2;i++){const n=e[i*2],s=e[i*2+1];e[i*2]=t.a*n+t.c*s+t.tx,e[i*2+1]=t.b*n+t.d*s+t.ty}}addColors(e,t,i,n,s=0){const o=pt.shared.setValue(t).toLittleEndianNumber(),l=pt.shared.setValue(o).toPremultiplied(i);e.length=Math.max(e.length,s+n);for(let u=0;u<n;u++)e[s+u]=l}addTextureIds(e,t,i,n=0){e.length=Math.max(e.length,n+i);for(let s=0;s<i;s++)e[n+s]=t}addUvs(e,t,i,n,s,o=null){let l=0;const u=t.length,c=i.frame;for(;l<s;){let p=e[(n+l)*2],m=e[(n+l)*2+1];if(o){const y=o.a*p+o.c*m+o.tx;m=o.b*p+o.d*m+o.ty,p=y}l++,t.push(p/c.width,m/c.height)}const d=i.baseTexture;(c.width<d.width||c.height<d.height)&&this.adjustUvs(t,i,u,s)}adjustUvs(e,t,i,n){const s=t.baseTexture,o=1e-6,l=i+n*2,u=t.frame,c=u.width/s.width,d=u.height/s.height;let p=u.x/u.width,m=u.y/u.height,y=Math.floor(e[i]+o),v=Math.floor(e[i+1]+o);for(let _=i+2;_<l;_+=2)y=Math.min(y,Math.floor(e[_]+o)),v=Math.min(v,Math.floor(e[_+1]+o));p-=y,m-=v;for(let _=i;_<l;_+=2)e[_]=(e[_]+p)*c,e[_+1]=(e[_+1]+m)*d}};ZT.BATCHABLE_SIZE=100;let t2=ZT;class Kh{constructor(){this.color=16777215,this.alpha=1,this.texture=De.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new Kh;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=De.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class vm extends Kh{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Kn.BUTT,this.join=tr.MITER,this.miterLimit=10}clone(){const e=new vm;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Kn.BUTT,this.join=tr.MITER,this.miterLimit=10}}const Lf={},Lp=class dh extends Er{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Kh,this._lineStyle=new vm,this._matrix=null,this._holeMode=!1,this.state=Jr.for2d(),this._geometry=e||new t2,this._geometry.refCount++,this._transformID=-1,this._tintColor=new pt(16777215),this.blendMode=je.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new dh(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,i,n=.5,s=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:i,alignment:n,native:s}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:De.WHITE,color:e!=null&&e.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Kn.BUTT,join:tr.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const i=e.width>0&&e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:i},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Bs,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new Bs,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,n=i[i.length-2],s=i[i.length-1];return(n!==e||s!==t)&&i.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,i,n){this._initCurve();const s=this.currentPath.points;return s.length===0&&this.moveTo(0,0),ym.curveTo(e,t,i,n,s),this}bezierCurveTo(e,t,i,n,s,o){return this._initCurve(),gm.curveTo(e,t,i,n,s,o,this.currentPath.points),this}arcTo(e,t,i,n,s){this._initCurve(e,t);const o=this.currentPath.points,l=px.curveTo(e,t,i,n,s,o);if(l){const{cx:u,cy:c,radius:d,startAngle:p,endAngle:m,anticlockwise:y}=l;this.arc(u,c,d,p,m,y)}return this}arc(e,t,i,n,s,o=!1){if(n===s)return this;if(!o&&s<=n?s+=Sh:o&&n<=s&&(n+=Sh),s-n===0)return this;const l=e+Math.cos(n)*i,u=t+Math.sin(n)*i,c=this._geometry.closePointEps;let d=this.currentPath?this.currentPath.points:null;if(d){const p=Math.abs(d[d.length-2]-l),m=Math.abs(d[d.length-1]-u);p<c&&m<c||d.push(l,u)}else this.moveTo(l,u),d=this.currentPath.points;return px.arc(l,u,e,t,i,n,s,o,d),this}beginFill(e=0,t){return this.beginTextureFill({texture:De.WHITE,color:e,alpha:t})}normalizeColor(e){const t=pt.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:De.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const i=e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:i},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,i,n){return this.drawShape(new Qe(e,t,i,n))}drawRoundedRect(e,t,i,n,s){return this.drawShape(new qh(e,t,i,n,s))}drawCircle(e,t,i){return this.drawShape(new Wh(e,t,i))}drawEllipse(e,t,i,n){return this.drawShape(new Yh(e,t,i,n))}drawPolygon(...e){let t,i=!0;const n=e[0];n.points?(i=n.closeStroke,t=n.points):Array.isArray(e[0])?t=e[0]:t=e;const s=new Bs(t);return s.closeStroke=i,this.drawShape(s),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===Ti.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,i=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(e.points);for(let n=0;n<i;n++){const s=e.batches[n],o=s.style.color,l=new Float32Array(this.vertexData.buffer,s.attribStart*4*2,s.attribSize*2),u=new Float32Array(e.uvsFloat32.buffer,s.attribStart*4*2,s.attribSize*2),c=new Uint16Array(e.indicesUint16.buffer,s.start*2,s.size),d={vertexData:l,blendMode:t,indices:c,uvs:u,_batchRGB:pt.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[n]=d}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,i=this.batches.length;t<i;t++){const n=this.batches[t];n.worldAlpha=this.worldAlpha*n.alpha,e.plugins[this.pluginName].render(n)}}}_renderDirect(e){const t=this._resolveDirectShader(e),i=this._geometry,n=this.worldAlpha,s=t.uniforms,o=i.drawCalls;s.translationMatrix=this.transform.worldTransform,pt.shared.setValue(this._tintColor).premultiply(n).toArray(s.tint),e.shader.bind(t),e.geometry.bind(i,t),e.state.set(this.state);for(let l=0,u=o.length;l<u;l++)this._renderDrawCallDirect(e,i.drawCalls[l])}_renderDrawCallDirect(e,t){const{texArray:i,type:n,size:s,start:o}=t,l=i.count;for(let u=0;u<l;u++)e.texture.bind(i.elements[u],u);e.geometry.draw(n,s,o)}_resolveDirectShader(e){let t=this.shader;const i=this.pluginName;if(!t){if(!Lf[i]){const{maxTextures:n}=e.plugins[i],s=new Int32Array(n);for(let u=0;u<n;u++)s[u]=u;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new xt,default:wr.from({uSamplers:s},!0)},l=e.plugins[i]._shader.program;Lf[i]=new Zr(l,o)}t=Lf[i]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:i,maxX:n,maxY:s}=e.bounds;this._bounds.addFrame(this.transform,t,i,n,s)}containsPoint(e){return this.worldTransform.applyInverse(e,dh._TEMP_POINT),this._geometry.containsPoint(dh._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=pt.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,i=t.a,n=t.b,s=t.c,o=t.d,l=t.tx,u=t.ty,c=this._geometry.points,d=this.vertexData;let p=0;for(let m=0;m<c.length;m+=2){const y=c[m],v=c[m+1];d[p++]=i*y+s*v+l,d[p++]=o*v+n*y+u}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};Lp.curves=qo,Lp._TEMP_POINT=new ot;let ul=Lp;class i2{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}}const Ff=new ot,vx=new Bs,KT=class JT extends Er{constructor(e,t,i,n=Xr.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=i||Jr.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=Re.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Xr.TRIANGLES&&t.length<JT.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const n=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[n]),e.plugins[n].render(this)}calculateVertices(){const e=this.geometry.buffers[0],t=e.data,i=e._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));const n=this.transform.worldTransform,s=n.a,o=n.b,l=n.c,u=n.d,c=n.tx,d=n.ty,p=this.vertexData;for(let m=0;m<p.length/2;m++){const y=t[m*2],v=t[m*2+1];p[m*2]=s*y+l*v+c,p[m*2+1]=o*y+u*v+d}if(this._roundPixels){const m=Re.RESOLUTION;for(let y=0;y<p.length;++y)p[y]=Math.round(p[y]*m)/m}this.vertexDirty=i}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new i2(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,Ff);const t=this.geometry.getBuffer("aVertexPosition").data,i=vx.points,n=this.geometry.getIndex().data,s=n.length,o=this.drawMode===4?3:1;for(let l=0;l+2<s;l+=o){const u=n[l]*2,c=n[l+1]*2,d=n[l+2]*2;if(i[0]=t[u],i[1]=t[u+1],i[2]=t[c],i[3]=t[c+1],i[4]=t[d],i[5]=t[d+1],vx.contains(Ff.x,Ff.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};KT.BATCHABLE_SIZE=100;let _x=KT;class r2 extends ts{constructor(e,t,i){super();const n=new Ut(e),s=new Ut(t,!0),o=new Ut(i,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,ke.FLOAT).addAttribute("aTextureCoord",s,2,!1,ke.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var n2=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,s2=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class xx extends Zr{constructor(e,t){const i={uSampler:e,alpha:1,uTextureMatrix:xt.IDENTITY,uColor:new Float32Array([1,1,1,1])};t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t),t.uniforms&&Object.assign(i,t.uniforms),super(t.program||gn.from(s2,n2),i),this._colorDirty=!1,this.uvMatrix=new pT(e),this.batchable=t.program===void 0,this.pluginName=t.pluginName,this._tintColor=new pt(t.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture.alphaMode;pt.shared.setValue(this._tintColor).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Tx{constructor(e,t,i){this.geometry=new ts,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<e.length;++n){let s=e[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||ke.FLOAT,offset:s.offset},t[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let t=0;this.indexBuffer=new Ut(bP(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const l=this.dynamicProperties[o];l.offset=t,t+=l.size,this.dynamicStride+=l.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new Ut(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const l=this.staticProperties[o];l.offset=n,n+=l.size,this.staticStride+=l.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new Ut(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const l=this.dynamicProperties[o];e.addAttribute(l.attributeName,this.dynamicBuffer,0,l.type===ke.UNSIGNED_BYTE,l.type,this.dynamicStride*4,l.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const l=this.staticProperties[o];e.addAttribute(l.attributeName,this.staticBuffer,0,l.type===ke.UNSIGNED_BYTE,l.type,this.staticStride*4,l.offset*4)}}uploadDynamic(e,t,i){for(let n=0;n<this.dynamicProperties.length;n++){const s=this.dynamicProperties[n];s.uploadFunction(e,t,i,s.type===ke.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,i){for(let n=0;n<this.staticProperties.length;n++){const s=this.staticProperties[n];s.uploadFunction(e,t,i,s.type===ke.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var o2=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,a2=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class $T extends Zh{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new xt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:ke.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Zr.from(a2,o2,{}),this.state=Jr.for2d()}render(e){const t=e.children,i=e._maxSize,n=e._batchSize,s=this.renderer;let o=t.length;if(o===0)return;o>i&&!e.autoResize&&(o=i);let l=e._buffers;l||(l=e._buffers=this.generateBuffers(e));const u=t[0]._texture.baseTexture,c=u.alphaMode>0;this.state.blendMode=K0(e.blendMode,c),s.state.set(this.state);const d=s.gl,p=e.worldTransform.copyTo(this.tempMatrix);p.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=p.toArray(!0),this.shader.uniforms.uColor=pt.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,c).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=u,this.renderer.shader.bind(this.shader);let m=!1;for(let y=0,v=0;y<o;y+=n,v+=1){let _=o-y;_>n&&(_=n),v>=l.length&&l.push(this._generateOneMoreBuffer(e));const T=l[v];T.uploadDynamic(t,y,_);const E=e._bufferUpdateIDs[v]||0;m=m||T._updateID<E,m&&(T._updateID=e._updateID,T.uploadStatic(t,y,_)),s.geometry.bind(T.geometry),d.drawElements(d.TRIANGLES,_*6,d.UNSIGNED_SHORT,0)}}generateBuffers(e){const t=[],i=e._maxSize,n=e._batchSize,s=e._properties;for(let o=0;o<i;o+=n)t.push(new Tx(this.properties,s,n));return t}_generateOneMoreBuffer(e){const t=e._batchSize,i=e._properties;return new Tx(this.properties,i,t)}uploadVertices(e,t,i,n,s,o){let l=0,u=0,c=0,d=0;for(let p=0;p<i;++p){const m=e[t+p],y=m._texture,v=m.scale.x,_=m.scale.y,T=y.trim,E=y.orig;T?(u=T.x-m.anchor.x*E.width,l=u+T.width,d=T.y-m.anchor.y*E.height,c=d+T.height):(l=E.width*(1-m.anchor.x),u=E.width*-m.anchor.x,c=E.height*(1-m.anchor.y),d=E.height*-m.anchor.y),n[o]=u*v,n[o+1]=d*_,n[o+s]=l*v,n[o+s+1]=d*_,n[o+s*2]=l*v,n[o+s*2+1]=c*_,n[o+s*3]=u*v,n[o+s*3+1]=c*_,o+=s*4}}uploadPosition(e,t,i,n,s,o){for(let l=0;l<i;l++){const u=e[t+l].position;n[o]=u.x,n[o+1]=u.y,n[o+s]=u.x,n[o+s+1]=u.y,n[o+s*2]=u.x,n[o+s*2+1]=u.y,n[o+s*3]=u.x,n[o+s*3+1]=u.y,o+=s*4}}uploadRotation(e,t,i,n,s,o){for(let l=0;l<i;l++){const u=e[t+l].rotation;n[o]=u,n[o+s]=u,n[o+s*2]=u,n[o+s*3]=u,o+=s*4}}uploadUvs(e,t,i,n,s,o){for(let l=0;l<i;++l){const u=e[t+l]._texture._uvs;u?(n[o]=u.x0,n[o+1]=u.y0,n[o+s]=u.x1,n[o+s+1]=u.y1,n[o+s*2]=u.x2,n[o+s*2+1]=u.y2,n[o+s*3]=u.x3,n[o+s*3+1]=u.y3,o+=s*4):(n[o]=0,n[o+1]=0,n[o+s]=0,n[o+s+1]=0,n[o+s*2]=0,n[o+s*2+1]=0,n[o+s*3]=0,n[o+s*3+1]=0,o+=s*4)}}uploadTint(e,t,i,n,s,o){for(let l=0;l<i;++l){const u=e[t+l],c=pt.shared.setValue(u._tintRGB).toPremultiplied(u.alpha,u.texture.baseTexture.alphaMode>0);n[o]=c,n[o+s]=c,n[o+s*2]=c,n[o+s*3]=c,o+=s*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}$T.extension={name:"particle",type:Ae.RendererPlugin};Le.add($T);var Jh=(r=>(r[r.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",r[r.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",r))(Jh||{});const Ku={willReadFrequently:!0},Hr=class Be{static get experimentalLetterSpacingSupported(){let e=Be._experimentalLetterSpacingSupported;if(e!==void 0){const t=Re.ADAPTER.getCanvasRenderingContext2D().prototype;e=Be._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,i,n,s,o,l,u,c){this.text=e,this.style=t,this.width=i,this.height=n,this.lines=s,this.lineWidths=o,this.lineHeight=l,this.maxLineWidth=u,this.fontProperties=c}static measureText(e,t,i,n=Be._canvas){i=i??t.wordWrap;const s=t.toFontString(),o=Be.measureFont(s);o.fontSize===0&&(o.fontSize=t.fontSize,o.ascent=t.fontSize);const l=n.getContext("2d",Ku);l.font=s;const u=(i?Be.wordWrap(e,t,n):e).split(/(?:\r\n|\r|\n)/),c=new Array(u.length);let d=0;for(let v=0;v<u.length;v++){const _=Be._measureText(u[v],t.letterSpacing,l);c[v]=_,d=Math.max(d,_)}let p=d+t.strokeThickness;t.dropShadow&&(p+=t.dropShadowDistance);const m=t.lineHeight||o.fontSize+t.strokeThickness;let y=Math.max(m,o.fontSize+t.strokeThickness*2)+t.leading+(u.length-1)*(m+t.leading);return t.dropShadow&&(y+=t.dropShadowDistance),new Be(e,t,p,y,u,c,m+t.leading,d,o)}static _measureText(e,t,i){let n=!1;Be.experimentalLetterSpacingSupported&&(Be.experimentalLetterSpacing?(i.letterSpacing=`${t}px`,i.textLetterSpacing=`${t}px`,n=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let s=i.measureText(e).width;return s>0&&(n?s-=t:s+=(Be.graphemeSegmenter(e).length-1)*t),s}static wordWrap(e,t,i=Be._canvas){const n=i.getContext("2d",Ku);let s=0,o="",l="";const u=Object.create(null),{letterSpacing:c,whiteSpace:d}=t,p=Be.collapseSpaces(d),m=Be.collapseNewlines(d);let y=!p;const v=t.wordWrapWidth+c,_=Be.tokenize(e);for(let T=0;T<_.length;T++){let E=_[T];if(Be.isNewline(E)){if(!m){l+=Be.addLine(o),y=!p,o="",s=0;continue}E=" "}if(p){const A=Be.isBreakingSpace(E),P=Be.isBreakingSpace(o[o.length-1]);if(A&&P)continue}const S=Be.getFromCache(E,c,u,n);if(S>v)if(o!==""&&(l+=Be.addLine(o),o="",s=0),Be.canBreakWords(E,t.breakWords)){const A=Be.wordWrapSplit(E);for(let P=0;P<A.length;P++){let D=A[P],k=D,U=1;for(;A[P+U];){const q=A[P+U];if(!Be.canBreakChars(k,q,E,P,t.breakWords))D+=q;else break;k=q,U++}P+=U-1;const j=Be.getFromCache(D,c,u,n);j+s>v&&(l+=Be.addLine(o),y=!1,o="",s=0),o+=D,s+=j}}else{o.length>0&&(l+=Be.addLine(o),o="",s=0);const A=T===_.length-1;l+=Be.addLine(E,!A),y=!1,o="",s=0}else S+s>v&&(y=!1,l+=Be.addLine(o),o="",s=0),(o.length>0||!Be.isBreakingSpace(E)||y)&&(o+=E,s+=S)}return l+=Be.addLine(o,!1),l}static addLine(e,t=!0){return e=Be.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,i,n){let s=i[e];return typeof s!="number"&&(s=Be._measureText(e,t,n)+t,i[e]=s),s}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const i=e[t];if(!Be.isBreakingSpace(i))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:Be._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:Be._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let i="";if(typeof e!="string")return t;for(let n=0;n<e.length;n++){const s=e[n],o=e[n+1];if(Be.isBreakingSpace(s,o)||Be.isNewline(s)){i!==""&&(t.push(i),i=""),t.push(s);continue}i+=s}return i!==""&&t.push(i),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,i,n,s){return!0}static wordWrapSplit(e){return Be.graphemeSegmenter(e)}static measureFont(e){if(Be._fonts[e])return Be._fonts[e];const t={ascent:0,descent:0,fontSize:0},i=Be._canvas,n=Be._context;n.font=e;const s=Be.METRICS_STRING+Be.BASELINE_SYMBOL,o=Math.ceil(n.measureText(s).width);let l=Math.ceil(n.measureText(Be.BASELINE_SYMBOL).width);const u=Math.ceil(Be.HEIGHT_MULTIPLIER*l);if(l=l*Be.BASELINE_MULTIPLIER|0,o===0||u===0)return Be._fonts[e]=t,t;i.width=o,i.height=u,n.fillStyle="#f00",n.fillRect(0,0,o,u),n.font=e,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(s,0,l);const c=n.getImageData(0,0,o,u).data,d=c.length,p=o*4;let m=0,y=0,v=!1;for(m=0;m<l;++m){for(let _=0;_<p;_+=4)if(c[y+_]!==255){v=!0;break}if(!v)y+=p;else break}for(t.ascent=l-m,y=d-p,v=!1,m=u;m>l;--m){for(let _=0;_<p;_+=4)if(c[y+_]!==255){v=!0;break}if(!v)y-=p;else break}return t.descent=m-l,t.fontSize=t.ascent+t.descent,Be._fonts[e]=t,t}static clearMetrics(e=""){e?delete Be._fonts[e]:Be._fonts={}}static get _canvas(){var e;if(!Be.__canvas){let t;try{const i=new OffscreenCanvas(0,0);if((e=i.getContext("2d",Ku))!=null&&e.measureText)return Be.__canvas=i,i;t=Re.ADAPTER.createCanvas()}catch{t=Re.ADAPTER.createCanvas()}t.width=t.height=10,Be.__canvas=t}return Be.__canvas}static get _context(){return Be.__context||(Be.__context=Be._canvas.getContext("2d",Ku)),Be.__context}};Hr.METRICS_STRING="|ÉqÅ",Hr.BASELINE_SYMBOL="M",Hr.BASELINE_MULTIPLIER=1.4,Hr.HEIGHT_MULTIPLIER=2,Hr.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const r=new Intl.Segmenter;return e=>[...r.segment(e)].map(t=>t.segment)}return r=>[...r]})(),Hr.experimentalLetterSpacing=!1,Hr._fonts={},Hr._newlines=[10,13],Hr._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Vn=Hr;const l2=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],ew=class qa{constructor(e){this.styleID=0,this.reset(),kf(this,e,e)}clone(){const e={};return kf(e,this,qa.defaultStyle),new qa(e)}reset(){kf(this,qa.defaultStyle,qa.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=Bf(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=Bf(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){u2(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=Bf(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let i=t.length-1;i>=0;i--){let n=t[i].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!l2.includes(n)&&(n=`"${n}"`),t[i]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};ew.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Jh.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let is=ew;function Bf(r){const e=pt.shared,t=i=>{const n=e.setValue(i);return n.alpha===1?n.toHex():n.toRgbaString()};return Array.isArray(r)?r.map(t):t(r)}function u2(r,e){if(!Array.isArray(r)||!Array.isArray(e)||r.length!==e.length)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}function kf(r,e,t){for(const i in t)Array.isArray(e[i])?r[i]=e[i].slice():r[i]=e[i]}const h2={texture:!0,children:!1,baseTexture:!0},tw=class Fp extends Zo{constructor(e,t,i){let n=!1;i||(i=Re.ADAPTER.createCanvas(),n=!0),i.width=3,i.height=3;const s=De.from(i);s.orig=new Qe,s.trim=new Qe,super(s),this._ownCanvas=n,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=Fp.defaultResolution??Re.RESOLUTION,this._autoResolution=Fp.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return Vn.experimentalLetterSpacing}static set experimentalLetterSpacing(e){et("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Vn.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const i=this.context,n=Vn.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=n.width,o=n.height,l=n.lines,u=n.lineHeight,c=n.lineWidths,d=n.maxLineWidth,p=n.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+t.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=t.strokeThickness,i.textBaseline=t.textBaseline,i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit;let m,y;const v=t.dropShadow?2:1;for(let _=0;_<v;++_){const T=t.dropShadow&&_===0,E=T?Math.ceil(Math.max(1,o)+t.padding*2):0,S=E*this._resolution;if(T){i.fillStyle="black",i.strokeStyle="black";const P=t.dropShadowColor,D=t.dropShadowBlur*this._resolution,k=t.dropShadowDistance*this._resolution;i.shadowColor=pt.shared.setValue(P).setAlpha(t.dropShadowAlpha).toRgbaString(),i.shadowBlur=D,i.shadowOffsetX=Math.cos(t.dropShadowAngle)*k,i.shadowOffsetY=Math.sin(t.dropShadowAngle)*k+S}else i.fillStyle=this._generateFillStyle(t,l,n),i.strokeStyle=t.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let A=(u-p.fontSize)/2;u-p.fontSize<0&&(A=0);for(let P=0;P<l.length;P++)m=t.strokeThickness/2,y=t.strokeThickness/2+P*u+p.ascent+A,t.align==="right"?m+=d-c[P]:t.align==="center"&&(m+=(d-c[P])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(l[P],m+t.padding,y+t.padding-E,!0),t.fill&&this.drawLetterSpacing(l[P],m+t.padding,y+t.padding-E)}this.updateTexture()}drawLetterSpacing(e,t,i,n=!1){const s=this._style.letterSpacing;let o=!1;if(Vn.experimentalLetterSpacingSupported&&(Vn.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),s===0||o){n?this.context.strokeText(e,t,i):this.context.fillText(e,t,i);return}let l=t;const u=Vn.graphemeSegmenter(e);let c=this.context.measureText(e).width,d=0;for(let p=0;p<u.length;++p){const m=u[p];n?this.context.strokeText(m,l,i):this.context.fillText(m,l,i);let y="";for(let v=p+1;v<u.length;++v)y+=u[v];d=this.context.measureText(y).width,l+=c-d+s,c=d}}updateTexture(){const e=this.canvas;if(this._style.trim){const o=OP(e);o.data&&(e.width=o.width,e.height=o.height,this.context.putImageData(o.data,0,0))}const t=this._texture,i=this._style,n=i.trim?0:i.padding,s=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-n,t.trim.y=-n,t.orig.width=t._frame.width-n*2,t.orig.height=t._frame.height-n*2,this._onTextureUpdate(),s.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,i){const n=e.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;let s;const o=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,u=this.canvas.width/this._resolution-o-l*2,c=this.canvas.height/this._resolution-o-l*2,d=n.slice(),p=e.fillGradientStops.slice();if(!p.length){const m=d.length+1;for(let y=1;y<m;++y)p.push(y/m)}if(d.unshift(n[0]),p.unshift(0),d.push(n[n.length-1]),p.push(1),e.fillGradientType===Jh.LINEAR_VERTICAL){s=this.context.createLinearGradient(u/2,l,u/2,c+l);const m=i.fontProperties.fontSize+e.strokeThickness;for(let y=0;y<t.length;y++){const v=i.lineHeight*(y-1)+m,_=i.lineHeight*y;let T=_;y>0&&v>_&&(T=(_+v)/2);const E=_+m,S=i.lineHeight*(y+1);let A=E;y+1<t.length&&S<E&&(A=(E+S)/2);const P=(A-T)/c;for(let D=0;D<d.length;D++){let k=0;typeof p[D]=="number"?k=p[D]:k=D/d.length;let U=Math.min(1,Math.max(0,T/c+k*P));U=Number(U.toFixed(5)),s.addColorStop(U,d[D])}}}else{s=this.context.createLinearGradient(l,c/2,u+l,c/2);const m=d.length+1;let y=1;for(let v=0;v<d.length;v++){let _;typeof p[v]=="number"?_=p[v]:_=y/m,s.addColorStop(_,d[v]),y++}}return s}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},h2,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=Qn(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=Qn(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof is?this._style=e:this._style=new is(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};tw.defaultAutoResolution=!0;let iw=tw;class c2{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function d2(r,e){var t;let i=!1;if((t=r==null?void 0:r._textures)!=null&&t.length){for(let n=0;n<r._textures.length;n++)if(r._textures[n]instanceof De){const s=r._textures[n].baseTexture;e.includes(s)||(e.push(s),i=!0)}}return i}function f2(r,e){if(r.baseTexture instanceof Ze){const t=r.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function p2(r,e){if(r._texture&&r._texture instanceof De){const t=r._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function m2(r,e){return e instanceof iw?(e.updateText(!0),!0):!1}function g2(r,e){if(e instanceof is){const t=e.toFontString();return Vn.measureFont(t),!0}return!1}function y2(r,e){if(r instanceof iw){e.includes(r.style)||e.push(r.style),e.includes(r)||e.push(r);const t=r._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function v2(r,e){return r instanceof is?(e.includes(r)||e.push(r),!0):!1}const rw=class nw{constructor(e){this.limiter=new c2(nw.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(y2),this.registerFindHook(v2),this.registerFindHook(d2),this.registerFindHook(f2),this.registerFindHook(p2),this.registerUploadHook(m2),this.registerUploadHook(g2)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,ji.system.addOnce(this.tick,this,zs.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let i=0,n=this.uploadHooks.length;i<n;i++)if(this.uploadHooks[i](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)ji.system.addOnce(this.tick,this,zs.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,i=e.length;t<i;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,i=this.addHooks.length;t<i&&!this.addHooks[t](e,this.queue);t++);if(e instanceof Er)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&ji.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};rw.uploadsPerFrame=4;let Bp=rw;Object.defineProperties(Re,{UPLOADS_PER_FRAME:{get(){return Bp.uploadsPerFrame},set(r){et("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Bp.uploadsPerFrame=r}}});function sw(r,e){return e instanceof Ze?(e._glTextures[r.CONTEXT_UID]||r.texture.bind(e),!0):!1}function _2(r,e){if(!(e instanceof ul))return!1;const{geometry:t}=e;e.finishPoly(),t.updateBatches();const{batches:i}=t;for(let n=0;n<i.length;n++){const{texture:s}=i[n].style;s&&sw(r,s.baseTexture)}return t.batchable||r.geometry.bind(t,e._resolveDirectShader(r)),!0}function x2(r,e){return r instanceof ul?(e.push(r),!0):!1}class ow extends Bp{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(x2),this.registerUploadHook(sw),this.registerUploadHook(_2)}}ow.extension={name:"prepare",type:Ae.RendererSystem};Le.add(ow);var T2=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,w2=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,E2=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,wx=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,S2=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const Ju=new xt;class aw extends Zh{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new hT,this.state=Jr.for2d()}contextChange(){const e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=Zr.from(wx,S2,t),this.shader=e.context.webGLVersion>1?Zr.from(w2,T2,t):Zr.from(wx,E2,t)}render(e){const t=this.renderer,i=this.quad;let n=i.vertices;n[0]=n[6]=e._width*-e.anchor.x,n[1]=n[3]=e._height*-e.anchor.y,n[2]=n[4]=e._width*(1-e.anchor.x),n[5]=n[7]=e._height*(1-e.anchor.y);const s=e.uvRespectAnchor?e.anchor.x:0,o=e.uvRespectAnchor?e.anchor.y:0;n=i.uvs,n[0]=n[6]=-s,n[1]=n[3]=-o,n[2]=n[4]=1-s,n[5]=n[7]=1-o,i.invalidate();const l=e._texture,u=l.baseTexture,c=u.alphaMode>0,d=e.tileTransform.localTransform,p=e.uvMatrix;let m=u.isPowerOfTwo&&l.frame.width===u.width&&l.frame.height===u.height;m&&(u._glTextures[t.CONTEXT_UID]?m=u.wrapMode!==Jn.CLAMP:u.wrapMode===Jn.CLAMP&&(u.wrapMode=Jn.REPEAT));const y=m?this.simpleShader:this.shader,v=l.width,_=l.height,T=e._width,E=e._height;Ju.set(d.a*v/T,d.b*v/E,d.c*_/T,d.d*_/E,d.tx/T,d.ty/E),Ju.invert(),m?Ju.prepend(p.mapCoord):(y.uniforms.uMapCoord=p.mapCoord.toArray(!0),y.uniforms.uClampFrame=p.uClampFrame,y.uniforms.uClampOffset=p.uClampOffset),y.uniforms.uTransform=Ju.toArray(!0),y.uniforms.uColor=pt.shared.setValue(e.tint).premultiply(e.worldAlpha,c).toArray(y.uniforms.uColor),y.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),y.uniforms.uSampler=l,t.shader.bind(y),t.geometry.bind(i),this.state.blendMode=K0(e.blendMode,c),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}aw.extension={name:"tilingSprite",type:Ae.RendererPlugin};Le.add(aw);const lw=class Za{constructor(e,t,i){this.linkedSheets=[],(e instanceof Ze||e instanceof De)&&(e={texture:e,data:t,resolutionFilename:i});const{texture:n,data:s,resolutionFilename:o=null,cachePrefix:l=""}=e;this.cachePrefix=l,this._texture=n instanceof De?n:null,this.baseTexture=n instanceof Ze?n:this._texture.baseTexture,this.textures={},this.animations={},this.data=s;const u=this.baseTexture.resource;this.resolution=this._updateResolution(o||(u?u.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let i=vn(e,null);return i===null&&(i=typeof t=="number"?t:parseFloat(t??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=Za.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const i=Za.BATCH_SIZE;for(;t-e<i&&t<this._frameKeys.length;){const n=this._frameKeys[t],s=this._frames[n],o=s.frame;if(o){let l=null,u=null;const c=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,d=new Qe(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);s.rotated?l=new Qe(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):l=new Qe(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(u=new Qe(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new De(this.baseTexture,l,d,u,s.rotated?2:0,s.anchor,s.borders),De.addToCache(this.textures[n],this.cachePrefix+n.toString())}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let i=0;i<e[t].length;i++){const n=e[t][i];this.animations[t].push(this.textures[n])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Za.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Za.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};lw.BATCH_SIZE=1e3;let Ex=lw;const A2=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function uw(r,e,t){const i={};if(r.forEach(n=>{i[n]=e}),Object.keys(e.textures).forEach(n=>{i[`${e.cachePrefix}${n}`]=e.textures[n]}),!t){const n=ci.dirname(r[0]);e.linkedSheets.forEach((s,o)=>{Object.assign(i,uw([`${n}/${e.data.meta.related_multi_packs[o]}`],s,!0))})}return i}const b2={extension:Ae.Asset,cache:{test:r=>r instanceof Ex,getCacheableAssets:(r,e)=>uw(r,e,!1)},resolver:{test:r=>{const e=r.split("?")[0].split("."),t=e.pop(),i=e.pop();return t==="json"&&A2.includes(i)},parse:r=>{var e;const t=r.split(".");return{resolution:parseFloat(((e=Re.RETINA_PREFIX.exec(r))==null?void 0:e[1])??"1"),format:t[t.length-2],src:r}}},loader:{name:"spritesheetLoader",extension:{type:Ae.LoadParser,priority:Rr.Normal},async testParse(r,e){return ci.extname(e.src).toLowerCase()===".json"&&!!r.frames},async parse(r,e,t){var i,n;const{texture:s,imageFilename:o,cachePrefix:l}=(e==null?void 0:e.data)??{};let u=ci.dirname(e.src);u&&u.lastIndexOf("/")!==u.length-1&&(u+="/");let c;if(s&&s.baseTexture)c=s;else{const m=Mp(u+(o??r.meta.image),e.src);c=(await t.load([m]))[m]}const d=new Ex({texture:c.baseTexture,data:r,resolutionFilename:e.src,cachePrefix:l});await d.parse();const p=(i=r==null?void 0:r.meta)==null?void 0:i.related_multi_packs;if(Array.isArray(p)){const m=[];for(const v of p){if(typeof v!="string")continue;let _=u+v;(n=e.data)!=null&&n.ignoreMultiPack||(_=Mp(_,e.src),m.push(t.load({src:_,data:{ignoreMultiPack:!0}})))}const y=await Promise.all(m);d.linkedSheets=y,y.forEach(v=>{v.linkedSheets=[d].concat(d.linkedSheets.filter(_=>_!==v))})}return d},unload(r){r.destroy(!0)}}};Le.add(b2);class Lh{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class fh{static test(e){return typeof e=="string"&&e.startsWith("info face=")}static parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const s in t){const o=t[s].match(/^[a-z]+/gm)[0],l=t[s].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),u={};for(const c in l){const d=l[c].split("="),p=d[0],m=d[1].replace(/"/gm,""),y=parseFloat(m),v=isNaN(y)?m:y;u[p]=v}i[o].push(u)}const n=new Lh;return i.info.forEach(s=>n.info.push({face:s.face,size:parseInt(s.size,10)})),i.common.forEach(s=>n.common.push({lineHeight:parseInt(s.lineHeight,10)})),i.page.forEach(s=>n.page.push({id:parseInt(s.id,10),file:s.file})),i.char.forEach(s=>n.char.push({id:parseInt(s.id,10),page:parseInt(s.page,10),x:parseInt(s.x,10),y:parseInt(s.y,10),width:parseInt(s.width,10),height:parseInt(s.height,10),xoffset:parseInt(s.xoffset,10),yoffset:parseInt(s.yoffset,10),xadvance:parseInt(s.xadvance,10)})),i.kerning.forEach(s=>n.kerning.push({first:parseInt(s.first,10),second:parseInt(s.second,10),amount:parseInt(s.amount,10)})),i.distanceField.forEach(s=>n.distanceField.push({distanceRange:parseInt(s.distanceRange,10),fieldType:s.fieldType})),n}}class kp{static test(e){const t=e;return typeof e!="string"&&"getElementsByTagName"in e&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(e){const t=new Lh,i=e.getElementsByTagName("info"),n=e.getElementsByTagName("common"),s=e.getElementsByTagName("page"),o=e.getElementsByTagName("char"),l=e.getElementsByTagName("kerning"),u=e.getElementsByTagName("distanceField");for(let c=0;c<i.length;c++)t.info.push({face:i[c].getAttribute("face"),size:parseInt(i[c].getAttribute("size"),10)});for(let c=0;c<n.length;c++)t.common.push({lineHeight:parseInt(n[c].getAttribute("lineHeight"),10)});for(let c=0;c<s.length;c++)t.page.push({id:parseInt(s[c].getAttribute("id"),10)||0,file:s[c].getAttribute("file")});for(let c=0;c<o.length;c++){const d=o[c];t.char.push({id:parseInt(d.getAttribute("id"),10),page:parseInt(d.getAttribute("page"),10)||0,x:parseInt(d.getAttribute("x"),10),y:parseInt(d.getAttribute("y"),10),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10),xoffset:parseInt(d.getAttribute("xoffset"),10),yoffset:parseInt(d.getAttribute("yoffset"),10),xadvance:parseInt(d.getAttribute("xadvance"),10)})}for(let c=0;c<l.length;c++)t.kerning.push({first:parseInt(l[c].getAttribute("first"),10),second:parseInt(l[c].getAttribute("second"),10),amount:parseInt(l[c].getAttribute("amount"),10)});for(let c=0;c<u.length;c++)t.distanceField.push({fieldType:u[c].getAttribute("fieldType"),distanceRange:parseInt(u[c].getAttribute("distanceRange"),10)});return t}}class Up{static test(e){return typeof e=="string"&&e.includes("<font>")?kp.test(Re.ADAPTER.parseXML(e)):!1}static parse(e){return kp.parse(Re.ADAPTER.parseXML(e))}}const Uf=[fh,kp,Up];function C2(r){for(let e=0;e<Uf.length;e++)if(Uf[e].test(r))return Uf[e];return null}function R2(r,e,t,i,n,s){const o=t.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let l;const u=t.dropShadow?t.dropShadowDistance:0,c=t.padding||0,d=r.width/i-u-c*2,p=r.height/i-u-c*2,m=o.slice(),y=t.fillGradientStops.slice();if(!y.length){const v=m.length+1;for(let _=1;_<v;++_)y.push(_/v)}if(m.unshift(o[0]),y.unshift(0),m.push(o[o.length-1]),y.push(1),t.fillGradientType===Jh.LINEAR_VERTICAL){l=e.createLinearGradient(d/2,c,d/2,p+c);let v=0;const _=(s.fontProperties.fontSize+t.strokeThickness)/p;for(let T=0;T<n.length;T++){const E=s.lineHeight*T;for(let S=0;S<m.length;S++){let A=0;typeof y[S]=="number"?A=y[S]:A=S/m.length;const P=E/p+A*_;let D=Math.max(v,P);D=Math.min(D,1),l.addColorStop(D,m[S]),v=D}}}else{l=e.createLinearGradient(c,p/2,d+c,p/2);const v=m.length+1;let _=1;for(let T=0;T<m.length;T++){let E;typeof y[T]=="number"?E=y[T]:E=_/v,l.addColorStop(E,m[T]),_++}}return l}function P2(r,e,t,i,n,s,o){const l=t.text,u=t.fontProperties;e.translate(i,n),e.scale(s,s);const c=o.strokeThickness/2,d=-(o.strokeThickness/2);if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=R2(r,e,o,s,[l],t),e.strokeStyle=o.stroke,o.dropShadow){const p=o.dropShadowColor,m=o.dropShadowBlur*s,y=o.dropShadowDistance*s;e.shadowColor=pt.shared.setValue(p).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=m,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*y,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*y}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(l,c,d+t.lineHeight-u.descent),o.fill&&e.fillText(l,c,d+t.lineHeight-u.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function ph(r){return r.codePointAt?r.codePointAt(0):r.charCodeAt(0)}function hw(r){return Array.from?Array.from(r):r.split("")}function O2(r){typeof r=="string"&&(r=[r]);const e=[];for(let t=0,i=r.length;t<i;t++){const n=r[t];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const s=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<s)throw new Error("[BitmapFont]: Invalid character range.");for(let l=s,u=o;l<=u;l++)e.push(String.fromCharCode(l))}else e.push(...hw(n))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}const zn=class zr{constructor(e,t,i){var n;const[s]=e.info,[o]=e.common,[l]=e.page,[u]=e.distanceField,c=vn(l.file),d={};this._ownsTextures=i,this.font=s.face,this.size=s.size,this.lineHeight=o.lineHeight/c,this.chars={},this.pageTextures=d;for(let p=0;p<e.page.length;p++){const{id:m,file:y}=e.page[p];d[m]=t instanceof Array?t[p]:t[y],u!=null&&u.fieldType&&u.fieldType!=="none"&&(d[m].baseTexture.alphaMode=Bi.NO_PREMULTIPLIED_ALPHA,d[m].baseTexture.mipmap=Qr.OFF)}for(let p=0;p<e.char.length;p++){const{id:m,page:y}=e.char[p];let{x:v,y:_,width:T,height:E,xoffset:S,yoffset:A,xadvance:P}=e.char[p];v/=c,_/=c,T/=c,E/=c,S/=c,A/=c,P/=c;const D=new Qe(v+d[y].frame.x/c,_+d[y].frame.y/c,T,E);this.chars[m]={xOffset:S,yOffset:A,xAdvance:P,kerning:{},texture:new De(d[y].baseTexture,D),page:y}}for(let p=0;p<e.kerning.length;p++){let{first:m,second:y,amount:v}=e.kerning[p];m/=c,y/=c,v/=c,this.chars[y]&&(this.chars[y].kerning[m]=v)}this.distanceFieldRange=u==null?void 0:u.distanceRange,this.distanceFieldType=((n=u==null?void 0:u.fieldType)==null?void 0:n.toLowerCase())??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,i){let n;if(e instanceof Lh)n=e;else{const o=C2(e);if(!o)throw new Error("Unrecognized data format for font.");n=o.parse(e)}t instanceof De&&(t=[t]);const s=new zr(n,t,i);return zr.available[s.font]=s,s}static uninstall(e){const t=zr.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete zr.available[e]}static from(e,t,i){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:n,padding:s,resolution:o,textureWidth:l,textureHeight:u,...c}=Object.assign({},zr.defaultOptions,i),d=O2(n),p=t instanceof is?t:new is(t),m=l,y=new Lh;y.info[0]={face:p.fontFamily,size:p.fontSize},y.common[0]={lineHeight:p.fontSize};let v=0,_=0,T,E,S,A=0;const P=[];for(let k=0;k<d.length;k++){T||(T=Re.ADAPTER.createCanvas(),T.width=l,T.height=u,E=T.getContext("2d"),S=new Ze(T,{resolution:o,...c}),P.push(new De(S)),y.page.push({id:P.length-1,file:""}));const U=d[k],j=Vn.measureText(U,p,!1,T),q=j.width,ee=Math.ceil(j.height),pe=Math.ceil((p.fontStyle==="italic"?2:1)*q);if(_>=u-ee*o){if(_===0)throw new Error(`[BitmapFont] textureHeight ${u}px is too small (fontFamily: '${p.fontFamily}', fontSize: ${p.fontSize}px, char: '${U}')`);--k,T=null,E=null,S=null,_=0,v=0,A=0;continue}if(A=Math.max(ee+j.fontProperties.descent,A),pe*o+v>=m){if(v===0)throw new Error(`[BitmapFont] textureWidth ${l}px is too small (fontFamily: '${p.fontFamily}', fontSize: ${p.fontSize}px, char: '${U}')`);--k,_+=A*o,_=Math.ceil(_),v=0,A=0;continue}P2(T,E,j,v,_,o,p);const H=ph(j.text);y.char.push({id:H,page:P.length-1,x:v/o,y:_/o,width:pe,height:ee,xoffset:0,yoffset:0,xadvance:q-(p.dropShadow?p.dropShadowDistance:0)-(p.stroke?p.strokeThickness:0)}),v+=(pe+2*s)*o,v=Math.ceil(v)}if(!(i!=null&&i.skipKerning))for(let k=0,U=d.length;k<U;k++){const j=d[k];for(let q=0;q<U;q++){const ee=d[q],pe=E.measureText(j).width,H=E.measureText(ee).width,F=E.measureText(j+ee).width-(pe+H);F&&y.kerning.push({first:ph(j),second:ph(ee),amount:F})}}const D=new zr(y,P,!0);return zr.available[e]!==void 0&&zr.uninstall(e),zr.available[e]=D,D}};zn.ALPHA=[["a","z"],["A","Z"]," "],zn.NUMERIC=[["0","9"]],zn.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],zn.ASCII=[[" ","~"]],zn.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:zn.ALPHANUMERIC},zn.available={};let Gn=zn;var I2=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,M2=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Sx=[],Ax=[],bx=[],N2=class cw extends Er{constructor(e,t={}){super();const{align:i,tint:n,maxWidth:s,letterSpacing:o,fontName:l,fontSize:u}=Object.assign({},cw.styleDefaults,t);if(!Gn.available[l])throw new Error(`Missing BitmapFont "${l}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new pt(n),this._font=void 0,this._fontName=l,this._fontSize=u,this.text=e,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new mn(()=>{this.dirty=!0},this,0,0),this._roundPixels=Re.ROUND_PIXELS,this.dirty=!0,this._resolution=Re.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var e;const t=Gn.available[this._fontName],i=this.fontSize,n=i/t.size,s=new ot,o=[],l=[],u=[],c=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",d=hw(c),p=this._maxWidth*t.size/i,m=t.distanceFieldType==="none"?Sx:Ax;let y=null,v=0,_=0,T=0,E=-1,S=0,A=0,P=0,D=0;for(let H=0;H<d.length;H++){const F=d[H],G=ph(F);if(/(?:\s)/.test(F)&&(E=H,S=v,D++),F==="\r"||F===`
`){l.push(v),u.push(-1),_=Math.max(_,v),++T,++A,s.x=0,s.y+=t.lineHeight,y=null,D=0;continue}const $=t.chars[G];if(!$)continue;y&&$.kerning[y]&&(s.x+=$.kerning[y]);const le=bx.pop()||{texture:De.EMPTY,line:0,charCode:0,prevSpaces:0,position:new ot};le.texture=$.texture,le.line=T,le.charCode=G,le.position.x=Math.round(s.x+$.xOffset+this._letterSpacing/2),le.position.y=Math.round(s.y+$.yOffset),le.prevSpaces=D,o.push(le),v=le.position.x+Math.max($.xAdvance-$.xOffset,$.texture.orig.width),s.x+=$.xAdvance+this._letterSpacing,P=Math.max(P,$.yOffset+$.texture.height),y=G,E!==-1&&p>0&&s.x>p&&(++A,Ho(o,1+E-A,1+H-E),H=E,E=-1,l.push(S),u.push(o.length>0?o[o.length-1].prevSpaces:0),_=Math.max(_,S),T++,s.x=0,s.y+=t.lineHeight,y=null,D=0)}const k=d[d.length-1];k!=="\r"&&k!==`
`&&(/(?:\s)/.test(k)&&(v=S),l.push(v),_=Math.max(_,v),u.push(-1));const U=[];for(let H=0;H<=T;H++){let F=0;this._align==="right"?F=_-l[H]:this._align==="center"?F=(_-l[H])/2:this._align==="justify"&&(F=u[H]<0?0:(_-l[H])/u[H]),U.push(F)}const j=o.length,q={},ee=[],pe=this._activePagesMeshData;m.push(...pe);for(let H=0;H<j;H++){const F=o[H].texture,G=F.baseTexture.uid;if(!q[G]){let $=m.pop();if(!$){const ie=new r2;let Y,de;t.distanceFieldType==="none"?(Y=new xx(De.EMPTY),de=je.NORMAL):(Y=new xx(De.EMPTY,{program:gn.from(M2,I2),uniforms:{uFWidth:0}}),de=je.NORMAL_NPM);const z=new _x(ie,Y);z.blendMode=de,$={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:z,vertices:null,uvs:null,indices:null}}$.index=0,$.indexCount=0,$.vertexCount=0,$.uvsCount=0,$.total=0;const{_textureCache:le}=this;le[G]=le[G]||new De(F.baseTexture),$.mesh.texture=le[G],$.mesh.tint=this._tintColor.value,ee.push($),q[G]=$}q[G].total++}for(let H=0;H<pe.length;H++)ee.includes(pe[H])||this.removeChild(pe[H].mesh);for(let H=0;H<ee.length;H++)ee[H].mesh.parent!==this&&this.addChild(ee[H].mesh);this._activePagesMeshData=ee;for(const H in q){const F=q[H],G=F.total;if(!(((e=F.indices)==null?void 0:e.length)>6*G)||F.vertices.length<_x.BATCHABLE_SIZE*2)F.vertices=new Float32Array(4*2*G),F.uvs=new Float32Array(4*2*G),F.indices=new Uint16Array(6*G);else{const $=F.total,le=F.vertices;for(let ie=$*4*2;ie<le.length;ie++)le[ie]=0}F.mesh.size=6*G}for(let H=0;H<j;H++){const F=o[H];let G=F.position.x+U[F.line]*(this._align==="justify"?F.prevSpaces:1);this._roundPixels&&(G=Math.round(G));const $=G*n,le=F.position.y*n,ie=F.texture,Y=q[ie.baseTexture.uid],de=ie.frame,z=ie._uvs,N=Y.index++;Y.indices[N*6+0]=0+N*4,Y.indices[N*6+1]=1+N*4,Y.indices[N*6+2]=2+N*4,Y.indices[N*6+3]=0+N*4,Y.indices[N*6+4]=2+N*4,Y.indices[N*6+5]=3+N*4,Y.vertices[N*8+0]=$,Y.vertices[N*8+1]=le,Y.vertices[N*8+2]=$+de.width*n,Y.vertices[N*8+3]=le,Y.vertices[N*8+4]=$+de.width*n,Y.vertices[N*8+5]=le+de.height*n,Y.vertices[N*8+6]=$,Y.vertices[N*8+7]=le+de.height*n,Y.uvs[N*8+0]=z.x0,Y.uvs[N*8+1]=z.y0,Y.uvs[N*8+2]=z.x1,Y.uvs[N*8+3]=z.y1,Y.uvs[N*8+4]=z.x2,Y.uvs[N*8+5]=z.y2,Y.uvs[N*8+6]=z.x3,Y.uvs[N*8+7]=z.y3}this._textWidth=_*n,this._textHeight=(s.y+t.lineHeight)*n;for(const H in q){const F=q[H];if(this.anchor.x!==0||this.anchor.y!==0){let ie=0;const Y=this._textWidth*this.anchor.x,de=this._textHeight*this.anchor.y;for(let z=0;z<F.total;z++)F.vertices[ie++]-=Y,F.vertices[ie++]-=de,F.vertices[ie++]-=Y,F.vertices[ie++]-=de,F.vertices[ie++]-=Y,F.vertices[ie++]-=de,F.vertices[ie++]-=Y,F.vertices[ie++]-=de}this._maxLineHeight=P*n;const G=F.mesh.geometry.getBuffer("aVertexPosition"),$=F.mesh.geometry.getBuffer("aTextureCoord"),le=F.mesh.geometry.getIndex();G.data=F.vertices,$.data=F.uvs,le.data=F.indices,G.update(),$.update(),le.update()}for(let H=0;H<o.length;H++)bx.push(o[H]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:i,size:n}=Gn.available[this._fontName];if(i!=="none"){const{a:s,b:o,c:l,d:u}=this.worldTransform,c=Math.sqrt(s*s+o*o),d=Math.sqrt(l*l+u*u),p=(Math.abs(c)+Math.abs(d))/2,m=this.fontSize/n,y=e._view.resolution;for(const v of this._activePagesMeshData)v.mesh.shader.uniforms.uFWidth=p*t*m*y}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=Gn.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!Gn.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??Gn.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,i=Gn.available[this._fontName].distanceFieldType==="none"?Sx:Ax;i.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],i.filter(n=>t[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=De.EMPTY});for(const n in t)t[n].destroy(),delete t[n];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}};N2.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const D2=[".xml",".fnt"],L2={extension:{type:Ae.LoadParser,priority:Rr.Normal},name:"loadBitmapFont",test(r){return D2.includes(ci.extname(r).toLowerCase())},async testParse(r){return fh.test(r)||Up.test(r)},async parse(r,e,t){const i=fh.test(r)?fh.parse(r):Up.parse(r),{src:n}=e,{page:s}=i,o=[];for(let c=0;c<s.length;++c){const d=s[c].file;let p=ci.join(ci.dirname(n),d);p=Mp(p,n),o.push(p)}const l=await t.load(o),u=o.map(c=>l[c]);return Gn.install(i,u,!0)},async load(r,e){return(await Re.ADAPTER.fetch(r)).text()},unload(r){r.destroy()}};Le.add(L2);const Hp=class Io extends is{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new Io(Object.keys(Io.defaultOptions).reduce((t,i)=>({...t,[i]:e[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(e=>{URL.revokeObjectURL(e.src),e.refs--,e.refs===0&&(e.fontFace&&document.fonts.delete(e.fontFace),delete Io.availableFonts[e.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,t={}){const{availableFonts:i}=Io;if(i[e]){const n=i[e];return this._fonts.push(n),n.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return Re.ADAPTER.fetch(e).then(n=>n.blob()).then(async n=>new Promise((s,o)=>{const l=URL.createObjectURL(n),u=new FileReader;u.onload=()=>s([l,u.result]),u.onerror=o,u.readAsDataURL(n)})).then(async([n,s])=>{const o=Object.assign({family:ci.basename(e,ci.extname(e)),weight:"normal",style:"normal",display:"auto",src:n,dataSrc:s,refs:1,originalUrl:e,fontFace:null},t);i[e]=o,this._fonts.push(o),this.styleID++;const l=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style,display:o.display});o.fontFace=l,await l.load(),document.fonts.add(l),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...e){const t=e.filter(i=>!this._overrides.includes(i));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){const t=e.filter(i=>this._overrides.includes(i));t.length>0&&(this._overrides=this._overrides.filter(i=>!t.includes(i)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((e,t)=>`${e}
            @font-face {
                font-family: "${t.family}";
                src: url('${t.dataSrc}');
                font-weight: ${t.weight};
                font-style: ${t.style};
                font-display: ${t.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(e=SP(e)),typeof e=="number"?EP(e):e}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(t*255|0).toString(16).padStart(2,"0"));const s=`${i}px ${n}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${s} ${e}`}reset(){Object.assign(this,Io.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(t=>setTimeout(t,100)):Promise.resolve()}get isSafari(){const{userAgent:e}=Re.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};Hp.availableFonts={},Hp.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let Hf=Hp;const $u=class Mo extends Zo{constructor(e="",t={}){super(De.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const i=new Image,n=De.from(i,{scaleMode:Re.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new Qe,n.trim=new Qe,this.texture=n;const s="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",l=document.createElementNS(s,"svg"),u=document.createElementNS(s,"foreignObject"),c=document.createElementNS(o,"div"),d=document.createElementNS(o,"style");u.setAttribute("width","10000"),u.setAttribute("height","10000"),u.style.overflow="hidden",l.appendChild(u),this.maxWidth=Mo.defaultMaxWidth,this.maxHeight=Mo.defaultMaxHeight,this._domElement=c,this._styleElement=d,this._svgRoot=l,this._foreignObject=u,this._foreignObject.appendChild(d),this._foreignObject.appendChild(c),this._image=i,this._loadImage=new Image,this._autoResolution=Mo.defaultAutoResolution,this._resolution=Mo.defaultResolution??Re.RESOLUTION,this.text=e,this.style=t}measureText(e){var t,i;const{text:n,style:s,resolution:o}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:n,style:s.toCSS(o)}),this._styleElement.textContent=s.toGlobalCSS(),document.body.appendChild(this._svgRoot);const l=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:u,height:c}=l;(u>this.maxWidth||c>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const d=Math.min(this.maxWidth,Math.ceil(u)),p=Math.min(this.maxHeight,Math.ceil(c));return this._svgRoot.setAttribute("width",d.toString()),this._svgRoot.setAttribute("height",p.toString()),n!==this._text&&(this._domElement.innerHTML=this._text),s!==this._style&&(Object.assign(this._domElement,{style:(t=this._style)==null?void 0:t.toCSS(o)}),this._styleElement.textContent=(i=this._style)==null?void 0:i.toGlobalCSS()),{width:d+s.padding*2,height:p+s.padding*2}}async updateText(e=!0){const{style:t,_image:i,_loadImage:n}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;const{width:s,height:o}=this.measureText();i.width=n.width=Math.ceil(Math.max(1,s)),i.height=n.height=Math.ceil(Math.max(1,o)),this._updateID++;const l=this._updateID;await new Promise(u=>{n.onload=async()=>{if(l<this._updateID){u();return}await t.onBeforeDraw(),i.src=n.src,n.onload=null,n.src="",this.updateTexture(),u()};const c=new XMLSerializer().serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(c)}`})}get source(){return this._image}updateTexture(){const{style:e,texture:t,_image:i,resolution:n}=this,{padding:s}=e,{baseTexture:o}=t;t.trim.width=t._frame.width=i.width/n,t.trim.height=t._frame.height=i.height/n,t.trim.x=-s,t.trim.y=-s,t.orig.width=t._frame.width-s*2,t.orig.height=t._frame.height-s*2,this._onTextureUpdate(),o.setRealSize(i.width,i.height,n),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){var t,i,n,s,o;typeof e=="boolean"&&(e={children:e}),e=Object.assign({},Mo.defaultDestroyOptions,e),super.destroy(e);const l=null;this.ownsStyle&&((t=this._style)==null||t.cleanFonts()),this._style=l,(i=this._svgRoot)==null||i.remove(),this._svgRoot=l,(n=this._domElement)==null||n.remove(),this._domElement=l,(s=this._foreignObject)==null||s.remove(),this._foreignObject=l,(o=this._styleElement)==null||o.remove(),this._styleElement=l,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=l,this._image.src="",this._image=l}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=Qn(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=Qn(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&(e=e||{},e instanceof Hf?(this.ownsStyle=!1,this._style=e):e instanceof is?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Hf.from(e)):(this.ownsStyle=!0,this._style=new Hf(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(e===""||e===null||e===void 0?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};$u.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},$u.defaultMaxWidth=2024,$u.defaultMaxHeight=2024,$u.defaultAutoResolution=!0;const F2=16777215,B2=.25,k2=16777215,U2=1,H2=1.5;let Yn=!1,$a;const zp=r=>{const e={tint:r!=null&&r.fill?new pt(r.fill).toNumber():F2,alpha:(r==null?void 0:r.fillOpacity)!==void 0?Math.min(r.fillOpacity,1):String(r==null?void 0:r.fill).toLowerCase().startsWith("rgba(")?new pt(r==null?void 0:r.fill).alpha:B2},t={tint:r!=null&&r.stroke?new pt(r.stroke).toNumber():k2,alpha:(r==null?void 0:r.strokeOpacity)!==void 0?Math.min(r.strokeOpacity,1):String(r==null?void 0:r.stroke).toLowerCase().startsWith("rgba(")?new pt(r==null?void 0:r.stroke).alpha:U2,lineWidth:(r==null?void 0:r.strokeWidth)===void 0?H2:r.strokeWidth};return{fillStyle:e,strokeStyle:t}},$h=r=>(e,t,i)=>{const{fillStyle:n,strokeStyle:s}=zp(i),o=new ul;o.beginFill(16777215),r(t,o),o.endFill(),o.tint=n.tint,o.alpha=n.alpha,e.addChild(o);const l=new ul,u=s.lineWidth===1?1:s.lineWidth/$a;return l.lineStyle(u,16777215,1,.5,s.lineWidth===1),r(t,l),l.tint=s.tint||16777215,l.alpha=s.alpha,e.addChild(l),{fill:o,stroke:l,strokeWidth:s.lineWidth}},z2=$h((r,e)=>{const{x:t,y:i,w:n,h:s}=r.geometry;e.drawRect(t,i,n,s)}),G2=$h((r,e)=>{const{cx:t,cy:i,rx:n,ry:s}=r.geometry;e.drawEllipse(t,i,n,s)}),V2=$h((r,e)=>{const t=r.geometry.points.reduce((i,n)=>[...i,...n],[]);e.drawPolygon(t)}),j2=$h((r,e)=>{const t=i=>i.points.reduce((n,s)=>[...n,...s],[]);r.geometry.polygons.forEach(i=>{const[n,...s]=i.rings;e.drawPolygon(t(n)),s.forEach(o=>{e.beginHole(),e.drawPolygon(t(o)),e.endHole()})})}),dw=r=>{const e=r.viewport.getContainerSize().x;return r.viewport.getZoom(!0)*e/r.world.getContentFactor()},Cx=(r,e,t,i)=>()=>{const n=r.viewport.viewportToImageRectangle(r.viewport.getBounds(!0)),s=dw(r);(s!==$a||!Yn)&&(Yn=!0,t.forEach(({stroke:m,strokeWidth:y})=>{const{lineStyle:v}=m.geometry.graphicsData[0];y>1?(Yn=s===$a,v.width=y/s,v.native=!1,m.geometry.invalidate()):y===1&&!v.native&&(v.width=1,v.native=!0,m.geometry.invalidate())})),$a=s;const o=r.viewport.getFlip();let l=Math.PI*r.viewport.getRotation(!0)/180;l<0&&(l+=2*Math.PI),l>2*Math.PI&&(l-=2*Math.PI);const u=o?r.viewport._containerInnerSize.x+n.x*s:-n.x*s,c=-n.y*s;let d,p;l>0&&l<=Math.PI/2?(d=n.height*s,p=0):l>Math.PI/2&&l<=Math.PI?(d=n.width*s,p=n.height*s):l>Math.PI&&l<=Math.PI*1.5?(d=0,p=n.width*s):(d=0,p=0),e.position.x=d+u*Math.cos(l)-c*Math.sin(l),e.position.y=p+u*Math.sin(l)+c*Math.cos(l),e.scale.set(o?-s:s,s),e.rotation=l,i.render(e)},X2=(r,e)=>{const t=new ul,i=IT({width:e.width,height:e.height,backgroundAlpha:0,view:e,antialias:!0,resolution:2}),n=new Map;let s=new Set,o,l;$a=dw(r);const u=(S,A)=>{Yn=!1;const{selector:P}=S.target,D=typeof l=="function"?l(S,A):l;let k;P.type===Ht.RECTANGLE?k=z2(t,P,D):P.type===Ht.POLYGON?k=V2(t,P,D):P.type===Ht.ELLIPSE?k=G2(t,P,D):P.type===Ht.MULTIPOLYGLON?k=j2(t,P,D):console.warn(`Unsupported shape type: ${P.type}`),k&&n.set(S.id,{annotation:S,...k})},c=S=>{const A=n.get(S.id);A&&(n.delete(S.id),A.fill.destroy(),A.stroke.destroy())},d=(S,A,P)=>{Yn=!1;const D=n.get(S.id);D&&(n.delete(S.id),D.fill.destroy(),D.stroke.destroy(),u(A,P))},p=(S,A)=>{const P=n.get(S);P&&(n.delete(S),P.fill.destroy(),P.stroke.destroy(),u(P.annotation,A))},m=(S,A)=>{i.resize(S,A),i.render(t)},y=S=>{Yn=!1;const{children:A}=t;n.forEach(({fill:P,stroke:D,annotation:k})=>{const U=S?s.has(k.id)||S(k):!0;U&&!A.includes(P)?(t.addChild(P),t.addChild(D)):!U&&A.includes(P)&&(t.removeChild(P),t.removeChild(D))}),i.render(t)},v=S=>{o!==S&&(o&&p(o,{selected:s.has(o)}),S&&p(S,{selected:s.has(S),hovered:!0}),o=S,i.render(t))},_=S=>{const A=S.selected.map(k=>k.id),P=A.filter(k=>!s.has(k)),D=[...s].filter(k=>!A.includes(k));[...P,...D].forEach(k=>p(k,{selected:A.includes(k),hovered:k===o})),s=new Set(A),i.render(t)},T=S=>{if(typeof S=="function")n.forEach(({annotation:A,fill:P,stroke:D,strokeWidth:k},U)=>{k>1&&(Yn=!1);const j={selected:s.has(A.id),hovered:o===A.id},{fillStyle:q,strokeStyle:ee}=zp(S(A,j));P.tint=q.tint,P.alpha=q.alpha,D.tint=ee.tint||16777215,D.alpha=ee.alpha,n.set(A.id,{annotation:A,fill:P,stroke:D,strokeWidth:ee.lineWidth})});else{const{fillStyle:A,strokeStyle:P}=zp(S);P.lineWidth>1&&(Yn=!1),n.forEach(({annotation:D,fill:k,stroke:U,strokeWidth:j},q)=>{k.tint=A.tint,k.alpha=A.alpha,U.tint=P.tint||16777215,U.alpha=P.alpha,n.set(D.id,{annotation:D,fill:k,stroke:U,strokeWidth:P.lineWidth})})}l=S,i.render(t),Cx(r,t,n,i)()},E=S=>{S?e.classList.remove("hidden"):e.classList.add("hidden")};return{addAnnotation:u,destroy:()=>i.destroy(),redraw:Cx(r,t,n,i),removeAnnotation:c,resize:m,setFilter:y,setHovered:v,setSelected:_,setStyle:T,setVisible:E,updateAnnotation:d}};function W2(r,e,t){let i,n,{filter:s}=e,{state:o}=e,{style:l}=e,{viewer:u}=e,{visible:c=!0}=e;const{store:d,hover:p,selection:m,viewport:y}=o;yh(r,p,k=>t(11,i=k)),yh(r,m,k=>t(8,n=k));const v=am();let _,T;const E=k=>{const U=new el.Point(k.x,k.y),{x:j,y:q}=u.viewport.pointFromPixel(U);return u.viewport.viewportToImageCoordinates(j,q)},S=k=>{const{x:U,y:j}=k.position;T={x:U,y:j}},A=k=>U=>{const{x:j,y:q}=E(new el.Point(U.offsetX,U.offsetY)),ee=d.getAt(j,q);ee&&(!s||s(ee))?(k.classList.add("hover"),i!==ee.id&&(p.set(ee.id),_.setHovered(ee.id))):(k.classList.remove("hover"),i&&(p.set(void 0),_.setHovered(void 0)))},P=k=>{if(!T)return;const U=k.originalEvent,{x:j,y:q}=k.position,ee=j-T.x,pe=q-T.y;if(Math.sqrt(ee*ee+pe*pe)<5){const{x:H,y:F}=E(k.position),G=d.getAt(H,F);G?v("click",{originalEvent:U,annotation:G}):v("click",{originalEvent:U})}T=void 0};let D;return Hh(()=>{var k;const{offsetWidth:U,offsetHeight:j}=u.canvas,q=document.createElement("canvas");q.width=U,q.height=j,q.className="a9s-gl-canvas",(k=u.element.querySelector(".openseadragon-canvas"))==null||k.appendChild(q),t(7,_=X2(u,q));const ee=A(q);q.addEventListener("pointermove",ee);const pe=new ResizeObserver(le=>{try{const{width:ie,height:Y}=le[0].contentRect;q.width=ie,q.height=Y,_.resize(ie,Y)}catch{console.warn("WebGL canvas already disposed")}});pe.observe(q);const H=()=>{const le=u.viewport.getBounds();D=u.viewport.viewportToImageRectangle(le);const{x:ie,y:Y,width:de,height:z}=D,N=d.getIntersecting(ie,Y,de,z);y.set(N.map(W=>W.id))};u.addHandler("canvas-press",S),u.addHandler("canvas-release",P),u.addHandler("update-viewport",_.redraw),u.addHandler("animation-finish",H);const F=le=>le.filter(ie=>Ls(ie)),G=le=>Ls(le.oldValue)&&Ls(le.newValue),$=le=>{const{created:ie,updated:Y,deleted:de}=le.changes;if(F(ie||[]).forEach(z=>_.addAnnotation(z)),F(de||[]).forEach(z=>_.removeAnnotation(z)),(Y||[]).filter(z=>G(z)).forEach(({oldValue:z,newValue:N})=>_.updateAnnotation(z,N)),D){const{x:z,y:N,width:W,height:re}=D,_e=d.getIntersecting(z,N,W,re);y.set(_e.map(me=>me.id))}else y.set(d.all().map(z=>z.id));_.redraw()};return d.observe($),()=>{var le;q.removeEventListener("pointermove",ee),pe.disconnect(),u.removeHandler("canvas-press",S),u.removeHandler("canvas-release",P),u.removeHandler("update-viewport",_.redraw),u.removeHandler("animation-finish",H),d.unobserve($),_.destroy(),(le=q.parentNode)==null||le.removeChild(q)}}),r.$$set=k=>{"filter"in k&&t(2,s=k.filter),"state"in k&&t(3,o=k.state),"style"in k&&t(4,l=k.style),"viewer"in k&&t(5,u=k.viewer),"visible"in k&&t(6,c=k.visible)},r.$$.update=()=>{r.$$.dirty&132&&(_==null||_.setFilter(s)),r.$$.dirty&384&&(_==null||_.setSelected(n)),r.$$.dirty&144&&(_==null||_.setStyle(l)),r.$$.dirty&192&&(_==null||_.setVisible(c))},[p,m,s,o,l,u,c,_,n]}class Y2 extends qi{constructor(e){super(),Yi(this,e,W2,null,Oi,{filter:2,state:3,style:4,viewer:5,visible:6})}}const _i=[];for(let r=0;r<256;++r)_i.push((r+256).toString(16).slice(1));function q2(r,e=0){return(_i[r[e+0]]+_i[r[e+1]]+_i[r[e+2]]+_i[r[e+3]]+"-"+_i[r[e+4]]+_i[r[e+5]]+"-"+_i[r[e+6]]+_i[r[e+7]]+"-"+_i[r[e+8]]+_i[r[e+9]]+"-"+_i[r[e+10]]+_i[r[e+11]]+_i[r[e+12]]+_i[r[e+13]]+_i[r[e+14]]+_i[r[e+15]]).toLowerCase()}let zf;const Z2=new Uint8Array(16);function Q2(){if(!zf){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");zf=crypto.getRandomValues.bind(crypto)}return zf(Z2)}const K2=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Rx={randomUUID:K2};function J2(r,e,t){var i;if(Rx.randomUUID&&!r)return Rx.randomUUID();r=r||{};const n=r.random??((i=r.rng)==null?void 0:i.call(r))??Q2();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,q2(n)}var $n=(r=>(r.ELLIPSE="ELLIPSE",r.MULTIPOLYGLON="MULTIPOLYGON",r.POLYGON="POLYGON",r.RECTANGLE="RECTANGLE",r))($n||{});const ec=(r,e)=>e,Gp=r=>{let e=0,t=r.length-1;for(let i=0;i<r.length;i++)e+=(r[t][0]+r[i][0])*(r[t][1]-r[i][1]),t=i;return Math.abs(.5*e)},Vp=(r,e,t)=>{let i=!1;for(let n=0,s=r.length-1;n<r.length;s=n++){const o=r[n][0],l=r[n][1],u=r[s][0],c=r[s][1];l>t!=c>t&&e<(u-o)*(t-l)/(c-l)+o&&(i=!i)}return i},$2={area:r=>Math.PI*r.geometry.rx*r.geometry.ry,intersects:(r,e,t)=>{const{cx:i,cy:n,rx:s,ry:o}=r.geometry,l=0,u=Math.cos(l),c=Math.sin(l),d=e-i,p=t-n,m=u*d+c*p,y=c*d-u*p;return m*m/(s*s)+y*y/(o*o)<=1}};ec($n.ELLIPSE,$2);const eN={area:r=>{const{polygons:e}=r.geometry;return e.reduce((t,i)=>{const[n,...s]=i.rings,o=Gp(n.points),l=s.reduce((u,c)=>u+Gp(c.points),0);return t+o-l},0)},intersects:(r,e,t)=>{const{polygons:i}=r.geometry;for(const n of i){const[s,...o]=n.rings;if(Vp(s.points,e,t)){let l=!1;for(const u of o)if(Vp(u.points,e,t)){l=!0;break}if(!l)return!0}}return!1}};ec($n.MULTIPOLYGLON,eN);const tN={area:r=>{const e=r.geometry.points;return Gp(e)},intersects:(r,e,t)=>{const i=r.geometry.points;return Vp(i,e,t)}};ec($n.POLYGON,tN);const iN={area:r=>r.geometry.w*r.geometry.h,intersects:(r,e,t)=>e>=r.geometry.x&&e<=r.geometry.x+r.geometry.w&&t>=r.geometry.y&&t<=r.geometry.y+r.geometry.h};ec($n.RECTANGLE,iN);const jt=" ";function rN(r){let e="";Array.isArray(r)||(r=[r]);for(let t=0;t<r.length;t++){const i=r[t];if(i.type===ae.CLOSE_PATH)e+="z";else if(i.type===ae.HORIZ_LINE_TO)e+=(i.relative?"h":"H")+i.x;else if(i.type===ae.VERT_LINE_TO)e+=(i.relative?"v":"V")+i.y;else if(i.type===ae.MOVE_TO)e+=(i.relative?"m":"M")+i.x+jt+i.y;else if(i.type===ae.LINE_TO)e+=(i.relative?"l":"L")+i.x+jt+i.y;else if(i.type===ae.CURVE_TO)e+=(i.relative?"c":"C")+i.x1+jt+i.y1+jt+i.x2+jt+i.y2+jt+i.x+jt+i.y;else if(i.type===ae.SMOOTH_CURVE_TO)e+=(i.relative?"s":"S")+i.x2+jt+i.y2+jt+i.x+jt+i.y;else if(i.type===ae.QUAD_TO)e+=(i.relative?"q":"Q")+i.x1+jt+i.y1+jt+i.x+jt+i.y;else if(i.type===ae.SMOOTH_QUAD_TO)e+=(i.relative?"t":"T")+i.x+jt+i.y;else if(i.type===ae.ARC)e+=(i.relative?"a":"A")+i.rX+jt+i.rY+jt+i.xRot+jt+ +i.lArcFlag+jt+ +i.sweepFlag+jt+i.x+jt+i.y;else throw new Error(`Unexpected command type "${i==null?void 0:i.type}" at index ${t}.`)}return e}function jp([r,e],t){return[r*Math.cos(t)-e*Math.sin(t),r*Math.sin(t)+e*Math.cos(t)]}function Pr(...r){for(let e=0;e<r.length;e++)if(typeof r[e]!="number")throw new Error(`assertNumbers arguments[${e}] is not a number. ${typeof r[e]} == typeof ${r[e]}`);return!0}const qn=Math.PI;function _m(r,e,t){r.lArcFlag=r.lArcFlag===0?0:1,r.sweepFlag=r.sweepFlag===0?0:1;let{rX:i,rY:n}=r;const{x:s,y:o}=r;if(Math.abs(i)<1e-10||Math.abs(n)<1e-10){r.rX=0,r.rY=0,r.cX=(e+s)/2,r.cY=(t+o)/2,r.phi1=0,r.phi2=0;return}i=Math.abs(r.rX),n=Math.abs(r.rY);const l=r.xRot/180*qn,[u,c]=jp([(e-s)/2,(t-o)/2],-l),d=Math.pow(u,2)/Math.pow(i,2)+Math.pow(c,2)/Math.pow(n,2);1<d&&(i*=Math.sqrt(d),n*=Math.sqrt(d)),r.rX=i,r.rY=n;const p=Math.pow(i,2)*Math.pow(c,2)+Math.pow(n,2)*Math.pow(u,2),m=(r.lArcFlag!==r.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(i,2)*Math.pow(n,2)-p)/p)),y=i*c/n*m,v=-n*u/i*m,_=jp([y,v],l);r.cX=_[0]+(e+s)/2,r.cY=_[1]+(t+o)/2,r.phi1=Math.atan2((c-v)/n,(u-y)/i),r.phi2=Math.atan2((-c-v)/n,(-u-y)/i),r.sweepFlag===0&&r.phi2>r.phi1&&(r.phi2-=2*qn),r.sweepFlag===1&&r.phi2<r.phi1&&(r.phi2+=2*qn),r.phi1*=180/qn,r.phi2*=180/qn}function Px(r,e,t){Pr(r,e,t);const i=r*r+e*e-t*t;if(0>i)return[];if(i===0)return[[r*t/(r*r+e*e),e*t/(r*r+e*e)]];const n=Math.sqrt(i);return[[(r*t+e*n)/(r*r+e*e),(e*t-r*n)/(r*r+e*e)],[(r*t-e*n)/(r*r+e*e),(e*t+r*n)/(r*r+e*e)]]}const Ss=Math.PI/180;function Ox(r,e,t){return(1-t)*r+t*e}function Ix(r,e,t,i){return r+Math.cos(i/180*qn)*e+Math.sin(i/180*qn)*t}function Mx(r,e,t,i){const n=e-r,s=t-e,o=i-t,l=3*n+3*o-6*s,u=(s-n)*6,c=3*n;return Math.abs(l)<1e-6?Math.abs(u)<1e-6?[]:[-c/u]:nN(u/l,c/l,1e-6)}function Nx(r,e,t,i,n){const s=1-n,o=s*s*s,l=3*s*s*n,u=3*s*n*n,c=n*n*n;return r*o+e*l+t*u+i*c}function nN(r,e,t=1e-6){const i=r*r/4-e;if(i<-t)return[];if(i<=t)return[-r/2];const n=Math.sqrt(i);return[-(r/2)-n,-(r/2)+n]}function sN(r,e,t){r.cX||_m(r,e,t);const i=r.xRot/180*qn;if(Math.abs(r.rX)<1e-10||Math.abs(r.rY)<1e-10)return[{relative:r.relative,type:ae.CURVE_TO,x1:e+(r.x-e)/3,y1:t+(r.y-t)/3,x2:e+2*(r.x-e)/3,y2:t+2*(r.y-t)/3,x:r.x,y:r.y}];const n=Math.min(r.phi1,r.phi2),s=Math.max(r.phi1,r.phi2),o=s-n,l=Math.ceil(o/90),u=new Array(l);let c=e,d=t;const p=(m,y)=>{const[v,_]=jp([m*r.rX,y*r.rY],i);return[r.cX+v,r.cY+_]};for(let m=0;m<l;m++){const y=Ox(r.phi1,r.phi2,m/l),v=Ox(r.phi1,r.phi2,(m+1)/l),_=v-y,T=4/3*Math.tan(_*Ss/4),E=Math.cos(y*Ss)-T*Math.sin(y*Ss),S=Math.sin(y*Ss)+T*Math.cos(y*Ss),A=Math.cos(v*Ss),P=Math.sin(v*Ss),D=A+T*P,k=P-T*A,U=p(E,S),j=p(D,k),q=p(A,P),ee={relative:r.relative,type:ae.CURVE_TO,x:q[0],y:q[1],x1:U[0],y1:U[1],x2:j[0],y2:j[1]};r.relative&&(ee.x1-=c,ee.y1-=d,ee.x2-=c,ee.y2-=d,ee.x-=c,ee.y-=d),c=q[0],d=q[1],u[m]=ee}return u}function Gf(r,e,t){const i=e[0]-r[0],n=e[1]-r[1],s=t[0]-r[0],o=t[1]-r[1],l=i*o-n*s;if(!(Math.abs(l)<1e-10))return!1;const u=i*s+n*o,c=i*i+n*n,d=s*s+o*o;return 0<=u&&u<=d&&c<=d}function oN(r,e=!0){if(r.length<2)return r;const t=Yt.INFO((s,o,l)=>({...s,x:s.x??o,y:s.y??l,relative:s.relative??!1})),i=[];let n=[];for(const s of r){const o=t(s);o.type===ae.MOVE_TO&&n.length>0&&(e?i.push(...eh(n)):i.unshift(...eh(n)),n=[]),n.push(o)}return n.length>0&&(e?i.push(...eh(n)):i.unshift(...eh(n))),i}function eh(r){var e;const t=((e=r[r.length-1])==null?void 0:e.type)===ae.CLOSE_PATH,i=t?r.length-2:r.length-1,n=[{type:ae.MOVE_TO,relative:!1,x:r[i].x,y:r[i].y}];for(let s=i;s>0;s--){const o=r[s],l=r[s-1];if(o.relative)throw new Error("Relative command are not supported convert first with `toAbs()`");switch(o.type){case ae.HORIZ_LINE_TO:n.push({type:ae.HORIZ_LINE_TO,relative:!1,x:l.x});break;case ae.VERT_LINE_TO:n.push({type:ae.VERT_LINE_TO,relative:!1,y:l.y});break;case ae.LINE_TO:case ae.MOVE_TO:n.push({type:ae.LINE_TO,relative:!1,x:l.x,y:l.y});break;case ae.CURVE_TO:n.push({type:ae.CURVE_TO,relative:!1,x:l.x,y:l.y,x1:o.x2,y1:o.y2,x2:o.x1,y2:o.y1});break;case ae.SMOOTH_CURVE_TO:throw new Error("Unsupported command: S (smooth cubic bezier)");case ae.SMOOTH_QUAD_TO:throw new Error("Unsupported command: T (smooth quadratic bezier)");case ae.ARC:throw new Error("Unsupported command: A (arc)");case ae.QUAD_TO:throw new Error("Unsupported command: Q (quadratic bezier)")}}return t&&n.push({type:ae.CLOSE_PATH}),n}function aN(r=1e13){Pr(r);function e(t){return Math.round(t*r)/r}return function(t){return"x1"in t&&typeof t.x1<"u"&&(t.x1=e(t.x1)),"y1"in t&&typeof t.y1<"u"&&(t.y1=e(t.y1)),"x2"in t&&typeof t.x2<"u"&&(t.x2=e(t.x2)),"y2"in t&&typeof t.y2<"u"&&(t.y2=e(t.y2)),"x"in t&&typeof t.x<"u"&&(t.x=e(t.x)),"y"in t&&typeof t.y<"u"&&(t.y=e(t.y)),"rX"in t&&typeof t.rX<"u"&&(t.rX=e(t.rX)),"rY"in t&&typeof t.rY<"u"&&(t.rY=e(t.rY)),t}}function fw(){return Or((r,e,t)=>(r.relative&&(typeof r.x1<"u"&&(r.x1+=e),typeof r.y1<"u"&&(r.y1+=t),typeof r.x2<"u"&&(r.x2+=e),typeof r.y2<"u"&&(r.y2+=t),typeof r.x<"u"&&(r.x+=e),typeof r.y<"u"&&(r.y+=t),r.relative=!1),r))}function lN(){return Or((r,e,t)=>(r.relative||(typeof r.x1<"u"&&(r.x1-=e),typeof r.y1<"u"&&(r.y1-=t),typeof r.x2<"u"&&(r.x2-=e),typeof r.y2<"u"&&(r.y2-=t),typeof r.x<"u"&&(r.x-=e),typeof r.y<"u"&&(r.y-=t),r.relative=!0),r))}function uN(r=!0,e=!0,t=!0,i=!0){return Or((n,s,o,l,u)=>{if(isNaN(l)&&!(n.type&ae.MOVE_TO))throw new Error("path must start with moveto");if(e&&n.type&ae.HORIZ_LINE_TO&&(n.type=ae.LINE_TO,n.y=n.relative?0:o),t&&n.type&ae.VERT_LINE_TO&&(n.type=ae.LINE_TO,n.x=n.relative?0:s),r&&n.type&ae.CLOSE_PATH&&(n.type=ae.LINE_TO,n.x=n.relative?l-s:l,n.y=n.relative?u-o:u),n.type&ae.ARC&&(n.rX===0||n.rY===0)&&(n.type=ae.LINE_TO,delete n.rX,delete n.rY,delete n.xRot,delete n.lArcFlag,delete n.sweepFlag),i&&n.type&ae.QUAD_TO){const c=[s,o],d=n.relative?[s+n.x1,o+n.y1]:[n.x1,n.y1],p=n.relative?[s+n.x,o+n.y]:[n.x,n.y];Gf(c,d,p)&&(n.type=ae.LINE_TO,delete n.x1,delete n.y1)}if(i&&n.type&ae.CURVE_TO){const c=[s,o],d=n.relative?[s+n.x1,o+n.y1]:[n.x1,n.y1],p=n.relative?[s+n.x2,o+n.y2]:[n.x2,n.y2],m=n.relative?[s+n.x,o+n.y]:[n.x,n.y];Gf(c,d,m)&&Gf(c,p,m)&&(n.type=ae.LINE_TO,delete n.x1,delete n.y1,delete n.x2,delete n.y2)}return n})}function pw(){let r=NaN,e=NaN,t=NaN,i=NaN;return Or((n,s,o)=>(n.type&ae.SMOOTH_CURVE_TO&&(n.type=ae.CURVE_TO,r=isNaN(r)?s:r,e=isNaN(e)?o:e,n.x1=n.relative?s-r:2*s-r,n.y1=n.relative?o-e:2*o-e),n.type&ae.CURVE_TO?(r=n.relative?s+n.x2:n.x2,e=n.relative?o+n.y2:n.y2):(r=NaN,e=NaN),n.type&ae.SMOOTH_QUAD_TO&&(n.type=ae.QUAD_TO,t=isNaN(t)?s:t,i=isNaN(i)?o:i,n.x1=n.relative?s-t:2*s-t,n.y1=n.relative?o-i:2*o-i),n.type&ae.QUAD_TO?(t=n.relative?s+n.x1:n.x1,i=n.relative?o+n.y1:n.y1):(t=NaN,i=NaN),n))}function mw(){let r=NaN,e=NaN;return Or((t,i,n)=>{if(t.type&ae.SMOOTH_QUAD_TO&&(t.type=ae.QUAD_TO,r=isNaN(r)?i:r,e=isNaN(e)?n:e,t.x1=t.relative?i-r:2*i-r,t.y1=t.relative?n-e:2*n-e),t.type&ae.QUAD_TO){r=t.relative?i+t.x1:t.x1,e=t.relative?n+t.y1:t.y1;const s=t.x1,o=t.y1;t.type=ae.CURVE_TO,t.x1=((t.relative?0:i)+s*2)/3,t.y1=((t.relative?0:n)+o*2)/3,t.x2=(t.x+s*2)/3,t.y2=(t.y+o*2)/3}else r=NaN,e=NaN;return t})}function Or(r){let e=0,t=0,i=NaN,n=NaN;return function(s){if(isNaN(i)&&!(s.type&ae.MOVE_TO))throw new Error("path must start with moveto");const o=r(s,e,t,i,n);return s.type&ae.CLOSE_PATH&&(e=i,t=n),"x"in s&&typeof s.x<"u"&&(e=s.relative?e+s.x:s.x),"y"in s&&typeof s.y<"u"&&(t=s.relative?t+s.y:s.y),s.type&ae.MOVE_TO&&(i=e,n=t),o}}function hN(r=0){Pr(r);let e=NaN,t=NaN,i=NaN,n=NaN;return Or((s,o,l,u,c)=>{const d=Math.abs;let p=!1,m=0,y=0;if(s.type&ae.SMOOTH_CURVE_TO&&(m=isNaN(e)?0:o-e,y=isNaN(t)?0:l-t),s.type&(ae.CURVE_TO|ae.SMOOTH_CURVE_TO)?(e=s.relative?o+s.x2:s.x2,t=s.relative?l+s.y2:s.y2):(e=NaN,t=NaN),s.type&ae.SMOOTH_QUAD_TO?(i=isNaN(i)?o:2*o-i,n=isNaN(n)?l:2*l-n):s.type&ae.QUAD_TO?(i=s.relative?o+s.x1:s.x1,n=s.relative?l+s.y1:s.y2):(i=NaN,n=NaN),s.type&ae.LINE_COMMANDS||s.type&ae.ARC&&(s.rX===0||s.rY===0||!s.lArcFlag)||s.type&ae.CURVE_TO||s.type&ae.SMOOTH_CURVE_TO||s.type&ae.QUAD_TO||s.type&ae.SMOOTH_QUAD_TO){const v=typeof s.x>"u"?0:s.relative?s.x:s.x-o,_=typeof s.y>"u"?0:s.relative?s.y:s.y-l;m=isNaN(i)?typeof s.x1>"u"?m:s.relative?s.x:s.x1-o:i-o,y=isNaN(n)?typeof s.y1>"u"?y:s.relative?s.y:s.y1-l:n-l;const T=typeof s.x2>"u"?0:s.relative?s.x:s.x2-o,E=typeof s.y2>"u"?0:s.relative?s.y:s.y2-l;d(v)<=r&&d(_)<=r&&d(m)<=r&&d(y)<=r&&d(T)<=r&&d(E)<=r&&(p=!0)}return s.type&ae.CLOSE_PATH&&d(o-u)<=r&&d(l-c)<=r&&(p=!0),p?[]:s})}function os(r,e,t,i,n,s){return Pr(r,e,t,i,n,s),Or((o,l,u,c)=>{const d=o.x1,p=o.x2,m=o.relative&&!isNaN(c),y=typeof o.x<"u"?o.x:m?0:l,v=typeof o.y<"u"?o.y:m?0:u;o.type&ae.HORIZ_LINE_TO&&e!==0&&(o.type=ae.LINE_TO,o.y=o.relative?0:u),o.type&ae.VERT_LINE_TO&&t!==0&&(o.type=ae.LINE_TO,o.x=o.relative?0:l),typeof o.x<"u"&&(o.x=o.x*r+v*t+(m?0:n)),typeof o.y<"u"&&(o.y=y*e+o.y*i+(m?0:s)),typeof o.x1<"u"&&(o.x1=o.x1*r+o.y1*t+(m?0:n)),typeof o.y1<"u"&&(o.y1=d*e+o.y1*i+(m?0:s)),typeof o.x2<"u"&&(o.x2=o.x2*r+o.y2*t+(m?0:n)),typeof o.y2<"u"&&(o.y2=p*e+o.y2*i+(m?0:s));function _(E){return E*E}const T=r*i-e*t;if(typeof o.xRot<"u"&&(r!==1||e!==0||t!==0||i!==1))if(T===0)delete o.rX,delete o.rY,delete o.xRot,delete o.lArcFlag,delete o.sweepFlag,o.type=ae.LINE_TO;else{const E=o.xRot*Math.PI/180,S=Math.sin(E),A=Math.cos(E),P=1/_(o.rX),D=1/_(o.rY),k=_(A)*P+_(S)*D,U=2*S*A*(P-D),j=_(S)*P+_(A)*D,q=k*i*i-U*e*i+j*e*e,ee=U*(r*i+e*t)-2*(k*t*i+j*r*e),pe=k*t*t-U*r*t+j*r*r,H=(Math.atan2(ee,q-pe)+Math.PI)%Math.PI/2,F=Math.sin(H),G=Math.cos(H);o.rX=Math.abs(T)/Math.sqrt(q*_(G)+ee*F*G+pe*_(F)),o.rY=Math.abs(T)/Math.sqrt(q*_(F)-ee*F*G+pe*_(G)),o.xRot=H*180/Math.PI}return typeof o.sweepFlag<"u"&&0>T&&(o.sweepFlag=+!o.sweepFlag),o})}function cN(r,e=0,t=0){Pr(r,e,t);const i=Math.sin(r),n=Math.cos(r);return os(n,i,-i,n,e-e*n+t*i,t-e*i-t*n)}function dN(r,e=0){return Pr(r,e),os(1,0,0,1,r,e)}function fN(r,e=r){return Pr(r,e),os(r,0,0,e,0,0)}function pN(r){return Pr(r),os(1,0,Math.tan(r),1,0,0)}function mN(r){return Pr(r),os(1,Math.tan(r),0,1,0,0)}function gN(r=0){return Pr(r),os(-1,0,0,1,r,0)}function yN(r=0){return Pr(r),os(1,0,0,-1,0,r)}function vN(){return Or((r,e,t)=>ae.ARC===r.type?sN(r,r.relative?0:e,r.relative?0:t):r)}function _N(){return Or((r,e,t)=>(r.relative&&(e=0,t=0),ae.ARC===r.type&&_m(r,e,t),r))}function gw(){return r=>({...r})}function xN(){const r=gw(),e=fw(),t=mw(),i=pw(),n=Or((s,o,l)=>{const u=i(t(e(r(s))));function c(p){p>n.maxX&&(n.maxX=p),p<n.minX&&(n.minX=p)}function d(p){p>n.maxY&&(n.maxY=p),p<n.minY&&(n.minY=p)}if(u.type&ae.DRAWING_COMMANDS&&(c(o),d(l)),u.type&ae.HORIZ_LINE_TO&&c(u.x),u.type&ae.VERT_LINE_TO&&d(u.y),u.type&ae.LINE_TO&&(c(u.x),d(u.y)),u.type&ae.CURVE_TO){c(u.x),d(u.y);const p=Mx(o,u.x1,u.x2,u.x);for(const y of p)0<y&&1>y&&c(Nx(o,u.x1,u.x2,u.x,y));const m=Mx(l,u.y1,u.y2,u.y);for(const y of m)0<y&&1>y&&d(Nx(l,u.y1,u.y2,u.y,y))}if(u.type&ae.ARC){c(u.x),d(u.y),_m(u,o,l);const p=u.xRot/180*Math.PI,m=Math.cos(p)*u.rX,y=Math.sin(p)*u.rX,v=-Math.sin(p)*u.rY,_=Math.cos(p)*u.rY,[T,E]=u.phi1<u.phi2?[u.phi1,u.phi2]:-180>u.phi2?[u.phi2+360,u.phi1+360]:[u.phi2,u.phi1],S=([D,k])=>{const U=Math.atan2(k,D)*180/Math.PI;return U<T?U+360:U},A=Px(v,-m,0).map(S);for(const D of A)D>T&&D<E&&c(Ix(u.cX,m,v,D));const P=Px(_,-y,0).map(S);for(const D of P)D>T&&D<E&&d(Ix(u.cY,y,_,D))}return s});return n.minX=1/0,n.maxX=-1/0,n.minY=1/0,n.maxY=-1/0,n}const Yt={ROUND:aN,TO_ABS:fw,TO_REL:lN,NORMALIZE_HVZ:uN,NORMALIZE_ST:pw,QT_TO_C:mw,INFO:Or,SANITIZE:hN,MATRIX:os,ROTATE:cN,TRANSLATE:dN,SCALE:fN,SKEW_X:pN,SKEW_Y:mN,X_AXIS_SYMMETRY:gN,Y_AXIS_SYMMETRY:yN,A_TO_C:vN,ANNOTATE_ARCS:_N,CLONE:gw,CALCULATE_BOUNDS:xN,REVERSE_PATH:oN};class yw{round(e){return this.transform(Yt.ROUND(e))}toAbs(){return this.transform(Yt.TO_ABS())}toRel(){return this.transform(Yt.TO_REL())}normalizeHVZ(e,t,i){return this.transform(Yt.NORMALIZE_HVZ(e,t,i))}normalizeST(){return this.transform(Yt.NORMALIZE_ST())}qtToC(){return this.transform(Yt.QT_TO_C())}aToC(){return this.transform(Yt.A_TO_C())}sanitize(e){return this.transform(Yt.SANITIZE(e))}translate(e,t){return this.transform(Yt.TRANSLATE(e,t))}scale(e,t){return this.transform(Yt.SCALE(e,t))}rotate(e,t,i){return this.transform(Yt.ROTATE(e,t,i))}matrix(e,t,i,n,s,o){return this.transform(Yt.MATRIX(e,t,i,n,s,o))}skewX(e){return this.transform(Yt.SKEW_X(e))}skewY(e){return this.transform(Yt.SKEW_Y(e))}xSymmetry(e){return this.transform(Yt.X_AXIS_SYMMETRY(e))}ySymmetry(e){return this.transform(Yt.Y_AXIS_SYMMETRY(e))}annotateArcs(){return this.transform(Yt.ANNOTATE_ARCS())}}const TN=r=>r===" "||r==="	"||r==="\r"||r===`
`,Dx=r=>48<=r.charCodeAt(0)&&r.charCodeAt(0)<=57;class wN extends yw{constructor(){super(),Rt(this,"curNumber",""),Rt(this,"curCommandType",-1),Rt(this,"curCommandRelative",!1),Rt(this,"canParseCommandOrComma",!0),Rt(this,"curNumberHasExp",!1),Rt(this,"curNumberHasExpDigits",!1),Rt(this,"curNumberHasDecimal",!1),Rt(this,"curArgs",[])}finish(e=[]){if(this.parse(" ",e),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return e}parse(e,t=[]){const i=n=>{t.push(n),this.curArgs.length=0,this.canParseCommandOrComma=!0};for(let n=0;n<e.length;n++){const s=e[n],o=this.curCommandType===ae.ARC&&(this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber.length===1&&(this.curNumber==="0"||this.curNumber==="1"),l=Dx(s)&&(this.curNumber==="0"&&s==="0"||o);if(Dx(s)&&!l){this.curNumber+=s,this.curNumberHasExpDigits=this.curNumberHasExp;continue}if(s==="e"||s==="E"){this.curNumber+=s,this.curNumberHasExp=!0;continue}if((s==="-"||s==="+")&&this.curNumberHasExp&&!this.curNumberHasExpDigits){this.curNumber+=s;continue}if(s==="."&&!this.curNumberHasExp&&!this.curNumberHasDecimal&&!o){this.curNumber+=s,this.curNumberHasDecimal=!0;continue}if(this.curNumber&&this.curCommandType!==-1){const u=Number(this.curNumber);if(isNaN(u))throw new SyntaxError(`Invalid number ending at ${n}`);if(this.curCommandType===ae.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>u)throw new SyntaxError(`Expected positive number, got "${u}" at index "${n}"`)}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError(`Expected a flag, got "${this.curNumber}" at index "${n}"`)}this.curArgs.push(u),this.curArgs.length===EN[this.curCommandType]&&(ae.HORIZ_LINE_TO===this.curCommandType?i({type:ae.HORIZ_LINE_TO,relative:this.curCommandRelative,x:u}):ae.VERT_LINE_TO===this.curCommandType?i({type:ae.VERT_LINE_TO,relative:this.curCommandRelative,y:u}):this.curCommandType===ae.MOVE_TO||this.curCommandType===ae.LINE_TO||this.curCommandType===ae.SMOOTH_QUAD_TO?(i({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),ae.MOVE_TO===this.curCommandType&&(this.curCommandType=ae.LINE_TO)):this.curCommandType===ae.CURVE_TO?i({type:ae.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===ae.SMOOTH_CURVE_TO?i({type:ae.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===ae.QUAD_TO?i({type:ae.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===ae.ARC&&i({type:ae.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!TN(s)){if(s===","&&this.canParseCommandOrComma){this.canParseCommandOrComma=!1;continue}if(s==="+"||s==="-"||s==="."){this.curNumber=s,this.curNumberHasDecimal=s===".";continue}if(l){this.curNumber=s,this.curNumberHasDecimal=!1;continue}if(this.curArgs.length!==0)throw new SyntaxError(`Unterminated command at index ${n}.`);if(!this.canParseCommandOrComma)throw new SyntaxError(`Unexpected character "${s}" at index ${n}. Command cannot follow comma`);if(this.canParseCommandOrComma=!1,s==="z"||s==="Z"){t.push({type:ae.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1;continue}else if(s==="h"||s==="H")this.curCommandType=ae.HORIZ_LINE_TO,this.curCommandRelative=s==="h";else if(s==="v"||s==="V")this.curCommandType=ae.VERT_LINE_TO,this.curCommandRelative=s==="v";else if(s==="m"||s==="M")this.curCommandType=ae.MOVE_TO,this.curCommandRelative=s==="m";else if(s==="l"||s==="L")this.curCommandType=ae.LINE_TO,this.curCommandRelative=s==="l";else if(s==="c"||s==="C")this.curCommandType=ae.CURVE_TO,this.curCommandRelative=s==="c";else if(s==="s"||s==="S")this.curCommandType=ae.SMOOTH_CURVE_TO,this.curCommandRelative=s==="s";else if(s==="q"||s==="Q")this.curCommandType=ae.QUAD_TO,this.curCommandRelative=s==="q";else if(s==="t"||s==="T")this.curCommandType=ae.SMOOTH_QUAD_TO,this.curCommandRelative=s==="t";else if(s==="a"||s==="A")this.curCommandType=ae.ARC,this.curCommandRelative=s==="a";else throw new SyntaxError(`Unexpected character "${s}" at index ${n}.`)}}return t}transform(e){return Object.create(this,{parse:{value(t,i=[]){const n=Object.getPrototypeOf(this).parse.call(this,t);for(const s of n){const o=e(s);Array.isArray(o)?i.push(...o):i.push(o)}return i}}})}}const St=class Xp extends yw{constructor(e){super(),Rt(this,"commands"),typeof e=="string"?this.commands=Xp.parse(e):this.commands=e}encode(){return Xp.encode(this.commands)}getBounds(){const e=Yt.CALCULATE_BOUNDS();return this.transform(e),e}transform(e){const t=[];for(const i of this.commands){const n=e(i);Array.isArray(n)?t.push(...n):t.push(n)}return this.commands=t,this}reverse(e=!0){return this.commands=Yt.REVERSE_PATH(this.commands,e),this}static encode(e){return rN(e)}static parse(e){const t=new wN,i=[];return t.parse(e,i),t.finish(i),i}};Rt(St,"CLOSE_PATH",1),Rt(St,"MOVE_TO",2),Rt(St,"HORIZ_LINE_TO",4),Rt(St,"VERT_LINE_TO",8),Rt(St,"LINE_TO",16),Rt(St,"CURVE_TO",32),Rt(St,"SMOOTH_CURVE_TO",64),Rt(St,"QUAD_TO",128),Rt(St,"SMOOTH_QUAD_TO",256),Rt(St,"ARC",512),Rt(St,"LINE_COMMANDS",St.LINE_TO|St.HORIZ_LINE_TO|St.VERT_LINE_TO),Rt(St,"DRAWING_COMMANDS",St.HORIZ_LINE_TO|St.VERT_LINE_TO|St.LINE_TO|St.CURVE_TO|St.SMOOTH_CURVE_TO|St.QUAD_TO|St.SMOOTH_QUAD_TO|St.ARC);let ae=St;const EN={[ae.MOVE_TO]:2,[ae.LINE_TO]:2,[ae.HORIZ_LINE_TO]:1,[ae.VERT_LINE_TO]:1,[ae.CLOSE_PATH]:0,[ae.QUAD_TO]:4,[ae.SMOOTH_QUAD_TO]:2,[ae.CURVE_TO]:6,[ae.SMOOTH_CURVE_TO]:4,[ae.ARC]:7};$n.RECTANGLE,$n.POLYGON,$n.MULTIPOLYGLON;const SN=(r,e)=>{const t=typeof e=="function"?e(r):e;if(t){const{fill:i,fillOpacity:n,stroke:s,strokeWidth:o,strokeOpacity:l}=t;let u="";return i&&(u+=`fill:${i};`,u+=`fill-opacity:${n||"0.25"};`),s&&(u+=`stroke:${s};`,u+=`stroke-width:${o||"1"};`,u+=`stroke-opacity:${l||"1"};`),u}};function AN(r,e,t){let i;const n=am();let{annotation:s}=e,{editor:o}=e,{style:l}=e,{target:u}=e,{transform:c}=e,{viewportScale:d}=e,p;return Hh(()=>(t(6,p=new o({target:u,props:{shape:s.target.selector,computedStyle:i,transform:c,viewportScale:d}})),p.$on("change",m=>{p.$$set({shape:m.detail}),n("change",m.detail)}),p.$on("grab",m=>n("grab",m.detail)),p.$on("release",m=>n("release",m.detail)),()=>{p.$destroy()})),r.$$set=m=>{"annotation"in m&&t(0,s=m.annotation),"editor"in m&&t(1,o=m.editor),"style"in m&&t(2,l=m.style),"target"in m&&t(3,u=m.target),"transform"in m&&t(4,c=m.transform),"viewportScale"in m&&t(5,d=m.viewportScale)},r.$$.update=()=>{r.$$.dirty&5&&t(7,i=SN(s,l)),r.$$.dirty&65&&s&&(p==null||p.$set({shape:s.target.selector})),r.$$.dirty&80&&p&&p.$set({transform:c}),r.$$.dirty&96&&p&&p.$set({viewportScale:d}),r.$$.dirty&192&&p&&i&&p.$set({computedStyle:i})},[s,o,l,u,c,d,p,i]}class bN extends qi{constructor(e){super(),Yi(this,e,AN,null,Oi,{annotation:0,editor:1,style:2,target:3,transform:4,viewportScale:5})}}typeof navigator>"u"||navigator.userAgent.indexOf("Mac OS X");const vw=(r,e,t,i)=>{if(!i)return r;if(e.shiftKey||e.ctrlKey||e.metaKey){const n=(t.selected||[]).map(s=>s.id);return n.includes(r)?n.filter(s=>s!==r):[...n,r]}else return r},CN=r=>({transform:r&2,scale:r&1}),Lx=r=>({transform:r[1],scale:r[0]});function RN(r){let e;const t=r[4].default,i=sC(t,r,r[3],Lx);return{c(){i&&i.c()},m(n,s){i&&i.m(n,s),e=!0},p(n,[s]){i&&i.p&&(!e||s&11)&&aC(i,t,n,n[3],e?oC(t,n[3],s,CN):lC(n[3]),Lx)},i(n){e||(qe(i,n),e=!0)},o(n){tt(i,n),e=!1},d(n){i&&i.d(n)}}}function PN(r,e,t){let{$$slots:i={},$$scope:n}=e,{viewer:s}=e,o=1,l;const u=()=>{const c=s.viewport.getContainerSize().x,d=s.viewport.getZoom(!0),p=s.viewport.getFlip(),m=s.viewport.pixelFromPoint(new el.Point(0,0),!0);p&&(m.x=c-m.x);const y=d*c/s.world.getContentFactor(),v=p?-y:y,_=s.viewport.getRotation(!0);t(1,l=`translate(${m.x}, ${m.y}) scale(${v}, ${y}) rotate(${_})`),t(0,o=d*c/s.world.getContentFactor())};return Hh(()=>(s.addHandler("update-viewport",u),()=>{s.removeHandler("update-viewport",u)})),r.$$set=c=>{"viewer"in c&&t(2,s=c.viewer),"$$scope"in c&&t(3,n=c.$$scope)},[o,l,s,n,i]}class xm extends qi{constructor(e){super(),Yi(this,e,PN,RN,Oi,{viewer:2})}}function ON(r,e,t){const i=am();let{drawingMode:n}=e,{opts:s}=e,{target:o}=e,{tool:l}=e,{transform:u}=e,{viewer:c}=e,{viewportScale:d}=e,p;return Hh(()=>{const m=o.closest("svg"),y=[],v=(_,T,E)=>{if(m==null||m.addEventListener(_,T,E),y.push(()=>m==null?void 0:m.removeEventListener(_,T,E)),_==="pointerup"||_==="dblclick"){const S=P=>{const{originalEvent:D}=P;T(D)},A=_==="pointerup"?"canvas-click":"canvas-double-click";c.addHandler(A,S),y.push(()=>c.removeHandler(A,S))}else if(_==="pointermove"){const S=A=>{const{originalEvent:P}=A;T(P)};c.addHandler("canvas-drag",S),y.push(()=>c.removeHandler("canvas-drag",S))}};return t(7,p=new l({target:o,props:{addEventListener:v,drawingMode:n,opts:s,transform:u,viewportScale:d}})),p.$on("create",_=>i("create",_.detail)),()=>{y.forEach(_=>_()),p.$destroy()}}),r.$$set=m=>{"drawingMode"in m&&t(0,n=m.drawingMode),"opts"in m&&t(1,s=m.opts),"target"in m&&t(2,o=m.target),"tool"in m&&t(3,l=m.tool),"transform"in m&&t(4,u=m.transform),"viewer"in m&&t(5,c=m.viewer),"viewportScale"in m&&t(6,d=m.viewportScale)},r.$$.update=()=>{r.$$.dirty&144&&p&&p.$set({transform:u}),r.$$.dirty&192&&p&&p.$set({viewportScale:d})},[n,s,o,l,u,c,d,p]}class IN extends qi{constructor(e){super(),Yi(this,e,ON,null,Oi,{drawingMode:0,opts:1,target:2,tool:3,transform:4,viewer:5,viewportScale:6})}}function Fx(r,e,t){const i=r.slice();i[35]=e[t];const n=i[16](i[35].target.selector);return i[36]=n,i}function MN(r){let e=`${r[2]}-${r[6]}`,t,i,n=Bx(r);return{c(){n.c(),t=xn()},m(s,o){n.m(s,o),di(s,t,o),i=!0},p(s,o){o[0]&68&&Oi(e,e=`${s[2]}-${s[6]}`)?(sr(),tt(n,1,1,ki),or(),n=Bx(s),n.c(),qe(n,1),n.m(t.parentNode,t)):n.p(s,o)},i(s){i||(qe(n),i=!0)},o(s){tt(n),i=!1},d(s){s&&ei(t),n.d(s)}}}function NN(r){let e,t,i=Wo(r[8].filter(r[26])),n=[];for(let o=0;o<i.length;o+=1)n[o]=Hx(Fx(r,i,o));const s=o=>tt(n[o],1,1,()=>{n[o]=null});return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=xn()},m(o,l){for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(o,l);di(o,e,l),t=!0},p(o,l){if(l[0]&96642|l[1]&8){i=Wo(o[8].filter(o[26]));let u;for(u=0;u<i.length;u+=1){const c=Fx(o,i,u);n[u]?(n[u].p(c,l),qe(n[u],1)):(n[u]=Hx(c),n[u].c(),qe(n[u],1),n[u].m(e.parentNode,e))}for(sr(),u=i.length;u<n.length;u+=1)s(u);or()}},i(o){if(!t){for(let l=0;l<i.length;l+=1)qe(n[l]);t=!0}},o(o){n=n.filter(Boolean);for(let l=0;l<n.length;l+=1)tt(n[l]);t=!1},d(o){o&&ei(e),sm(n,o)}}}function Bx(r){let e,t;return e=new IN({props:{target:r[7],tool:r[9],drawingMode:r[4],transform:{elementToImage:r[11]},viewer:r[3],viewportScale:r[34],opts:r[5]}}),e.$on("create",r[15]),{c(){ar(e.$$.fragment)},m(i,n){Xi(e,i,n),t=!0},p(i,n){const s={};n[0]&128&&(s.target=i[7]),n[0]&512&&(s.tool=i[9]),n[0]&16&&(s.drawingMode=i[4]),n[0]&8&&(s.viewer=i[3]),n[1]&8&&(s.viewportScale=i[34]),n[0]&32&&(s.opts=i[5]),e.$set(s)},i(i){t||(qe(e.$$.fragment,i),t=!0)},o(i){tt(e.$$.fragment,i),t=!1},d(i){Wi(e,i)}}}function kx(r){let e=r[35].id,t,i,n=Ux(r);return{c(){n.c(),t=xn()},m(s,o){n.m(s,o),di(s,t,o),i=!0},p(s,o){o[0]&256&&Oi(e,e=s[35].id)?(sr(),tt(n,1,1,ki),or(),n=Ux(s),n.c(),qe(n,1),n.m(t.parentNode,t)):n.p(s,o)},i(s){i||(qe(n),i=!0)},o(s){tt(n),i=!1},d(s){s&&ei(t),n.d(s)}}}function Ux(r){let e,t;return e=new bN({props:{target:r[7],editor:r[16](r[35].target.selector),annotation:r[35],style:r[1],transform:{elementToImage:r[11]},viewportScale:r[34]}}),e.$on("grab",r[12]),e.$on("change",function(){nm(r[14](r[35]))&&r[14](r[35]).apply(this,arguments)}),e.$on("release",r[13]),{c(){ar(e.$$.fragment)},m(i,n){Xi(e,i,n),t=!0},p(i,n){r=i;const s={};n[0]&128&&(s.target=r[7]),n[0]&256&&(s.editor=r[16](r[35].target.selector)),n[0]&256&&(s.annotation=r[35]),n[0]&2&&(s.style=r[1]),n[1]&8&&(s.viewportScale=r[34]),e.$set(s)},i(i){t||(qe(e.$$.fragment,i),t=!0)},o(i){tt(e.$$.fragment,i),t=!1},d(i){Wi(e,i)}}}function Hx(r){let e,t,i=r[36]&&kx(r);return{c(){i&&i.c(),e=xn()},m(n,s){i&&i.m(n,s),di(n,e,s),t=!0},p(n,s){n[36]?i?(i.p(n,s),s[0]&256&&qe(i,1)):(i=kx(n),i.c(),qe(i,1),i.m(e.parentNode,e)):i&&(sr(),tt(i,1,1,()=>{i=null}),or())},i(n){t||(qe(i),t=!0)},o(n){tt(i),t=!1},d(n){n&&ei(e),i&&i.d(n)}}}function DN(r){let e,t,i,n,s,o;const l=[NN,MN],u=[];function c(d,p){var m;return d[7]&&((m=d[8])==null?void 0:m.length)===1?0:d[7]&&d[9]&&d[0]?1:-1}return~(i=c(r))&&(n=u[i]=l[i](r)),{c(){e=hi("svg"),t=hi("g"),n&&n.c(),Se(t,"transform",s=r[33]),Se(t,"class","svelte-190cqdf"),Se(e,"class","a9s-annotationlayer a9s-osd-drawinglayer svelte-190cqdf"),e_(e,"drawing",r[0])},m(d,p){di(d,e,p),Yr(e,t),~i&&u[i].m(t,null),r[27](t),o=!0},p(d,p){let m=i;i=c(d),i===m?~i&&u[i].p(d,p):(n&&(sr(),tt(u[m],1,1,()=>{u[m]=null}),or()),~i?(n=u[i],n?n.p(d,p):(n=u[i]=l[i](d),n.c()),qe(n,1),n.m(t,null)):n=null),(!o||p[1]&4&&s!==(s=d[33]))&&Se(t,"transform",s),(!o||p[0]&1)&&e_(e,"drawing",d[0])},i(d){o||(qe(n),o=!0)},o(d){tt(n),o=!1},d(d){d&&ei(e),~i&&u[i].d(),r[27](null)}}}function LN(r){let e,t;return e=new xm({props:{viewer:r[3],$$slots:{default:[DN,({transform:i,scale:n})=>({33:i,34:n}),({transform:i,scale:n})=>[0,(i?4:0)|(n?8:0)]]},$$scope:{ctx:r}}}),{c(){ar(e.$$.fragment)},m(i,n){Xi(e,i,n),t=!0},p(i,n){const s={};n[0]&8&&(s.viewer=i[3]),n[0]&1023|n[1]&268&&(s.$$scope={dirty:n,ctx:i}),e.$set(s)},i(i){t||(qe(e.$$.fragment,i),t=!0)},o(i){tt(e.$$.fragment,i),t=!1},d(i){Wi(e,i)}}}function FN(r,e,t){let i,n,s,o,{drawingEnabled:l}=e,{filter:u}=e,{multiSelect:c}=e,{preferredDrawingMode:d}=e,{state:p}=e,{style:m=void 0}=e,{toolName:y=_0()[0]}=e,{user:v}=e,{viewer:_}=e,T=0;const E=()=>t(6,T+=1),S=()=>y,A=()=>l;let P;const{store:D,selection:k,hover:U}=p;yh(r,k,z=>t(25,o=z));let j,q,ee;const pe=z=>{D.unobserve(j);const N=z.filter(({editable:W})=>W).map(({id:W})=>W);N.length>0?(t(8,q=N.map(W=>D.getAnnotation(W))),j=W=>{const{updated:re}=W.changes;t(8,q=(re||[]).map(_e=>_e.newValue))},D.observe(j,{annotations:N}),_.forceRedraw()):t(8,q=void 0)},H=(z,N)=>{const{x:W,y:re}=_.viewport.viewerElementToImageCoordinates(new el.Point(z,N));return[W,re]},F=z=>{_.setMouseNavEnabled(!1),ee=z.timeStamp},G=z=>{if(_.setMouseNavEnabled(!0),performance.now()-(ee||0)<300){const{offsetX:N,offsetY:W}=z.detail,[re,_e]=H(N,W),me=D.getAt(re,_e);if(me&&(!u||u(me))&&!q.find(Pe=>Pe.id===me.id)){U.set(me.id);const Pe=vw(me.id,z.detail,k,c);k.userSelect(Pe)}}},$=z=>N=>{var W;const{target:re}=z,_e=10*60*1e3,me=((W=re.creator)==null?void 0:W.id)!==v.id||!re.created||new Date().getTime()-re.created.getTime()>_e;D.updateTarget({...re,selector:N.detail,created:me?re.created:new Date,updated:me?new Date:void 0,updatedBy:me?v:void 0})},le=z=>{const N=J2(),W={id:N,bodies:[],target:{annotation:N,selector:z.detail,creator:v,created:new Date}};D.addAnnotation(W),k.setSelected(W.id),_.setMouseNavEnabled(!0)},ie=z=>Pb(z),Y=z=>Ls(z);function de(z){vh[z?"unshift":"push"](()=>{P=z,t(7,P)})}return r.$$set=z=>{"drawingEnabled"in z&&t(0,l=z.drawingEnabled),"filter"in z&&t(17,u=z.filter),"multiSelect"in z&&t(18,c=z.multiSelect),"preferredDrawingMode"in z&&t(19,d=z.preferredDrawingMode),"state"in z&&t(20,p=z.state),"style"in z&&t(1,m=z.style),"toolName"in z&&t(2,y=z.toolName),"user"in z&&t(21,v=z.user),"viewer"in z&&t(3,_=z.viewer)},r.$$.update=()=>{r.$$.dirty[0]&4&&t(9,{tool:i,opts:n}=x0(y)||{tool:void 0,opts:void 0},i,(t(5,n),t(2,y))),r.$$.dirty[0]&524320&&t(4,s=(n==null?void 0:n.drawingMode)||d),r.$$.dirty[0]&25&&(l&&s==="drag"?_.setMouseNavEnabled(!1):_.setMouseNavEnabled(!0)),r.$$.dirty[0]&1&&l&&k.clear(),r.$$.dirty[0]&33554457&&o.selected.length===0&&s==="drag"&&l&&_.setMouseNavEnabled(!1),r.$$.dirty[0]&33554432&&pe(o.selected)},[l,m,y,_,s,n,T,P,q,i,k,H,F,G,$,le,ie,u,c,d,p,v,E,S,A,o,Y,de]}class BN extends qi{constructor(e){super(),Yi(this,e,FN,LN,Oi,{drawingEnabled:0,filter:17,multiSelect:18,preferredDrawingMode:19,state:20,style:1,toolName:2,user:21,viewer:3,cancelDrawing:22,getDrawingTool:23,isDrawingEnabled:24},null,[-1,-1])}get cancelDrawing(){return this.$$.ctx[22]}get getDrawingTool(){return this.$$.ctx[23]}get isDrawingEnabled(){return this.$$.ctx[24]}}function kN(r){let e,t,i,n,s,o,l,u=r[2].appearance.label+"",c,d,p,m;return{c(){e=hi("g"),t=hi("rect"),l=hi("text"),c=A0(u),Se(t,"class","a9s-presence-label-bg svelte-1rehw2p"),Se(t,"x",r[0]),Se(t,"y",i=r[1]-18/r[3]),Se(t,"height",n=18/r[3]),Se(t,"fill",s=r[2].appearance.color),Se(t,"stroke",o=r[2].appearance.color),Se(l,"font-size",d=12/r[3]),Se(l,"x",p=r[0]+Math.round(5/r[3])),Se(l,"y",m=r[1]-5/r[3]),Se(l,"class","svelte-1rehw2p"),Se(e,"class","a9s-presence-label")},m(y,v){di(y,e,v),Yr(e,t),Yr(e,l),Yr(l,c),r[6](e)},p(y,[v]){v&1&&Se(t,"x",y[0]),v&10&&i!==(i=y[1]-18/y[3])&&Se(t,"y",i),v&8&&n!==(n=18/y[3])&&Se(t,"height",n),v&4&&s!==(s=y[2].appearance.color)&&Se(t,"fill",s),v&4&&o!==(o=y[2].appearance.color)&&Se(t,"stroke",o),v&4&&u!==(u=y[2].appearance.label+"")&&hC(c,u),v&8&&d!==(d=12/y[3])&&Se(l,"font-size",d),v&9&&p!==(p=y[0]+Math.round(5/y[3]))&&Se(l,"x",p),v&10&&m!==(m=y[1]-5/y[3])&&Se(l,"y",m)},i:ki,o:ki,d(y){y&&ei(e),r[6](null)}}}function UN(r,e,t){let{x:i}=e,{y:n}=e,{user:s}=e,{scale:o}=e,{hAlign:l=null}=e,u;const c=p=>{const m=u.querySelector("text"),y=u.querySelector("rect"),v=m.getBBox().width+10/p;l==="CENTER"&&u.setAttribute("style",`transform: translateX(-${v/2}px)`),y.setAttribute("width",`${v}`)};function d(p){vh[p?"unshift":"push"](()=>{u=p,t(4,u)})}return r.$$set=p=>{"x"in p&&t(0,i=p.x),"y"in p&&t(1,n=p.y),"user"in p&&t(2,s=p.user),"scale"in p&&t(3,o=p.scale),"hAlign"in p&&t(5,l=p.hAlign)},r.$$.update=()=>{r.$$.dirty&24&&u&&c(o)},[i,n,s,o,u,l,d]}class _w extends qi{constructor(e){super(),Yi(this,e,UN,kN,Oi,{x:0,y:1,user:2,scale:3,hAlign:5})}}function HN(r){let e,t,i,n,s,o;return t=new _w({props:{scale:r[1],user:r[0],x:r[3][0],y:r[3][1],hAlign:"CENTER"}}),{c(){e=hi("g"),ar(t.$$.fragment),i=hi("polygon"),Se(i,"class","a9s-presence-shape a9s-presence-polygon svelte-fgq4n0"),Se(i,"stroke",n=r[0].appearance.color),Se(i,"fill","transparent"),Se(i,"points",s=r[2].points.map(zx).join(" ")),Se(e,"class","a9s-presence-overlay")},m(l,u){di(l,e,u),Xi(t,e,null),Yr(e,i),o=!0},p(l,[u]){const c={};u&2&&(c.scale=l[1]),u&1&&(c.user=l[0]),u&8&&(c.x=l[3][0]),u&8&&(c.y=l[3][1]),t.$set(c),(!o||u&1&&n!==(n=l[0].appearance.color))&&Se(i,"stroke",n),(!o||u&4&&s!==(s=l[2].points.map(zx).join(" ")))&&Se(i,"points",s)},i(l){o||(qe(t.$$.fragment,l),o=!0)},o(l){tt(t.$$.fragment,l),o=!1},d(l){l&&ei(e),Wi(t)}}}const zx=r=>r.join(",");function zN(r,e,t){let i,n,{annotation:s}=e,{user:o}=e,{scale:l}=e;const u=c=>{let[d,...p]=c.points;return p.forEach(([m,y])=>{y<d[1]&&(d=[m,y])}),d};return r.$$set=c=>{"annotation"in c&&t(4,s=c.annotation),"user"in c&&t(0,o=c.user),"scale"in c&&t(1,l=c.scale)},r.$$.update=()=>{r.$$.dirty&16&&t(2,i=s.target.selector.geometry),r.$$.dirty&4&&t(3,n=u(i))},[o,l,i,n,s]}class GN extends qi{constructor(e){super(),Yi(this,e,zN,HN,Oi,{annotation:4,user:0,scale:1})}}function VN(r){let e,t,i,n,s,o,l,u,c;return t=new _w({props:{scale:r[1],user:r[0],x:r[2].x,y:r[2].y}}),{c(){e=hi("g"),ar(t.$$.fragment),i=hi("rect"),Se(i,"class","a9s-presence-shape a9s-presence-rectangle svelte-gze948"),Se(i,"stroke",n=r[0].appearance.color),Se(i,"fill","transparent"),Se(i,"x",s=r[2].x),Se(i,"y",o=r[2].y),Se(i,"width",l=r[2].w),Se(i,"height",u=r[2].h),Se(e,"class","a9s-presence-overlay")},m(d,p){di(d,e,p),Xi(t,e,null),Yr(e,i),c=!0},p(d,[p]){const m={};p&2&&(m.scale=d[1]),p&1&&(m.user=d[0]),p&4&&(m.x=d[2].x),p&4&&(m.y=d[2].y),t.$set(m),(!c||p&1&&n!==(n=d[0].appearance.color))&&Se(i,"stroke",n),(!c||p&4&&s!==(s=d[2].x))&&Se(i,"x",s),(!c||p&4&&o!==(o=d[2].y))&&Se(i,"y",o),(!c||p&4&&l!==(l=d[2].w))&&Se(i,"width",l),(!c||p&4&&u!==(u=d[2].h))&&Se(i,"height",u)},i(d){c||(qe(t.$$.fragment,d),c=!0)},o(d){tt(t.$$.fragment,d),c=!1},d(d){d&&ei(e),Wi(t)}}}function jN(r,e,t){let i,{annotation:n}=e,{user:s}=e,{scale:o}=e;return r.$$set=l=>{"annotation"in l&&t(3,n=l.annotation),"user"in l&&t(0,s=l.user),"scale"in l&&t(1,o=l.scale)},r.$$.update=()=>{r.$$.dirty&8&&t(2,i=n.target.selector.geometry)},[s,o,i,n]}class XN extends qi{constructor(e){super(),Yi(this,e,jN,VN,Oi,{annotation:3,user:0,scale:1})}}const{Boolean:WN}=S0;function Gx(r,e,t){const i=r.slice();return i[8]=e[t],i}function Vx(r){let e,t;return e=new xm({props:{viewer:r[0],$$slots:{default:[ZN,({transform:i,scale:n})=>({6:i,7:n}),({transform:i,scale:n})=>(i?64:0)|(n?128:0)]},$$scope:{ctx:r}}}),{c(){ar(e.$$.fragment)},m(i,n){Xi(e,i,n),t=!0},p(i,n){const s={};n&1&&(s.viewer=i[0]),n&2244&&(s.$$scope={dirty:n,ctx:i}),e.$set(s)},i(i){t||(qe(e.$$.fragment,i),t=!0)},o(i){tt(e.$$.fragment,i),t=!1},d(i){Wi(e,i)}}}function jx(r){let e,t,i=Wo(r[2]),n=[];for(let o=0;o<i.length;o+=1)n[o]=Xx(Gx(r,i,o));const s=o=>tt(n[o],1,1,()=>{n[o]=null});return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=xn()},m(o,l){for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(o,l);di(o,e,l),t=!0},p(o,l){if(l&132){i=Wo(o[2]);let u;for(u=0;u<i.length;u+=1){const c=Gx(o,i,u);n[u]?(n[u].p(c,l),qe(n[u],1)):(n[u]=Xx(c),n[u].c(),qe(n[u],1),n[u].m(e.parentNode,e))}for(sr(),u=i.length;u<n.length;u+=1)s(u);or()}},i(o){if(!t){for(let l=0;l<i.length;l+=1)qe(n[l]);t=!0}},o(o){n=n.filter(WN);for(let l=0;l<n.length;l+=1)tt(n[l]);t=!1},d(o){o&&ei(e),sm(n,o)}}}function YN(r){let e,t;return e=new GN({props:{annotation:r[8].annotation,user:r[8].selectedBy,scale:r[7]}}),{c(){ar(e.$$.fragment)},m(i,n){Xi(e,i,n),t=!0},p(i,n){const s={};n&4&&(s.annotation=i[8].annotation),n&4&&(s.user=i[8].selectedBy),n&128&&(s.scale=i[7]),e.$set(s)},i(i){t||(qe(e.$$.fragment,i),t=!0)},o(i){tt(e.$$.fragment,i),t=!1},d(i){Wi(e,i)}}}function qN(r){let e,t;return e=new XN({props:{annotation:r[8].annotation,user:r[8].selectedBy,scale:r[7]}}),{c(){ar(e.$$.fragment)},m(i,n){Xi(e,i,n),t=!0},p(i,n){const s={};n&4&&(s.annotation=i[8].annotation),n&4&&(s.user=i[8].selectedBy),n&128&&(s.scale=i[7]),e.$set(s)},i(i){t||(qe(e.$$.fragment,i),t=!0)},o(i){tt(e.$$.fragment,i),t=!1},d(i){Wi(e,i)}}}function Xx(r){let e,t,i,n;const s=[qN,YN],o=[];function l(u,c){return u[8].annotation.target.selector.type===Ht.RECTANGLE?0:u[8].annotation.target.selector.type===Ht.POLYGON?1:-1}return~(e=l(r))&&(t=o[e]=s[e](r)),{c(){t&&t.c(),i=xn()},m(u,c){~e&&o[e].m(u,c),di(u,i,c),n=!0},p(u,c){let d=e;e=l(u),e===d?~e&&o[e].p(u,c):(t&&(sr(),tt(o[d],1,1,()=>{o[d]=null}),or()),~e?(t=o[e],t?t.p(u,c):(t=o[e]=s[e](u),t.c()),qe(t,1),t.m(i.parentNode,i)):t=null)},i(u){n||(qe(t),n=!0)},o(u){tt(t),n=!1},d(u){u&&ei(i),~e&&o[e].d(u)}}}function ZN(r){let e,t,i,n,s=r[2].length>0&&jx(r);return{c(){e=hi("svg"),t=hi("g"),s&&s.c(),Se(t,"transform",i=r[6]),Se(e,"class","a9s-osd-presencelayer svelte-1krwc4m")},m(o,l){di(o,e,l),Yr(e,t),s&&s.m(t,null),n=!0},p(o,l){o[2].length>0?s?(s.p(o,l),l&4&&qe(s,1)):(s=jx(o),s.c(),qe(s,1),s.m(t,null)):s&&(sr(),tt(s,1,1,()=>{s=null}),or()),(!n||l&64&&i!==(i=o[6]))&&Se(t,"transform",i)},i(o){n||(qe(s),n=!0)},o(o){tt(s),n=!1},d(o){o&&ei(e),s&&s.d()}}}function QN(r){let e=!!r[1],t,i,n=e&&Vx(r);return{c(){n&&n.c(),t=xn()},m(s,o){n&&n.m(s,o),di(s,t,o),i=!0},p(s,[o]){o&2&&(e=!!s[1]),e?n?(n.p(s,o),o&2&&qe(n,1)):(n=Vx(s),n.c(),qe(n,1),n.m(t.parentNode,t)):n&&(sr(),tt(n,1,1,()=>{n=null}),or())},i(s){i||(qe(n),i=!0)},o(s){tt(n),i=!1},d(s){s&&ei(t),n&&n.d(s)}}}function KN(r,e,t){let{store:i}=e,{viewer:n}=e,{provider:s}=e,o=[],l;const u=(c,d)=>{t(2,o=[...o.filter(({selectedBy:p})=>p.presenceKey!==c.presenceKey),...(d||[]).map(p=>({annotation:i.getAnnotation(p),selectedBy:c}))].filter(({annotation:p})=>(p||console.warn("Selection event on unknown annotation"),!!p))),l&&i.unobserve(l),l=p=>{const{deleted:m,updated:y}=p.changes,v=new Set((m||[]).map(T=>T.id)),_=o.filter(({annotation:T})=>!v.has(T.id)).map(T=>{const E=(y||[]).find(S=>S.oldValue.id===T.annotation.id);return E?{selectedBy:T.selectedBy,annotation:E.newValue}:T});t(2,o=_)},i.observe(l,{annotations:o.map(p=>p.annotation.id)})};return dC(()=>{l&&i.unobserve(l)}),r.$$set=c=>{"store"in c&&t(3,i=c.store),"viewer"in c&&t(0,n=c.viewer),"provider"in c&&t(1,s=c.provider)},r.$$.update=()=>{r.$$.dirty&2&&s&&s.on("selectionChange",u)},[n,s,o,i]}class JN extends qi{constructor(e){super(),Yi(this,e,KN,QN,Oi,{store:3,viewer:0,provider:1})}}function $N(r){let e,t,i,n,s;return{c(){e=hi("rect"),Se(e,"x",t=r[0].x),Se(e,"y",i=r[0].y),Se(e,"width",n=r[0].w),Se(e,"height",s=r[0].h)},m(o,l){di(o,e,l)},p(o,[l]){l&1&&t!==(t=o[0].x)&&Se(e,"x",t),l&1&&i!==(i=o[0].y)&&Se(e,"y",i),l&1&&n!==(n=o[0].w)&&Se(e,"width",n),l&1&&s!==(s=o[0].h)&&Se(e,"height",s)},i:ki,o:ki,d(o){o&&ei(e)}}}function eD(r,e,t){let i,{annotation:n}=e;return r.$$set=s=>{"annotation"in s&&t(1,n=s.annotation)},r.$$.update=()=>{r.$$.dirty&2&&t(0,i=n.target.selector.geometry)},[i,n]}class tD extends qi{constructor(e){super(),Yi(this,e,eD,$N,Oi,{annotation:1})}}function iD(r){let e,t;return{c(){e=hi("polygon"),Se(e,"points",t=r[0].points.map(Wx).join(" "))},m(i,n){di(i,e,n)},p(i,[n]){n&1&&t!==(t=i[0].points.map(Wx).join(" "))&&Se(e,"points",t)},i:ki,o:ki,d(i){i&&ei(e)}}}const Wx=r=>r.join(",");function rD(r,e,t){let i,{annotation:n}=e;return r.$$set=s=>{"annotation"in s&&t(1,n=s.annotation)},r.$$.update=()=>{r.$$.dirty&2&&t(0,i=n.target.selector.geometry)},[i,n]}class nD extends qi{constructor(e){super(),Yi(this,e,rD,iD,Oi,{annotation:1})}}function sD(r){let e,t,i,n,s;return{c(){e=hi("ellipse"),Se(e,"cx",t=r[0].cx),Se(e,"cy",i=r[0].cy),Se(e,"rx",n=r[0].rx),Se(e,"ry",s=r[0].ry)},m(o,l){di(o,e,l)},p(o,[l]){l&1&&t!==(t=o[0].cx)&&Se(e,"cx",t),l&1&&i!==(i=o[0].cy)&&Se(e,"cy",i),l&1&&n!==(n=o[0].rx)&&Se(e,"rx",n),l&1&&s!==(s=o[0].ry)&&Se(e,"ry",s)},i:ki,o:ki,d(o){o&&ei(e)}}}function oD(r,e,t){let i,{annotation:n}=e;return r.$$set=s=>{"annotation"in s&&t(1,n=s.annotation)},r.$$.update=()=>{r.$$.dirty&2&&t(0,i=n.target.selector.geometry)},[i,n]}class aD extends qi{constructor(e){super(),Yi(this,e,oD,sD,Oi,{annotation:1})}}const{Boolean:lD}=S0;function Yx(r,e,t){const i=r.slice();return i[10]=e[t],i}function qx(r){let e,t;return e=new xm({props:{viewer:r[0],$$slots:{default:[dD,({transform:i})=>({9:i}),({transform:i})=>i?512:0]},$$scope:{ctx:r}}}),{c(){ar(e.$$.fragment)},m(i,n){Xi(e,i,n),t=!0},p(i,n){const s={};n&1&&(s.viewer=i[0]),n&8710&&(s.$$scope={dirty:n,ctx:i}),e.$set(s)},i(i){t||(qe(e.$$.fragment,i),t=!0)},o(i){tt(e.$$.fragment,i),t=!1},d(i){Wi(e,i)}}}function uD(r){let e,t;return e=new aD({props:{annotation:r[10]}}),{c(){ar(e.$$.fragment)},m(i,n){Xi(e,i,n),t=!0},p(i,n){const s={};n&2&&(s.annotation=i[10]),e.$set(s)},i(i){t||(qe(e.$$.fragment,i),t=!0)},o(i){tt(e.$$.fragment,i),t=!1},d(i){Wi(e,i)}}}function hD(r){let e,t;return e=new nD({props:{annotation:r[10]}}),{c(){ar(e.$$.fragment)},m(i,n){Xi(e,i,n),t=!0},p(i,n){const s={};n&2&&(s.annotation=i[10]),e.$set(s)},i(i){t||(qe(e.$$.fragment,i),t=!0)},o(i){tt(e.$$.fragment,i),t=!1},d(i){Wi(e,i)}}}function cD(r){let e,t;return e=new tD({props:{annotation:r[10]}}),{c(){ar(e.$$.fragment)},m(i,n){Xi(e,i,n),t=!0},p(i,n){const s={};n&2&&(s.annotation=i[10]),e.$set(s)},i(i){t||(qe(e.$$.fragment,i),t=!0)},o(i){tt(e.$$.fragment,i),t=!1},d(i){Wi(e,i)}}}function Zx(r){let e,t,i,n;const s=[cD,hD,uD],o=[];function l(u,c){return u[10].target.selector.type===Ht.RECTANGLE?0:u[10].target.selector.type===Ht.POLYGON?1:u[10].target.selector.type===Ht.ELLIPSE?2:-1}return~(e=l(r))&&(t=o[e]=s[e](r)),{c(){t&&t.c(),i=xn()},m(u,c){~e&&o[e].m(u,c),di(u,i,c),n=!0},p(u,c){let d=e;e=l(u),e===d?~e&&o[e].p(u,c):(t&&(sr(),tt(o[d],1,1,()=>{o[d]=null}),or()),~e?(t=o[e],t?t.p(u,c):(t=o[e]=s[e](u),t.c()),qe(t,1),t.m(i.parentNode,i)):t=null)},i(u){n||(qe(t),n=!0)},o(u){tt(t),n=!1},d(u){u&&ei(i),~e&&o[e].d(u)}}}function dD(r){let e,t,i,n,s,o,l,u,c,d,p,m,y,v,_=Wo(r[1].filter(r[6])),T=[];for(let S=0;S<_.length;S+=1)T[S]=Zx(Yx(r,_,S));const E=S=>tt(T[S],1,1,()=>{T[S]=null});return{c(){var S,A,P,D;e=hi("svg"),t=hi("g"),i=hi("rect"),u=hi("rect");for(let k=0;k<T.length;k+=1)T[k].c();Se(i,"class","a9s-union-bg svelte-n2zwns"),Se(i,"x",n=(S=r[2])==null?void 0:S.minX),Se(i,"y",s=(A=r[2])==null?void 0:A.minY),Se(i,"width",o=r[2]?r[2].maxX-r[2].minX:0),Se(i,"height",l=r[2]?r[2].maxY-r[2].minY:0),Se(u,"class","a9s-union-fg svelte-n2zwns"),Se(u,"x",c=(P=r[2])==null?void 0:P.minX),Se(u,"y",d=(D=r[2])==null?void 0:D.minY),Se(u,"width",p=r[2]?r[2].maxX-r[2].minX:0),Se(u,"height",m=r[2]?r[2].maxY-r[2].minY:0),Se(t,"transform",y=r[9]),Se(e,"class","a9s-osd-selectionlayer svelte-n2zwns")},m(S,A){di(S,e,A),Yr(e,t),Yr(t,i),Yr(t,u);for(let P=0;P<T.length;P+=1)T[P]&&T[P].m(t,null);v=!0},p(S,A){var P,D,k,U;if((!v||A&4&&n!==(n=(P=S[2])==null?void 0:P.minX))&&Se(i,"x",n),(!v||A&4&&s!==(s=(D=S[2])==null?void 0:D.minY))&&Se(i,"y",s),(!v||A&4&&o!==(o=S[2]?S[2].maxX-S[2].minX:0))&&Se(i,"width",o),(!v||A&4&&l!==(l=S[2]?S[2].maxY-S[2].minY:0))&&Se(i,"height",l),(!v||A&4&&c!==(c=(k=S[2])==null?void 0:k.minX))&&Se(u,"x",c),(!v||A&4&&d!==(d=(U=S[2])==null?void 0:U.minY))&&Se(u,"y",d),(!v||A&4&&p!==(p=S[2]?S[2].maxX-S[2].minX:0))&&Se(u,"width",p),(!v||A&4&&m!==(m=S[2]?S[2].maxY-S[2].minY:0))&&Se(u,"height",m),A&2){_=Wo(S[1].filter(S[6]));let j;for(j=0;j<_.length;j+=1){const q=Yx(S,_,j);T[j]?(T[j].p(q,A),qe(T[j],1)):(T[j]=Zx(q),T[j].c(),qe(T[j],1),T[j].m(t,null))}for(sr(),j=_.length;j<T.length;j+=1)E(j);or()}(!v||A&512&&y!==(y=S[9]))&&Se(t,"transform",y)},i(S){if(!v){for(let A=0;A<_.length;A+=1)qe(T[A]);v=!0}},o(S){T=T.filter(lD);for(let A=0;A<T.length;A+=1)tt(T[A]);v=!1},d(S){S&&ei(e),sm(T,S)}}}function fD(r){let e=!!r[2],t,i,n=e&&qx(r);return{c(){n&&n.c(),t=xn()},m(s,o){n&&n.m(s,o),di(s,t,o),i=!0},p(s,[o]){o&4&&(e=!!s[2]),e?n?(n.p(s,o),o&4&&qe(n,1)):(n=qx(s),n.c(),qe(n,1),n.m(t.parentNode,t)):n&&(sr(),tt(n,1,1,()=>{n=null}),or())},i(s){i||(qe(n),i=!0)},o(s){tt(n),i=!1},d(s){s&&ei(t),n&&n.d(s)}}}function pD(r,e,t){let i,n,s,{state:o}=e,{viewer:l}=e;const{store:u}=o,{selection:c}=o;yh(r,c,m=>t(5,s=m));const d=m=>{let y=-1/0,v=-1/0,_=1/0,T=1/0;for(let E of m.filter(S=>Ls(S))){const{bounds:S}=E.target.selector.geometry;S.maxX>y&&(y=S.maxX),S.maxY>v&&(v=S.maxY),S.minX<_&&(_=S.minX),S.minY<T&&(T=S.minY)}return l.forceRedraw(),{maxX:y,maxY:v,minX:_,minY:T}},p=m=>Ls(m);return r.$$set=m=>{"state"in m&&t(4,o=m.state),"viewer"in m&&t(0,l=m.viewer)},r.$$.update=()=>{r.$$.dirty&32&&t(1,i=s.selected.map(({id:m})=>u.getAnnotation(m))),r.$$.dirty&2&&t(2,n=i.length>1?d(i):void 0)},[l,i,n,c,o,s,p]}class mD extends qi{constructor(e){super(),Yi(this,e,pD,fD,Oi,{state:4,viewer:0})}}const Qx=(r,e)=>{e==="auto"?r.addHandler("open",t=>{const i=r.world.getItemCount();r.world.getItemAt(i-1).addOnceHandler("fully-loaded-change",n=>{const{fullyLoaded:s}=n;if(s){const o=r.canvas.querySelector("canvas"),l=$b(o);r.element.setAttribute("data-theme",l)}})}):r.element.setAttribute("data-theme",e)},xw=(r,e,t)=>(i,n={})=>{const s=typeof i=="string"?i:i.id,o=e.getAnnotation(s);if(!o||!Ls(o))return;const l=r.container.getBoundingClientRect(),{padding:u}=n;let[c,d,p,m]=u?Array.isArray(u)?u:[u,u,u,u]:[0,0,0,0];c=c/l.height,d=d/l.width,p=p/l.height,m=m/l.width;const{minX:y,minY:v,maxX:_,maxY:T}=o.target.selector.geometry.bounds,E=_-y,S=T-v,A=y-m*E,P=v-c*S,D=E+(d+m)*E,k=S+(c+p)*S,U=r.viewport.imageToViewportRectangle(A,P,D,k);r.viewport[t](U,n.immediately)},gD=(r,e)=>xw(r,e,"fitBounds"),yD=(r,e)=>xw(r,e,"fitBoundsWithConstraints"),vD=(r,e={})=>{const t=eC(e,{drawingEnabled:!1,drawingMode:y0?"drag":"click",userSelectAction:s0.EDIT,theme:"light"}),i=Kb(t),{hover:n,selection:s,store:o}=i,l=qS(o,t.initialHistory),u=ZS(i,l,t.adapter,t.autoSave);let c=rA(),d=t.drawingEnabled,p=t.drawingMode,m=t.modalSelect;const y=tC(l,r.element),v=new Y2({target:r.element,props:{state:i,viewer:r,style:t.style,filter:void 0}}),_=new JN({target:r.element.querySelector(".openseadragon-canvas"),props:{provider:void 0,store:o,viewer:r}}),T=new BN({target:r.element.querySelector(".openseadragon-canvas"),props:{drawingEnabled:!!d,filter:void 0,multiSelect:t.multiSelect,preferredDrawingMode:p,state:i,style:t.style,user:c,viewer:r}}),E=new mD({target:r.element.querySelector(".openseadragon-canvas"),props:{state:i,viewer:r}});v.$on("click",N=>{const{originalEvent:W,annotation:re}=N.detail,_e=me=>vw(me.id,W,s,t.multiSelect);m?s.isEmpty()&&re&&s.userSelect(_e(re),W):re&&!(p==="click"&&d)?s.userSelect(_e(re),W):s.isEmpty()||s.clear()}),r.element.addEventListener("pointerdown",N=>{if(n.current){const W=o.getAnnotation(n.current);u.emit("clickAnnotation",W,N)}}),Qx(r,t.theme);const S=KS(i,l,t.adapter),A=()=>T.cancelDrawing(),P=()=>{v.$destroy(),_.$destroy(),T.$destroy(),E.$destroy(),y.destroy(),l.destroy()},D=gD(r,o),k=yD(r,o),U=()=>T.getDrawingTool(),j=()=>c,q=()=>T.isDrawingEnabled(),ee=(N,W,re)=>Gb(N,W,re),pe=(N,W)=>Ob(N,W),H=N=>{if(!x0(N))throw`No drawing tool named ${N}`;T.$set({toolName:N})},F=N=>{d=N,T.$set({drawingEnabled:N})},G=N=>{v.$set({filter:N}),T.$set({filter:N})},$=N=>m=N,le=N=>{v.$set({style:N}),T.$set({style:N})},ie=N=>_.$set({provider:N}),Y=N=>Qx(r,N),de=N=>{c=N,T.$set({user:N})},z=N=>v.$set({visible:N});return{...S,cancelDrawing:A,destroy:P,fitBounds:D,fitBoundsWithConstraints:k,getDrawingTool:U,getUser:j,isDrawingEnabled:q,listDrawingTools:_0,on:u.on,off:u.off,registerDrawingTool:ee,registerShapeEditor:pe,setDrawingEnabled:F,setDrawingTool:H,setFilter:G,setModalSelect:$,setPresenceProvider:ie,setStyle:le,setTheme:Y,setUser:de,setVisible:z,state:i,viewer:r}},Tm=dt.createContext({viewer:null,setViewer:null}),OD=dt.forwardRef((r,e)=>{const{children:t,tool:i,...n}=r,[s,o]=dt.useState(),{anno:l,setAnno:u}=dt.useContext(Zp);return dt.useImperativeHandle(e,()=>l,[l]),dt.useEffect(()=>{if(s!=null&&s.element){const c=vD(s,n);return u(c),()=>{c.destroy(),u(void 0)}}},[s]),dt.useEffect(()=>{l&&l.setDrawingEnabled(r.drawingEnabled)},[l,r.drawingEnabled]),dt.useEffect(()=>{l&&l.setFilter(r.filter)},[l,r.filter]),dt.useEffect(()=>{l&&l.setStyle(r.style)},[l,r.style]),dt.useEffect(()=>{l&&l.setDrawingTool(i||"rectangle")},[l,i]),dt.useEffect(()=>{l&&l.setModalSelect(r.modalSelect)},[l,r.modalSelect]),dt.useEffect(()=>{l&&(r.user?l.setUser(r.user):l.setUser(B1()))},[l,r.user]),dt.useEffect(()=>{l&&l.setUserSelectAction(r.userSelectAction)},[l,r.userSelectAction]),qp.jsx(Tm.Provider,{value:{viewer:s,setViewer:o},children:r.children})}),ID=()=>{const{viewer:r}=dt.useContext(Tm);return r},MD=dt.forwardRef((r,e)=>{const{className:t,options:i}=r,n=dt.useRef(null),{viewer:s,setViewer:o}=dt.useContext(Tm);return dt.useLayoutEffect(()=>{if(n.current){const l=el({...i,element:n.current});return o&&o(l),()=>{o&&o(void 0),l.destroy()}}},[JSON.stringify(i)]),dt.useImperativeHandle(e,()=>s),qp.jsx("div",{className:t,ref:n})});export{A1 as K,SD as L,k1 as M,I1 as O,E1 as R,MD as S,ID as U,w1 as a,dt as b,_D as c,S1 as d,xD as e,wD as f,Wp as g,el as h,ED as i,qp as j,OD as k,AD as p,Yp as r,TD as s,CD as u};
